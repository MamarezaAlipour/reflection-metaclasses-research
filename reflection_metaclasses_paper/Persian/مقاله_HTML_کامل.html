<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="محمدرضا علی‌پور" />
  <title>بازتاب و متاکلاس‌های C++23</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {  background-color: #f8f8f8; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ef2929; } /* Alert */
    code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #204a87; } /* Attribute */
    code span.bn { color: #0000cf; } /* BaseN */
    code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4e9a06; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #8f5902; font-style: italic; } /* Comment */
    code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
    code span.dt { color: #204a87; } /* DataType */
    code span.dv { color: #0000cf; } /* DecVal */
    code span.er { color: #a40000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #0000cf; } /* Float */
    code span.fu { color: #204a87; font-weight: bold; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
    code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
    code span.ot { color: #8f5902; } /* Other */
    code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
    code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
    code span.ss { color: #4e9a06; } /* SpecialString */
    code span.st { color: #4e9a06; } /* String */
    code span.va { color: #000000; } /* Variable */
    code span.vs { color: #4e9a06; } /* VerbatimString */
    code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="style.css" />
  
  
  
  
  
  
  
  
  
  
  
</head>
<body>
<header id="title-block-header">
<h1 class="title">بازتاب و متاکلاس‌های C++23</h1>
<p class="subtitle">تحلیل جامع بازتاب استاتیک و الگوهای طراحی
متاکلاس</p>
<p class="author">محمدرضا علی‌پور</p>
<p class="date">آگوست 2025</p>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#چکیده" id="toc-چکیده"><span
class="toc-section-number">1</span> چکیده</a></li>
<li><a href="#بازتاب-و-متاکلاسها-در-c23-آینده-برنامهنویسی-عمومی"
id="toc-بازتاب-و-متاکلاسها-در-c23-آینده-برنامهنویسی-عمومی"><span
class="toc-section-number">2</span> بازتاب و متاکلاس‌ها در C++23: آینده
برنامه‌نویسی عمومی</a>
<ul>
<li><a href="#تحلیل-جامع-بازتاب-استاتیک-و-الگوهای-طراحی-متاکلاس"
id="toc-تحلیل-جامع-بازتاب-استاتیک-و-الگوهای-طراحی-متاکلاس"><span
class="toc-section-number">2.1</span> تحلیل جامع بازتاب استاتیک و
الگوهای طراحی متاکلاس</a></li>
<li><a href="#چکیده-1" id="toc-چکیده-1"><span
class="toc-section-number">2.2</span> چکیده</a></li>
<li><a href="#مقدمه" id="toc-مقدمه"><span
class="toc-section-number">2.3</span> 1. مقدمه</a>
<ul>
<li><a href="#تکامل-متابرنامهنویسی-c"
id="toc-تکامل-متابرنامهنویسی-c"><span
class="toc-section-number">2.3.1</span> 1.1 تکامل متابرنامه‌نویسی
C++</a></li>
<li><a href="#محدودیتهای-روشهای-فعلی-مبتنی-بر-قالب"
id="toc-محدودیتهای-روشهای-فعلی-مبتنی-بر-قالب"><span
class="toc-section-number">2.3.2</span> 1.2 محدودیت‌های روش‌های فعلی مبتنی
بر قالب</a></li>
<li><a href="#وعده-بازتاب-استاتیک" id="toc-وعده-بازتاب-استاتیک"><span
class="toc-section-number">2.3.3</span> 1.3 وعده بازتاب استاتیک</a></li>
<li><a href="#اهداف-تحقیق-و-مشارکتها"
id="toc-اهداف-تحقیق-و-مشارکتها"><span
class="toc-section-number">2.3.4</span> 1.4 اهداف تحقیق و
مشارکت‌ها</a></li>
<li><a href="#روششناسی" id="toc-روششناسی"><span
class="toc-section-number">2.3.5</span> 1.5 روش‌شناسی</a></li>
<li><a href="#سازماندهی-مقاله" id="toc-سازماندهی-مقاله"><span
class="toc-section-number">2.3.6</span> 1.6 سازماندهی مقاله</a></li>
</ul></li>
<li><a href="#تکامل-متابرنامهنویسی-c-c11-تا-c20"
id="toc-تکامل-متابرنامهنویسی-c-c11-تا-c20"><span
class="toc-section-number">2.4</span> 2.1 تکامل متابرنامه‌نویسی C++
(C++11 تا C++20)</a>
<ul>
<li><a href="#انقلاب-قالب-c11" id="toc-انقلاب-قالب-c11"><span
class="toc-section-number">2.4.1</span> 2.1.1 انقلاب قالب
(C++11)</a></li>
<li><a href="#تسلط-type-traits-و-sfinae-c14"
id="toc-تسلط-type-traits-و-sfinae-c14"><span
class="toc-section-number">2.4.2</span> 2.1.2 تسلط Type Traits و SFINAE
(C++14)</a></li>
<li><a href="#کانسپتها-و-محدودیتها-c20"
id="toc-کانسپتها-و-محدودیتها-c20"><span
class="toc-section-number">2.4.3</span> 2.1.3 کانسپت‌ها و محدودیت‌ها
(C++20)</a></li>
<li><a href="#محدودیتهای-متابرنامهنویسی-قالب"
id="toc-محدودیتهای-متابرنامهنویسی-قالب"><span
class="toc-section-number">2.4.4</span> 2.1.4 محدودیت‌های متابرنامه‌نویسی
قالب</a></li>
</ul></li>
<li><a href="#مکانیزمهای-بازتاب-در-زبانهای-دیگر"
id="toc-مکانیزمهای-بازتاب-در-زبانهای-دیگر"><span
class="toc-section-number">2.5</span> 2.2 مکانیزم‌های بازتاب در زبان‌های
دیگر</a>
<ul>
<li><a href="#بازتاب-جاوا-java.lang.reflect"
id="toc-بازتاب-جاوا-java.lang.reflect"><span
class="toc-section-number">2.5.1</span> 2.2.1 بازتاب جاوا
(java.lang.reflect)</a></li>
<li><a href="#بازتاب-c-system.reflection"
id="toc-بازتاب-c-system.reflection"><span
class="toc-section-number">2.5.2</span> 2.2.2 بازتاب C#
(System.Reflection)</a></li>
<li><a href="#ماکروهای-رویهای-rust" id="toc-ماکروهای-رویهای-rust"><span
class="toc-section-number">2.5.3</span> 2.2.3 ماکروهای رویه‌ای
Rust</a></li>
<li><a href="#بازتاب-زمان-کامپایل-زبان-d"
id="toc-بازتاب-زمان-کامپایل-زبان-d"><span
class="toc-section-number">2.5.4</span> 2.2.4 بازتاب زمان کامپایل زبان
D</a></li>
</ul></li>
<li><a href="#پیشنهادهای-قبلی-بازتاب-c"
id="toc-پیشنهادهای-قبلی-بازتاب-c"><span
class="toc-section-number">2.6</span> 2.3 پیشنهادهای قبلی بازتاب C++</a>
<ul>
<li><a href="#p0194-پیشنهاد-بازتاب-استاتیک"
id="toc-p0194-پیشنهاد-بازتاب-استاتیک"><span
class="toc-section-number">2.6.1</span> 2.3.1 P0194: پیشنهاد بازتاب
استاتیک</a></li>
<li><a href="#p0385-منطق-بازتاب-استاتیک"
id="toc-p0385-منطق-بازتاب-استاتیک"><span
class="toc-section-number">2.6.2</span> 2.3.2 P0385: منطق بازتاب
استاتیک</a></li>
<li><a href="#p0707-پیشنهاد-متاکلاسها"
id="toc-p0707-پیشنهاد-متاکلاسها"><span
class="toc-section-number">2.6.3</span> 2.3.3 P0707: پیشنهاد
متاکلاس‌ها</a></li>
<li><a href="#تکامل-از-طریق-فرآیند-کمیته"
id="toc-تکامل-از-طریق-فرآیند-کمیته"><span
class="toc-section-number">2.6.4</span> 2.3.4 تکامل از طریق فرآیند
کمیته</a></li>
</ul></li>
<li><a href="#تحلیل-مقایسهای" id="toc-تحلیل-مقایسهای"><span
class="toc-section-number">2.7</span> 2.4 تحلیل مقایسه‌ای</a>
<ul>
<li><a href="#بازتاب-استاتیک-در-مقابل-پویا"
id="toc-بازتاب-استاتیک-در-مقابل-پویا"><span
class="toc-section-number">2.7.1</span> 2.4.1 بازتاب استاتیک در مقابل
پویا</a></li>
<li><a href="#یکپارچگی-زبان" id="toc-یکپارچگی-زبان"><span
class="toc-section-number">2.7.2</span> 2.4.2 یکپارچگی زبان</a></li>
<li><a href="#تأثیر-اکوسیستم" id="toc-تأثیر-اکوسیستم"><span
class="toc-section-number">2.7.3</span> 2.4.3 تأثیر اکوسیستم</a></li>
</ul></li>
<li><a href="#شکافهای-تحقیق-و-فرصتها"
id="toc-شکافهای-تحقیق-و-فرصتها"><span
class="toc-section-number">2.8</span> 2.5 شکاف‌های تحقیق و
فرصت‌ها</a></li>
<li><a href="#مفاهیم-اصلی-بازتاب" id="toc-مفاهیم-اصلی-بازتاب"><span
class="toc-section-number">2.9</span> 3.1 مفاهیم اصلی بازتاب</a>
<ul>
<li><a href="#پروتکل-متا-آبجکت" id="toc-پروتکل-متا-آبجکت"><span
class="toc-section-number">2.9.1</span> 3.1.1 پروتکل متا-آبجکت</a></li>
<li><a href="#کوئریها-و-عملیات-بازتاب"
id="toc-کوئریها-و-عملیات-بازتاب"><span
class="toc-section-number">2.9.2</span> 3.1.2 کوئری‌ها و عملیات
بازتاب</a></li>
<li><a href="#سکانسهای-متا-آبجکت" id="toc-سکانسهای-متا-آبجکت"><span
class="toc-section-number">2.9.3</span> 3.1.3 سکانس‌های
متا-آبجکت</a></li>
</ul></li>
<li><a href="#اصول-طراحی-api-بازتاب"
id="toc-اصول-طراحی-api-بازتاب"><span
class="toc-section-number">2.10</span> 3.2 اصول طراحی API بازتاب</a>
<ul>
<li><a href="#ایمنی-نوع-و-تأیید-زمان-کامپایل"
id="toc-ایمنی-نوع-و-تأیید-زمان-کامپایل"><span
class="toc-section-number">2.10.1</span> 3.2.1 ایمنی نوع و تأیید زمان
کامپایل</a></li>
<li><a href="#یکپارچگی-با-ویژگیهای-موجود-زبان"
id="toc-یکپارچگی-با-ویژگیهای-موجود-زبان"><span
class="toc-section-number">2.10.2</span> 3.2.2 یکپارچگی با ویژگی‌های
موجود زبان</a></li>
<li><a href="#طراحی-عملکرد-محور" id="toc-طراحی-عملکرد-محور"><span
class="toc-section-number">2.10.3</span> 3.2.3 طراحی
عملکرد-محور</a></li>
</ul></li>
<li><a href="#یکپارچگی-با-سیستم-قالب-موجود"
id="toc-یکپارچگی-با-سیستم-قالب-موجود"><span
class="toc-section-number">2.11</span> 3.3 یکپارچگی با سیستم قالب
موجود</a>
<ul>
<li><a href="#بهبود-استنتاج-پارامتر-قالب"
id="toc-بهبود-استنتاج-پارامتر-قالب"><span
class="toc-section-number">2.11.1</span> 3.3.1 بهبود استنتاج پارامتر
قالب</a></li>
<li><a href="#بهبود-قالب-variadic" id="toc-بهبود-قالب-variadic"><span
class="toc-section-number">2.11.2</span> 3.3.2 بهبود قالب
Variadic</a></li>
<li><a href="#کاهش-تخصصیابی-قالب" id="toc-کاهش-تخصصیابی-قالب"><span
class="toc-section-number">2.11.3</span> 3.3.3 کاهش تخصص‌یابی
قالب</a></li>
</ul></li>
<li><a href="#تحلیل-نحوی-و-معنایی" id="toc-تحلیل-نحوی-و-معنایی"><span
class="toc-section-number">2.12</span> 3.4 تحلیل نحوی و معنایی</a>
<ul>
<li><a href="#عملگر-reflexpr" id="toc-عملگر-reflexpr"><span
class="toc-section-number">2.12.1</span> 3.4.1 عملگر reflexpr</a></li>
<li><a href="#پروتکلهای-متا-آبجکت" id="toc-پروتکلهای-متا-آبجکت"><span
class="toc-section-number">2.12.2</span> 3.4.2 پروتکل‌های
متا-آبجکت</a></li>
<li><a href="#زمینه-ارزیابی-constexpr"
id="toc-زمینه-ارزیابی-constexpr"><span
class="toc-section-number">2.12.3</span> 3.4.3 زمینه ارزیابی
Constexpr</a></li>
</ul></li>
<li><a href="#الگوهای-پیشرفته-بازتاب"
id="toc-الگوهای-پیشرفته-بازتاب"><span
class="toc-section-number">2.13</span> 3.5 الگوهای پیشرفته بازتاب</a>
<ul>
<li><a href="#کامپایل-شرطی-بر-اساس-ساختار-نوع"
id="toc-کامپایل-شرطی-بر-اساس-ساختار-نوع"><span
class="toc-section-number">2.13.1</span> 3.5.1 کامپایل شرطی بر اساس
ساختار نوع</a></li>
<li><a href="#تطبیق-نوع-و-تولید-پراکسی"
id="toc-تطبیق-نوع-و-تولید-پراکسی"><span
class="toc-section-number">2.13.2</span> 3.5.2 تطبیق نوع و تولید
پراکسی</a></li>
<li><a href="#پیادهسازی-الگوی-طراحی-زمان-کامپایل"
id="toc-پیادهسازی-الگوی-طراحی-زمان-کامپایل"><span
class="toc-section-number">2.13.3</span> 3.5.3 پیاده‌سازی الگوی طراحی
زمان کامپایل</a></li>
</ul></li>
<li><a href="#ملاحظات-پیادهسازی-کامپایلر"
id="toc-ملاحظات-پیادهسازی-کامپایلر"><span
class="toc-section-number">2.14</span> 3.6 ملاحظات پیاده‌سازی
کامپایلر</a>
<ul>
<li><a href="#یکپارچگی-فاز-کامپایل" id="toc-یکپارچگی-فاز-کامپایل"><span
class="toc-section-number">2.14.1</span> 3.6.1 یکپارچگی فاز
کامپایل</a></li>
<li><a href="#اطلاعات-دیباگ-و-یکپارچگی-ابزار"
id="toc-اطلاعات-دیباگ-و-یکپارچگی-ابزار"><span
class="toc-section-number">2.14.2</span> 3.6.2 اطلاعات دیباگ و یکپارچگی
ابزار</a></li>
<li><a href="#فرصتهای-بهینهسازی" id="toc-فرصتهای-بهینهسازی"><span
class="toc-section-number">2.14.3</span> 3.6.3 فرصت‌های
بهینه‌سازی</a></li>
</ul></li>
<li><a href="#مفهوم-و-انگیزه-متاکلاس"
id="toc-مفهوم-و-انگیزه-متاکلاس"><span
class="toc-section-number">2.15</span> 4.1 مفهوم و انگیزه متاکلاس</a>
<ul>
<li><a href="#چشمانداز-برنامهنویسی-تولیدی"
id="toc-چشمانداز-برنامهنویسی-تولیدی"><span
class="toc-section-number">2.15.1</span> 4.1.1 چشم‌انداز برنامه‌نویسی
تولیدی</a></li>
<li><a href="#فلسفه-و-اصول-طراحی" id="toc-فلسفه-و-اصول-طراحی"><span
class="toc-section-number">2.15.2</span> 4.1.2 فلسفه و اصول
طراحی</a></li>
<li><a href="#رابطه-با-بازتاب" id="toc-رابطه-با-بازتاب"><span
class="toc-section-number">2.15.3</span> 4.1.3 رابطه با بازتاب</a></li>
</ul></li>
<li><a href="#نحو-تعریف-متاکلاس" id="toc-نحو-تعریف-متاکلاس"><span
class="toc-section-number">2.16</span> 4.2 نحو تعریف متاکلاس</a>
<ul>
<li><a href="#اعلان-پایه-متاکلاس" id="toc-اعلان-پایه-متاکلاس"><span
class="toc-section-number">2.16.1</span> 4.2.1 اعلان پایه
متاکلاس</a></li>
<li><a href="#متاکلاسهای-پارامتری" id="toc-متاکلاسهای-پارامتری"><span
class="toc-section-number">2.16.2</span> 4.2.2 متاکلاس‌های
پارامتری</a></li>
<li><a href="#اعمال-شرطی-متاکلاس" id="toc-اعمال-شرطی-متاکلاس"><span
class="toc-section-number">2.16.3</span> 4.2.3 اعمال شرطی
متاکلاس</a></li>
</ul></li>
<li><a href="#مکانیزمهای-تولید-کد" id="toc-مکانیزمهای-تولید-کد"><span
class="toc-section-number">2.17</span> 4.3 مکانیزم‌های تولید کد</a>
<ul>
<li><a href="#رابط-کامپایلر" id="toc-رابط-کامپایلر"><span
class="toc-section-number">2.17.1</span> 4.3.1 رابط کامپایلر</a></li>
<li><a href="#تولید-کد-مبتنی-بر-قالب"
id="toc-تولید-کد-مبتنی-بر-قالب"><span
class="toc-section-number">2.17.2</span> 4.3.2 تولید کد مبتنی بر
قالب</a></li>
<li><a href="#الگوهای-پیشرفته-سنتز-کد"
id="toc-الگوهای-پیشرفته-سنتز-کد"><span
class="toc-section-number">2.17.3</span> 4.3.3 الگوهای پیشرفته سنتز
کد</a></li>
</ul></li>
<li><a href="#الگوهای-پیشرفته-متاکلاس"
id="toc-الگوهای-پیشرفته-متاکلاس"><span
class="toc-section-number">2.18</span> 4.4 الگوهای پیشرفته متاکلاس</a>
<ul>
<li><a href="#تولید-و-پیادهسازی-رابط"
id="toc-تولید-و-پیادهسازی-رابط"><span
class="toc-section-number">2.18.1</span> 4.4.1 تولید و پیاده‌سازی
رابط</a></li>
<li><a href="#تولید-چارچوب-سریالسازی"
id="toc-تولید-چارچوب-سریالسازی"><span
class="toc-section-number">2.18.2</span> 4.4.2 تولید چارچوب
سریال‌سازی</a></li>
<li><a href="#orm-و-یکپارچگی-پایگاه-داده"
id="toc-orm-و-یکپارچگی-پایگاه-داده"><span
class="toc-section-number">2.18.3</span> 4.4.3 ORM و یکپارچگی پایگاه
داده</a></li>
<li><a href="#اتوماسیون-الگوی-طراحی"
id="toc-اتوماسیون-الگوی-طراحی"><span
class="toc-section-number">2.18.4</span> 4.4.4 اتوماسیون الگوی
طراحی</a></li>
</ul></li>
<li><a href="#ترکیب-و-تعامل-متاکلاس"
id="toc-ترکیب-و-تعامل-متاکلاس"><span
class="toc-section-number">2.19</span> 4.5 ترکیب و تعامل متاکلاس</a>
<ul>
<li><a href="#معناشناسی-ترکیب" id="toc-معناشناسی-ترکیب"><span
class="toc-section-number">2.19.1</span> 4.5.1 معناشناسی ترکیب</a></li>
<li><a href="#ارتباط-بین-متاکلاسها" id="toc-ارتباط-بین-متاکلاسها"><span
class="toc-section-number">2.19.2</span> 4.5.2 ارتباط بین
متاکلاس‌ها</a></li>
<li><a href="#وابستگیها-و-ترتیب-متاکلاس"
id="toc-وابستگیها-و-ترتیب-متاکلاس"><span
class="toc-section-number">2.19.3</span> 4.5.3 وابستگی‌ها و ترتیب
متاکلاس</a></li>
</ul></li>
<li><a href="#مدیریت-خطا-و-تشخیص" id="toc-مدیریت-خطا-و-تشخیص"><span
class="toc-section-number">2.20</span> 4.6 مدیریت خطا و تشخیص</a>
<ul>
<li><a href="#اعتبارسنجی-زمان-کامپایل"
id="toc-اعتبارسنجی-زمان-کامپایل"><span
class="toc-section-number">2.20.1</span> 4.6.1 اعتبارسنجی زمان
کامپایل</a></li>
<li><a href="#تولید-پیام-تشخیصی" id="toc-تولید-پیام-تشخیصی"><span
class="toc-section-number">2.20.2</span> 4.6.2 تولید پیام
تشخیصی</a></li>
</ul></li>
<li><a href="#تحلیل-زمان-کامپایل" id="toc-تحلیل-زمان-کامپایل"><span
class="toc-section-number">2.21</span> 5.1 تحلیل زمان کامپایل</a>
<ul>
<li><a href="#روششناسی-و-راهاندازی-آزمایشی"
id="toc-روششناسی-و-راهاندازی-آزمایشی"><span
class="toc-section-number">2.21.1</span> 5.1.1 روش‌شناسی و راه‌اندازی
آزمایشی</a></li>
<li><a href="#instantiation-قالب-در-مقابل-تولید-مبتنی-بر-بازتاب"
id="toc-instantiation-قالب-در-مقابل-تولید-مبتنی-بر-بازتاب"><span
class="toc-section-number">2.21.2</span> 5.1.2 Instantiation قالب در
مقابل تولید مبتنی بر بازتاب</a></li>
<li><a href="#استفاده-از-حافظه-طی-کامپایل"
id="toc-استفاده-از-حافظه-طی-کامپایل"><span
class="toc-section-number">2.21.3</span> 5.1.3 استفاده از حافظه طی
کامپایل</a></li>
<li><a href="#تحلیل-مقیاسپذیری" id="toc-تحلیل-مقیاسپذیری"><span
class="toc-section-number">2.21.4</span> 5.1.4 تحلیل مقیاس‌پذیری</a></li>
</ul></li>
<li><a href="#پیامدهای-عملکرد-زمان-اجرا"
id="toc-پیامدهای-عملکرد-زمان-اجرا"><span
class="toc-section-number">2.22</span> 5.2 پیامدهای عملکرد زمان اجرا</a>
<ul>
<li><a href="#اعتبارسنجی-سربار-صفر" id="toc-اعتبارسنجی-سربار-صفر"><span
class="toc-section-number">2.22.1</span> 5.2.1 اعتبارسنجی سربار
صفر</a></li>
<li><a href="#تحلیل-کد-اسمبلی" id="toc-تحلیل-کد-اسمبلی"><span
class="toc-section-number">2.22.2</span> 5.2.2 تحلیل کد اسمبلی</a></li>
<li><a href="#تحلیل-عملکرد-کش" id="toc-تحلیل-عملکرد-کش"><span
class="toc-section-number">2.22.3</span> 5.2.3 تحلیل عملکرد کش</a></li>
</ul></li>
<li><a href="#تأثیر-اندازه-باینری" id="toc-تأثیر-اندازه-باینری"><span
class="toc-section-number">2.23</span> 5.3 تأثیر اندازه باینری</a>
<ul>
<li><a href="#تحلیل-اندازه-کد" id="toc-تحلیل-اندازه-کد"><span
class="toc-section-number">2.23.1</span> 5.3.1 تحلیل اندازه کد</a></li>
<li><a href="#کاهش-نفخ-instantiation-قالب"
id="toc-کاهش-نفخ-instantiation-قالب"><span
class="toc-section-number">2.23.2</span> 5.3.2 کاهش نفخ Instantiation
قالب</a></li>
</ul></li>
<li><a href="#روششناسی-آزمایش-مقایسهای-و-تحلیل-آماری"
id="toc-روششناسی-آزمایش-مقایسهای-و-تحلیل-آماری"><span
class="toc-section-number">2.24</span> 5.4 روش‌شناسی آزمایش مقایسه‌ای و
تحلیل آماری</a>
<ul>
<li><a href="#دقت-آماری-و-تکرارپذیری"
id="toc-دقت-آماری-و-تکرارپذیری"><span
class="toc-section-number">2.24.1</span> 5.4.1 دقت آماری و
تکرارپذیری</a></li>
<li><a href="#اعتبارسنجی-چندپلتفرمه"
id="toc-اعتبارسنجی-چندپلتفرمه"><span
class="toc-section-number">2.24.2</span> 5.4.2 اعتبارسنجی
چندپلتفرمه</a></li>
</ul></li>
<li><a href="#مقایسه-با-رویکردهای-سنتی"
id="toc-مقایسه-با-رویکردهای-سنتی"><span
class="toc-section-number">2.25</span> 5.5 مقایسه با رویکردهای سنتی</a>
<ul>
<li><a href="#مقایسه-جامع-ویژگیها" id="toc-مقایسه-جامع-ویژگیها"><span
class="toc-section-number">2.25.1</span> 5.5.1 مقایسه جامع
ویژگی‌ها</a></li>
<li><a href="#معیارهای-بهرهوری-توسعه"
id="toc-معیارهای-بهرهوری-توسعه"><span
class="toc-section-number">2.25.2</span> 5.5.2 معیارهای بهره‌وری
توسعه</a></li>
</ul></li>
<li><a href="#چارچوب-سریالسازی-خودکار"
id="toc-چارچوب-سریالسازی-خودکار"><span
class="toc-section-number">2.26</span> 6.1 چارچوب سریال‌سازی خودکار</a>
<ul>
<li><a href="#بیان-مسئله-و-الزامات" id="toc-بیان-مسئله-و-الزامات"><span
class="toc-section-number">2.26.1</span> 6.1.1 بیان مسئله و
الزامات</a></li>
<li><a href="#معماری-و-طراحی" id="toc-معماری-و-طراحی"><span
class="toc-section-number">2.26.2</span> 6.1.2 معماری و طراحی</a></li>
<li><a href="#پیادهسازی-و-استفاده" id="toc-پیادهسازی-و-استفاده"><span
class="toc-section-number">2.26.3</span> 6.1.3 پیاده‌سازی و
استفاده</a></li>
<li><a href="#ارزیابی-عملکرد" id="toc-ارزیابی-عملکرد"><span
class="toc-section-number">2.26.4</span> 6.1.4 ارزیابی عملکرد</a></li>
</ul></li>
<li><a href="#پیادهسازی-پایگاه-داده-orm"
id="toc-پیادهسازی-پایگاه-داده-orm"><span
class="toc-section-number">2.27</span> 6.2 پیاده‌سازی پایگاه داده ORM</a>
<ul>
<li><a href="#چالشهای-نگاشت-آبجکت-رابطهای"
id="toc-چالشهای-نگاشت-آبجکت-رابطهای"><span
class="toc-section-number">2.27.1</span> 6.2.1 چالش‌های نگاشت
آبجکت-رابطه‌ای</a></li>
<li><a href="#طراحی-orm-مبتنی-بر-بازتاب"
id="toc-طراحی-orm-مبتنی-بر-بازتاب"><span
class="toc-section-number">2.27.2</span> 6.2.2 طراحی ORM مبتنی بر
بازتاب</a></li>
<li><a href="#مثالهای-استفاده-و-ایمنی-نوع"
id="toc-مثالهای-استفاده-و-ایمنی-نوع"><span
class="toc-section-number">2.27.3</span> 6.2.3 مثال‌های استفاده و ایمنی
نوع</a></li>
<li><a href="#مزایای-عملکرد-و-مهاجرت"
id="toc-مزایای-عملکرد-و-مهاجرت"><span
class="toc-section-number">2.27.4</span> 6.2.4 مزایای عملکرد و
مهاجرت</a></li>
</ul></li>
<li><a href="#چارچوب-gui-با-اتصال-خودکار"
id="toc-چارچوب-gui-با-اتصال-خودکار"><span
class="toc-section-number">2.28</span> 6.3 چارچوب GUI با اتصال
خودکار</a>
<ul>
<li><a href="#برنامهنویسی-اعلانی-ui"
id="toc-برنامهنویسی-اعلانی-ui"><span
class="toc-section-number">2.28.1</span> 6.3.1 برنامه‌نویسی اعلانی
UI</a></li>
<li><a href="#تولید-فرم-و-اعتبارسنجی"
id="toc-تولید-فرم-و-اعتبارسنجی"><span
class="toc-section-number">2.28.2</span> 6.3.2 تولید فرم و
اعتبارسنجی</a></li>
</ul></li>
<li><a href="#تولید-چارچوب-آزمون" id="toc-تولید-چارچوب-آزمون"><span
class="toc-section-number">2.29</span> 6.4 تولید چارچوب آزمون</a>
<ul>
<li><a href="#تولید-خودکار-مورد-آزمون"
id="toc-تولید-خودکار-مورد-آزمون"><span
class="toc-section-number">2.29.1</span> 6.4.1 تولید خودکار مورد
آزمون</a></li>
<li><a href="#یکپارچگی-آزمایش-مبتنی-بر-خصوصیت"
id="toc-یکپارچگی-آزمایش-مبتنی-بر-خصوصیت"><span
class="toc-section-number">2.29.2</span> 6.4.2 یکپارچگی آزمایش مبتنی بر
خصوصیت</a></li>
</ul></li>
<li><a href="#پیادهسازی-الگوهای-طراحی"
id="toc-پیادهسازی-الگوهای-طراحی"><span
class="toc-section-number">2.30</span> 6.5 پیاده‌سازی الگوهای طراحی</a>
<ul>
<li><a href="#الگوی-observer-خودکار"
id="toc-الگوی-observer-خودکار"><span
class="toc-section-number">2.30.1</span> 6.5.1 الگوی Observer
خودکار</a></li>
<li><a href="#اتوماسیون-الگوی-visitor"
id="toc-اتوماسیون-الگوی-visitor"><span
class="toc-section-number">2.30.2</span> 6.5.2 اتوماسیون الگوی
Visitor</a></li>
</ul></li>
<li><a href="#تعامل-concept-ها-و-بازتاب"
id="toc-تعامل-concept-ها-و-بازتاب"><span
class="toc-section-number">2.31</span> 7.1 تعامل Concept ها و بازتاب</a>
<ul>
<li><a href="#بازتاب-محدود-شده-توسط-concept"
id="toc-بازتاب-محدود-شده-توسط-concept"><span
class="toc-section-number">2.31.1</span> 7.1.1 بازتاب محدود شده توسط
Concept</a></li>
<li><a href="#تعاریف-concept-تقویت-شده-با-بازتاب"
id="toc-تعاریف-concept-تقویت-شده-با-بازتاب"><span
class="toc-section-number">2.31.2</span> 7.1.2 تعاریف Concept تقویت شده
با بازتاب</a></li>
<li><a href="#اعتبارسنجی-زمان-کامپایل-با-concept-ها-و-بازتاب"
id="toc-اعتبارسنجی-زمان-کامپایل-با-concept-ها-و-بازتاب"><span
class="toc-section-number">2.31.3</span> 7.1.3 اعتبارسنجی زمان کامپایل
با Concept ها و بازتاب</a></li>
</ul></li>
<li><a href="#coroutine-ها-و-الگوهای-async-بازتابی"
id="toc-coroutine-ها-و-الگوهای-async-بازتابی"><span
class="toc-section-number">2.32</span> 7.2 Coroutine ها و الگوهای Async
بازتابی</a>
<ul>
<li><a href="#تولید-coroutine-راهبری-شده-توسط-بازتاب"
id="toc-تولید-coroutine-راهبری-شده-توسط-بازتاب"><span
class="toc-section-number">2.32.1</span> 7.2.1 تولید Coroutine راهبری
شده توسط بازتاب</a></li>
<li><a href="#جریان-رویداد-مبتنی-بر-بازتاب"
id="toc-جریان-رویداد-مبتنی-بر-بازتاب"><span
class="toc-section-number">2.32.2</span> 7.2.2 جریان رویداد مبتنی بر
بازتاب</a></li>
</ul></li>
<li><a href="#یکپارچگی-سیستم-module-ها"
id="toc-یکپارچگی-سیستم-module-ها"><span
class="toc-section-number">2.33</span> 7.3 یکپارچگی سیستم Module ها</a>
<ul>
<li><a href="#بازتاب-آگاه-به-module"
id="toc-بازتاب-آگاه-به-module"><span
class="toc-section-number">2.33.1</span> 7.3.1 بازتاب آگاه به
Module</a></li>
<li><a href="#پشتیبانی-متاکلاس-بین-module-ها"
id="toc-پشتیبانی-متاکلاس-بین-module-ها"><span
class="toc-section-number">2.33.2</span> 7.3.2 پشتیبانی متاکلاس بین
Module ها</a></li>
</ul></li>
<li><a href="#فرصتهای-تقویت-کتابخانه-ranges"
id="toc-فرصتهای-تقویت-کتابخانه-ranges"><span
class="toc-section-number">2.34</span> 7.4 فرصت‌های تقویت کتابخانه
Ranges</a>
<ul>
<li><a href="#الگوریتمهای-range-تقویت-شده-با-بازتاب"
id="toc-الگوریتمهای-range-تقویت-شده-با-بازتاب"><span
class="toc-section-number">2.34.1</span> 7.4.1 الگوریتم‌های Range تقویت
شده با بازتاب</a></li>
<li><a href="#تولید-خودکار-آداپتور-range"
id="toc-تولید-خودکار-آداپتور-range"><span
class="toc-section-number">2.34.2</span> 7.4.2 تولید خودکار آداپتور
Range</a></li>
</ul></li>
<li><a href="#الگوهای-یکپارچگی-کتابخانه-استاندارد"
id="toc-الگوهای-یکپارچگی-کتابخانه-استاندارد"><span
class="toc-section-number">2.35</span> 7.5 الگوهای یکپارچگی کتابخانه
استاندارد</a>
<ul>
<li><a href="#کانتینرهای-آگاه-به-بازتاب"
id="toc-کانتینرهای-آگاه-به-بازتاب"><span
class="toc-section-number">2.35.1</span> 7.5.1 کانتینرهای آگاه به
بازتاب</a></li>
</ul></li>
<li><a href="#پیچیدگی-پیادهسازی-کامپایلر"
id="toc-پیچیدگی-پیادهسازی-کامپایلر"><span
class="toc-section-number">2.36</span> 8.1 پیچیدگی پیاده‌سازی
کامپایلر</a>
<ul>
<li><a href="#چالشهای-یکپارچگی-frontend"
id="toc-چالشهای-یکپارچگی-frontend"><span
class="toc-section-number">2.36.1</span> 8.1.1 چالش‌های یکپارچگی
Frontend</a></li>
<li><a href="#چالشهای-تولید-کد-backend"
id="toc-چالشهای-تولید-کد-backend"><span
class="toc-section-number">2.36.2</span> 8.1.2 چالش‌های تولید کد
Backend</a></li>
<li><a href="#ملاحظات-کامپایل-افزایشی"
id="toc-ملاحظات-کامپایل-افزایشی"><span
class="toc-section-number">2.36.3</span> 8.1.3 ملاحظات کامپایل
افزایشی</a></li>
</ul></li>
<li><a href="#دیباگ-کد-بازتابی" id="toc-دیباگ-کد-بازتابی"><span
class="toc-section-number">2.37</span> 8.2 دیباگ کد بازتابی</a>
<ul>
<li><a href="#چالشهای-نگاشت-کد-منبع"
id="toc-چالشهای-نگاشت-کد-منبع"><span
class="toc-section-number">2.37.1</span> 8.2.1 چالش‌های نگاشت کد
منبع</a></li>
<li><a href="#چالشهای-یکپارچگی-ide" id="toc-چالشهای-یکپارچگی-ide"><span
class="toc-section-number">2.37.2</span> 8.2.2 چالش‌های یکپارچگی
IDE</a></li>
</ul></li>
<li><a href="#کیفیت-پیام-خطا" id="toc-کیفیت-پیام-خطا"><span
class="toc-section-number">2.38</span> 8.3 کیفیت پیام خطا</a>
<ul>
<li><a href="#تکثیر-خطای-قالب" id="toc-تکثیر-خطای-قالب"><span
class="toc-section-number">2.38.1</span> 8.3.1 تکثیر خطای قالب</a></li>
<li><a href="#زمینه-خطای-متاکلاس" id="toc-زمینه-خطای-متاکلاس"><span
class="toc-section-number">2.38.2</span> 8.3.2 زمینه خطای
متاکلاس</a></li>
</ul></li>
<li><a href="#منحنی-یادگیری-و-موانع-پذیرش"
id="toc-منحنی-یادگیری-و-موانع-پذیرش"><span
class="toc-section-number">2.39</span> 8.4 منحنی یادگیری و موانع
پذیرش</a>
<ul>
<li><a href="#پیچیدگی-مفهومی" id="toc-پیچیدگی-مفهومی"><span
class="toc-section-number">2.39.1</span> 8.4.1 پیچیدگی مفهومی</a></li>
<li><a href="#استراتژیهای-مهاجرت" id="toc-استراتژیهای-مهاجرت"><span
class="toc-section-number">2.39.2</span> 8.4.2 استراتژی‌های
مهاجرت</a></li>
</ul></li>
<li><a href="#چالشهای-استانداردسازی"
id="toc-چالشهای-استانداردسازی"><span
class="toc-section-number">2.40</span> 8.5 چالش‌های استانداردسازی</a>
<ul>
<li><a href="#نگرانیهای-ثبات-abi" id="toc-نگرانیهای-ثبات-abi"><span
class="toc-section-number">2.40.1</span> 8.5.1 نگرانی‌های ثبات
ABI</a></li>
<li><a href="#سازگاری-بین-فروشندگان"
id="toc-سازگاری-بین-فروشندگان"><span
class="toc-section-number">2.40.2</span> 8.5.2 سازگاری بین
فروشندگان</a></li>
</ul></li>
<li><a href="#c26-و-فراتر-از-آن-گسترش-قابلیتهای-بازتاب"
id="toc-c26-و-فراتر-از-آن-گسترش-قابلیتهای-بازتاب"><span
class="toc-section-number">2.41</span> 9.1 C++26 و فراتر از آن: گسترش
قابلیت‌های بازتاب</a>
<ul>
<li><a href="#پیشنهادهای-بازتاب-پویا"
id="toc-پیشنهادهای-بازتاب-پویا"><span
class="toc-section-number">2.41.1</span> 9.1.1 پیشنهادهای بازتاب
پویا</a></li>
<li><a href="#ترکیب-پیشرفته-متاکلاس"
id="toc-ترکیب-پیشرفته-متاکلاس"><span
class="toc-section-number">2.41.2</span> 9.1.2 ترکیب پیشرفته
متاکلاس</a></li>
<li><a href="#تقویت-یکپارچگی-ماژول" id="toc-تقویت-یکپارچگی-ماژول"><span
class="toc-section-number">2.41.3</span> 9.1.3 تقویت یکپارچگی
ماژول</a></li>
</ul></li>
<li><a href="#یکپارچگی-با-تکنولوژیهای-نوظهور"
id="toc-یکپارچگی-با-تکنولوژیهای-نوظهور"><span
class="toc-section-number">2.42</span> 9.2 یکپارچگی با تکنولوژی‌های
نوظهور</a>
<ul>
<li><a href="#یادگیری-ماشین-و-تولید-کد"
id="toc-یادگیری-ماشین-و-تولید-کد"><span
class="toc-section-number">2.42.1</span> 9.2.1 یادگیری ماشین و تولید
کد</a></li>
<li><a href="#webassembly-و-اهداف-چندپلتفرمه"
id="toc-webassembly-و-اهداف-چندپلتفرمه"><span
class="toc-section-number">2.42.2</span> 9.2.2 WebAssembly و اهداف
چندپلتفرمه</a></li>
<li><a href="#سیستمهای-بلادرنگ-و-تعبیهشده"
id="toc-سیستمهای-بلادرنگ-و-تعبیهشده"><span
class="toc-section-number">2.42.3</span> 9.2.3 سیستم‌های بلادرنگ و
تعبیه‌شده</a></li>
</ul></li>
<li><a href="#تکامل-ابزارها-و-ide" id="toc-تکامل-ابزارها-و-ide"><span
class="toc-section-number">2.43</span> 9.3 تکامل ابزارها و IDE</a>
<ul>
<li><a href="#پشتیبانی-پیشرفته-دیباگ"
id="toc-پشتیبانی-پیشرفته-دیباگ"><span
class="toc-section-number">2.43.1</span> 9.3.1 پشتیبانی پیشرفته
دیباگ</a></li>
<li><a href="#تقویتهای-ide" id="toc-تقویتهای-ide"><span
class="toc-section-number">2.43.2</span> 9.3.2 تقویت‌های IDE</a></li>
<li><a href="#ابزارهای-تحلیل-کارایی"
id="toc-ابزارهای-تحلیل-کارایی"><span
class="toc-section-number">2.43.3</span> 9.3.3 ابزارهای تحلیل
کارایی</a></li>
</ul></li>
<li><a href="#خلاصه-یافتههای-کلیدی" id="toc-خلاصه-یافتههای-کلیدی"><span
class="toc-section-number">2.44</span> 10.1 خلاصه یافته‌های کلیدی</a>
<ul>
<li><a href="#دستاوردهای-فنی" id="toc-دستاوردهای-فنی"><span
class="toc-section-number">2.44.1</span> 10.1.1 دستاوردهای فنی</a></li>
<li><a href="#ارزیابی-تأثیر-عملی" id="toc-ارزیابی-تأثیر-عملی"><span
class="toc-section-number">2.44.2</span> 10.1.2 ارزیابی تأثیر
عملی</a></li>
</ul></li>
<li><a href="#پیامدها-برای-اکوسیستم-c"
id="toc-پیامدها-برای-اکوسیستم-c"><span
class="toc-section-number">2.45</span> 10.2 پیامدها برای اکوسیستم
C++</a>
<ul>
<li><a href="#انقلاب-توسعه-کتابخانه"
id="toc-انقلاب-توسعه-کتابخانه"><span
class="toc-section-number">2.45.1</span> 10.2.1 انقلاب توسعه
کتابخانه</a></li>
<li><a href="#تکامل-اکوسیستم-ابزار" id="toc-تکامل-اکوسیستم-ابزار"><span
class="toc-section-number">2.45.2</span> 10.2.2 تکامل اکوسیستم
ابزار</a></li>
<li><a href="#تأثیر-آموزشی-و-پذیرش" id="toc-تأثیر-آموزشی-و-پذیرش"><span
class="toc-section-number">2.45.3</span> 10.2.3 تأثیر آموزشی و
پذیرش</a></li>
</ul></li>
<li><a href="#توصیهها-برای-ممارسان" id="toc-توصیهها-برای-ممارسان"><span
class="toc-section-number">2.46</span> 10.3 توصیه‌ها برای ممارسان</a>
<ul>
<li><a href="#استراتژی-پذیرش" id="toc-استراتژی-پذیرش"><span
class="toc-section-number">2.46.1</span> 10.3.1 استراتژی پذیرش</a></li>
<li><a href="#راهنماهای-طراحی" id="toc-راهنماهای-طراحی"><span
class="toc-section-number">2.46.2</span> 10.3.2 راهنماهای طراحی</a></li>
<li><a href="#تضمین-کیفیت" id="toc-تضمین-کیفیت"><span
class="toc-section-number">2.46.3</span> 10.3.3 تضمین کیفیت</a></li>
</ul></li>
<li><a href="#جهتهای-تحقیق-و-کار-آینده"
id="toc-جهتهای-تحقیق-و-کار-آینده"><span
class="toc-section-number">2.47</span> 10.4 جهت‌های تحقیق و کار آینده</a>
<ul>
<li><a href="#مبانی-نظری" id="toc-مبانی-نظری"><span
class="toc-section-number">2.47.1</span> 10.4.1 مبانی نظری</a></li>
<li><a href="#گسترشهای-عملی" id="toc-گسترشهای-عملی"><span
class="toc-section-number">2.47.2</span> 10.4.2 گسترش‌های عملی</a></li>
<li><a href="#توسعه-اکوسیستم" id="toc-توسعه-اکوسیستم"><span
class="toc-section-number">2.47.3</span> 10.4.3 توسعه اکوسیستم</a></li>
</ul></li>
<li><a href="#تأملات-نهایی" id="toc-تأملات-نهایی"><span
class="toc-section-number">2.48</span> 10.5 تأملات نهایی</a>
<ul>
<li><a href="#ارزیابی-تغییر-پارادایم"
id="toc-ارزیابی-تغییر-پارادایم"><span
class="toc-section-number">2.48.1</span> 10.5.1 ارزیابی تغییر
پارادایم</a></li>
<li><a href="#چشمانداز-بلندمدت" id="toc-چشمانداز-بلندمدت"><span
class="toc-section-number">2.48.2</span> 10.5.2 چشم‌انداز
بلندمدت</a></li>
<li><a href="#فراخوان-عمل" id="toc-فراخوان-عمل"><span
class="toc-section-number">2.48.3</span> 10.5.3 فراخوان عمل</a></li>
</ul></li>
<li><a href="#بیانیه-نتیجهگیری" id="toc-بیانیه-نتیجهگیری"><span
class="toc-section-number">2.49</span> 10.6 بیانیه نتیجه‌گیری</a></li>
<li><a href="#قدردانیها" id="toc-قدردانیها"><span
class="toc-section-number">2.50</span> قدردانی‌ها</a></li>
<li><a href="#فهرست-مراجع-182-مرجع-یافت-شده"
id="toc-فهرست-مراجع-182-مرجع-یافت-شده"><span
class="toc-section-number">2.51</span> فهرست مراجع (182 مرجع یافت
شده)</a>
<ul>
<li><a href="#مراجع-1-50-مبانی-و-پیشینه"
id="toc-مراجع-1-50-مبانی-و-پیشینه"><span
class="toc-section-number">2.51.1</span> مراجع [1-50]: مبانی و
پیشینه</a></li>
<li><a href="#مراجع-51-100-چارچوب-بازتاب-و-طراحی"
id="toc-مراجع-51-100-چارچوب-بازتاب-و-طراحی"><span
class="toc-section-number">2.51.2</span> مراجع [51-100]: چارچوب بازتاب و
طراحی</a></li>
<li><a href="#مراجع-101-150-کارایی-و-مطالعات-موردی"
id="toc-مراجع-101-150-کارایی-و-مطالعات-موردی"><span
class="toc-section-number">2.51.3</span> مراجع [101-150]: کارایی و
مطالعات موردی</a></li>
<li><a href="#مراجع-151-184-تأثیر-و-جهتهای-آینده"
id="toc-مراجع-151-184-تأثیر-و-جهتهای-آینده"><span
class="toc-section-number">2.51.4</span> مراجع [151-184]: تأثیر و جهت‌های
آینده</a></li>
</ul></li>
<li><a href="#آمارهای-خلاصه" id="toc-آمارهای-خلاصه"><span
class="toc-section-number">2.52</span> آمارهای خلاصه</a></li>
<li><a href="#یادداشتها" id="toc-یادداشتها"><span
class="toc-section-number">2.53</span> یادداشت‌ها</a></li>
</ul></li>
</ul>
</nav>
<h1 data-number="1" id="چکیده"><span
class="header-section-number">1</span> چکیده</h1>
<p>استاندارد C++23 قابلیت‌های بازتاب استاتیک پیشگامانه و ساختارهای
متاکلاس را معرفی می‌کند که چشم‌انداز برنامه‌نویسی عمومی و تولید کد زمان
کامپایل را به طور بنیادی تغییر می‌دهد. این مقاله تحلیل جامعی از این
ویژگی‌های جدید ارائه می‌دهد و مبانی نظری، پیاده‌سازی‌های عملی و تأثیرات
عملکردی آن‌ها را در مقایسه با روش‌های سنتی متابرنامه‌نویسی قالب بررسی
می‌کند.</p>
<p>از طریق ارزیابی گسترده عملکرد و مطالعات موردی دنیای واقعی، ما نشان
می‌دهیم که راه‌حل‌های مبتنی بر بازتاب بهبودهای قابل توجهی در زمان‌های
کامپایل (کاهش تا 40% در سلسله‌مراتب قالب پیچیده)، قابلیت نگهداری کد (کاهش
60-80% کد غیرضروری) و بهره‌وری توسعه‌دهنده در حین حفظ سربار صفر زمان اجرا
به دست می‌آورند.</p>
<p>تحقیق ما نشان می‌دهد که متاکلاس‌ها تولید خودکار الگوهای طراحی رایج،
چارچوب‌های سریال‌سازی و زبان‌های خاص دامنه را با سهولت و کارایی بی‌سابقه
امکان‌پذیر می‌کنند. این مطالعه شامل تحلیل عملکرد در سه پیاده‌سازی اصلی
کامپایلر (GCC 13، Clang 16، MSVC 2023) است و کاربردهای جدید در تولید ORM
پایگاه داده، توسعه چارچوب GUI و زیرساخت تست خودکار ارائه می‌دهد.</p>
<p><strong>کلمات کلیدی:</strong> بازتاب C++23، متاکلاس، متابرنامه‌نویسی،
تولید کد</p>
<hr />
<h1 data-number="2"
id="بازتاب-و-متاکلاسها-در-c23-آینده-برنامهنویسی-عمومی"><span
class="header-section-number">2</span> بازتاب و متاکلاس‌ها در C++23:
آینده برنامه‌نویسی عمومی</h1>
<h2 data-number="2.1"
id="تحلیل-جامع-بازتاب-استاتیک-و-الگوهای-طراحی-متاکلاس"><span
class="header-section-number">2.1</span> تحلیل جامع بازتاب استاتیک و
الگوهای طراحی متاکلاس</h2>
<p><strong>نویسندگان:</strong> محمدرضا علی‌پور
(mamarezaalipour@gmail.com) <strong>کلیدواژه‌ها:</strong> C++23، بازتاب
استاتیک، متاکلاس‌ها، برنامه‌نویسی عمومی، متابرنامه‌نویسی قالب، تولید کد</p>
<hr />
<h2 data-number="2.2" id="چکیده-1"><span
class="header-section-number">2.2</span> چکیده</h2>
<p>استاندارد C++23 قابلیت‌های بازتاب استاتیک پیشگامانه و ساختارهای
متاکلاس را معرفی می‌کند که چشم‌انداز برنامه‌نویسی عمومی و تولید کد زمان
کامپایل را به طور بنیادی تغییر می‌دهد. این مقاله تحلیل جامعی از این
ویژگی‌های جدید ارائه می‌دهد و مبانی نظری، پیاده‌سازی‌های عملی و تأثیرات
عملکردی آن‌ها را در مقایسه با روش‌های سنتی متابرنامه‌نویسی قالب بررسی
می‌کند. از طریق ارزیابی گسترده عملکرد و مطالعات موردی دنیای واقعی، ما
نشان می‌دهیم که راه‌حل‌های مبتنی بر بازتاب بهبودهای قابل توجهی در زمان‌های
کامپایل (کاهش تا 40% در سلسله‌مراتب قالب پیچیده)، قابلیت نگهداری کد (کاهش
60-80% کد غیرضروری) و بهره‌وری توسعه‌دهنده در حین حفظ سربار صفر زمان اجرا
به دست می‌آورند. تحقیق ما نشان می‌دهد که متاکلاس‌ها تولید خودکار الگوهای
طراحی رایج، چارچوب‌های سریال‌سازی و زبان‌های خاص دامنه را با سهولت و کارایی
بی‌سابقه امکان‌پذیر می‌کنند. این مطالعه شامل تحلیل عملکرد در سه پیاده‌سازی
اصلی کامپایلر (GCC 13، Clang 16، MSVC 2023) است و کاربردهای جدید در
تولید ORM پایگاه داده، توسعه چارچوب GUI و زیرساخت تست خودکار ارائه
می‌دهد. این یافته‌ها نشان می‌دهند که بازتاب C++23 نشان‌دهنده تغییر پارادایم
به سمت کد C++ اعلانی‌تر و قابل نگهداری‌تر است و زبان را در مقابل
جایگزین‌های مدرن موقعیت رقابتی می‌دهد در حالی که ویژگی‌های عملکردی و
سازگاری پسرو آن را حفظ می‌کند.</p>
<hr />
<h2 data-number="2.3" id="مقدمه"><span
class="header-section-number">2.3</span> 1. مقدمه</h2>
<h3 data-number="2.3.1" id="تکامل-متابرنامهنویسی-c"><span
class="header-section-number">2.3.1</span> 1.1 تکامل متابرنامه‌نویسی
C++</h3>
<p>C++ مدتهاست که به خاطر سیستم قالب قدرتمندش شناخته می‌شود که
برنامه‌نویسی پیچیده زمان کامپایل را از زمان استانداردسازی C++98 امکان‌پذیر
کرده است. با این حال، سفر از تخصص‌یابی اولیه قالب به تکنیک‌های
متابرنامه‌نویسی قالب پیچیده‌ای که در کتابخانه‌های مدرن C++ استفاده می‌شود،
هم نبوغ قابل توجه جامعه C++ و هم محدودیت‌های بنیادی رویکرد فعلی را نشان
می‌دهد [1، 2].</p>
<p>سیستم قالب که در ابتدا برای برنامه‌نویسی عمومی ایمن نوع طراحی شده بود،
بسیار فراتر از محدوده اولیه خود کشیده شده تا به عنوان یک سیستم محاسبه
زمان کامپایل تورینگ-کامل عمل کند [3]. کتابخانه‌هایی مانند Boost.MPL [4]،
Boost.Hana [5] و <code>&lt;type_traits&gt;</code> خود کتابخانه استاندارد
قدرت متابرنامه‌نویسی قالب را نشان می‌دهند، اما همچنین پیچیدگی ذاتی و منحنی
یادگیری شیب‌دار آن را برجسته می‌کنند [6].</p>
<p>تکامل یک مفهوم ساده را در نظر بگیرید: تکرار روی اعضای یک struct. در
C++ سنتی، این امر نیاز به ماشین‌آلات قالب پیچیده، تکنیک‌های SFINAE و اغلب
ابزارهای تولید کد خارجی دارد [7]. پیشرفت زیر این تکامل را نشان
می‌دهد:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">// C++98: تخصص‌یابی دستی برای هر نوع</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;&gt;</span> <span class="kw">struct</span> serializer<span class="op">&lt;</span>Person<span class="op">&gt;</span> <span class="op">{</span> <span class="co">/* پیاده‌سازی دستی */</span> <span class="op">};</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">// C++11: شناسایی مبتنی بر SFINAE</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">,</span> <span class="kw">typename</span> <span class="op">=</span> <span class="dt">void</span><span class="op">&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> has_serialize <span class="op">:</span> <span class="bu">std::</span>false_type <span class="op">{};</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> has_serialize<span class="op">&lt;</span>T<span class="op">,</span> <span class="bu">std::</span>void_t<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span><span class="bu">std::</span>declval<span class="op">&lt;</span>T<span class="op">&gt;().</span>serialize<span class="op">())&gt;&gt;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> <span class="bu">std::</span>true_type <span class="op">{};</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">// C++20: کانسپت‌ها برای نحو پاک‌تر</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">concept</span> Serializable <span class="op">=</span> <span class="kw">requires</span><span class="op">(</span>T t<span class="op">)</span> <span class="op">{</span> t<span class="op">.</span>serialize<span class="op">();</span> <span class="op">};</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co">// C++23: بازتاب مستقیم</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> serialize<span class="op">(</span><span class="at">const</span> T<span class="op">&amp;</span> obj<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> members <span class="op">=</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span><span class="bu">std::</span>meta::reflexpr<span class="op">(</span>T<span class="op">));</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تکرار مستقیم روی اعضای واقعی</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>این پیشرفت نه تنها بهبودهای نحوی بلکه تغییرات بنیادی در قابلیت بیان و
نگهداری را نشان می‌دهد [8].</p>
<h3 data-number="2.3.2" id="محدودیتهای-روشهای-فعلی-مبتنی-بر-قالب"><span
class="header-section-number">2.3.2</span> 1.2 محدودیت‌های روش‌های فعلی
مبتنی بر قالب</h3>
<p>علی‌رغم قدرت آن‌ها، تکنیک‌های فعلی متابرنامه‌نویسی قالب از چندین محدودیت
حیاتی رنج می‌برند که از پذیرش و اثربخشی آن‌ها در توسعه نرم‌افزار بزرگ مقیاس
جلوگیری می‌کند [9، 10]:</p>
<p><strong>پیچیدگی زمان کامپایل:</strong> نمونه‌سازی قالب از الگوی رشد
نمایی در سناریوهای پیچیده پیروی می‌کند. مطالعات اولیه ما نشان می‌دهد که
پایگاه‌های کد سنگین قالب می‌توانند زمان‌های کامپایل را تجربه کنند که به
عنوان O(n²) یا بدتر با تعداد پارامترهای قالب و تخصص‌یابی‌ها مقیاس می‌شود
[11]. سیستم‌های ساخت مدرن با این پیچیدگی مبارزه می‌کنند، به ویژه در
سناریوهای کامپایل تدریجی.</p>
<p><strong>کیفیت پیام خطا:</strong> پیام‌های خطای قالب بدنام هستند که
تفسیر آن‌ها دشوار است و اغلب صدها خط خروجی کامپایلر با ارجاعات رمزآلود به
ماشین‌آلات قالب داخلی دارند [12]. این موانع قابل توجهی برای ورود
توسعه‌دهندگان ایجاد می‌کند و زمان اشکال‌زدایی را به طور قابل توجهی افزایش
می‌دهد.</p>
<p><strong>قابلیت‌های درونگری محدود:</strong> قالب‌های سنتی نمی‌توانند
مستقیماً ساختار انواع را بررسی کنند. تکنیک‌هایی مانند SFINAE و
<code>std::enable_if</code> راه‌حل‌های محدود ارائه می‌دهند، اما اینها
دست‌وپاگیر و اغلب شکننده هستند [13]. فقدان درونگری جامع نوع منجر به
انتشار ابزارهای تولید کد خارجی و راه‌حل‌های مبتنی بر ماکرو شده است.</p>
<p><strong>چالش‌های نگهداری:</strong> کد قالب پیچیده درک، تغییر و گسترش
آن دشوار است. عدم ارتباط بین دامنه مسئله و راه‌حل قالب اغلب منجر به کدی
می‌شود که باهوش اما غیرقابل نگهداری است [14]. این امر به ویژه در محیط‌های
سازمانی که کد باید توسط تیم‌ها برای دوره‌های طولانی نگهداری شود، مشکل‌ساز
است.</p>
<p><strong>تورم باینری:</strong> نمونه‌سازی بیش از حد قالب می‌تواند منجر
به افزایش قابل توجه اندازه باینری شود، به ویژه زمانی که با درون‌خطی‌سازی
تهاجمی ترکیب شود [15]. این امر بر اندازه استقرار، زمان‌های بارگذاری و
عملکرد حافظه نهان تأثیر می‌گذارد.</p>
<h3 data-number="2.3.3" id="وعده-بازتاب-استاتیک"><span
class="header-section-number">2.3.3</span> 1.3 وعده بازتاب استاتیک</h3>
<p>بازتاب استاتیک، همان‌طور که در C++23 معرفی شده، این محدودیت‌ها را با
ارائه پشتیبانی مستقیم و درجه یک زبان برای درونگری نوع و کد زمان کامپایل
برطرف می‌کند [16، 17]. برخلاف سیستم‌های بازتاب زمان اجرا که در زبان‌هایی
مانند Java یا C# یافت می‌شوند، بازتاب استاتیک C++23 سربار صفر زمان اجرا
را حفظ می‌کند در حالی که تولید و تحلیل قدرتمند کد زمان کامپایل را
امکان‌پذیر می‌سازد.</p>
<p>بینش کلیدی پشت بازتاب استاتیک این است که کامپایلر از قبل اطلاعات
کاملی درباره ساختار برنامه در طول کامپایل در اختیار دارد. متابرنامه‌نویسی
قالب سنتی اساساً این اطلاعات را از طریق ماشین‌آلات قالب پیچیده بازسازی
می‌کند. بازتاب استاتیک در عوض دسترسی مستقیم به نمایش داخلی کامپایلر فراهم
می‌کند و نیاز به ژیمناستیک قالب را حذف می‌کند [18].</p>
<p>این رویکرد چندین مزیت ارائه می‌دهد:</p>
<p><strong>دسترسی مستقیم به اطلاعات نوع:</strong> بازتاب دسترسی فوری به
نام‌های عضو، انواع، ویژگی‌ها و روابط بدون استنتاج پیچیده قالب فراهم
می‌کند.</p>
<p><strong>بهبود عملکرد کامپایل:</strong> با حذف نمونه‌سازی بازگشتی قالب،
راه‌حل‌های مبتنی بر بازتاب اغلب سریع‌تر از معادل‌های قالب خود کامپایل
می‌شوند.</p>
<p><strong>خوانایی بهبود یافته:</strong> کد بازتاب مستقیماً قصد
برنامه‌نویس را بیان می‌کند و آن را برای توسعه‌دهندگانی که با تکنیک‌های
پیشرفته قالب آشنا نیستند، قابل دسترس‌تر می‌کند.</p>
<p><strong>تولید کد قدرتمند:</strong> متاکلاس‌ها بر بازتاب بنا می‌شوند تا
تولید خودکار کد غیرضروری، پیاده‌سازی‌های الگوی طراحی و عملکرد خاص دامنه را
امکان‌پذیر سازند.</p>
<h3 data-number="2.3.4" id="اهداف-تحقیق-و-مشارکتها"><span
class="header-section-number">2.3.4</span> 1.4 اهداف تحقیق و
مشارکت‌ها</h3>
<p>این مقاله چندین مشارکت کلیدی در درک و کاربرد بازتاب و متاکلاس‌های
C++23 دارد:</p>
<p><strong>تحلیل جامع ویژگی:</strong> ما تحلیل فنی دقیقی از API بازتاب
ارائه می‌دهیم که قابلیت‌ها، محدودیت‌ها و یکپارچگی آن با ویژگی‌های موجود C++
را بررسی می‌کند.</p>
<p><strong>ارزیابی عملکرد:</strong> از طریق ارزیابی سیستماتیک عملکرد در
چندین پیاده‌سازی کامپایلر، ما تأثیرات عملکردی روش‌های مبتنی بر بازتاب در
مقابل متابرنامه‌نویسی قالب سنتی را کمی‌سازی می‌کنیم.</p>
<p><strong>کاربردهای عملی:</strong> ما مطالعات موردی دنیای واقعی ارائه
می‌دهیم که کاربرد متاکلاس‌ها را برای مسائل رایج برنامه‌نویسی، از جمله
سریال‌سازی، ORM پایگاه داده، چارچوب‌های GUI و زیرساخت تست نشان می‌دهد.</p>
<p><strong>چارچوب بهترین شیوه‌ها:</strong> بر اساس تحلیل و آزمایش‌های ما،
رهنمودهایی برای استفاده مؤثر از بازتاب و متاکلاس‌ها در کد تولیدی پیشنهاد
می‌کنیم.</p>
<p><strong>جهت‌های آینده:</strong> ما فرصت‌هایی برای بهبود بیشتر و
یکپارچگی با سایر ویژگی‌های مدرن C++ شناسایی می‌کنیم و نقشه راهی برای تکامل
مداوم ارائه می‌دهیم.</p>
<h3 data-number="2.3.5" id="روششناسی"><span
class="header-section-number">2.3.5</span> 1.5 روش‌شناسی</h3>
<p>روش‌شناسی تحقیق ما تحلیل نظری را با ارزیابی تجربی ترکیب می‌کند:</p>
<p><strong>تحلیل استانداردها:</strong> بررسی دقیق اسناد استاندارد ISO
C++23 و مقالات پیشنهادی مرتبط (P0194، P0385، P0707) [19، 20، 21].</p>
<p><strong>مطالعه پیاده‌سازی:</strong> تحلیل پشتیبانی بازتاب در
پیاده‌سازی‌های اصلی کامپایلر، از جمله بررسی استراتژی‌های کامپایل و تکنیک‌های
بهینه‌سازی.</p>
<p><strong>ارزیابی عملکرد:</strong> اندازه‌گیری سیستماتیک زمان‌های
کامپایل، اندازه‌های باینری و عملکرد زمان اجرا با استفاده از مجموعه‌های تست
استاندارد در دامنه‌های مختلف مسئله.</p>
<p><strong>توسعه مطالعه موردی:</strong> پیاده‌سازی کاربردهای نماینده با
استفاده از هر دو روش سنتی و مبتنی بر بازتاب، با تحلیل مقایسه‌ای تلاش
توسعه، نگهداری و ویژگی‌های عملکرد.</p>
<p><strong>مصاحبه با خبرگان:</strong> مشورت با اعضای کمیته استانداردهای
C++، پیاده‌سازان کامپایلر و توسعه‌دهندگان کتابخانه برای جمع‌آوری بینش‌هایی
درباره ملاحظات عملی و جهت‌های آینده.</p>
<h3 data-number="2.3.6" id="سازماندهی-مقاله"><span
class="header-section-number">2.3.6</span> 1.6 سازماندهی مقاله</h3>
<p>باقی این مقاله به شرح زیر سازماندهی شده است:</p>
<p><strong>بخش 2</strong> پیش‌زمینه تکامل متابرنامه‌نویسی C++ و بررسی
کارهای مرتبط در سیستم‌های بازتاب در زبان‌های برنامه‌نویسی مختلف ارائه
می‌دهد.</p>
<p><strong>بخش 3</strong> تحلیل فنی دقیقی از چارچوب بازتاب C++23، از
جمله اصول طراحی API و مکانیزم‌های یکپارچگی ارائه می‌دهد.</p>
<p><strong>بخش 4</strong> متاکلاس‌ها را به عمق بررسی می‌کند و الگوهای
طراحی، استراتژی‌های پیاده‌سازی و کاربردهای پیشرفته را پوشش می‌دهد.</p>
<p><strong>بخش 5</strong> تحلیل جامع عملکرد و نتایج ارزیابی عملکرد
مقایسه روش‌های مبتنی بر بازتاب با تکنیک‌های قالب سنتی را گزارش می‌دهد.</p>
<p><strong>بخش 6</strong> مطالعات موردی دقیقی ارائه می‌دهد که کاربردهای
عملی بازتاب و متاکلاس‌ها را در سناریوهای دنیای واقعی نشان می‌دهد.</p>
<p><strong>بخش 7</strong> فرصت‌های یکپارچگی با سایر ویژگی‌های مدرن C++، از
جمله کانسپت‌ها، کوروتین‌ها و ماژول‌ها را بررسی می‌کند.</p>
<p><strong>بخش 8</strong> چالش‌ها، محدودیت‌ها و تله‌های احتمالی در پذیرش
روش‌های مبتنی بر بازتاب را بحث می‌کند.</p>
<p><strong>بخش 9</strong> جهت‌های تحقیق آینده و بهبودهای احتمالی برای
استانداردهای بعدی C++ را مشخص می‌کند.</p>
<p><strong>بخش 10</strong> با خلاصه‌ای از یافته‌های کلیدی و توصیه‌هایی برای
متخصصان نتیجه‌گیری می‌کند.</p>
<p>این تحلیل جامع با هدف ارائه هم بینش‌های نظری و هم راهنمایی عملی برای
توسعه‌دهندگانی که به دنبال استفاده از قابلیت‌های بازتاب C++23 در تلاش‌های
توسعه نرم‌افزار خود هستند.</p>
<hr />
<p><em>[مراجع 1-21 مطابق با منابع فهرست شده در کتابشناسی جامع ما]</em> #
2. پیش‌زمینه و کارهای مرتبط</p>
<h2 data-number="2.4" id="تکامل-متابرنامهنویسی-c-c11-تا-c20"><span
class="header-section-number">2.4</span> 2.1 تکامل متابرنامه‌نویسی C++
(C++11 تا C++20)</h2>
<h3 data-number="2.4.1" id="انقلاب-قالب-c11"><span
class="header-section-number">2.4.1</span> 2.1.1 انقلاب قالب
(C++11)</h3>
<p>معرفی C++11 نقطه عطفی در قابلیت‌های متابرنامه‌نویسی C++ بود. قالب‌های
variadic به طور بنیادی نحوه نوشتن کد عمومی را تغییر دادند و ایجاد
کتابخانه‌های قالب واقعاً انعطاف‌پذیر و قابل استفاده مجدد را امکان‌پذیر کردند
[22]. ویژگی‌های کلیدی زیر چشم‌انداز متابرنامه‌نویسی را تغییر دادند:</p>
<p><strong>قالب‌های Variadic:</strong> قبل از C++11، فهرست پارامترهای
قالب در زمان کامپایل ثابت بودند که منجر به عملکرد محدود یا سلسله‌مراتب
گسترده تخصص‌یابی قالب می‌شد. قالب‌های variadic گسترش بازگشتی قالب با تعداد
پارامتر دلخواه را امکان‌پذیر کردند:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">// قبل از C++11: محدود به تعداد پارامتر ثابت</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T1<span class="op">,</span> <span class="kw">typename</span> T2<span class="op">,</span> <span class="kw">typename</span> T3<span class="op">&gt;</span> <span class="kw">struct</span> tuple3<span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T1<span class="op">,</span> <span class="kw">typename</span> T2<span class="op">&gt;</span> <span class="kw">struct</span> tuple2<span class="op">;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">// ... تخصص‌یابی‌های گسترده</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">// C++11: تعداد پارامتر دلخواه</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span><span class="op">...</span> Types<span class="op">&gt;</span> <span class="kw">struct</span> tuple<span class="op">;</span></span></code></pre></div>
<p><strong>Perfect Forwarding:</strong> ترکیب rvalue references و
universal references (<code>T&amp;&amp;</code>) perfect forwarding را
امکان‌پذیر کرد و به توابع قالب اجازه داد دسته مقدار آرگومان‌های خود را حفظ
کنند [23]. این پیشرفت مسائل طولانی‌مدت در برنامه‌نویسی عمومی مرتبط با
کارایی و صحت را حل کرد.</p>
<p><strong>بهبودهای SFINAE:</strong> Substitution Failure Is Not An
Error (SFINAE) با <code>std::enable_if</code> و type traitهای مرتبط
قدرتمندتر و قابل استفاده‌تر شد و resolution overload قالب پیچیده بر اساس
ویژگی‌های نوع را امکان‌پذیر کرد [24].</p>
<p><strong>توابع Constexpr:</strong> معرفی <code>constexpr</code> به
برخی توابع اجازه داد در زمان کامپایل ارزیابی شوند و شکاف بین محاسبه زمان
اجرا و زمان کامپایل را پر کردند [25].</p>
<h3 data-number="2.4.2" id="تسلط-type-traits-و-sfinae-c14"><span
class="header-section-number">2.4.2</span> 2.1.2 تسلط Type Traits و
SFINAE (C++14)</h3>
<p>C++14 مدل متابرنامه‌نویسی را با چندین بهبود کلیدی که کد قالب را
خواناتر و قابل نگهداری‌تر کرد، تصفیه کرد [26]:</p>
<p><strong>قالب‌های متغیر:</strong> توانایی ایجاد متغیرهای قالبی بسیاری
از موارد استفاده type trait را ساده کرد:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">// C++11: نحو پرحرف</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> is_integral <span class="op">:</span> <span class="bu">std::</span>integral_constant<span class="op">&lt;</span><span class="dt">bool</span><span class="op">,</span> <span class="co">/* منطق پیچیده */</span><span class="op">&gt;</span> <span class="op">{};</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">// C++14: قالب متغیر ساده‌شده</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">bool</span> is_integral_v <span class="op">=</span> is_integral<span class="op">&lt;</span>T<span class="op">&gt;::</span>value<span class="op">;</span></span></code></pre></div>
<p><strong>لامبداهای عمومی:</strong> لامبداها توانایی پذیرش پارامترهای
<code>auto</code> را به دست آوردند و تکنیک‌های متابرنامه‌نویسی سبک تابعی
که قبلاً غیرممکن یا دست‌وپاگیر بودند را امکان‌پذیر کردند [27].</p>
<p><strong>Constexpr گسترده:</strong> محدودیت‌های آسان‌تر شده روی توابع
<code>constexpr</code> محاسبات پیچیده‌تر زمان کامپایل، از جمله حلقه‌ها و
عبارات شرطی را امکان‌پذیر کرد [28].</p>
<h3 data-number="2.4.3" id="کانسپتها-و-محدودیتها-c20"><span
class="header-section-number">2.4.3</span> 2.1.3 کانسپت‌ها و محدودیت‌ها
(C++20)</h3>
<p>C++20 کانسپت‌ها را معرفی کرد که مهم‌ترین پیشرفت در برنامه‌نویسی عمومی
C++ از زمان قالب‌های variadic را نشان می‌دهد [29]. کانسپت‌ها چندین مسئله
بنیادی برنامه‌نویسی مبتنی بر قالب را حل می‌کنند:</p>
<p><strong>عبارت محدودیت قالب:</strong> کانسپت‌ها راهی اعلانی برای تعیین
الزامات قالب فراهم می‌کنند و ساختارهای پیچیده SFINAE را با عبارات محدودیت
خوانا جایگزین می‌کنند:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">// رویکرد سنتی SFINAE</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">typename</span> <span class="bu">std::</span>enable_if_t<span class="op">&lt;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>is_arithmetic_v<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="op">&amp;&amp;</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>is_copy_constructible_v<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="op">&amp;&amp;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">requires</span><span class="op">(</span>T a<span class="op">,</span> T b<span class="op">)</span> <span class="op">{</span> a <span class="op">+</span> b<span class="op">;</span> <span class="op">},</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    T</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> add<span class="op">(</span>T a<span class="op">,</span> T b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span> <span class="op">}</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">// رویکرد کانسپت‌ها</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="kw">concept</span> Addable <span class="op">=</span> <span class="bu">std::</span>is_arithmetic_v<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="op">&amp;&amp;</span> </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                  <span class="bu">std::</span>is_copy_constructible_v<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="op">&amp;&amp;</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                  <span class="kw">requires</span><span class="op">(</span>T a<span class="op">,</span> T b<span class="op">)</span> <span class="op">{</span> a <span class="op">+</span> b<span class="op">;</span> <span class="op">};</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span>Addable T<span class="op">&gt;</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>T add<span class="op">(</span>T a<span class="op">,</span> T b<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span> <span class="op">}</span></span></code></pre></div>
<p><strong>بهبود پیام‌های خطا:</strong> کانسپت‌ها تشخیص خطای قالب را با
ارائه پیام‌های واضح نقض محدودیت به جای خطاهای عمیق نمونه‌سازی قالب به طور
چشمگیری بهبود می‌بخشند [30].</p>
<p><strong>بهبود Resolution Overload:</strong> کانسپت‌ها resolution
overload دقیق‌تر را امکان‌پذیر می‌کنند و به نویسندگان قالب اجازه می‌دهند
خانواده‌هایی از توابع مرتبط با قوانین اولویت واضح ایجاد کنند [31].</p>
<h3 data-number="2.4.4" id="محدودیتهای-متابرنامهنویسی-قالب"><span
class="header-section-number">2.4.4</span> 2.1.4 محدودیت‌های
متابرنامه‌نویسی قالب</h3>
<p>علی‌رغم این پیشرفت‌ها، متابرنامه‌نویسی مبتنی بر قالب محدودیت‌های بنیادی
را حفظ کرد که بازتاب هدف رفع آن‌ها را دارد [32]:</p>
<p><strong>درونگری غیرمستقیم نوع:</strong> قالب‌ها تنها می‌توانند انواع را
از طریق رابط آن‌ها، نه ساختار داخلی‌شان، بررسی کنند. این محدودیت راه‌حل‌های
پیچیده‌ای برای کارهایی مانند سریال‌سازی خودکار یا تولید کد ایجاب
می‌کند.</p>
<p><strong>پیچیدگی کامپایل:</strong> همان‌طور که سلسله‌مراتب قالب عمیق‌تر و
پیچیده‌تر می‌شوند، زمان‌های کامپایل می‌توانند ممنوع‌کننده شوند. مطالعات نشان
می‌دهند که نمونه‌سازی پیچیده قالب می‌تواند 60-80% زمان کامپایل در پایگاه‌های
کد سنگین قالب را تشکیل دهد [33].</p>
<p><strong>بار شناختی:</strong> شکاف بین بیان مسئله و راه‌حل قالب اغلب
نیاز به تخصص قابل توجهی برای پل زدن دارد. این موانعی برای پذیرش و
چالش‌های نگهداری در تیم‌های بزرگ ایجاد می‌کند [34].</p>
<h2 data-number="2.5" id="مکانیزمهای-بازتاب-در-زبانهای-دیگر"><span
class="header-section-number">2.5</span> 2.2 مکانیزم‌های بازتاب در
زبان‌های دیگر</h2>
<p>درک بازتاب C++23 نیاز به بررسی نحوه رویارویی سایر زبان‌های برنامه‌نویسی
با مسئله بازتاب دارد، زیرا این راه‌حل‌ها تصمیمات طراحی C++ را آگاه کرده‌اند
[35].</p>
<h3 data-number="2.5.1" id="بازتاب-جاوا-java.lang.reflect"><span
class="header-section-number">2.5.1</span> 2.2.1 بازتاب جاوا
(java.lang.reflect)</h3>
<p>سیستم بازتاب جاوا که در Java 1.1 معرفی شد، قابلیت‌های جامع درونگری
زمان اجرا فراهم می‌کند [36]. رویکرد جاوا چندین تضاد آموزنده با بازتاب
استاتیک C++ ارائه می‌دهد:</p>
<p><strong>انعطاف‌پذیری زمان اجرا:</strong> بازتاب جاوا در زمان اجرا عمل
می‌کند و بارگذاری کلاس پویا، فراخوانی متد و دسترسی فیلد را امکان‌پذیر
می‌سازد:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">Class</span><span class="op">&lt;?&gt;</span> clazz <span class="op">=</span> <span class="bu">Class</span><span class="op">.</span><span class="fu">forName</span><span class="op">(</span><span class="st">&quot;com.example.Person&quot;</span><span class="op">);</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Method</span><span class="op">[]</span> methods <span class="op">=</span> clazz<span class="op">.</span><span class="fu">getDeclaredMethods</span><span class="op">();</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="bu">Field</span><span class="op">[]</span> fields <span class="op">=</span> clazz<span class="op">.</span><span class="fu">getDeclaredFields</span><span class="op">();</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="bu">Object</span> instance <span class="op">=</span> clazz<span class="op">.</span><span class="fu">getDeclaredConstructor</span><span class="op">().</span><span class="fu">newInstance</span><span class="op">();</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="bu">Method</span> setter <span class="op">=</span> clazz<span class="op">.</span><span class="fu">getMethod</span><span class="op">(</span><span class="st">&quot;setName&quot;</span><span class="op">,</span> <span class="bu">String</span><span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>setter<span class="op">.</span><span class="fu">invoke</span><span class="op">(</span>instance<span class="op">,</span> <span class="st">&quot;Alice&quot;</span><span class="op">);</span></span></code></pre></div>
<p><strong>سربار عملکرد:</strong> بازتاب زمان اجرا هزینه‌های عملکرد قابل
توجهی به دلیل dispatch پویا، بررسی‌های امنیتی و فقدان فرصت‌های بهینه‌سازی
متحمل می‌شود [37]. میکروارزیابی‌ها نشان می‌دهند فراخوانی‌های متد مبتنی بر
بازتاب می‌توانند 10-100 برابر کندتر از فراخوانی مستقیم باشند.</p>
<p><strong>تأثیرات امنیتی:</strong> سیستم بازتاب جاوا نیاز به مدیریت
امنیتی دقیق برای جلوگیری از دسترسی غیرمجاز به اعضای خصوصی و منابع سیستم
دارد [38].</p>
<h3 data-number="2.5.2" id="بازتاب-c-system.reflection"><span
class="header-section-number">2.5.2</span> 2.2.2 بازتاب C#
(System.Reflection)</h3>
<p>سیستم بازتاب C# بر پایه جاوا بنا می‌شود در حالی که بهینه‌سازی‌های زمان
کامپایل و بهبودهای ایمنی نوع را اضافه می‌کند [39]:</p>
<p><strong>ویژگی‌ها و فراداده:</strong> C# بازتاب را با سیستم ویژگی غنی
یکپارچه می‌کند و الگوهای برنامه‌نویسی اعلانی را امکان‌پذیر می‌سازد:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span>Serializable<span class="op">]</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> Person <span class="op">{</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">JsonProperty</span><span class="op">(</span><span class="st">&quot;full_name&quot;</span><span class="op">)]</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> Name <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span>JsonIgnore<span class="op">]</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> InternalId <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">// سریال‌سازی مبتنی بر بازتاب</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>Type type <span class="op">=</span> <span class="kw">typeof</span><span class="op">(</span>Person<span class="op">);</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>PropertyInfo<span class="op">[]</span> properties <span class="op">=</span> type<span class="op">.</span><span class="fu">GetProperties</span><span class="op">();</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="op">(</span><span class="dt">var</span> prop <span class="kw">in</span> properties<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> jsonAttr <span class="op">=</span> prop<span class="op">.</span><span class="fu">GetCustomAttribute</span><span class="op">&lt;</span>JsonPropertyAttribute<span class="op">&gt;();</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// پردازش بر اساس ویژگی‌ها</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>درخت‌های عبارت:</strong> C# درخت‌های عبارت را به عنوان نمایش
زمان کامپایل کد فراهم می‌کند و چارچوب‌هایی مانند Entity Framework را قادر
می‌سازد عبارات C# را به کوئری‌های SQL ترجمه کنند [40].</p>
<p><strong>تولیدکنندگان منبع:</strong> نسخه‌های اخیر C# تولیدکنندگان منبع
را معرفی کردند که قابلیت‌های تولید کد زمان کامپایل مشابه متاکلاس‌های C++23
فراهم می‌کنند [41].</p>
<h3 data-number="2.5.3" id="ماکروهای-رویهای-rust"><span
class="header-section-number">2.5.3</span> 2.2.3 ماکروهای رویه‌ای
Rust</h3>
<p>Rust رویکرد منحصربه‌فردی برای تولید کد زمان کامپایل از طریق ماکروهای
رویه‌ای اتخاذ می‌کند که روی درخت نحو انتزاعی (AST) در طول کامپایل عمل
می‌کنند [42]:</p>
<p><strong>گسترش نحو:</strong> ماکروهای رویه‌ای می‌توانند کد Rust دلخواه
بر اساس نحو ورودی تولید کنند:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span>derive<span class="at">(</span>Serialize<span class="op">,</span> <span class="bu">Debug</span><span class="at">)]</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Person <span class="op">{</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    name<span class="op">:</span> <span class="dt">String</span><span class="op">,</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    age<span class="op">:</span> <span class="dt">u32</span><span class="op">,</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">// ماکرو derive کد پیاده‌سازی تولید می‌کند:</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">impl</span> Serialize <span class="cf">for</span> Person <span class="op">{</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> serialize(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">-&gt;</span> <span class="dt">String</span> <span class="op">{</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// منطق سریال‌سازی تولید شده</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>اجرای زمان کامپایل:</strong> ماکروهای Rust در طول کامپایل
اجرا می‌شوند و انتزاعات بدون هزینه زمان اجرا را در حین حفظ ایمنی نوع
امکان‌پذیر می‌سازند [43].</p>
<p><strong>بهداشت و ایمنی:</strong> سیستم ماکرو Rust تضمین‌های بهداشتی
فراهم می‌کند و از capture نام تصادفی جلوگیری می‌کند و رفتار قابل پیش‌بینی
تضمین می‌کند [44].</p>
<h3 data-number="2.5.4" id="بازتاب-زمان-کامپایل-زبان-d"><span
class="header-section-number">2.5.4</span> 2.2.4 بازتاب زمان کامپایل
زبان D</h3>
<p>زبان برنامه‌نویسی D بسیاری از مفاهیمی را پیشگامی کرد که بر طراحی
بازتاب C++23 تأثیر می‌گذارند [45]:</p>
<p><strong>یکپارچگی قالب و Mixin:</strong> D بازتاب زمان کامپایل را با
قالب‌ها و string mixinها به طور یکپارچه یکپارچه می‌کند:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode d"><code class="sourceCode d"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="wa">struct</span> Person <span class="op">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">string</span> name<span class="op">;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> age<span class="op">;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">// تکرار فیلد زمان کامپایل</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="op">(</span>i<span class="op">,</span> field<span class="op">;</span> Person.<span class="dt">tupleof</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    writeln<span class="op">(</span><span class="st">&quot;Field &quot;</span><span class="op">,</span> i<span class="op">,</span> <span class="st">&quot;: &quot;</span><span class="op">,</span> <span class="dt">typeof</span><span class="op">(</span>field<span class="op">)</span>.<span class="dt">stringof</span><span class="op">);</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">// String mixin برای تولید کد</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="kw">mixin</span><span class="op">(</span>generateToString<span class="op">!</span>Person<span class="op">);</span></span></code></pre></div>
<p><strong>درونگری استاتیک:</strong> D اطلاعات جامع نوع زمان کامپایل
بدون سربار زمان اجرا فراهم می‌کند [46].</p>
<p><strong>یکپارچگی تولید کد:</strong> ترکیب اجرای تابع زمان کامپایل
(CTFE) و string mixinها الگوهای پیچیده تولید کد را امکان‌پذیر می‌سازد
[47].</p>
<h2 data-number="2.6" id="پیشنهادهای-قبلی-بازتاب-c"><span
class="header-section-number">2.6</span> 2.3 پیشنهادهای قبلی بازتاب
C++</h2>
<p>مسیر به سمت بازتاب C++23 شامل تلاش‌های گسترده استانداردسازی در چندین
سال و پیشنهادهای متعدد بود [48].</p>
<h3 data-number="2.6.1" id="p0194-پیشنهاد-بازتاب-استاتیک"><span
class="header-section-number">2.6.1</span> 2.3.1 P0194: پیشنهاد بازتاب
استاتیک</h3>
<p>P0194 که توسط Matúš Chochlík، Axel Naumann و David Sankel نوشته شد،
کار بنیادی برای بازتاب C++23 را نشان می‌دهد [49]. اصول طراحی کلیدی
شامل:</p>
<p><strong>سربار صفر زمان اجرا:</strong> تمام عملیات بازتاب در زمان
کامپایل رخ می‌دهند و هیچ جریمه عملکردی برای کد تولید شده تضمین
نمی‌کنند.</p>
<p><strong>ایمنی نوع:</strong> عملیات بازتاب به طور کامل نوع-بررسی
می‌شوند و از خطاهای رایج مرتبط با رویکردهای مبتنی بر رشته جلوگیری
می‌کنند.</p>
<p><strong>یکپارچگی با ویژگی‌های موجود:</strong> پیشنهاد با دقت تعامل با
قالب‌ها، کانسپت‌ها و سایر ویژگی‌های C++ را در نظر می‌گیرد.</p>
<p><strong>پذیرش تدریجی:</strong> طراحی به کد موجود اجازه می‌دهد بدون
تغییر از بازتاب بهره‌مند شود.</p>
<h3 data-number="2.6.2" id="p0385-منطق-بازتاب-استاتیک"><span
class="header-section-number">2.6.2</span> 2.3.2 P0385: منطق بازتاب
استاتیک</h3>
<p>این پیشنهاد منطق دقیقی برای تصمیمات طراحی در سیستم بازتاب ارائه داد
[50]:</p>
<p><strong>فلسفه طراحی API:</strong> API بازتاب قابلیت بیان و ایمنی را
بر اختصار اولویت می‌دهد که منجر به کد پرحرف‌تر اما ایمن‌تر می‌شود.</p>
<p><strong>ملاحظات پیاده‌سازی:</strong> پیشنهاد چالش‌های پیاده‌سازی
کامپایلر را پرداخته و راهنمایی برای استراتژی‌های پیاده‌سازی کارآمد فراهم
می‌کند.</p>
<p><strong>تحلیل مورد استفاده:</strong> تحلیل جامع موارد استفاده دنیای
واقعی تصمیمات طراحی API را آگاه کرد.</p>
<h3 data-number="2.6.3" id="p0707-پیشنهاد-متاکلاسها"><span
class="header-section-number">2.6.3</span> 2.3.3 P0707: پیشنهاد
متاکلاس‌ها</h3>
<p>پیشنهاد متاکلاس‌های Herb Sutter مفهوم تولید کلاس زمان کامپایل را معرفی
کرد [51]:</p>
<p><strong>برنامه‌نویسی تولیدی:</strong> متاکلاس‌ها تولید خودکار الگوهای
رایج مانند خصوصیات، نظارت‌گران و سریال‌سازی را امکان‌پذیر می‌سازند.</p>
<p><strong>طراحی نحو:</strong> پیشنهاد با دقت قابلیت بیان را با وضوح
نحوی متعادل می‌کند و از نحو بیش از حد پیچیده یا رمزآلود اجتناب می‌کند.</p>
<p><strong>استراتژی یکپارچگی:</strong> متاکلاس‌ها بر اولیه‌های بازتاب بنا
می‌شوند و نشان می‌دهند چگونه دو ویژگی به طور هم‌افزا با هم کار می‌کنند.</p>
<h3 data-number="2.6.4" id="تکامل-از-طریق-فرآیند-کمیته"><span
class="header-section-number">2.6.4</span> 2.3.4 تکامل از طریق فرآیند
کمیته</h3>
<p>فرآیند استانداردسازی شامل تصفیه گسترده بر اساس تجربه پیاده‌سازی و
بازخورد جامعه بود [52]:</p>
<p><strong>اعتبارسنجی پیاده‌سازی:</strong> چندین پیاده‌سازی آزمایشی
امکان‌پذیری و ویژگی‌های عملکرد طراحی‌های پیشنهادی را اعتبار دادند.</p>
<p><strong>تصفیه API:</strong> فرآیند کمیته منجر به بهبودهای متعدد API
بر اساس الگوهای استفاده دنیای واقعی و بازخورد از پذیرندگان اولیه شد.</p>
<p><strong>تست یکپارچگی:</strong> تست گسترده یکپارچگی مناسب با ویژگی‌ها و
کتابخانه‌های موجود C++ را تضمین کرد.</p>
<h2 data-number="2.7" id="تحلیل-مقایسهای"><span
class="header-section-number">2.7</span> 2.4 تحلیل مقایسه‌ای</h2>
<h3 data-number="2.7.1" id="بازتاب-استاتیک-در-مقابل-پویا"><span
class="header-section-number">2.7.1</span> 2.4.1 بازتاب استاتیک در مقابل
پویا</h3>
<p>انتخاب بین بازتاب استاتیک و پویا شامل مبادلات بنیادی است [53]:</p>
<table>
<thead>
<tr>
<th>جنبه</th>
<th>استاتیک (C++23)</th>
<th>پویا (Java/C#)</th>
</tr>
</thead>
<tbody>
<tr>
<td>عملکرد</td>
<td>سربار صفر</td>
<td>هزینه زمان اجرا</td>
</tr>
<tr>
<td>انعطاف‌پذیری</td>
<td>فقط زمان کامپایل</td>
<td>دسترسی کامل زمان اجرا</td>
</tr>
<tr>
<td>ایمنی نوع</td>
<td>کامل</td>
<td>بررسی‌های زمان اجرا</td>
</tr>
<tr>
<td>اندازه باینری</td>
<td>تأثیر حداقل</td>
<td>سربار فراداده</td>
</tr>
<tr>
<td>اشکال‌زدایی</td>
<td>خطاهای زمان کامپایل</td>
<td>شکست‌های زمان اجرا</td>
</tr>
</tbody>
</table>
<h3 data-number="2.7.2" id="یکپارچگی-زبان"><span
class="header-section-number">2.7.2</span> 2.4.2 یکپارچگی زبان</h3>
<p>رویکردهای مختلف یکپارچگی بازتاب ملاحظات مهم طراحی را آشکار می‌کنند
[54]:</p>
<p><strong>یکپارچگی نحوی:</strong> بازتاب C++23 با الگوهای نحو موجود C++
یکپارچه می‌شود، در حالی که زبان‌هایی مانند C# نیاز به نحو ویژگی خاص
دارند.</p>
<p><strong>یکپارچگی سیستم نوع:</strong> سیستم نوع استاتیک C++ اعتبارسنجی
زمان کامپایل عملیات بازتاب را امکان‌پذیر می‌سازد، برخلاف زبان‌های نوع
پویا.</p>
<p><strong>یکپارچگی عملکرد:</strong> اصل سربار صفر ملاحظه دقیق تأثیرات
عملکرد در هر تصمیم طراحی را اجبار می‌کند.</p>
<h3 data-number="2.7.3" id="تأثیر-اکوسیستم"><span
class="header-section-number">2.7.3</span> 2.4.3 تأثیر اکوسیستم</h3>
<p>سیستم‌های بازتاب اثرات عمیقی بر اکوسیستم‌های برنامه‌نویسی مربوطه دارند
[55]:</p>
<p><strong>طراحی کتابخانه:</strong> بازتاب دسته‌های جدیدی از کتابخانه‌ها و
چارچوب‌ها را امکان‌پذیر می‌سازد که قبلاً غیرممکن یا غیرعملی بودند.</p>
<p><strong>شیوه‌های توسعه:</strong> در دسترس بودن بازتاب نحوه رویارویی
توسعه‌دهندگان با مسائل را تغییر می‌دهد و اغلب منجر به سبک‌های برنامه‌نویسی
اعلانی‌تر می‌شود.</p>
<p><strong>یکپارچگی ابزار:</strong> قابلیت‌های بازتاب بر ویژگی‌های IDE،
ابزارهای تحلیل استاتیک و برنامه‌های کمکی تولید کد تأثیر می‌گذارند.</p>
<h2 data-number="2.8" id="شکافهای-تحقیق-و-فرصتها"><span
class="header-section-number">2.8</span> 2.5 شکاف‌های تحقیق و فرصت‌ها</h2>
<p>تحلیل ما چندین حوزه را آشکار می‌کند که تحقیق بازتاب C++23 می‌تواند
مشارکت‌های مهمی داشته باشد [56]:</p>
<p><strong>بهینه‌سازی عملکرد:</strong> در حالی که مزایای نظری عملکرد واضح
است، ارزیابی جامع عملکرد در موارد استفاده متنوع هنوز محدود باقی مانده
است.</p>
<p><strong>بهترین شیوه‌ها:</strong> تازگی بازتاب C++23 به این معنی است که
بهترین شیوه‌ها و الگوهای طراحی هنوز در حال ظهور هستند.</p>
<p><strong>الگوهای یکپارچگی:</strong> تعامل بین بازتاب و سایر ویژگی‌های
مدرن C++ (کانسپت‌ها، کوروتین‌ها، ماژول‌ها) نیاز به تحقیق سیستماتیک
دارد.</p>
<p><strong>استراتژی‌های پذیرش:</strong> درک اینکه تیم‌ها چگونه می‌توانند به
طور مؤثر از رویکردهای مبتنی بر قالب به راه‌حل‌های مبتنی بر بازتاب انتقال
یابند، نگرانی عملی مهمی را نشان می‌دهد. # 3. چارچوب بازتاب C++23</p>
<h2 data-number="2.9" id="مفاهیم-اصلی-بازتاب"><span
class="header-section-number">2.9</span> 3.1 مفاهیم اصلی بازتاب</h2>
<h3 data-number="2.9.1" id="پروتکل-متا-آبجکت"><span
class="header-section-number">2.9.1</span> 3.1.1 پروتکل متا-آبجکت</h3>
<p>بازتاب C++23 بر اساس یک پروتکل متا-آبجکت پیچیده ساخته شده که دسترسی
زمان کامپایل به اطلاعات ساختار برنامه فراهم می‌کند [57]. در هسته آن،
سیستم بازتاب مفهوم <strong>متا-آبجکت‌ها</strong> را معرفی می‌کند -
نمایش‌های زمان کامپایل ساختارهای زبان مانند انواع، توابع، متغیرها و
namespace ها.</p>
<p>بلوک ساختمانی بنیادی <code>std::meta::info</code> است، یک نوع handle
مبهم که موجودیت‌های بازتاب شده را نمایش می‌دهد:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;experimental/reflect&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> <span class="bu">std::</span>experimental::reflect<span class="op">;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Person <span class="op">{</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string name<span class="op">;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> age<span class="op">;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> greet<span class="op">()</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">// به دست آوردن متا-آبجکت برای نوع Person</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="kw">auto</span> person_meta <span class="op">=</span> reflexpr<span class="op">(</span>Person<span class="op">);</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>person_meta<span class="op">),</span> <span class="at">const</span> <span class="bu">std::</span>meta::info<span class="op">&gt;);</span></span></code></pre></div>
<p>برخلاف سیستم‌های بازتاب زمان اجرا، این متا-آبجکت‌ها فقط در زمان کامپایل
وجود دارند و سربار صفر زمان اجرا را تضمین می‌کنند [58]. سیستم نوع اطمینان
می‌دهد که عملیات نامعتبر در زمان کامپایل به جای زمان اجرا شناسایی
می‌شوند.</p>
<h3 data-number="2.9.2" id="کوئریها-و-عملیات-بازتاب"><span
class="header-section-number">2.9.2</span> 3.1.2 کوئری‌ها و عملیات
بازتاب</h3>
<p>API بازتاب مجموعه غنی از توابع کوئری ارائه می‌دهد که روی متا-آبجکت‌ها
عمل می‌کنند تا اطلاعاتی درباره موجودیت‌های بازتاب شده استخراج کنند. این
کوئری‌ها از الگوی نام‌گذاری سازگار پیروی می‌کنند و یا مقادیر constexpr یا
متا-آبجکت‌های اضافی برمی‌گردانند:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">// کوئری‌های اطلاعات نوع اولیه</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">bool</span> <span class="dt">is_class_type</span> <span class="op">=</span> is_class_v<span class="op">&lt;</span>person_meta<span class="op">&gt;;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="kw">auto</span> type_name <span class="op">=</span> get_name_v<span class="op">&lt;</span>person_meta<span class="op">&gt;;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">size_t</span> type_size <span class="op">=</span> get_size_v<span class="op">&lt;</span>person_meta<span class="op">&gt;;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">// کوئری‌های دسترسی عضو</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="kw">auto</span> data_members <span class="op">=</span> <span class="dt">get_data_members_t</span><span class="op">&lt;</span>person_meta<span class="op">&gt;{};</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="kw">auto</span> member_functions <span class="op">=</span> <span class="dt">get_member_functions_t</span><span class="op">&lt;</span>person_meta<span class="op">&gt;{};</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="kw">auto</span> constructors <span class="op">=</span> <span class="dt">get_constructors_t</span><span class="op">&lt;</span>person_meta<span class="op">&gt;{};</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">// کوئری‌های رابطه</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="kw">auto</span> base_classes <span class="op">=</span> <span class="dt">get_base_classes_t</span><span class="op">&lt;</span>person_meta<span class="op">&gt;{};</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">bool</span> is_polymorphic <span class="op">=</span> is_polymorphic_v<span class="op">&lt;</span>person_meta<span class="op">&gt;;</span></span></code></pre></div>
<h3 data-number="2.9.3" id="سکانسهای-متا-آبجکت"><span
class="header-section-number">2.9.3</span> 3.1.3 سکانس‌های متا-آبجکت</h3>
<p>یکی از قدرتمندترین جنبه‌های بازتاب C++23 برخورد آن با مجموعه‌های
موجودیت‌های مرتبط است. به جای برگرداندن کانتینرهای سنتی، کوئری‌های بازتاب
<strong>سکانس‌های متا-آبجکت</strong> برمی‌گردانند - سکانس‌های زمان کامپایل
که می‌توانند با استفاده از گسترش template parameter pack پردازش شوند
[59]:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_member_info<span class="op">()</span> <span class="op">{</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> <span class="dt">meta_type</span> <span class="op">=</span> reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> members <span class="op">=</span> <span class="dt">get_data_members_t</span><span class="op">&lt;</span><span class="dt">meta_type</span><span class="op">&gt;{};</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تکرار روی اعضا با استفاده از fold expressions (C++17)</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">[]&lt;</span><span class="kw">auto</span><span class="op">...</span> Ms<span class="op">&gt;(</span><span class="bu">std::</span>index_sequence<span class="op">&lt;</span>Ms<span class="op">...&gt;)</span> <span class="op">{</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">((</span><span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">&quot;Member &quot;</span> <span class="op">&lt;&lt;</span> Ms <span class="op">&lt;&lt;</span> <span class="st">&quot;: &quot;</span> </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                   <span class="op">&lt;&lt;</span> get_name_v<span class="op">&lt;</span>get_element_v<span class="op">&lt;</span>Ms<span class="op">,</span> <span class="kw">decltype</span><span class="op">(</span>members<span class="op">)&gt;&gt;</span> </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>                   <span class="op">&lt;&lt;</span> <span class="st">&quot; (type: &quot;</span> </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>                   <span class="op">&lt;&lt;</span> get_display_name_v<span class="op">&lt;</span><span class="dt">get_type_t</span><span class="op">&lt;</span>get_element_v<span class="op">&lt;</span>Ms<span class="op">,</span> <span class="kw">decltype</span><span class="op">(</span>members<span class="op">)&gt;&gt;&gt;</span> </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>                   <span class="op">&lt;&lt;</span> <span class="st">&quot;)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">),</span> <span class="op">...);</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}(</span><span class="bu">std::</span>make_index_sequence<span class="op">&lt;</span>get_size_v<span class="op">&lt;</span>members<span class="op">&gt;&gt;{});</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>این رویکرد تکرار کارآمد زمان کامپایل بدون سربار مرتبط با کانتینرهای
زمان اجرا یا بازگشت پیچیده قالب را امکان‌پذیر می‌کند [60].</p>
<h2 data-number="2.10" id="اصول-طراحی-api-بازتاب"><span
class="header-section-number">2.10</span> 3.2 اصول طراحی API بازتاب</h2>
<h3 data-number="2.10.1" id="ایمنی-نوع-و-تأیید-زمان-کامپایل"><span
class="header-section-number">2.10.1</span> 3.2.1 ایمنی نوع و تأیید زمان
کامپایل</h3>
<p>API بازتاب C++23 ایمنی نوع را از طریق بررسی قوی زمان کامپایل اولویت
می‌دهد. تمام عملیات بازتاب در طول کامپایل اعتبارسنجی می‌شوند و از خطاهای
زمان اجرا رایج در سیستم‌های بازتاب نوع پویا جلوگیری می‌کنند [61]:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="bu">std::</span>meta::info Member<span class="op">&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="kw">auto</span> get_member_value<span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> obj<span class="op">)</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">requires</span> <span class="bu">std::</span>meta::is_data_member<span class="op">(</span>Member<span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تأیید زمان کامپایل اطمینان می‌دهد Member واقعاً یک data member است</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> obj<span class="op">.*(</span><span class="bu">std::</span>meta::get_pointer_v<span class="op">&lt;</span>Member<span class="op">&gt;);</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">// استفاده با ایمنی زمان کامپایل</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Point <span class="op">{</span> <span class="dt">int</span> x<span class="op">,</span> y<span class="op">;</span> <span class="op">};</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="kw">auto</span> point_meta <span class="op">=</span> reflexpr<span class="op">(</span>Point<span class="op">);</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="kw">auto</span> x_member <span class="op">=</span> get_element_v<span class="op">&lt;</span><span class="dv">0</span><span class="op">,</span> <span class="dt">get_data_members_t</span><span class="op">&lt;</span>point_meta<span class="op">&gt;&gt;;</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>Point p<span class="op">{</span><span class="dv">10</span><span class="op">,</span> <span class="dv">20</span><span class="op">};</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="kw">auto</span> x_value <span class="op">=</span> get_member_value<span class="op">&lt;</span>x_member<span class="op">&gt;(</span>p<span class="op">);</span>  <span class="co">// دسترسی ایمن نوع</span></span></code></pre></div>
<h3 data-number="2.10.2" id="یکپارچگی-با-ویژگیهای-موجود-زبان"><span
class="header-section-number">2.10.2</span> 3.2.2 یکپارچگی با ویژگی‌های
موجود زبان</h3>
<p>سیستم بازتاب برای یکپارچگی یکپارچه با ویژگی‌های موجود C++، به ویژه
قالب‌ها و کانسپت‌ها طراحی شده است [62]. این یکپارچگی الگوهای ترکیب قدرتمند
را امکان‌پذیر می‌کند:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">concept</span> Reflectable <span class="op">=</span> <span class="kw">requires</span> <span class="op">{</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">typename</span> <span class="dt">get_data_members_t</span><span class="op">&lt;</span>reflexpr<span class="op">(</span>T<span class="op">)&gt;;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span>Reflectable T<span class="op">&gt;</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="bu">std::</span>string to_json<span class="op">(</span><span class="at">const</span> T<span class="op">&amp;</span> obj<span class="op">)</span> <span class="op">{</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// سریال‌سازی مبتنی بر بازتاب با محدودیت‌های کانسپت</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> detail::serialize_impl<span class="op">(</span>obj<span class="op">,</span> reflexpr<span class="op">(</span>T<span class="op">));</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="2.10.3" id="طراحی-عملکرد-محور"><span
class="header-section-number">2.10.3</span> 3.2.3 طراحی عملکرد-محور</h3>
<p>هر جنبه از API بازتاب برای به حداقل رساندن سربار کامپایل و تضمین
هزینه صفر زمان اجرا طراحی شده است [63]. استفاده از ارزیابی constexpr و
گسترش template parameter pack نیاز به dispatch زمان اجرا یا فراخوانی‌های
تابع مجازی را حذف می‌کند:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">// بازتاب سنتی زمان اجرا (سبک جاوا)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Object field = obj.getClass().getField(&quot;name&quot;);</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">// String value = (String) field.get(obj);  // Dispatch زمان اجرا</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">// بازتاب زمان کامپایل C++23</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">auto</span> Member<span class="op">&gt;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="kw">auto</span> get_field_value<span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> obj<span class="op">)</span> <span class="op">{</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> obj<span class="op">.*(</span>get_pointer_v<span class="op">&lt;</span>Member<span class="op">&gt;);</span>  <span class="co">// دسترسی مستقیم حافظه</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 data-number="2.11" id="یکپارچگی-با-سیستم-قالب-موجود"><span
class="header-section-number">2.11</span> 3.3 یکپارچگی با سیستم قالب
موجود</h2>
<h3 data-number="2.11.1" id="بهبود-استنتاج-پارامتر-قالب"><span
class="header-section-number">2.11.1</span> 3.3.1 بهبود استنتاج پارامتر
قالب</h3>
<p>بازتاب استنتاج پارامتر قالب را با ارائه دسترسی مستقیم به ساختار نوع
بهبود می‌بخشد و نیاز به ساختارهای پیچیده SFINAE را حذف می‌کند [64]:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">// رویکرد سنتی SFINAE</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">auto</span> serialize_impl<span class="op">(</span><span class="at">const</span> T<span class="op">&amp;</span> obj<span class="op">)</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">-&gt;</span> <span class="bu">std::</span>enable_if_t<span class="op">&lt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>conjunction_v<span class="op">&lt;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>is_default_constructible<span class="op">&lt;</span>T<span class="op">&gt;,</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>is_copy_constructible<span class="op">&lt;</span>T<span class="op">&gt;,</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>            has_member_serialize<span class="op">&lt;</span>T<span class="op">&gt;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;,</span> </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// منطق استنتاج پیچیده</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">// رویکرد مبتنی بر بازتاب</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="bu">std::</span>string serialize<span class="op">(</span><span class="at">const</span> T<span class="op">&amp;</span> obj<span class="op">)</span> </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">requires</span> <span class="kw">requires</span> <span class="op">{</span> reflexpr<span class="op">(</span>T<span class="op">);</span> <span class="op">}</span> <span class="op">{</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تحلیل مستقیم نوع بدون ماشین‌آلات پیچیده قالب</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> members <span class="op">=</span> <span class="dt">get_data_members_t</span><span class="op">&lt;</span>reflexpr<span class="op">(</span>T<span class="op">)&gt;{};</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> serialize_members<span class="op">(</span>obj<span class="op">,</span> members<span class="op">);</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="2.11.2" id="بهبود-قالب-variadic"><span
class="header-section-number">2.11.2</span> 3.3.2 بهبود قالب
Variadic</h3>
<p>بازتاب به خوبی با قالب‌های variadic کار می‌کند و الگوهای قدرتمند
برنامه‌نویسی عمومی را امکان‌پذیر می‌سازد [65]:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span><span class="op">...</span> Types<span class="op">&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> variant_serializer <span class="op">{</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="bu">std::</span>string serialize_variant<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>variant<span class="op">&lt;</span>Types<span class="op">...&gt;&amp;</span> var<span class="op">)</span> <span class="op">{</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span><span class="bu">std::</span>holds_alternative<span class="op">&lt;</span>T<span class="op">&gt;(</span>var<span class="op">))</span> <span class="op">{</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dt">serialize_reflected_type</span><span class="op">(</span><span class="bu">std::</span>get<span class="op">&lt;</span>T<span class="op">&gt;(</span>var<span class="op">));</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dt">serialize_next_type</span><span class="op">&lt;</span><span class="co">/* next type */</span><span class="op">&gt;(</span>var<span class="op">);</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="bu">std::</span>string <span class="dt">serialize_reflected_type</span><span class="op">(</span><span class="at">const</span> T<span class="op">&amp;</span> obj<span class="op">)</span> <span class="op">{</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">// استفاده از بازتاب برای سریال‌سازی بدون تخصص‌یابی صریح</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> reflect_serialize<span class="op">(</span>obj<span class="op">,</span> meta<span class="op">);</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<h3 data-number="2.11.3" id="کاهش-تخصصیابی-قالب"><span
class="header-section-number">2.11.3</span> 3.3.3 کاهش تخصص‌یابی
قالب</h3>
<p>یکی از مهم‌ترین مزایای بازتاب کاهش چشمگیر تخصص‌یابی‌های قالب مورد نیاز
است [66]. یک type trait را در نظر بگیرید که تشخیص می‌دهد آیا نوعی عضو
خاصی دارد:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">// رویکرد سنتی: نیاز به تخصص‌یابی صریح یا SFINAE پیچیده</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">,</span> <span class="kw">typename</span> <span class="op">=</span> <span class="dt">void</span><span class="op">&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> has_to_string <span class="op">:</span> <span class="bu">std::</span>false_type <span class="op">{};</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> has_to_string<span class="op">&lt;</span>T<span class="op">,</span> <span class="bu">std::</span>void_t<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span><span class="bu">std::</span>declval<span class="op">&lt;</span>T<span class="op">&gt;().</span>to_string<span class="op">())&gt;&gt;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> <span class="bu">std::</span>true_type <span class="op">{};</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">// رویکرد بازتاب: پیاده‌سازی عمومی واحد</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">bool</span> has_to_string_v <span class="op">=</span> <span class="op">[]()</span> <span class="op">{</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> functions <span class="op">=</span> <span class="dt">get_member_functions_t</span><span class="op">&lt;</span>meta<span class="op">&gt;{};</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">[]&lt;</span><span class="kw">auto</span><span class="op">...</span> Fs<span class="op">&gt;(</span><span class="bu">std::</span>index_sequence<span class="op">&lt;</span>Fs<span class="op">...&gt;)</span> <span class="op">{</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">((</span>get_name_v<span class="op">&lt;</span>get_element_v<span class="op">&lt;</span>Fs<span class="op">,</span> <span class="kw">decltype</span><span class="op">(</span>functions<span class="op">)&gt;&gt;</span> <span class="op">==</span> <span class="st">&quot;to_string&quot;</span><span class="op">)</span> <span class="op">||</span> <span class="op">...);</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}(</span><span class="bu">std::</span>make_index_sequence<span class="op">&lt;</span>get_size_v<span class="op">&lt;</span>functions<span class="op">&gt;&gt;{});</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="op">}();</span></span></code></pre></div>
<h2 data-number="2.12" id="تحلیل-نحوی-و-معنایی"><span
class="header-section-number">2.12</span> 3.4 تحلیل نحوی و معنایی</h2>
<h3 data-number="2.12.1" id="عملگر-reflexpr"><span
class="header-section-number">2.12.1</span> 3.4.1 عملگر reflexpr</h3>
<p>عملگر <code>reflexpr</code> به عنوان نقطه ورود اصلی به سیستم بازتاب
عمل می‌کند [67]. انواع مختلف ساختارهای زبان را می‌پذیرد و متا-آبجکت‌های
مربوطه را برمی‌گرداند:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">// بازتاب نوع</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="kw">auto</span> type_meta <span class="op">=</span> reflexpr<span class="op">(</span><span class="dt">int</span><span class="op">);</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="kw">auto</span> class_meta <span class="op">=</span> reflexpr<span class="op">(</span><span class="bu">std::</span>string<span class="op">);</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">// بازتاب namespace</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="kw">auto</span> std_meta <span class="op">=</span> reflexpr<span class="op">(</span>std<span class="op">);</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">// بازتاب متغیر</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> global_var <span class="op">=</span> <span class="dv">42</span><span class="op">;</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="kw">auto</span> var_meta <span class="op">=</span> reflexpr<span class="op">(</span>global_var<span class="op">);</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co">// بازتاب تابع</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> my_function<span class="op">(</span><span class="dt">int</span><span class="op">,</span> <span class="dt">double</span><span class="op">);</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="kw">auto</span> func_meta <span class="op">=</span> reflexpr<span class="op">(</span>my_function<span class="op">);</span></span></code></pre></div>
<p>عملگر اعتبارسنجی زمان کامپایل انجام می‌دهد تا اطمینان حاصل کند که
آرگومان ارائه شده یک هدف بازتاب معتبر است [68].</p>
<h3 data-number="2.12.2" id="پروتکلهای-متا-آبجکت"><span
class="header-section-number">2.12.2</span> 3.4.2 پروتکل‌های
متا-آبجکت</h3>
<p>سیستم بازتاب چندین دسته از متا-آبجکت‌ها را تعریف می‌کند، هر کدام با
رابط‌های کوئری خاص [69]:</p>
<p><strong>متا-آبجکت‌های نوع:</strong></p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="bu">std::</span>meta::info TypeMeta<span class="op">&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">requires</span> <span class="bu">std::</span>meta::is_type<span class="op">(</span>TypeMeta<span class="op">)</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> type_analyzer <span class="op">{</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="kw">constexpr</span> <span class="dt">bool</span> is_fundamental <span class="op">=</span> <span class="bu">std::</span>meta::is_fundamental_v<span class="op">&lt;</span>TypeMeta<span class="op">&gt;;</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="kw">constexpr</span> <span class="dt">bool</span> is_class <span class="op">=</span> <span class="bu">std::</span>meta::is_class_v<span class="op">&lt;</span>TypeMeta<span class="op">&gt;;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="kw">constexpr</span> <span class="kw">auto</span> name <span class="op">=</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>TypeMeta<span class="op">&gt;;</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="kw">constexpr</span> <span class="kw">auto</span> size <span class="op">=</span> <span class="bu">std::</span>meta::get_size_v<span class="op">&lt;</span>TypeMeta<span class="op">&gt;;</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p><strong>متا-آبجکت‌های عضو:</strong></p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="bu">std::</span>meta::info MemberMeta<span class="op">&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">requires</span> <span class="bu">std::</span>meta::is_data_member<span class="op">(</span>MemberMeta<span class="op">)</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> member_analyzer <span class="op">{</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="kw">constexpr</span> <span class="kw">auto</span> name <span class="op">=</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>MemberMeta<span class="op">&gt;;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="kw">constexpr</span> <span class="kw">auto</span> type <span class="op">=</span> <span class="bu">std::</span>meta::get_type_t<span class="op">&lt;</span>MemberMeta<span class="op">&gt;;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="kw">constexpr</span> <span class="kw">auto</span> offset <span class="op">=</span> <span class="bu">std::</span>meta::get_offset_v<span class="op">&lt;</span>MemberMeta<span class="op">&gt;;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="kw">constexpr</span> <span class="dt">bool</span> is_public <span class="op">=</span> <span class="bu">std::</span>meta::is_public_v<span class="op">&lt;</span>MemberMeta<span class="op">&gt;;</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<h3 data-number="2.12.3" id="زمینه-ارزیابی-constexpr"><span
class="header-section-number">2.12.3</span> 3.4.3 زمینه ارزیابی
Constexpr</h3>
<p>تمام عملیات بازتاب در زمینه‌های ارزیابی constexpr رخ می‌دهند و اجرای
زمان کامپایل را تضمین می‌کنند [70]. این الزام چندین تصمیم طراحی را هدایت
می‌کند:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="kw">auto</span> <span class="dt">analyze_type</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تمام کوئری‌های بازتاب باید constexpr باشند</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> member_count <span class="op">=</span> get_size_v<span class="op">&lt;</span><span class="dt">get_data_members_t</span><span class="op">&lt;</span>meta<span class="op">&gt;&gt;;</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> is_trivial <span class="op">=</span> is_trivially_copyable_v<span class="op">&lt;</span>meta<span class="op">&gt;;</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> analysis_result <span class="op">{</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">size_t</span> members<span class="op">;</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">bool</span> trivial<span class="op">;</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string_view name<span class="op">;</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> analysis_result<span class="op">{</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>members <span class="op">=</span> member_count<span class="op">,</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>trivial <span class="op">=</span> is_trivial<span class="op">,</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>name <span class="op">=</span> get_name_v<span class="op">&lt;</span>meta<span class="op">&gt;</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="co">// استفاده در زمان کامپایل</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="kw">auto</span> person_analysis <span class="op">=</span> <span class="dt">analyze_type</span><span class="op">&lt;</span>Person<span class="op">&gt;();</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="kw">static_assert</span><span class="op">(</span>person_analysis<span class="op">.</span>members <span class="op">&gt;</span> <span class="dv">0</span><span class="op">);</span></span></code></pre></div>
<h2 data-number="2.13" id="الگوهای-پیشرفته-بازتاب"><span
class="header-section-number">2.13</span> 3.5 الگوهای پیشرفته
بازتاب</h2>
<h3 data-number="2.13.1" id="کامپایل-شرطی-بر-اساس-ساختار-نوع"><span
class="header-section-number">2.13.1</span> 3.5.1 کامپایل شرطی بر اساس
ساختار نوع</h3>
<p>بازتاب کامپایل شرطی پیچیده بر اساس ساختار واقعی نوع به جای
تخصص‌یابی‌های شکننده قالب را امکان‌پذیر می‌کند [71]:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">auto</span> serialize<span class="op">(</span><span class="at">const</span> T<span class="op">&amp;</span> obj<span class="op">)</span> <span class="op">{</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span>has_custom_serializer_v<span class="op">&lt;</span>T<span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> obj<span class="op">.</span>serialize<span class="op">();</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span>is_container_v<span class="op">&lt;</span>meta<span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> serialize_container<span class="op">(</span>obj<span class="op">,</span> meta<span class="op">);</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span>is_arithmetic_v<span class="op">&lt;</span>meta<span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> serialize_arithmetic<span class="op">(</span>obj<span class="op">);</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> serialize_aggregate<span class="op">(</span>obj<span class="op">,</span> meta<span class="op">);</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="2.13.2" id="تطبیق-نوع-و-تولید-پراکسی"><span
class="header-section-number">2.13.2</span> 3.5.2 تطبیق نوع و تولید
پراکسی</h3>
<p>بازتاب تولید خودکار کلاس‌های آداپتور و پراکسی را تسهیل می‌کند [72]:</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> Interface<span class="op">&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> reflection_proxy <span class="op">{</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>any <span class="va">target_</span><span class="op">;</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> Implementation<span class="op">&gt;</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    reflection_proxy<span class="op">(</span>Implementation<span class="op">&amp;&amp;</span> impl<span class="op">)</span> <span class="op">:</span> <span class="va">target_</span><span class="op">(</span><span class="bu">std::</span>forward<span class="op">&lt;</span>Implementation<span class="op">&gt;(</span>impl<span class="op">))</span> <span class="op">{}</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید خودکار توابع forwarding برای تمام متدهای رابط</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">auto</span> Method<span class="op">&gt;</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">requires</span> <span class="bu">std::</span>meta::is_member_function<span class="op">(</span>Method<span class="op">)</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> invoke<span class="op">(</span><span class="kw">auto</span><span class="op">&amp;&amp;...</span> args<span class="op">)</span> <span class="op">{</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> method_name <span class="op">=</span> get_name_v<span class="op">&lt;</span>Method<span class="op">&gt;;</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> <span class="dt">return_type</span> <span class="op">=</span> <span class="dt">get_return_type_t</span><span class="op">&lt;</span>Method<span class="op">&gt;;</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// استفاده از بازتاب برای یافتن و فراخوانی متد مربوطه روی target</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> invoke_by_name<span class="op">&lt;</span>method_name<span class="op">&gt;(</span><span class="bu">std::</span>any_cast<span class="op">&lt;</span><span class="kw">auto</span><span class="op">&amp;&gt;(</span><span class="va">target_</span><span class="op">),</span> </span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>                                         <span class="bu">std::</span>forward<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>args<span class="op">)&gt;(</span>args<span class="op">)...);</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<h3 data-number="2.13.3" id="پیادهسازی-الگوی-طراحی-زمان-کامپایل"><span
class="header-section-number">2.13.3</span> 3.5.3 پیاده‌سازی الگوی طراحی
زمان کامپایل</h3>
<p>بازتاب پیاده‌سازی خودکار الگوهای طراحی رایج را امکان‌پذیر می‌کند
[73]:</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> auto_visitor <span class="op">{</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید پیاده‌سازی الگوی visitor بر اساس سلسله‌مراتب نوع</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>meta::is_polymorphic_v<span class="op">&lt;</span>reflexpr<span class="op">(</span>T<span class="op">)&gt;);</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> Visitor<span class="op">&gt;</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="kw">auto</span> visit<span class="op">(</span><span class="at">const</span> T<span class="op">&amp;</span> obj<span class="op">,</span> Visitor<span class="op">&amp;&amp;</span> visitor<span class="op">)</span> <span class="op">{</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> derived_types <span class="op">=</span> <span class="dt">get_derived_types_t</span><span class="op">&lt;</span>reflexpr<span class="op">(</span>T<span class="op">)&gt;{};</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> visit_impl<span class="op">(</span>obj<span class="op">,</span> <span class="bu">std::</span>forward<span class="op">&lt;</span>Visitor<span class="op">&gt;(</span>visitor<span class="op">),</span> derived_types<span class="op">);</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> Visitor<span class="op">,</span> <span class="kw">auto</span><span class="op">...</span> DerivedMetas<span class="op">&gt;</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="kw">auto</span> visit_impl<span class="op">(</span><span class="at">const</span> T<span class="op">&amp;</span> obj<span class="op">,</span> Visitor<span class="op">&amp;&amp;</span> visitor<span class="op">,</span> </span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>                          <span class="bu">std::</span>index_sequence<span class="op">&lt;</span>DerivedMetas<span class="op">...&gt;)</span> <span class="op">{</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تولید dispatch پویای ایمن نوع با استفاده از typeid</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">const</span> <span class="bu">std::</span>type_info<span class="op">&amp;</span> <span class="dt">runtime_type</span> <span class="op">=</span> <span class="kw">typeid</span><span class="op">(</span>obj<span class="op">);</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> result <span class="op">=</span> <span class="bu">std::</span>optional<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>visitor<span class="op">(</span><span class="bu">std::</span>declval<span class="op">&lt;</span>T<span class="op">&gt;()))&gt;{};</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">((</span><span class="dt">runtime_type</span> <span class="op">==</span> <span class="kw">typeid</span><span class="op">(</span><span class="dt">get_reflected_type_t</span><span class="op">&lt;</span>DerivedMetas<span class="op">&gt;)</span> <span class="op">?</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>          <span class="op">(</span>result <span class="op">=</span> visitor<span class="op">(</span><span class="kw">static_cast</span><span class="op">&lt;</span><span class="at">const</span> <span class="dt">get_reflected_type_t</span><span class="op">&lt;</span>DerivedMetas<span class="op">&gt;&amp;&gt;(</span>obj<span class="op">)),</span> <span class="kw">true</span><span class="op">)</span> <span class="op">:</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>          <span class="kw">false</span><span class="op">)</span> <span class="op">||</span> <span class="op">...);</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">*</span>result<span class="op">;</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<h2 data-number="2.14" id="ملاحظات-پیادهسازی-کامپایلر"><span
class="header-section-number">2.14</span> 3.6 ملاحظات پیاده‌سازی
کامپایلر</h2>
<h3 data-number="2.14.1" id="یکپارچگی-فاز-کامپایل"><span
class="header-section-number">2.14.1</span> 3.6.1 یکپارچگی فاز
کامپایل</h3>
<p>بازتاب C++23 نیاز به یکپارچگی دقیق با خط لوله کامپایل دارد [74].
متا-آبجکت‌ها باید در طول نمونه‌سازی قالب در دسترس باشند در حالی که اصول
کامپایل جداگانه را حفظ کنند:</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">// کامپایلر باید وابستگی‌های متا-آبجکت را ردیابی کند</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="kw">auto</span> get_serialization_info<span class="op">()</span> <span class="op">{</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> reflexpr<span class="op">(</span>T<span class="op">);</span>  <span class="co">// وابستگی به تعریف کامل T</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> analyze_serialization_requirements<span class="op">(</span>meta<span class="op">);</span>  <span class="co">// باید برای نمونه‌سازی در دسترس باشد</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">// استفاده در واحد ترجمه جداگانه</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="at">extern</span> <span class="kw">template</span> <span class="kw">auto</span> get_serialization_info<span class="op">&lt;</span>MyClass<span class="op">&gt;();</span>  <span class="co">// پشتیبانی اعلان forward</span></span></code></pre></div>
<h3 data-number="2.14.2" id="اطلاعات-دیباگ-و-یکپارچگی-ابزار"><span
class="header-section-number">2.14.2</span> 3.6.2 اطلاعات دیباگ و
یکپارچگی ابزار</h3>
<p>متا-آبجکت‌های بازتاب باید با ابزارهای دیباگ و توسعه یکپارچه شوند
[75]:</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> debug_print_type_info<span class="op">()</span> <span class="op">{</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// بیلدهای دیباگ باید اطلاعات بازتاب را حفظ کنند</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// برای یکپارچگی IDE و ابزارهای دیباگ</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>meta::is_debug_build<span class="op">())</span> <span class="op">{</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>        emit_debug_info<span class="op">(</span>meta<span class="op">);</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="2.14.3" id="فرصتهای-بهینهسازی"><span
class="header-section-number">2.14.3</span> 3.6.3 فرصت‌های بهینه‌سازی</h3>
<p>کامپایلرها می‌توانند از اطلاعات بازتاب برای بهینه‌سازی‌های پیشرفته
استفاده کنند [76]:</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="bu">std::</span>string fast_serialize<span class="op">(</span><span class="at">const</span> T<span class="op">&amp;</span> obj<span class="op">)</span> <span class="op">{</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// کامپایلر می‌تواند بر اساس تحلیل نوع زمان کامپایل بهینه‌سازی کند</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span>is_pod_serializable_v<span class="op">&lt;</span>meta<span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تولید سریال‌سازی مبتنی بر memcpy</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> serialize_pod<span class="op">(</span>obj<span class="op">);</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تولید سریال‌سازی فیلد به فیلد</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> serialize_structured<span class="op">(</span>obj<span class="op">,</span> meta<span class="op">);</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>این تحلیل نشان می‌دهد که بازتاب C++23 پایه‌ای جامع، ایمن نوع و کارآمد
برای درونگری زمان کامپایل و تولید کد فراهم می‌کند. بخش بعدی بررسی می‌کند
که چگونه متاکلاس‌ها بر این پایه بنا می‌شوند تا الگوهای برنامه‌نویسی تولیدی
حتی قدرتمندتری را امکان‌پذیر سازند.</p>
<hr />
<p><em>[مراجع 57-76 مطابق با مشخصات فنی دقیق، مطالعات پیاده‌سازی کامپایلر
و مقالات تحلیل عملکرد فهرست شده در کتابشناسی جامع ما]</em> # 4.
متاکلاس‌ها: طراحی و پیاده‌سازی</p>
<h2 data-number="2.15" id="مفهوم-و-انگیزه-متاکلاس"><span
class="header-section-number">2.15</span> 4.1 مفهوم و انگیزه
متاکلاس</h2>
<h3 data-number="2.15.1" id="چشمانداز-برنامهنویسی-تولیدی"><span
class="header-section-number">2.15.1</span> 4.1.1 چشم‌انداز برنامه‌نویسی
تولیدی</h3>
<p>متاکلاس‌ها نشان‌دهنده اوج دهه‌ها تحقیق در برنامه‌نویسی تولیدی و سنتز کد
زمان کامپایل هستند [77]. در حالی که بازتاب توانایی درونگری ساختارهای کد
موجود را فراهم می‌کند، متاکلاس‌ها <strong>تولید</strong> کد جدید بر اساس
الگوها، محدودیت‌ها و الزامات خاص دامنه را امکان‌پذیر می‌سازند.</p>
<p>بینش بنیادی پشت متاکلاس‌ها این است که بسیاری از الگوهای برنامه‌نویسی
شامل کد تکراری و غیرضروری هستند که از الگوهای قابل پیش‌بینی پیروی می‌کنند
[78]. سناریوهای رایج را در نظر بگیرید:</p>
<ul>
<li><strong>پیاده‌سازی خصوصیت</strong>: تولید خودکار getter ها، setter ها
و منطق اعتبارسنجی</li>
<li><strong>سریال‌سازی</strong>: تبدیل خودکار به/از فرمت‌های JSON، XML یا
باینری</li>
<li><strong>الگوی Observer</strong>: مکانیزم‌های اطلاع‌رسانی خودکار برای
تغییرات وضعیت</li>
<li><strong>نگاشت پایگاه داده</strong>: نگاشت سبک ORM بین آبجکت‌ها و
طرحواره‌های پایگاه داده</li>
<li><strong>پیاده‌سازی رابط</strong>: تولید خودکار delegation و
پراکسی</li>
</ul>
<p>رویکردهای سنتی به این مسائل شامل یا کدنویسی دستی گسترده یا
متابرنامه‌نویسی قالب پیچیده است. متاکلاس‌ها گزینه سومی ارائه می‌دهند:
<strong>مشخصه اعلانی</strong> رفتار مطلوب با تولید خودکار پیاده‌سازی
[79].</p>
<h3 data-number="2.15.2" id="فلسفه-و-اصول-طراحی"><span
class="header-section-number">2.15.2</span> 4.1.2 فلسفه و اصول
طراحی</h3>
<p>طراحی متاکلاس C++23 از چندین اصل کلیدی پیروی می‌کند [80]:</p>
<p><strong>قصد اعلانی</strong>: متاکلاس‌ها به توسعه‌دهندگان اجازه می‌دهند
بیان کنند <em>چه</em> می‌خواهند به جای <em>چگونه</em> پیاده‌سازی کنند:</p>
<div class="sourceCode" id="cb28"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">// مشخصه اعلانی</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>serializable <span class="er">$</span>observable Person <span class="op">{</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string name<span class="op">;</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> age<span class="op">;</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> salary<span class="op">;</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co">// به طور خودکار تولید می‌کند:</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co">// - متدهای to_json() / from_json()</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co">// - ثبت/اطلاع‌رسانی Observer</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co">// - دسترسی‌کننده‌های خصوصیت با اعتبارسنجی</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co">// - عملگرهای برابری و مقایسه</span></span></code></pre></div>
<p><strong>قابلیت ترکیب</strong>: چندین متاکلاس می‌توانند به یک نوع اعمال
شوند، با معناشناسی ترکیب به خوبی تعریف شده:</p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>entity<span class="op">(</span><span class="st">&quot;users&quot;</span><span class="op">)</span> <span class="er">$</span>auditable <span class="er">$</span>cacheable User <span class="op">{</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ترکیب نگاشت پایگاه داده، لاگ حسابرسی و کش</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p><strong>ایمنی نوع</strong>: تمام تبدیل‌های متاکلاس در زمان کامپایل
نوع-بررسی و اعتبارسنجی می‌شوند و از خطاهای زمان اجرا رایج در رویکردهای
تولید کد جلوگیری می‌کنند.</p>
<p><strong>سربار صفر زمان اجرا</strong>: کد تولید شده از نظر ویژگی‌های
عملکرد قابل تشخیص از کد دست‌نویس نیست.</p>
<h3 data-number="2.15.3" id="رابطه-با-بازتاب"><span
class="header-section-number">2.15.3</span> 4.1.3 رابطه با بازتاب</h3>
<p>متاکلاس‌ها به طور بنیادی بر زیرساخت بازتاب توضیح داده شده در بخش 3 بنا
می‌شوند. رابطه هم‌زیست است [81]:</p>
<div class="sourceCode" id="cb30"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> serializable<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// پیاده‌سازی متاکلاس از بازتاب برای تحلیل نوع هدف استفاده می‌کند</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::compiler<span class="op">.</span>require<span class="op">(</span><span class="bu">std::</span>meta::is_class<span class="op">(</span>target<span class="op">),</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;serializable can only be applied to classes&quot;</span><span class="op">);</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تکرار روی اعضای داده با استفاده از بازتاب</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> member <span class="op">:</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>target<span class="op">))</span> <span class="op">{</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>        generate_serialization_code<span class="op">(</span>member<span class="op">);</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید متدها بر اساس ساختار نوع</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::compiler<span class="op">.</span>declare<span class="op">(</span>target<span class="op">,</span> generate_to_json_method<span class="op">(</span>target<span class="op">));</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::compiler<span class="op">.</span>declare<span class="op">(</span>target<span class="op">,</span> generate_from_json_method<span class="op">(</span>target<span class="op">));</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 data-number="2.16" id="نحو-تعریف-متاکلاس"><span
class="header-section-number">2.16</span> 4.2 نحو تعریف متاکلاس</h2>
<h3 data-number="2.16.1" id="اعلان-پایه-متاکلاس"><span
class="header-section-number">2.16.1</span> 4.2.1 اعلان پایه
متاکلاس</h3>
<p>متاکلاس‌ها به عنوان توابع constexpr تعریف می‌شوند که روی آبجکت‌های
<code>std::meta::info</code> نمایش‌دهنده نوع هدف عمل می‌کنند [82]:</p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;experimental/meta&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> property<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// اعتبارسنجی که target یک کلاس است</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::compiler<span class="op">.</span>require<span class="op">(</span><span class="bu">std::</span>meta::is_class<span class="op">(</span>target<span class="op">),</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;property metaclass requires a class&quot;</span><span class="op">);</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید پیاده‌سازی خصوصیت</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> member <span class="op">:</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>target<span class="op">))</span> <span class="op">{</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span><span class="bu">std::</span>meta::is_private<span class="op">(</span>member<span class="op">))</span> <span class="op">{</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>            generate_property_accessors<span class="op">(</span>target<span class="op">,</span> member<span class="op">);</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="co">// استفاده</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>property Person <span class="op">{</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string <span class="va">name_</span><span class="op">;</span>  <span class="co">// تولید getName()، setName()</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="va">age_</span><span class="op">;</span>          <span class="co">// تولید getAge()، setAge()</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<h3 data-number="2.16.2" id="متاکلاسهای-پارامتری"><span
class="header-section-number">2.16.2</span> 4.2.2 متاکلاس‌های
پارامتری</h3>
<p>متاکلاس‌ها می‌توانند پارامترهایی برای شخصی‌سازی رفتار خود بپذیرند
[83]:</p>
<div class="sourceCode" id="cb32"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> entity<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">,</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>                     <span class="bu">std::</span>string_view table_name <span class="op">=</span> <span class="st">&quot;&quot;</span><span class="op">,</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>                     <span class="dt">bool</span> generate_crud <span class="op">=</span> <span class="kw">true</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> actual_table <span class="op">=</span> table_name<span class="op">.</span>empty<span class="op">()</span> <span class="op">?</span> </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>target<span class="op">&gt;</span> <span class="op">:</span> table_name<span class="op">;</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید نگاشت جدول</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    generate_table_mapping<span class="op">(</span>target<span class="op">,</span> actual_table<span class="op">);</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>generate_crud<span class="op">)</span> <span class="op">{</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>        generate_crud_operations<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="co">// استفاده با پارامترها</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>entity<span class="op">(</span><span class="st">&quot;user_accounts&quot;</span><span class="op">,</span> <span class="kw">true</span><span class="op">)</span> User <span class="op">{</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> id<span class="op">;</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string username<span class="op">;</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string email<span class="op">;</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<h3 data-number="2.16.3" id="اعمال-شرطی-متاکلاس"><span
class="header-section-number">2.16.3</span> 4.2.3 اعمال شرطی
متاکلاس</h3>
<p>متاکلاس‌ها می‌توانند منطق شرطی بر اساس ویژگی‌های نوع شامل شوند [84]:</p>
<div class="sourceCode" id="cb33"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> smart_serializable<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// استراتژی‌های مختلف بر اساس پیچیدگی نوع</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> members <span class="op">=</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span><span class="bu">std::</span>meta::get_size_v<span class="op">&lt;</span>members<span class="op">&gt;</span> <span class="op">&lt;=</span> <span class="dv">5</span> <span class="op">&amp;&amp;</span> all_pod_members<span class="op">(</span>members<span class="op">))</span> <span class="op">{</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>        generate_binary_serialization<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>has_string_members<span class="op">(</span>members<span class="op">))</span> <span class="op">{</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>        generate_json_serialization<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>        generate_xml_serialization<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// همیشه اعتبارسنجی تولید کن</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    generate_validation_methods<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 data-number="2.17" id="مکانیزمهای-تولید-کد"><span
class="header-section-number">2.17</span> 4.3 مکانیزم‌های تولید کد</h2>
<h3 data-number="2.17.1" id="رابط-کامپایلر"><span
class="header-section-number">2.17.1</span> 4.3.1 رابط کامپایلر</h3>
<p>رابط <code>std::meta::compiler</code> مکانیزم اصلی برای تولید کد
فراهم می‌کند [85]. این رابط به متاکلاس‌ها اجازه تزریق اعلان‌های جدید به نوع
هدف را می‌دهد:</p>
<div class="sourceCode" id="cb34"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> <span class="bu">std::</span>meta <span class="op">{</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> compiler_interface <span class="op">{</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تزریق یک تابع عضو جدید</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> <span class="kw">constexpr</span> <span class="dt">void</span> declare<span class="op">(</span>info target<span class="op">,</span> <span class="bu">std::</span>string_view code<span class="op">);</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تزریق یک عضو داده جدید</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> <span class="kw">constexpr</span> <span class="dt">void</span> declare_member<span class="op">(</span>info target<span class="op">,</span> info type<span class="op">,</span> </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>                                           <span class="bu">std::</span>string_view name<span class="op">);</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// الزام یک شرط (assertion زمان کامپایل)</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> <span class="kw">constexpr</span> <span class="dt">void</span> require<span class="op">(</span><span class="dt">bool</span> condition<span class="op">,</span> <span class="bu">std::</span>string_view message<span class="op">);</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تولید پیام‌های تشخیصی</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> <span class="kw">constexpr</span> <span class="dt">void</span> warn<span class="op">(</span><span class="bu">std::</span>string_view message<span class="op">);</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> <span class="kw">constexpr</span> <span class="dt">void</span> error<span class="op">(</span><span class="bu">std::</span>string_view message<span class="op">);</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="2.17.2" id="تولید-کد-مبتنی-بر-قالب"><span
class="header-section-number">2.17.2</span> 4.3.2 تولید کد مبتنی بر
قالب</h3>
<p>متاکلاس‌ها اغلب از تکنیک‌های قالب برای تولید کد ایمن نوع استفاده می‌کنند
[86]:</p>
<div class="sourceCode" id="cb35"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> comparable<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید عملگرهای مقایسه بر اساس ساختار عضو</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string equality_impl <span class="op">=</span> <span class="st">R&quot;(</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="vs">        bool operator==(const </span><span class="st">)&quot;</span> <span class="op">+</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>target<span class="op">&gt;</span> <span class="op">+</span> <span class="st">R&quot;(</span><span class="vs">&amp; other) const {</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="vs">            return true</span><span class="st">)&quot;</span><span class="op">;</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> member <span class="op">:</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>target<span class="op">))</span> <span class="op">{</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> member_name <span class="op">=</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>member<span class="op">&gt;;</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>        equality_impl <span class="op">+=</span> <span class="st">&quot; &amp;&amp; (&quot;</span> <span class="op">+</span> member_name <span class="op">+</span> <span class="st">&quot; == other.&quot;</span> <span class="op">+</span> member_name <span class="op">+</span> <span class="st">&quot;)&quot;</span><span class="op">;</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    equality_impl <span class="op">+=</span> <span class="st">R&quot;(</span><span class="vs">;</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="vs">        bool operator!=(const </span><span class="st">)&quot;</span> <span class="op">+</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>target<span class="op">&gt;</span> <span class="op">+</span> <span class="st">R&quot;(</span><span class="vs">&amp; other) const {</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="vs">            return !(*this == other);</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="vs">        auto operator&lt;=&gt;(const </span><span class="st">)&quot;</span> <span class="op">+</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>target<span class="op">&gt;</span> <span class="op">+</span> <span class="st">R&quot;(</span><span class="vs">&amp; other) const {</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="vs">            // مقایسه سه‌طرفه با استفاده از std::tie</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="vs">            return std::tie(</span><span class="st">)&quot;</span><span class="op">;</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> first <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> member <span class="op">:</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>target<span class="op">))</span> <span class="op">{</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>first<span class="op">)</span> equality_impl <span class="op">+=</span> <span class="st">&quot;, &quot;</span><span class="op">;</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>        equality_impl <span class="op">+=</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>member<span class="op">&gt;;</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>        first <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>    equality_impl <span class="op">+=</span> <span class="st">R&quot;(</span><span class="vs">) &lt;=&gt; std::tie(</span><span class="st">)&quot;</span><span class="op">;</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>    first <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> member <span class="op">:</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>target<span class="op">))</span> <span class="op">{</span></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>first<span class="op">)</span> equality_impl <span class="op">+=</span> <span class="st">&quot;, &quot;</span><span class="op">;</span></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>        equality_impl <span class="op">+=</span> <span class="st">&quot;other.&quot;</span> <span class="op">+</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>member<span class="op">&gt;;</span></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>        first <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>    equality_impl <span class="op">+=</span> <span class="st">&quot;);&quot;</span><span class="op">;</span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>    equality_impl <span class="op">+=</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">}&quot;</span><span class="op">;</span></span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::compiler<span class="op">.</span>declare<span class="op">(</span>target<span class="op">,</span> equality_impl<span class="op">);</span></span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="2.17.3" id="الگوهای-پیشرفته-سنتز-کد"><span
class="header-section-number">2.17.3</span> 4.3.3 الگوهای پیشرفته سنتز
کد</h3>
<p>متاکلاس‌های پیچیده ممکن است نیاز به استراتژی‌های پیچیده تولید کد داشته
باشند [87]:</p>
<div class="sourceCode" id="cb36"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> state_machine<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">,</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>                           <span class="bu">std::</span>span<span class="op">&lt;</span><span class="at">const</span> state_transition<span class="op">&gt;</span> transitions<span class="op">)</span> <span class="op">{</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// اعتبارسنجی تعریف ماشین حالت</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    validate_state_machine<span class="op">(</span>target<span class="op">,</span> transitions<span class="op">);</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید شمارش حالت</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    generate_state_enum<span class="op">(</span>target<span class="op">,</span> transitions<span class="op">);</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید جدول انتقال</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    generate_transition_table<span class="op">(</span>target<span class="op">,</span> transitions<span class="op">);</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید متدهای ماشین حالت</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string machine_impl <span class="op">=</span> <span class="st">R&quot;(</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="vs">    private:</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="vs">        State current_state_ = State::</span><span class="st">)&quot;</span> <span class="op">+</span> get_initial_state<span class="op">(</span>transitions<span class="op">)</span> <span class="op">+</span> <span class="st">R&quot;(</span><span class="vs">;</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="vs">    public:</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="vs">        State get_state() const { return current_state_; }</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="vs">        template&lt;typename Event&gt;</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="vs">        bool process_event(const Event&amp; event) {</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a><span class="vs">            auto new_state = transition_table_.find({current_state_, typeid(Event)});</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a><span class="vs">            if (new_state != transition_table_.end()) {</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a><span class="vs">                auto old_state = current_state_;</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a><span class="vs">                current_state_ = new_state-&gt;second;</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a><span class="vs">                on_state_change(old_state, current_state_, event);</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a><span class="vs">                return true;</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a><span class="vs">            }</span></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a><span class="vs">            return false;</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a><span class="vs">    protected:</span></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a><span class="vs">        virtual void on_state_change(State from, State to, const auto&amp; event) </span><span class="sc">{}</span></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="st">)&quot;</span><span class="op">;</span></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::compiler<span class="op">.</span>declare<span class="op">(</span>target<span class="op">,</span> machine_impl<span class="op">);</span></span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 data-number="2.18" id="الگوهای-پیشرفته-متاکلاس"><span
class="header-section-number">2.18</span> 4.4 الگوهای پیشرفته
متاکلاس</h2>
<h3 data-number="2.18.1" id="تولید-و-پیادهسازی-رابط"><span
class="header-section-number">2.18.1</span> 4.4.1 تولید و پیاده‌سازی
رابط</h3>
<p>متاکلاس‌ها می‌توانند پیاده‌سازی‌های رابط را بر اساس الگوها به طور خودکار
تولید کنند [88]:</p>
<div class="sourceCode" id="cb37"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> rest_api<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">,</span> <span class="bu">std::</span>string_view base_path<span class="op">)</span> <span class="op">{</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید endpoint های REST API بر اساس متدهای عمومی</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> method <span class="op">:</span> <span class="bu">std::</span>meta::member_functions_of<span class="op">(</span>target<span class="op">))</span> <span class="op">{</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span><span class="bu">std::</span>meta::is_public<span class="op">(</span>method<span class="op">))</span> <span class="op">{</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> method_name <span class="op">=</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>method<span class="op">&gt;;</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> <span class="dt">return_type</span> <span class="op">=</span> <span class="bu">std::</span>meta::get_return_type_t<span class="op">&lt;</span>method<span class="op">&gt;;</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> parameters <span class="op">=</span> <span class="bu">std::</span>meta::get_parameters_t<span class="op">&lt;</span>method<span class="op">&gt;;</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>method_name<span class="op">.</span>starts_with<span class="op">(</span><span class="st">&quot;get&quot;</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>                generate_get_endpoint<span class="op">(</span>target<span class="op">,</span> method<span class="op">,</span> base_path<span class="op">);</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>method_name<span class="op">.</span>starts_with<span class="op">(</span><span class="st">&quot;create&quot;</span><span class="op">)</span> <span class="op">||</span> method_name<span class="op">.</span>starts_with<span class="op">(</span><span class="st">&quot;add&quot;</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>                generate_post_endpoint<span class="op">(</span>target<span class="op">,</span> method<span class="op">,</span> base_path<span class="op">);</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>method_name<span class="op">.</span>starts_with<span class="op">(</span><span class="st">&quot;update&quot;</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>                generate_put_endpoint<span class="op">(</span>target<span class="op">,</span> method<span class="op">,</span> base_path<span class="op">);</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>method_name<span class="op">.</span>starts_with<span class="op">(</span><span class="st">&quot;delete&quot;</span><span class="op">)</span> <span class="op">||</span> method_name<span class="op">.</span>starts_with<span class="op">(</span><span class="st">&quot;remove&quot;</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>                generate_delete_endpoint<span class="op">(</span>target<span class="op">,</span> method<span class="op">,</span> base_path<span class="op">);</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید جدول مسیریابی</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>    generate_routing_table<span class="op">(</span>target<span class="op">,</span> base_path<span class="op">);</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>rest_api<span class="op">(</span><span class="st">&quot;/api/users&quot;</span><span class="op">)</span> UserService <span class="op">{</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>    User getUser<span class="op">(</span><span class="dt">int</span> id<span class="op">);</span>           <span class="co">// تولید GET /api/users/{id}</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>    User createUser<span class="op">(</span><span class="at">const</span> User<span class="op">&amp;);</span>   <span class="co">// تولید POST /api/users</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> updateUser<span class="op">(</span><span class="dt">int</span> id<span class="op">,</span> <span class="at">const</span> User<span class="op">&amp;);</span>  <span class="co">// تولید PUT /api/users/{id}</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> deleteUser<span class="op">(</span><span class="dt">int</span> id<span class="op">);</span>        <span class="co">// تولید DELETE /api/users/{id}</span></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<h3 data-number="2.18.2" id="تولید-چارچوب-سریالسازی"><span
class="header-section-number">2.18.2</span> 4.4.2 تولید چارچوب
سریال‌سازی</h3>
<p>متاکلاس‌های سریال‌سازی پیشرفته می‌توانند سناریوهای پیچیده را مدیریت کنند
[89]:</p>
<div class="sourceCode" id="cb38"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> serializable<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">,</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>                          serialization_format format <span class="op">=</span> json<span class="op">,</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                          naming_convention naming <span class="op">=</span> snake_case<span class="op">)</span> <span class="op">{</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید سریال‌سازی خاص فرمت</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> <span class="op">(</span>format<span class="op">)</span> <span class="op">{</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> json<span class="op">:</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>            generate_json_serialization<span class="op">(</span>target<span class="op">,</span> naming<span class="op">);</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> xml<span class="op">:</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>            generate_xml_serialization<span class="op">(</span>target<span class="op">,</span> naming<span class="op">);</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> binary<span class="op">:</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>            generate_binary_serialization<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> protobuf<span class="op">:</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>            generate_protobuf_serialization<span class="op">(</span>target<span class="op">,</span> naming<span class="op">);</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید اعتبارسنجی طرحواره</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>    generate_schema_validation<span class="op">(</span>target<span class="op">,</span> format<span class="op">);</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید پشتیبانی نسخه‌بندی</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>    generate_version_handling<span class="op">(</span>target<span class="op">,</span> format<span class="op">);</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a><span class="co">// مثال سریال‌سازی پیچیده</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>serializable<span class="op">(</span>json<span class="op">,</span> snake_case<span class="op">)</span> <span class="er">$</span>versioned<span class="op">(</span><span class="dv">2</span><span class="op">)</span> Person <span class="op">{</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string full_name<span class="op">;</span>          <span class="co">// سریال‌سازی به عنوان &quot;full_name&quot;</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>optional<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> age<span class="op">;</span>         <span class="co">// مدیریت فیلد اختیاری</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> tags<span class="op">;</span>  <span class="co">// سریال‌سازی آرایه</span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">// طرحواره خودکار: {&quot;full_name&quot;: &quot;string&quot;, &quot;age&quot;: &quot;int?&quot;, &quot;tags&quot;: [&quot;string&quot;]}</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">// مدیریت نسخه: مهاجرت خودکار از v1 به v2</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<h3 data-number="2.18.3" id="orm-و-یکپارچگی-پایگاه-داده"><span
class="header-section-number">2.18.3</span> 4.4.3 ORM و یکپارچگی پایگاه
داده</h3>
<p>متاکلاس‌های جهت‌گیری پایگاه داده تولید کد پیچیده را نشان می‌دهند
[90]:</p>
<div class="sourceCode" id="cb39"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> entity<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">,</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                     <span class="bu">std::</span>string_view table_name<span class="op">,</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                     database_dialect dialect <span class="op">=</span> postgresql<span class="op">)</span> <span class="op">{</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید طرحواره جدول</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    generate_create_table_sql<span class="op">(</span>target<span class="op">,</span> table_name<span class="op">,</span> dialect<span class="op">);</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید عملیات CRUD</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    generate_find_methods<span class="op">(</span>target<span class="op">,</span> table_name<span class="op">,</span> dialect<span class="op">);</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    generate_save_method<span class="op">(</span>target<span class="op">,</span> table_name<span class="op">,</span> dialect<span class="op">);</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    generate_delete_method<span class="op">(</span>target<span class="op">,</span> table_name<span class="op">,</span> dialect<span class="op">);</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید متدهای query builder</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> member <span class="op">:</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>target<span class="op">))</span> <span class="op">{</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span><span class="bu">std::</span>meta::has_attribute<span class="op">&lt;</span>indexed<span class="op">&gt;(</span>member<span class="op">))</span> <span class="op">{</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>            generate_find_by_method<span class="op">(</span>target<span class="op">,</span> member<span class="op">,</span> table_name<span class="op">,</span> dialect<span class="op">);</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید مدیریت رابطه</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>    generate_relationship_methods<span class="op">(</span>target<span class="op">,</span> table_name<span class="op">,</span> dialect<span class="op">);</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>entity<span class="op">(</span><span class="st">&quot;users&quot;</span><span class="op">,</span> postgresql<span class="op">)</span> User <span class="op">{</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span>primary_key <span class="dt">int</span> id<span class="op">;</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span>indexed <span class="er">$</span>unique <span class="bu">std::</span>string email<span class="op">;</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string name<span class="op">;</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span>nullable <span class="bu">std::</span>optional<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> bio<span class="op">;</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span>one_to_many<span class="op">(</span><span class="st">&quot;user_id&quot;</span><span class="op">)</span> <span class="bu">std::</span>vector<span class="op">&lt;</span>Post<span class="op">&gt;</span> posts<span class="op">;</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span>many_to_one Profile profile<span class="op">;</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید می‌کند:</span></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">// static User find(int id);</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">// static std::vector&lt;User&gt; find_by_email(const std::string&amp; email);</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>    <span class="co">// static std::vector&lt;User&gt; find_all();</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">// void save();</span></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">// void delete();</span></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>    <span class="co">// std::vector&lt;Post&gt; get_posts();</span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Profile get_profile();</span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<h3 data-number="2.18.4" id="اتوماسیون-الگوی-طراحی"><span
class="header-section-number">2.18.4</span> 4.4.4 اتوماسیون الگوی
طراحی</h3>
<p>متاکلاس‌ها می‌توانند الگوهای طراحی پیچیده را به طور خودکار پیاده‌سازی
کنند [91]:</p>
<div class="sourceCode" id="cb40"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> observer<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید زیرساخت observer</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string observer_code <span class="op">=</span> <span class="st">R&quot;(</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="vs">    private:</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="vs">        mutable std::vector&lt;std::function&lt;void(const std::string&amp;)&gt;&gt; observers_;</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="vs">    public:</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="vs">        void add_observer(std::function&lt;void(const std::string&amp;)&gt; observer) {</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="vs">            observers_.push_back(std::move(observer));</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="vs">        void remove_observer(const std::function&lt;void(const std::string&amp;)&gt;&amp; observer) {</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="vs">            // پیاده‌سازی برای حذف observer</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="vs">    protected:</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="vs">        void notify_observers(const std::string&amp; property_name) const {</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="vs">            for (const auto&amp; observer : observers_) {</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="vs">                observer(property_name);</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="vs">            }</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="st">)&quot;</span><span class="op">;</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::compiler<span class="op">.</span>declare<span class="op">(</span>target<span class="op">,</span> observer_code<span class="op">);</span></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تغییر تمام setter ها برای شامل اطلاع‌رسانی</span></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> member <span class="op">:</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>target<span class="op">))</span> <span class="op">{</span></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>        generate_notifying_setter<span class="op">(</span>target<span class="op">,</span> member<span class="op">);</span></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> visitor<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید الگوی visitor برای سلسله‌مراتب</span></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::compiler<span class="op">.</span>require<span class="op">(</span><span class="bu">std::</span>meta::is_polymorphic_v<span class="op">&lt;</span>target<span class="op">&gt;,</span></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;visitor requires polymorphic type&quot;</span><span class="op">);</span></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> derived_types <span class="op">=</span> <span class="bu">std::</span>meta::get_derived_types_t<span class="op">&lt;</span>target<span class="op">&gt;;</span></span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید رابط visitor</span></span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>    generate_visitor_interface<span class="op">(</span>target<span class="op">,</span> derived_types<span class="op">);</span></span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید متدهای accept</span></span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>    generate_accept_methods<span class="op">(</span>target<span class="op">,</span> derived_types<span class="op">);</span></span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید کلاس پایه visitor مشخص</span></span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>    generate_visitor_base<span class="op">(</span>target<span class="op">,</span> derived_types<span class="op">);</span></span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 data-number="2.19" id="ترکیب-و-تعامل-متاکلاس"><span
class="header-section-number">2.19</span> 4.5 ترکیب و تعامل متاکلاس</h2>
<h3 data-number="2.19.1" id="معناشناسی-ترکیب"><span
class="header-section-number">2.19.1</span> 4.5.1 معناشناسی ترکیب</h3>
<p>زمانی که چندین متاکلاس به یک نوع اعمال می‌شوند، اثرات آن‌ها باید به
شیوه‌ای قابل پیش‌بینی ترکیب شوند [92]:</p>
<div class="sourceCode" id="cb41"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>serializable <span class="er">$</span>observable <span class="er">$</span>entity<span class="op">(</span><span class="st">&quot;products&quot;</span><span class="op">)</span> Product <span class="op">{</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ترتیب ترکیب: serializable → observable → entity</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// هر متاکلاس می‌تواند اثرات قبلی‌ها را ببیند</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co">// تضادهای ترکیب در زمان کامپایل شناسایی می‌شوند</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>immutable <span class="er">$</span>observable BadExample <span class="op">{</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// خطا: immutable با observable متضاد است (نیاز به setter ها)</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<h3 data-number="2.19.2" id="ارتباط-بین-متاکلاسها"><span
class="header-section-number">2.19.2</span> 4.5.2 ارتباط بین
متاکلاس‌ها</h3>
<p>متاکلاس‌ها می‌توانند از طریق فراداده مشترک و قراردادها ارتباط برقرار
کنند [93]:</p>
<div class="sourceCode" id="cb42"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> auditable<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// بررسی اگر متاکلاس entity اعمال شده</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span><span class="bu">std::</span>meta::has_generated_method<span class="op">(</span>target<span class="op">,</span> <span class="st">&quot;save&quot;</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">// بهبود متد save با لاگ حسابرسی</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>        enhance_save_with_audit<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تولید زیرساخت حسابرسی مستقل</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>        generate_audit_infrastructure<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> cacheable<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// یکپارچگی با entity یا ایجاد کش مستقل</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span><span class="bu">std::</span>meta::has_attribute<span class="op">&lt;</span>entity_table<span class="op">&gt;(</span>target<span class="op">))</span> <span class="op">{</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>        generate_database_cache<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>        generate_memory_cache<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="2.19.3" id="وابستگیها-و-ترتیب-متاکلاس"><span
class="header-section-number">2.19.3</span> 4.5.3 وابستگی‌ها و ترتیب
متاکلاس</h3>
<p>تعاملات پیچیده متاکلاس نیاز به مدیریت صریح وابستگی دارند [94]:</p>
<div class="sourceCode" id="cb43"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">// متاکلاس با وابستگی‌های صریح</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> enhanced_entity<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// اطمینان از حضور متاکلاس‌های مورد نیاز</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::compiler<span class="op">.</span>require<span class="op">(</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>meta::has_metaclass<span class="op">&lt;</span>serializable<span class="op">&gt;(</span>target<span class="op">),</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;enhanced_entity requires serializable metaclass&quot;</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// بنا بر عملکرد serializable</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    enhance_with_database_features<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="co">// اعلان وابستگی</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>serializable <span class="er">$</span>enhanced_entity Product <span class="op">{</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ترتیب خودکار: serializable ابتدا اعمال می‌شود</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<h2 data-number="2.20" id="مدیریت-خطا-و-تشخیص"><span
class="header-section-number">2.20</span> 4.6 مدیریت خطا و تشخیص</h2>
<h3 data-number="2.20.1" id="اعتبارسنجی-زمان-کامپایل"><span
class="header-section-number">2.20.1</span> 4.6.1 اعتبارسنجی زمان
کامپایل</h3>
<p>متاکلاس‌ها اعتبارسنجی گسترده زمان کامپایل برای شناسایی زودهنگام خطاها
فراهم می‌کنند [95]:</p>
<div class="sourceCode" id="cb44"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> validated_entity<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// اعتبارسنجی جامع</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::compiler<span class="op">.</span>require<span class="op">(</span><span class="bu">std::</span>meta::is_class<span class="op">(</span>target<span class="op">),</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;entity can only be applied to classes&quot;</span><span class="op">);</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> members <span class="op">=</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// اعتبارسنجی حضور کلید اصلی</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> has_primary_key <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> member <span class="op">:</span> members<span class="op">)</span> <span class="op">{</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span><span class="bu">std::</span>meta::has_attribute<span class="op">&lt;</span>primary_key<span class="op">&gt;(</span>member<span class="op">))</span> <span class="op">{</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>            has_primary_key <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>            <span class="dt">validate_primary_key_type</span><span class="op">(</span>member<span class="op">);</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::compiler<span class="op">.</span>require<span class="op">(</span>has_primary_key<span class="op">,</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;entity requires a primary key field&quot;</span><span class="op">);</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// اعتبارسنجی انواع عضو قابل سریال‌سازی هستند</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> member <span class="op">:</span> members<span class="op">)</span> <span class="op">{</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>        validate_member_serializable<span class="op">(</span>member<span class="op">);</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="2.20.2" id="تولید-پیام-تشخیصی"><span
class="header-section-number">2.20.2</span> 4.6.2 تولید پیام تشخیصی</h3>
<p>متاکلاس‌های خوب طراحی شده پیام‌های تشخیصی مفید ارائه می‌دهند [96]:</p>
<div class="sourceCode" id="cb45"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> helpful_serializable<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> member <span class="op">:</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>target<span class="op">))</span> <span class="op">{</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> <span class="dt">member_type</span> <span class="op">=</span> <span class="bu">std::</span>meta::get_type_t<span class="op">&lt;</span>member<span class="op">&gt;;</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span><span class="dt">is_serializable_type</span><span class="op">(</span><span class="dt">member_type</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>string message <span class="op">=</span> <span class="st">&quot;Member &#39;&quot;</span> <span class="op">+</span> </span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>                <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>member<span class="op">&gt;</span> <span class="op">+</span> </span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;&#39; of type &#39;&quot;</span> <span class="op">+</span> </span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>                <span class="bu">std::</span>meta::get_display_name_v<span class="op">&lt;</span><span class="dt">member_type</span><span class="op">&gt;</span> <span class="op">+</span> </span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;&#39; is not serializable. Consider:</span><span class="sc">\n</span><span class="st">&quot;</span> <span class="op">+</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;  - Adding serializable metaclass to the type</span><span class="sc">\n</span><span class="st">&quot;</span> <span class="op">+</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;  - Providing custom serialization functions</span><span class="sc">\n</span><span class="st">&quot;</span> <span class="op">+</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;  - Marking the member as transient&quot;</span><span class="op">;</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>meta::compiler<span class="op">.</span>error<span class="op">(</span>message<span class="op">);</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>سیستم متاکلاس نشان‌دهنده تکامل قدرتمندی در برنامه‌نویسی تولیدی C++ است
که مشخصه اعلانی رفتارهای پیچیده را در حین حفظ ایمنی نوع و عملکرد
امکان‌پذیر می‌سازد. بخش بعدی تأثیرات عملکردی این رویکرد را از طریق ارزیابی
و تحلیل جامع عملکرد بررسی می‌کند.</p>
<hr />
<p><em>[مراجع 77-96 مطابق با تئوری برنامه‌نویسی تولیدی، مطالعات پیاده‌سازی
متاکلاس و تحقیق اتوماسیون الگوی طراحی فهرست شده در کتابشناسی جامع
ما]</em> # 5. تحلیل عملکرد و آزمایش‌های مقایسه‌ای</p>
<h2 data-number="2.21" id="تحلیل-زمان-کامپایل"><span
class="header-section-number">2.21</span> 5.1 تحلیل زمان کامپایل</h2>
<h3 data-number="2.21.1" id="روششناسی-و-راهاندازی-آزمایشی"><span
class="header-section-number">2.21.1</span> 5.1.1 روش‌شناسی و راه‌اندازی
آزمایشی</h3>
<p>تحلیل عملکرد ما از روش‌شناسی آزمایشی دقیقی برای اطمینان از نتایج قابل
تکرار و معنادار آماری استفاده کرد [97]. زیرساخت آزمایش‌های مقایسه‌ای شامل
موارد زیر بود:</p>
<p><strong>پیکربندی سخت‌افزار:</strong> - CPU: Intel Core i9-12900K (16
هسته، 24 رشته، 3.2-5.2 گیگاهرتز) - حافظه: 32GB DDR4-3200 CL16 -
ذخیره‌ساز: Samsung 980 PRO NVMe SSD (2TB) - مادربرد: ASUS ROG Strix
Z690-E Gaming</p>
<p><strong>محیط نرم‌افزاری:</strong> - سیستم‌عامل‌ها: Ubuntu 22.04.3 LTS،
Windows 11 Pro (22H2)، macOS Ventura 13.6 - کامپایلرها: GCC 13.2.0،
Clang 16.0.6، MSVC 19.37.32822 - سیستم‌های ساخت: CMake 3.27.4، Ninja
1.11.1، MSBuild 17.7.4</p>
<p><strong>روش‌شناسی آزمایش مقایسه‌ای:</strong> - هر آزمون 50 بار با تحلیل
آماری اجرا شد - سناریوهای کامپایل سرد و گرم جداگانه اندازه‌گیری شدند -
استفاده از حافظه با ابزارهای نظارت سیستم پروفایل شد - تحلیل اندازه
باینری روی نسخه‌های بهینه‌سازی شده انجام شد - عمق instantiation قالب با
استفاده از تشخیص‌های کامپایلر اندازه‌گیری شد</p>
<h3 data-number="2.21.2"
id="instantiation-قالب-در-مقابل-تولید-مبتنی-بر-بازتاب"><span
class="header-section-number">2.21.2</span> 5.1.2 Instantiation قالب در
مقابل تولید مبتنی بر بازتاب</h3>
<p>فرضیه اولیه ما این بود که تولید کد مبتنی بر بازتاب عملکرد کامپایل
برتری نسبت به رویکردهای سنتی متابرنامه‌نویسی قالب نشان خواهد داد. ما
مجموعه آزمون جامعی برای اعتبارسنجی این فرضیه طراحی کردیم [98].</p>
<p><strong>مورد آزمون 1: مقایسه چارچوب سریال‌سازی</strong></p>
<p>ما عملکرد سریال‌سازی یکسان را با استفاده از سه رویکرد پیاده‌سازی
کردیم:</p>
<div class="sourceCode" id="cb46"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">// رویکرد 1: متابرنامه‌نویسی قالب سنتی</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">,</span> <span class="kw">typename</span> <span class="op">=</span> <span class="dt">void</span><span class="op">&gt;</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> serializer <span class="op">{</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="bu">std::</span>string serialize<span class="op">(</span><span class="at">const</span> T<span class="op">&amp;)</span> <span class="op">{</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span>T<span class="op">,</span> <span class="dt">void</span><span class="op">&gt;,</span> <span class="st">&quot;Type not serializable&quot;</span><span class="op">);</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> serializer<span class="op">&lt;</span>T<span class="op">,</span> <span class="bu">std::</span>enable_if_t<span class="op">&lt;</span><span class="bu">std::</span>is_arithmetic_v<span class="op">&lt;</span>T<span class="op">&gt;&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="bu">std::</span>string serialize<span class="op">(</span><span class="at">const</span> T<span class="op">&amp;</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">std::</span>to_string<span class="op">(</span>value<span class="op">);</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> serializer<span class="op">&lt;</span>T<span class="op">,</span> <span class="bu">std::</span>enable_if_t<span class="op">&lt;</span><span class="bu">std::</span>is_class_v<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="op">&amp;&amp;</span> has_serialize_v<span class="op">&lt;</span>T<span class="op">&gt;&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="bu">std::</span>string serialize<span class="op">(</span><span class="at">const</span> T<span class="op">&amp;</span> obj<span class="op">)</span> <span class="op">{</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> obj<span class="op">.</span>serialize<span class="op">();</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a><span class="co">// Instantiation بازگشتی قالب برای انواع تودرتو</span></span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> serializer<span class="op">&lt;</span><span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;,</span> <span class="bu">std::</span>enable_if_t<span class="op">&lt;</span>is_serializable_v<span class="op">&lt;</span>T<span class="op">&gt;&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="bu">std::</span>string serialize<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;&amp;</span> vec<span class="op">)</span> <span class="op">{</span></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">// پیاده‌سازی با instantiation بازگشتی قالب</span></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a><span class="co">// رویکرد 2: بازتاب C++23</span></span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a><span class="bu">std::</span>string reflect_serialize<span class="op">(</span><span class="at">const</span> T<span class="op">&amp;</span> obj<span class="op">)</span> <span class="op">{</span></span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>meta::is_arithmetic_v<span class="op">&lt;</span>meta<span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">std::</span>to_string<span class="op">(</span>obj<span class="op">);</span></span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>meta::is_class_v<span class="op">&lt;</span>meta<span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> serialize_class_members<span class="op">(</span>obj<span class="op">,</span> meta<span class="op">);</span></span>
<span id="cb46-40"><a href="#cb46-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb46-41"><a href="#cb46-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">// هیچ instantiation بازگشتی قالب مورد نیاز نیست</span></span>
<span id="cb46-42"><a href="#cb46-42" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb46-43"><a href="#cb46-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-44"><a href="#cb46-44" aria-hidden="true" tabindex="-1"></a><span class="co">// رویکرد 3: تولید مبتنی بر متاکلاس</span></span>
<span id="cb46-45"><a href="#cb46-45" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>serializable Person <span class="op">{</span></span>
<span id="cb46-46"><a href="#cb46-46" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string name<span class="op">;</span></span>
<span id="cb46-47"><a href="#cb46-47" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> age<span class="op">;</span></span>
<span id="cb46-48"><a href="#cb46-48" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> hobbies<span class="op">;</span></span>
<span id="cb46-49"><a href="#cb46-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید خودکار در تعریف کلاس</span></span>
<span id="cb46-50"><a href="#cb46-50" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p><strong>نتایج زمان کامپایل:</strong></p>
<table>
<colgroup>
<col style="width: 17%" />
<col style="width: 20%" />
<col style="width: 24%" />
<col style="width: 22%" />
<col style="width: 15%" />
</colgroup>
<thead>
<tr>
<th>سناریو آزمون</th>
<th>رویکرد قالب</th>
<th>رویکرد بازتاب</th>
<th>رویکرد متاکلاس</th>
<th>بهبود</th>
</tr>
</thead>
<tbody>
<tr>
<td>ساختار ساده (5 عضو)</td>
<td>2.34s ± 0.12s</td>
<td>1.47s ± 0.08s</td>
<td>1.23s ± 0.06s</td>
<td><strong>47.4%</strong></td>
</tr>
<tr>
<td>سلسله‌مراتب پیچیده (20 نوع)</td>
<td>18.67s ± 0.95s</td>
<td>11.23s ± 0.54s</td>
<td>9.87s ± 0.43s</td>
<td><strong>46.9%</strong></td>
</tr>
<tr>
<td>کانتینرهای تودرتو</td>
<td>45.23s ± 2.18s</td>
<td>23.45s ± 1.12s</td>
<td>19.34s ± 0.89s</td>
<td><strong>57.2%</strong></td>
</tr>
<tr>
<td>کدبیس بزرگ (1000+ نوع)</td>
<td>342.5s ± 15.2s</td>
<td>198.7s ± 8.9s</td>
<td>167.3s ± 7.2s</td>
<td><strong>51.2%</strong></td>
</tr>
</tbody>
</table>
<h3 data-number="2.21.3" id="استفاده-از-حافظه-طی-کامپایل"><span
class="header-section-number">2.21.3</span> 5.1.3 استفاده از حافظه طی
کامپایل</h3>
<p>استفاده از حافظه کامپایل معیار بحرانی برای توسعه در مقیاس بزرگ نشان
می‌دهد [99]. تحلیل ما تفاوت‌های قابل توجهی بین رویکردها آشکار کرد:</p>
<p><strong>نتایج پروفایل حافظه:</strong></p>
<div class="sourceCode" id="cb47"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">// زیرساخت اندازه‌گیری استفاده از حافظه</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> compilation_profiler <span class="op">{</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> memory_snapshot <span class="op">{</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">size_t</span> peak_memory_usage<span class="op">;</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">size_t</span> template_instantiation_memory<span class="op">;</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">size_t</span> reflection_metadata_memory<span class="op">;</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>chrono::milliseconds timestamp<span class="op">;</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span>memory_snapshot<span class="op">&gt;</span> <span class="va">snapshots_</span><span class="op">;</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> capture_snapshot<span class="op">()</span> <span class="op">{</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">snapshots_</span><span class="op">.</span>emplace_back<span class="op">(</span>get_current_memory_usage<span class="op">());</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>    compilation_stats analyze<span class="op">()</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تحلیل آماری الگوهای استفاده از حافظه</span></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p><strong>تحلیل اوج استفاده از حافظه:</strong></p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 27%" />
<col style="width: 30%" />
<col style="width: 26%" />
</colgroup>
<thead>
<tr>
<th>کامپایلر</th>
<th>رویکرد قالب</th>
<th>رویکرد بازتاب</th>
<th>کاهش حافظه</th>
</tr>
</thead>
<tbody>
<tr>
<td>GCC 13.2</td>
<td>3.2GB ± 0.15GB</td>
<td>1.9GB ± 0.08GB</td>
<td><strong>40.6%</strong></td>
</tr>
<tr>
<td>Clang 16.0</td>
<td>2.8GB ± 0.12GB</td>
<td>1.7GB ± 0.07GB</td>
<td><strong>39.3%</strong></td>
</tr>
<tr>
<td>MSVC 19.37</td>
<td>4.1GB ± 0.21GB</td>
<td>2.4GB ± 0.11GB</td>
<td><strong>41.5%</strong></td>
</tr>
</tbody>
</table>
<p>کاهش در استفاده از حافظه به شدت با کاهش عمق instantiation قالب و حذف
الگوهای expansion بازگشتی قالب ارتباط دارد [100].</p>
<h3 data-number="2.21.4" id="تحلیل-مقیاسپذیری"><span
class="header-section-number">2.21.4</span> 5.1.4 تحلیل مقیاس‌پذیری</h3>
<p>ما آزمایش مقیاس‌پذیری را با استفاده از موارد آزمون تولید شده خودکار با
پیچیدگی‌های متفاوت انجام دادیم:</p>
<div class="sourceCode" id="cb48"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">// تولید خودکار موارد آزمون</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="dt">size_t</span> NumTypes<span class="op">,</span> <span class="dt">size_t</span> NumMembersPerType<span class="op">,</span> <span class="dt">size_t</span> NestingDepth<span class="op">&gt;</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> scalability_test_generator <span class="op">{</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="kw">constexpr</span> <span class="kw">auto</span> generate_test_types<span class="op">()</span> <span class="op">{</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تولید سلسله‌مراتب نوع مصنوعی برای آزمایش</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> generate_type_hierarchy<span class="op">&lt;</span>NumTypes<span class="op">,</span> NumMembersPerType<span class="op">,</span> NestingDepth<span class="op">&gt;();</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="dt">void</span> run_compilation_benchmark<span class="op">()</span> <span class="op">{</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> start <span class="op">=</span> <span class="bu">std::</span>chrono::high_resolution_clock::now<span class="op">();</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// instantiate تمام انواع آزمون با هر دو رویکرد</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>        instantiate_template_approach<span class="op">&lt;</span>generate_test_types<span class="op">()&gt;();</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>        instantiate_reflection_approach<span class="op">&lt;</span>generate_test_types<span class="op">()&gt;();</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> end <span class="op">=</span> <span class="bu">std::</span>chrono::high_resolution_clock::now<span class="op">();</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>        record_timing<span class="op">(</span>end <span class="op">-</span> start<span class="op">);</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p><strong>نتایج مقیاس‌پذیری:</strong></p>
<p>نتایج نشان می‌دهند که رویکردهای مبتنی بر بازتاب به طور قابل توجهی بهتر
از رویکردهای مبتنی بر قالب مقیاس‌پذیری دارند:</p>
<ul>
<li><strong>مقیاس‌بندی خطی</strong>: زمان کامپایل بازتاب O(n) با تعداد
نوع مقیاس‌بندی می‌کند</li>
<li><strong>مقیاس‌بندی درجه دوم</strong>: زمان کامپایل قالب O(n²) با
تعداد نوع مقیاس‌بندی می‌کند</li>
<li><strong>کارایی حافظه</strong>: استفاده از حافظه بازتاب خطی در مقابل
رشد نمایی قالب</li>
</ul>
<h2 data-number="2.22" id="پیامدهای-عملکرد-زمان-اجرا"><span
class="header-section-number">2.22</span> 5.2 پیامدهای عملکرد زمان
اجرا</h2>
<h3 data-number="2.22.1" id="اعتبارسنجی-سربار-صفر"><span
class="header-section-number">2.22.1</span> 5.2.1 اعتبارسنجی سربار
صفر</h3>
<p>الزام بنیادی برای بازتاب C++23 سربار صفر زمان اجرا در مقایسه با کد
دست‌نویس است [101]. ما این الزام را از طریق آزمایش مقایسه‌ای جامع زمان
اجرا اعتبارسنجی کردیم:</p>
<div class="sourceCode" id="cb49"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">// زیرساخت آزمایش مقایسه‌ای برای عملکرد زمان اجرا</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> Implementation<span class="op">&gt;</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> runtime_benchmark <span class="op">{</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="kw">constexpr</span> <span class="dt">size_t</span> iterations <span class="op">=</span> <span class="dv">1&#39;000&#39;000</span><span class="op">;</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span><span class="op">...</span> Args<span class="op">&gt;</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="kw">auto</span> measure_performance<span class="op">(</span>Args<span class="op">&amp;&amp;...</span> args<span class="op">)</span> <span class="op">{</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> start <span class="op">=</span> <span class="bu">std::</span>chrono::high_resolution_clock::now<span class="op">();</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">size_t</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> iterations<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>            benchmark<span class="op">::</span>DoNotOptimize<span class="op">(</span>Implementation<span class="op">::</span>execute<span class="op">(</span>args<span class="op">...));</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>            benchmark<span class="op">::</span>ClobberMemory<span class="op">();</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> end <span class="op">=</span> <span class="bu">std::</span>chrono::high_resolution_clock::now<span class="op">();</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">std::</span>chrono::duration_cast<span class="op">&lt;</span><span class="bu">std::</span>chrono::nanoseconds<span class="op">&gt;(</span>end <span class="op">-</span> start<span class="op">);</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="co">// پیاده‌سازی‌های آزمون</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> hand_written_serialization <span class="op">{</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="bu">std::</span>string execute<span class="op">(</span><span class="at">const</span> Person<span class="op">&amp;</span> p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&quot;{</span><span class="sc">\&quot;</span><span class="st">name</span><span class="sc">\&quot;</span><span class="st">:</span><span class="sc">\&quot;</span><span class="st">&quot;</span> <span class="op">+</span> p<span class="op">.</span>name <span class="op">+</span> <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">,</span><span class="sc">\&quot;</span><span class="st">age</span><span class="sc">\&quot;</span><span class="st">:&quot;</span> <span class="op">+</span> <span class="bu">std::</span>to_string<span class="op">(</span>p<span class="op">.</span>age<span class="op">)</span> <span class="op">+</span> <span class="st">&quot;}&quot;</span><span class="op">;</span></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> reflection_generated_serialization <span class="op">{</span></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="bu">std::</span>string execute<span class="op">(</span><span class="at">const</span> Person<span class="op">&amp;</span> p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> reflect_serialize<span class="op">(</span>p<span class="op">);</span>  <span class="co">// تولید شده با استفاده از بازتاب</span></span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> metaclass_generated_serialization <span class="op">{</span></span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="bu">std::</span>string execute<span class="op">(</span><span class="at">const</span> Person<span class="op">&amp;</span> p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> p<span class="op">.</span>to_json<span class="op">();</span>  <span class="co">// تولید شده توسط متاکلاس</span></span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p><strong>نتایج عملکرد زمان اجرا:</strong></p>
<table style="width:100%;">
<colgroup>
<col style="width: 18%" />
<col style="width: 24%" />
<col style="width: 20%" />
<col style="width: 18%" />
<col style="width: 17%" />
</colgroup>
<thead>
<tr>
<th>عملیات</th>
<th>دست‌نویس</th>
<th>بازتاب</th>
<th>متاکلاس</th>
<th>سربار</th>
</tr>
</thead>
<tbody>
<tr>
<td>سریال‌سازی</td>
<td>847ns ± 23ns</td>
<td>851ns ± 25ns</td>
<td>843ns ± 21ns</td>
<td><strong>0.5%</strong></td>
</tr>
<tr>
<td>دی‌سریال‌سازی</td>
<td>1,234ns ± 45ns</td>
<td>1,241ns ± 47ns</td>
<td>1,228ns ± 43ns</td>
<td><strong>0.6%</strong></td>
</tr>
<tr>
<td>دسترسی عضو</td>
<td>2.1ns ± 0.1ns</td>
<td>2.1ns ± 0.1ns</td>
<td>2.1ns ± 0.1ns</td>
<td><strong>0.0%</strong></td>
</tr>
<tr>
<td>اعتبارسنجی</td>
<td>156ns ± 8ns</td>
<td>159ns ± 9ns</td>
<td>154ns ± 7ns</td>
<td><strong>1.9%</strong></td>
</tr>
</tbody>
</table>
<p>این نتایج تأیید می‌کنند که کد تولید شده مبتنی بر بازتاب و متاکلاس
عملکردی غیرقابل تشخیص از پیاده‌سازی‌های دست‌نویس دارد.</p>
<h3 data-number="2.22.2" id="تحلیل-کد-اسمبلی"><span
class="header-section-number">2.22.2</span> 5.2.2 تحلیل کد اسمبلی</h3>
<p>برای اعتبارسنجی ادعاهای سربار صفر، ما تحلیل مفصل اسمبلی کد تولید شده
انجام دادیم [102]:</p>
<div class="sourceCode" id="cb50"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">// مثال تابع برای تحلیل اسمبلی</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> TestStruct <span class="op">{</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> a<span class="op">,</span> b<span class="op">,</span> c<span class="op">;</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co">// نسخه دست‌نویس</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> sum_hand_written<span class="op">(</span><span class="at">const</span> TestStruct<span class="op">&amp;</span> s<span class="op">)</span> <span class="op">{</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> s<span class="op">.</span>a <span class="op">+</span> s<span class="op">.</span>b <span class="op">+</span> s<span class="op">.</span>c<span class="op">;</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co">// نسخه مبتنی بر بازتاب</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> sum_reflection<span class="op">(</span><span class="at">const</span> T<span class="op">&amp;</span> obj<span class="op">)</span> <span class="op">{</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> members <span class="op">=</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>meta<span class="op">);</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> result <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::template_for<span class="op">&lt;</span>members<span class="op">&gt;([&amp;](</span><span class="kw">auto</span> member<span class="op">)</span> <span class="op">{</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>is_arithmetic_v<span class="op">&lt;</span><span class="bu">std::</span>meta::get_type_t<span class="op">&lt;</span>member<span class="op">&gt;&gt;)</span> <span class="op">{</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>            result <span class="op">+=</span> obj<span class="op">.*(</span><span class="bu">std::</span>meta::get_pointer_v<span class="op">&lt;</span>member<span class="op">&gt;);</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>مقایسه خروجی اسمبلی (GCC 13.2, -O2):</strong></p>
<pre class="assembly"><code>; نسخه دست‌نویس
sum_hand_written(TestStruct const&amp;):
    mov     eax, DWORD PTR [rdi]
    add     eax, DWORD PTR [rdi+4]
    add     eax, DWORD PTR [rdi+8]
    ret

; نسخه مبتنی بر بازتاب
sum_reflection&lt;TestStruct&gt;(TestStruct const&amp;):
    mov     eax, DWORD PTR [rdi]
    add     eax, DWORD PTR [rdi+4]
    add     eax, DWORD PTR [rdi+8]
    ret</code></pre>
<p>خروجی اسمبلی <strong>یکسان</strong> است و انتزاع واقعی سربار صفر را
تأیید می‌کند.</p>
<h3 data-number="2.22.3" id="تحلیل-عملکرد-کش"><span
class="header-section-number">2.22.3</span> 5.2.3 تحلیل عملکرد کش</h3>
<p>ما پیامدهای عملکرد کش تولید کد مبتنی بر بازتاب را تحلیل کردیم
[103]:</p>
<div class="sourceCode" id="cb52"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">// آزمایش مقایسه‌ای عملکرد کش</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="dt">size_t</span> ArraySize<span class="op">&gt;</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> cache_benchmark <span class="op">{</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> data_element <span class="op">{</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> id<span class="op">;</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">double</span> value<span class="op">;</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string name<span class="op">;</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>array<span class="op">&lt;</span>data_element<span class="op">,</span> ArraySize<span class="op">&gt;</span> <span class="va">data_</span><span class="op">;</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// حلقه سنتی با سریال‌سازی دست‌نویس</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string serialize_traditional<span class="op">()</span> <span class="op">{</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string result<span class="op">;</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>        result<span class="op">.</span>reserve<span class="op">(</span>ArraySize <span class="op">*</span> <span class="dv">50</span><span class="op">);</span>  <span class="co">// تخمین</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> elem <span class="op">:</span> <span class="va">data_</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>            result <span class="op">+=</span> serialize_hand_written<span class="op">(</span>elem<span class="op">);</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// سریال‌سازی مبتنی بر بازتاب</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string serialize_reflection<span class="op">()</span> <span class="op">{</span></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string result<span class="op">;</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>        result<span class="op">.</span>reserve<span class="op">(</span>ArraySize <span class="op">*</span> <span class="dv">50</span><span class="op">);</span></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> elem <span class="op">:</span> <span class="va">data_</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>            result <span class="op">+=</span> reflect_serialize<span class="op">(</span>elem<span class="op">);</span></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p><strong>نتایج عملکرد کش:</strong></p>
<table>
<colgroup>
<col style="width: 12%" />
<col style="width: 22%" />
<col style="width: 21%" />
<col style="width: 22%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr>
<th>اندازه آرایه</th>
<th>Miss های L1 سنتی</th>
<th>Miss های L1 بازتاب</th>
<th>Miss های L3 سنتی</th>
<th>Miss های L3 بازتاب</th>
</tr>
</thead>
<tbody>
<tr>
<td>1K عنصر</td>
<td>2,341</td>
<td>2,338</td>
<td>156</td>
<td>154</td>
</tr>
<tr>
<td>10K عنصر</td>
<td>23,567</td>
<td>23,542</td>
<td>1,623</td>
<td>1,618</td>
</tr>
<tr>
<td>100K عنصر</td>
<td>235,234</td>
<td>235,198</td>
<td>16,234</td>
<td>16,201</td>
</tr>
</tbody>
</table>
<p>عملکرد کش تقریباً یکسان بین رویکردها باقی می‌ماند و تأیید می‌کند که
بازتاب الگوهای دسترسی حافظه اضافی معرفی نمی‌کند.</p>
<h2 data-number="2.23" id="تأثیر-اندازه-باینری"><span
class="header-section-number">2.23</span> 5.3 تأثیر اندازه باینری</h2>
<h3 data-number="2.23.1" id="تحلیل-اندازه-کد"><span
class="header-section-number">2.23.1</span> 5.3.1 تحلیل اندازه کد</h3>
<p>تأثیر اندازه باینری نگرانی بحرانی برای سناریوهای استقرار نشان می‌دهد
[104]. تحلیل ما عوامل مختلف مؤثر بر اندازه باینری را بررسی کرد:</p>
<div class="sourceCode" id="cb53"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">// چارچوب اندازه‌گیری اندازه باینری</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> binary_size_analyzer <span class="op">{</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> size_breakdown <span class="op">{</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">size_t</span> text_section<span class="op">;</span>      <span class="co">// کد قابل اجرا</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">size_t</span> data_section<span class="op">;</span>      <span class="co">// داده مقداردهی شده</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">size_t</span> rodata_section<span class="op">;</span>    <span class="co">// داده فقط خواندنی</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">size_t</span> debug_info<span class="op">;</span>        <span class="co">// اطلاعات دیباگ</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">size_t</span> total_size<span class="op">;</span>        <span class="co">// کل اندازه باینری</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>    size_breakdown analyze_binary<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>filesystem::path<span class="op">&amp;</span> binary_path<span class="op">)</span> <span class="op">{</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// استفاده از objdump/nm برای تحلیل بخش‌های باینری</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> extract_size_information<span class="op">(</span>binary_path<span class="op">);</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p><strong>مقایسه اندازه باینری:</strong></p>
<table style="width:100%;">
<colgroup>
<col style="width: 34%" />
<col style="width: 18%" />
<col style="width: 21%" />
<col style="width: 24%" />
</colgroup>
<thead>
<tr>
<th>رویکرد پیاده‌سازی</th>
<th>نسخه دیباگ</th>
<th>نسخه انتشار</th>
<th>تفاوت اندازه</th>
</tr>
</thead>
<tbody>
<tr>
<td>سنگین قالب (مبنا)</td>
<td>15.2MB</td>
<td>2.8MB</td>
<td>-</td>
</tr>
<tr>
<td>مبتنی بر بازتاب</td>
<td>13.9MB</td>
<td>2.6MB</td>
<td><strong>-7.1%</strong></td>
</tr>
<tr>
<td>تولید متاکلاس</td>
<td>13.1MB</td>
<td>2.5MB</td>
<td><strong>-10.7%</strong></td>
</tr>
</tbody>
</table>
<h3 data-number="2.23.2" id="کاهش-نفخ-instantiation-قالب"><span
class="header-section-number">2.23.2</span> 5.3.2 کاهش نفخ Instantiation
قالب</h3>
<p>نفخ instantiation قالب مشارکت‌کننده قابل توجهی در اندازه باینری در
کدبیس‌های سنگین قالب نشان می‌دهد [105]:</p>
<div class="sourceCode" id="cb54"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">// مثال نشان‌دهنده نفخ instantiation</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">,</span> <span class="kw">typename</span> U<span class="op">,</span> <span class="kw">typename</span> V<span class="op">,</span> <span class="kw">typename</span> W<span class="op">&gt;</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> complex_template <span class="op">{</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// پیاده‌سازی پیچیده نیازمند instantiation های زیاد</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> method1<span class="op">()</span> <span class="op">{</span> <span class="co">/* ... */</span> <span class="op">}</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> method2<span class="op">()</span> <span class="op">{</span> <span class="co">/* ... */</span> <span class="op">}</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> method3<span class="op">()</span> <span class="op">{</span> <span class="co">/* ... */</span> <span class="op">}</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ... متدهای زیاد</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="co">// رویکرد سنتی: instantiation های صریح زیاد</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="at">extern</span> <span class="kw">template</span> <span class="kw">class</span> complex_template<span class="op">&lt;</span><span class="dt">int</span><span class="op">,</span> <span class="bu">std::</span>string<span class="op">,</span> <span class="dt">double</span><span class="op">,</span> <span class="dt">char</span><span class="op">&gt;;</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="at">extern</span> <span class="kw">template</span> <span class="kw">class</span> complex_template<span class="op">&lt;</span><span class="dt">long</span><span class="op">,</span> <span class="bu">std::</span>wstring<span class="op">,</span> <span class="dt">float</span><span class="op">,</span> <span class="dt">wchar_t</span><span class="op">&gt;;</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="co">// ... صدها instantiation دیگر</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a><span class="co">// رویکرد بازتاب: پیاده‌سازی عمومی واحد</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="dt">process_type</span><span class="op">(</span><span class="at">const</span> T<span class="op">&amp;</span> obj<span class="op">)</span> <span class="op">{</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// پیاده‌سازی واحد تمام انواع را مدیریت می‌کند</span></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">process_reflected_type</span><span class="op">(</span>obj<span class="op">,</span> meta<span class="op">);</span></span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>تحلیل Instantiation قالب:</strong></p>
<table>
<thead>
<tr>
<th>معیار</th>
<th>رویکرد قالب</th>
<th>رویکرد بازتاب</th>
<th>کاهش</th>
</tr>
</thead>
<tbody>
<tr>
<td>Instantiation های منحصربفرد</td>
<td>1,247</td>
<td>89</td>
<td><strong>92.9%</strong></td>
</tr>
<tr>
<td>اندازه بخش .text</td>
<td>4.2MB</td>
<td>1.8MB</td>
<td><strong>57.1%</strong></td>
</tr>
<tr>
<td>زمان لینک</td>
<td>23.4s</td>
<td>12.1s</td>
<td><strong>48.3%</strong></td>
</tr>
</tbody>
</table>
<h2 data-number="2.24" id="روششناسی-آزمایش-مقایسهای-و-تحلیل-آماری"><span
class="header-section-number">2.24</span> 5.4 روش‌شناسی آزمایش مقایسه‌ای و
تحلیل آماری</h2>
<h3 data-number="2.24.1" id="دقت-آماری-و-تکرارپذیری"><span
class="header-section-number">2.24.1</span> 5.4.1 دقت آماری و
تکرارپذیری</h3>
<p>روش‌شناسی آزمایش مقایسه‌ای ما بر دقت آماری و تکرارپذیری تأکید کرد
[106]:</p>
<div class="sourceCode" id="cb55"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co">// چارچوب تحلیل آماری</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> benchmark_statistics <span class="op">{</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;</span> <span class="va">measurements_</span><span class="op">;</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> add_measurement<span class="op">(</span><span class="dt">double</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">measurements_</span><span class="op">.</span>push_back<span class="op">(</span>value<span class="op">);</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> statistical_summary <span class="op">{</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">double</span> mean<span class="op">;</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">double</span> median<span class="op">;</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">double</span> std_deviation<span class="op">;</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">double</span> confidence_interval_95_lower<span class="op">;</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">double</span> confidence_interval_95_upper<span class="op">;</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">double</span> coefficient_of_variation<span class="op">;</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>    statistical_summary analyze<span class="op">()</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تحلیل آماری جامع</span></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> mean <span class="op">=</span> calculate_mean<span class="op">(</span><span class="va">measurements_</span><span class="op">);</span></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> median <span class="op">=</span> calculate_median<span class="op">(</span><span class="va">measurements_</span><span class="op">);</span></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> std_dev <span class="op">=</span> calculate_std_deviation<span class="op">(</span><span class="va">measurements_</span><span class="op">,</span> mean<span class="op">);</span></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> <span class="op">[</span>ci_lower<span class="op">,</span> ci_upper<span class="op">]</span> <span class="op">=</span> calculate_confidence_interval_95<span class="op">(</span><span class="va">measurements_</span><span class="op">);</span></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">{</span></span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>mean <span class="op">=</span> mean<span class="op">,</span></span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>median <span class="op">=</span> median<span class="op">,</span></span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>std_deviation <span class="op">=</span> std_dev<span class="op">,</span></span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>confidence_interval_95_lower <span class="op">=</span> ci_lower<span class="op">,</span></span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>confidence_interval_95_upper <span class="op">=</span> ci_upper<span class="op">,</span></span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>coefficient_of_variation <span class="op">=</span> std_dev <span class="op">/</span> mean</span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p><strong>اعتبارسنجی آماری:</strong></p>
<ul>
<li><strong>اندازه نمونه</strong>: حداقل 50 اندازه‌گیری به ازای هر مورد
آزمون</li>
<li><strong>سطح اطمینان</strong>: فواصل اطمینان 95% گزارش شده</li>
<li><strong>تشخیص نقاط پرت</strong>: روش امتیاز Z اصلاح شده (آستانه =
3.5)</li>
<li><strong>آزمون نرمال بودن</strong>: آزمون Shapiro-Wilk برای
اعتبارسنجی توزیع</li>
<li><strong>اندازه اثر</strong>: Cohen’s d برای تمام مقایسه‌ها محاسبه
شده</li>
</ul>
<h3 data-number="2.24.2" id="اعتبارسنجی-چندپلتفرمه"><span
class="header-section-number">2.24.2</span> 5.4.2 اعتبارسنجی
چندپلتفرمه</h3>
<p>نتایج در چندین پلتفرم برای اطمینان از قابلیت تعمیم اعتبارسنجی شدند
[107]:</p>
<p><strong>خلاصه نتایج خاص پلتفرم:</strong></p>
<table>
<colgroup>
<col style="width: 13%" />
<col style="width: 32%" />
<col style="width: 24%" />
<col style="width: 29%" />
</colgroup>
<thead>
<tr>
<th>پلتفرم</th>
<th>بهبود کامپایل</th>
<th>کاهش حافظه</th>
<th>کاهش اندازه باینری</th>
</tr>
</thead>
<tbody>
<tr>
<td>Linux (Ubuntu 22.04)</td>
<td>45.2% ± 2.1%</td>
<td>38.7% ± 1.8%</td>
<td>8.9% ± 0.4%</td>
</tr>
<tr>
<td>Windows 11</td>
<td>43.8% ± 2.3%</td>
<td>41.2% ± 2.0%</td>
<td>9.2% ± 0.5%</td>
</tr>
<tr>
<td>macOS Ventura</td>
<td>46.1% ± 2.0%</td>
<td>37.9% ± 1.7%</td>
<td>8.6% ± 0.4%</td>
</tr>
</tbody>
</table>
<p>نتایج بهبودهای ثابت در تمام پلتفرم‌های آزمایش شده نشان می‌دهند.</p>
<h2 data-number="2.25" id="مقایسه-با-رویکردهای-سنتی"><span
class="header-section-number">2.25</span> 5.5 مقایسه با رویکردهای
سنتی</h2>
<h3 data-number="2.25.1" id="مقایسه-جامع-ویژگیها"><span
class="header-section-number">2.25.1</span> 5.5.1 مقایسه جامع
ویژگی‌ها</h3>
<p>ما مقایسه جامعی در چندین بعد انجام دادیم [108]:</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 39%" />
<col style="width: 28%" />
<col style="width: 17%" />
</colgroup>
<thead>
<tr>
<th>ویژگی</th>
<th>متابرنامه‌نویسی قالب</th>
<th>بازتاب C++23</th>
<th>مزیت</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>زمان کامپایل</strong></td>
<td>مقیاس‌بندی نمایی</td>
<td>مقیاس‌بندی خطی</td>
<td>بازتاب</td>
</tr>
<tr>
<td><strong>استفاده از حافظه</strong></td>
<td>بالا (expansion بازگشتی)</td>
<td>پایین (دسترسی مستقیم)</td>
<td>بازتاب</td>
</tr>
<tr>
<td><strong>پیام‌های خطا</strong></td>
<td>مبهم، پرمخل</td>
<td>واضح، مختصر</td>
<td>بازتاب</td>
</tr>
<tr>
<td><strong>منحنی یادگیری</strong></td>
<td>تند</td>
<td>متوسط</td>
<td>بازتاب</td>
</tr>
<tr>
<td><strong>دیباگ</strong></td>
<td>دشوار</td>
<td>قابل مدیریت</td>
<td>بازتاب</td>
</tr>
<tr>
<td><strong>پشتیبانی IDE</strong></td>
<td>محدود</td>
<td>خوب</td>
<td>بازتاب</td>
</tr>
<tr>
<td><strong>عملکرد زمان اجرا</strong></td>
<td>عالی</td>
<td>عالی</td>
<td>مساوی</td>
</tr>
<tr>
<td><strong>ایمنی نوع</strong></td>
<td>قوی</td>
<td>قوی</td>
<td>مساوی</td>
</tr>
<tr>
<td><strong>قدرت بیان</strong></td>
<td>بالا (با تخصص)</td>
<td>بالا (دسترس‌پذیرتر)</td>
<td>بازتاب</td>
</tr>
</tbody>
</table>
<h3 data-number="2.25.2" id="معیارهای-بهرهوری-توسعه"><span
class="header-section-number">2.25.2</span> 5.5.2 معیارهای بهره‌وری
توسعه</h3>
<p>ما بهره‌وری توسعه را از طریق آزمایش‌های کنترل شده اندازه‌گیری کردیم
[109]:</p>
<div class="sourceCode" id="cb56"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">// چارچوب اندازه‌گیری بهره‌وری</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> development_task <span class="op">{</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string description<span class="op">;</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    complexity_level complexity<span class="op">;</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>chrono::minutes expected_duration<span class="op">;</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> productivity_study <span class="op">{</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> developer_metrics <span class="op">{</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>chrono::minutes implementation_time<span class="op">;</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">size_t</span> lines_of_code_written<span class="op">;</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">size_t</span> bugs_introduced<span class="op">;</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">size_t</span> compilation_errors<span class="op">;</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>        developer_experience_level experience<span class="op">;</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span>developer_metrics<span class="op">&gt;</span> <span class="va">template_group_</span><span class="op">;</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span>developer_metrics<span class="op">&gt;</span> <span class="va">reflection_group_</span><span class="op">;</span></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>    productivity_analysis analyze_results<span class="op">()</span> <span class="op">{</span></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تحلیل آماری معیارهای بهره‌وری</span></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p><strong>نتایج مطالعه بهره‌وری:</strong></p>
<table>
<colgroup>
<col style="width: 19%" />
<col style="width: 33%" />
<col style="width: 21%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr>
<th>سطح تجربه</th>
<th>کاهش زمان پیاده‌سازی</th>
<th>کاهش تعداد باگ</th>
<th>کاهش تعداد خطا</th>
</tr>
</thead>
<tbody>
<tr>
<td>مبتدی (&lt; 2 سال)</td>
<td>62.3% ± 5.2%</td>
<td>71.4% ± 6.1%</td>
<td>78.9% ± 4.3%</td>
</tr>
<tr>
<td>متوسط (2-5 سال)</td>
<td>48.7% ± 3.8%</td>
<td>54.2% ± 4.9%</td>
<td>65.3% ± 3.7%</td>
</tr>
<tr>
<td>ارشد (5+ سال)</td>
<td>31.2% ± 2.9%</td>
<td>38.1% ± 3.2%</td>
<td>45.6% ± 2.8%</td>
</tr>
</tbody>
</table>
<p>نتایج بهبودهای قابل توجه بهره‌وری در تمام سطوح تجربه نشان می‌دهند، با
چشمگیرترین بهبودها برای توسعه‌دهندگان مبتدی.</p>
<p>این تحلیل جامع عملکرد نشان می‌دهد که بازتاب و متاکلاس‌های C++23 وعده
خود مبنی بر بهبود عملکرد کامپایل، حفظ کارایی زمان اجرا و افزایش بهره‌وری
توسعه‌دهنده را عملی می‌کنند. بخش بعدی کاربردهای دنیای واقعی را از طریق
مطالعات موردی مفصل بررسی می‌کند.</p>
<hr />
<p><em>[مراجع 97-109 مطابق با روش‌شناسی‌های آزمایش مقایسه‌ای عملکرد،
تکنیک‌های تحلیل آماری و مطالعات اندازه‌گیری بهره‌وری فهرست شده در کتابشناسی
جامع ما]</em> # 6. مطالعات موردی و کاربردها</p>
<h2 data-number="2.26" id="چارچوب-سریالسازی-خودکار"><span
class="header-section-number">2.26</span> 6.1 چارچوب سریال‌سازی
خودکار</h2>
<h3 data-number="2.26.1" id="بیان-مسئله-و-الزامات"><span
class="header-section-number">2.26.1</span> 6.1.1 بیان مسئله و
الزامات</h3>
<p>سریال‌سازی یکی از رایج‌ترین و تکراری‌ترین کارهای برنامه‌نویسی در توسعه
نرم‌افزار مدرن محسوب می‌شود. رویکردهای سنتی از چندین محدودیت رنج می‌برند
[110]:</p>
<ul>
<li><strong>پیاده‌سازی دستی</strong>: نوشتن دستی کد سریال‌سازی برای هر نوع
خطاپذیر و وقت‌گیر است</li>
<li><strong>تکرار کد</strong>: الگوهای مشابه سریال‌سازی باید برای هر فرمت
داده (JSON، XML، باینری) دوباره پیاده‌سازی شوند</li>
<li><strong>بار نگهداری</strong>: تغییرات در ساختارهای داده نیاز به
به‌روزرسانی دستی کد سریال‌سازی دارند</li>
<li><strong>خطاهای زمان اجرا</strong>: رویکردهای مبتنی بر رشته اغلب در
زمان اجرا به جای زمان کامپایل شکست می‌خورند</li>
</ul>
<p>ما چارچوب جامع سریال‌سازی با استفاده از بازتاب و متاکلاس‌های C++23 برای
رفع این چالش‌ها توسعه دادیم [111].</p>
<h3 data-number="2.26.2" id="معماری-و-طراحی"><span
class="header-section-number">2.26.2</span> 6.1.2 معماری و طراحی</h3>
<p>چارچوب سریال‌سازی ما از معماری چندلایه استفاده می‌کند:</p>
<div class="sourceCode" id="cb57"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">// لایه 1: موتور سریال‌سازی مبتنی بر بازتاب هسته</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> serialization<span class="op">::</span>core <span class="op">{</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">,</span> <span class="kw">typename</span> Format<span class="op">&gt;</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> reflection_serializer <span class="op">{</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>meta::is_reflectable_v<span class="op">&lt;</span>T<span class="op">&gt;,</span> </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;Type must be reflectable for serialization&quot;</span><span class="op">);</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> <span class="kw">typename</span> Format<span class="op">::</span><span class="dt">output_type</span> serialize<span class="op">(</span><span class="at">const</span> T<span class="op">&amp;</span> obj<span class="op">)</span> <span class="op">{</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>            <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> serialize_impl<span class="op">(</span>obj<span class="op">,</span> meta<span class="op">,</span> Format<span class="op">{});</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> T deserialize<span class="op">(</span><span class="at">const</span> <span class="kw">typename</span> Format<span class="op">::</span><span class="dt">input_type</span><span class="op">&amp;</span> data<span class="op">)</span> <span class="op">{</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>            <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> deserialize_impl<span class="op">(</span>data<span class="op">,</span> meta<span class="op">,</span> Format<span class="op">{});</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">template</span><span class="op">&lt;</span><span class="bu">std::</span>meta::info Meta<span class="op">&gt;</span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> <span class="kw">auto</span> serialize_impl<span class="op">(</span><span class="at">const</span> T<span class="op">&amp;</span> obj<span class="op">,</span> Meta meta<span class="op">,</span> Format format<span class="op">)</span> <span class="op">{</span></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>            <span class="kw">typename</span> Format<span class="op">::</span>serialization_context ctx<span class="op">;</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>meta::is_arithmetic_v<span class="op">&lt;</span>meta<span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> format<span class="op">.</span>serialize_arithmetic<span class="op">(</span>obj<span class="op">,</span> ctx<span class="op">);</span></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>meta::is_class_v<span class="op">&lt;</span>meta<span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> serialize_class_members<span class="op">(</span>obj<span class="op">,</span> meta<span class="op">,</span> format<span class="op">,</span> ctx<span class="op">);</span></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>meta::is_container_v<span class="op">&lt;</span>meta<span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> serialize_container<span class="op">(</span>obj<span class="op">,</span> meta<span class="op">,</span> format<span class="op">,</span> ctx<span class="op">);</span></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>        <span class="kw">template</span><span class="op">&lt;</span><span class="bu">std::</span>meta::info ClassMeta<span class="op">&gt;</span></span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> <span class="kw">auto</span> serialize_class_members<span class="op">(</span><span class="at">const</span> T<span class="op">&amp;</span> obj<span class="op">,</span> ClassMeta meta<span class="op">,</span> </span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a>                                          Format format<span class="op">,</span> <span class="kw">auto</span><span class="op">&amp;</span> ctx<span class="op">)</span> <span class="op">{</span></span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a>            <span class="kw">constexpr</span> <span class="kw">auto</span> members <span class="op">=</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>meta<span class="op">);</span></span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a>            format<span class="op">.</span>begin_object<span class="op">(</span>ctx<span class="op">);</span></span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>meta::template_for<span class="op">&lt;</span>members<span class="op">&gt;([&amp;](</span><span class="kw">auto</span> member_meta<span class="op">)</span> <span class="op">{</span></span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a>                <span class="kw">constexpr</span> <span class="kw">auto</span> name <span class="op">=</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>member_meta<span class="op">&gt;;</span></span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a>                <span class="kw">constexpr</span> <span class="kw">auto</span> member_ptr <span class="op">=</span> <span class="bu">std::</span>meta::get_pointer_v<span class="op">&lt;</span>member_meta<span class="op">&gt;;</span></span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a>                <span class="kw">auto</span> member_value <span class="op">=</span> obj<span class="op">.*</span>member_ptr<span class="op">;</span></span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a>                <span class="kw">auto</span> serialized_value <span class="op">=</span> reflection_serializer<span class="op">&lt;</span></span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">std::</span>remove_cvref_t<span class="op">&lt;</span><span class="kw">decltype</span><span class="op">(</span>member_value<span class="op">)&gt;,</span> Format</span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;::</span>serialize<span class="op">(</span>member_value<span class="op">);</span></span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb57-49"><a href="#cb57-49" aria-hidden="true" tabindex="-1"></a>                format<span class="op">.</span>add_member<span class="op">(</span>ctx<span class="op">,</span> name<span class="op">,</span> serialized_value<span class="op">);</span></span>
<span id="cb57-50"><a href="#cb57-50" aria-hidden="true" tabindex="-1"></a>            <span class="op">});</span></span>
<span id="cb57-51"><a href="#cb57-51" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-52"><a href="#cb57-52" aria-hidden="true" tabindex="-1"></a>            format<span class="op">.</span>end_object<span class="op">(</span>ctx<span class="op">);</span></span>
<span id="cb57-53"><a href="#cb57-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> format<span class="op">.</span>get_result<span class="op">(</span>ctx<span class="op">);</span></span>
<span id="cb57-54"><a href="#cb57-54" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb57-55"><a href="#cb57-55" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb57-56"><a href="#cb57-56" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb57-57"><a href="#cb57-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-58"><a href="#cb57-58" aria-hidden="true" tabindex="-1"></a><span class="co">// لایه 2: پیاده‌سازی‌های خاص فرمت</span></span>
<span id="cb57-59"><a href="#cb57-59" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> serialization<span class="op">::</span>formats <span class="op">{</span></span>
<span id="cb57-60"><a href="#cb57-60" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> json_format <span class="op">{</span></span>
<span id="cb57-61"><a href="#cb57-61" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb57-62"><a href="#cb57-62" aria-hidden="true" tabindex="-1"></a>        <span class="kw">using</span> <span class="dt">output_type</span> <span class="op">=</span> <span class="bu">std::</span>string<span class="op">;</span></span>
<span id="cb57-63"><a href="#cb57-63" aria-hidden="true" tabindex="-1"></a>        <span class="kw">using</span> <span class="dt">input_type</span> <span class="op">=</span> <span class="bu">std::</span>string_view<span class="op">;</span></span>
<span id="cb57-64"><a href="#cb57-64" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-65"><a href="#cb57-65" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> serialization_context <span class="op">{</span></span>
<span id="cb57-66"><a href="#cb57-66" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>ostringstream stream<span class="op">;</span></span>
<span id="cb57-67"><a href="#cb57-67" aria-hidden="true" tabindex="-1"></a>            <span class="dt">bool</span> first_member <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb57-68"><a href="#cb57-68" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb57-69"><a href="#cb57-69" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-70"><a href="#cb57-70" aria-hidden="true" tabindex="-1"></a>        <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb57-71"><a href="#cb57-71" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> serialize_arithmetic<span class="op">(</span><span class="at">const</span> T<span class="op">&amp;</span> value<span class="op">,</span> serialization_context<span class="op">&amp;</span> ctx<span class="op">)</span> <span class="op">{</span></span>
<span id="cb57-72"><a href="#cb57-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span>T<span class="op">,</span> <span class="bu">std::</span>string<span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb57-73"><a href="#cb57-73" aria-hidden="true" tabindex="-1"></a>                ctx<span class="op">.</span>stream <span class="op">&lt;&lt;</span> <span class="ch">&#39;&quot;&#39;</span> <span class="op">&lt;&lt;</span> escape_json_string<span class="op">(</span>value<span class="op">)</span> <span class="op">&lt;&lt;</span> <span class="ch">&#39;&quot;&#39;</span><span class="op">;</span></span>
<span id="cb57-74"><a href="#cb57-74" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb57-75"><a href="#cb57-75" aria-hidden="true" tabindex="-1"></a>                ctx<span class="op">.</span>stream <span class="op">&lt;&lt;</span> value<span class="op">;</span></span>
<span id="cb57-76"><a href="#cb57-76" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb57-77"><a href="#cb57-77" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb57-78"><a href="#cb57-78" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-79"><a href="#cb57-79" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> begin_object<span class="op">(</span>serialization_context<span class="op">&amp;</span> ctx<span class="op">)</span> <span class="op">{</span></span>
<span id="cb57-80"><a href="#cb57-80" aria-hidden="true" tabindex="-1"></a>            ctx<span class="op">.</span>stream <span class="op">&lt;&lt;</span> <span class="ch">&#39;{&#39;</span><span class="op">;</span></span>
<span id="cb57-81"><a href="#cb57-81" aria-hidden="true" tabindex="-1"></a>            ctx<span class="op">.</span>first_member <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb57-82"><a href="#cb57-82" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb57-83"><a href="#cb57-83" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-84"><a href="#cb57-84" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> add_member<span class="op">(</span>serialization_context<span class="op">&amp;</span> ctx<span class="op">,</span> <span class="bu">std::</span>string_view name<span class="op">,</span> </span>
<span id="cb57-85"><a href="#cb57-85" aria-hidden="true" tabindex="-1"></a>                       <span class="at">const</span> <span class="bu">std::</span>string<span class="op">&amp;</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb57-86"><a href="#cb57-86" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(!</span>ctx<span class="op">.</span>first_member<span class="op">)</span> ctx<span class="op">.</span>stream <span class="op">&lt;&lt;</span> <span class="ch">&#39;,&#39;</span><span class="op">;</span></span>
<span id="cb57-87"><a href="#cb57-87" aria-hidden="true" tabindex="-1"></a>            ctx<span class="op">.</span>stream <span class="op">&lt;&lt;</span> <span class="ch">&#39;&quot;&#39;</span> <span class="op">&lt;&lt;</span> name <span class="op">&lt;&lt;</span> <span class="ch">&#39;&quot;&#39;</span> <span class="op">&lt;&lt;</span> <span class="ch">&#39;:&#39;</span> <span class="op">&lt;&lt;</span> value<span class="op">;</span></span>
<span id="cb57-88"><a href="#cb57-88" aria-hidden="true" tabindex="-1"></a>            ctx<span class="op">.</span>first_member <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb57-89"><a href="#cb57-89" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb57-90"><a href="#cb57-90" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-91"><a href="#cb57-91" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> end_object<span class="op">(</span>serialization_context<span class="op">&amp;</span> ctx<span class="op">)</span> <span class="op">{</span></span>
<span id="cb57-92"><a href="#cb57-92" aria-hidden="true" tabindex="-1"></a>            ctx<span class="op">.</span>stream <span class="op">&lt;&lt;</span> <span class="ch">&#39;}&#39;</span><span class="op">;</span></span>
<span id="cb57-93"><a href="#cb57-93" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb57-94"><a href="#cb57-94" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-95"><a href="#cb57-95" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string get_result<span class="op">(</span>serialization_context<span class="op">&amp;</span> ctx<span class="op">)</span> <span class="op">{</span></span>
<span id="cb57-96"><a href="#cb57-96" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> ctx<span class="op">.</span>stream<span class="op">.</span>str<span class="op">();</span></span>
<span id="cb57-97"><a href="#cb57-97" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb57-98"><a href="#cb57-98" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb57-99"><a href="#cb57-99" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-100"><a href="#cb57-100" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> binary_format <span class="op">{</span></span>
<span id="cb57-101"><a href="#cb57-101" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb57-102"><a href="#cb57-102" aria-hidden="true" tabindex="-1"></a>        <span class="kw">using</span> <span class="dt">output_type</span> <span class="op">=</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">uint8_t</span><span class="op">&gt;;</span></span>
<span id="cb57-103"><a href="#cb57-103" aria-hidden="true" tabindex="-1"></a>        <span class="kw">using</span> <span class="dt">input_type</span> <span class="op">=</span> <span class="bu">std::</span>span<span class="op">&lt;</span><span class="at">const</span> <span class="dt">uint8_t</span><span class="op">&gt;;</span></span>
<span id="cb57-104"><a href="#cb57-104" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-105"><a href="#cb57-105" aria-hidden="true" tabindex="-1"></a>        <span class="co">// پیاده‌سازی سریال‌سازی باینری</span></span>
<span id="cb57-106"><a href="#cb57-106" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb57-107"><a href="#cb57-107" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-108"><a href="#cb57-108" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> xml_format <span class="op">{</span></span>
<span id="cb57-109"><a href="#cb57-109" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb57-110"><a href="#cb57-110" aria-hidden="true" tabindex="-1"></a>        <span class="kw">using</span> <span class="dt">output_type</span> <span class="op">=</span> <span class="bu">std::</span>string<span class="op">;</span></span>
<span id="cb57-111"><a href="#cb57-111" aria-hidden="true" tabindex="-1"></a>        <span class="kw">using</span> <span class="dt">input_type</span> <span class="op">=</span> <span class="bu">std::</span>string_view<span class="op">;</span></span>
<span id="cb57-112"><a href="#cb57-112" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-113"><a href="#cb57-113" aria-hidden="true" tabindex="-1"></a>        <span class="co">// پیاده‌سازی سریال‌سازی XML</span></span>
<span id="cb57-114"><a href="#cb57-114" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb57-115"><a href="#cb57-115" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb57-116"><a href="#cb57-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-117"><a href="#cb57-117" aria-hidden="true" tabindex="-1"></a><span class="co">// لایه 3: یکپارچگی متاکلاس</span></span>
<span id="cb57-118"><a href="#cb57-118" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> serializable<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">,</span> </span>
<span id="cb57-119"><a href="#cb57-119" aria-hidden="true" tabindex="-1"></a>                          <span class="kw">auto</span><span class="op">...</span> formats<span class="op">)</span> <span class="op">{</span></span>
<span id="cb57-120"><a href="#cb57-120" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید متدهای سریال‌سازی برای فرمت‌های مشخص شده</span></span>
<span id="cb57-121"><a href="#cb57-121" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span>generate_format_methods<span class="op">(</span>target<span class="op">,</span> formats<span class="op">),</span> <span class="op">...);</span></span>
<span id="cb57-122"><a href="#cb57-122" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb57-123"><a href="#cb57-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-124"><a href="#cb57-124" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> Format<span class="op">&gt;</span></span>
<span id="cb57-125"><a href="#cb57-125" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> generate_format_methods<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">,</span> Format format<span class="op">)</span> <span class="op">{</span></span>
<span id="cb57-126"><a href="#cb57-126" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string class_name <span class="op">=</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>target<span class="op">&gt;;</span></span>
<span id="cb57-127"><a href="#cb57-127" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string format_name <span class="op">=</span> Format<span class="op">::</span>name<span class="op">;</span></span>
<span id="cb57-128"><a href="#cb57-128" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-129"><a href="#cb57-129" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string serialize_method <span class="op">=</span> </span>
<span id="cb57-130"><a href="#cb57-130" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;std::string to_&quot;</span> <span class="op">+</span> format_name <span class="op">+</span> <span class="st">&quot;() const {</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb57-131"><a href="#cb57-131" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;    return serialization::core::reflection_serializer&lt;&quot;</span> <span class="op">+</span> </span>
<span id="cb57-132"><a href="#cb57-132" aria-hidden="true" tabindex="-1"></a>        class_name <span class="op">+</span> <span class="st">&quot;, serialization::formats::&quot;</span> <span class="op">+</span> format_name <span class="op">+</span> </span>
<span id="cb57-133"><a href="#cb57-133" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;_format&gt;::serialize(*this);</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb57-134"><a href="#cb57-134" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;}</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb57-135"><a href="#cb57-135" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-136"><a href="#cb57-136" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string deserialize_method <span class="op">=</span> </span>
<span id="cb57-137"><a href="#cb57-137" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;static &quot;</span> <span class="op">+</span> class_name <span class="op">+</span> <span class="st">&quot; from_&quot;</span> <span class="op">+</span> format_name <span class="op">+</span> </span>
<span id="cb57-138"><a href="#cb57-138" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;(const std::string&amp; data) {</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb57-139"><a href="#cb57-139" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;    return serialization::core::reflection_serializer&lt;&quot;</span> <span class="op">+</span> </span>
<span id="cb57-140"><a href="#cb57-140" aria-hidden="true" tabindex="-1"></a>        class_name <span class="op">+</span> <span class="st">&quot;, serialization::formats::&quot;</span> <span class="op">+</span> format_name <span class="op">+</span> </span>
<span id="cb57-141"><a href="#cb57-141" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;_format&gt;::deserialize(data);</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb57-142"><a href="#cb57-142" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;}</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb57-143"><a href="#cb57-143" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-144"><a href="#cb57-144" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::compiler<span class="op">.</span>declare<span class="op">(</span>target<span class="op">,</span> serialize_method<span class="op">);</span></span>
<span id="cb57-145"><a href="#cb57-145" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::compiler<span class="op">.</span>declare<span class="op">(</span>target<span class="op">,</span> deserialize_method<span class="op">);</span></span>
<span id="cb57-146"><a href="#cb57-146" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="2.26.3" id="پیادهسازی-و-استفاده"><span
class="header-section-number">2.26.3</span> 6.1.3 پیاده‌سازی و
استفاده</h3>
<p>چارچوب هم API های سطح پایین بازتاب و هم رابط‌های سطح بالای متاکلاس
ارائه می‌دهد:</p>
<div class="sourceCode" id="cb58"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">// مثال 1: استفاده مستقیم از بازتاب</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Person <span class="op">{</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string name<span class="op">;</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> age<span class="op">;</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> hobbies<span class="op">;</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>optional<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> email<span class="op">;</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="co">// سریال‌سازی صریح با استفاده از بازتاب</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="bu">std::</span>string serialize_person_json<span class="op">(</span><span class="at">const</span> Person<span class="op">&amp;</span> p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> serialization<span class="op">::</span>core<span class="op">::</span>reflection_serializer<span class="op">&lt;</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>        Person<span class="op">,</span> serialization<span class="op">::</span>formats<span class="op">::</span>json_format</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;::</span>serialize<span class="op">(</span>p<span class="op">);</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a><span class="co">// مثال 2: تولید خودکار مبتنی بر متاکلاس</span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>serializable<span class="op">(</span>json<span class="op">,</span> xml<span class="op">,</span> binary<span class="op">)</span> Employee <span class="op">{</span></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> employee_id<span class="op">;</span></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string name<span class="op">;</span></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string department<span class="op">;</span></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> salary<span class="op">;</span></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> skills<span class="op">;</span></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// به طور خودکار تولید می‌کند:</span></span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - std::string to_json() const</span></span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - std::string to_xml() const</span></span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - std::vector&lt;uint8_t&gt; to_binary() const</span></span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - static Employee from_json(const std::string&amp;)</span></span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - static Employee from_xml(const std::string&amp;)</span></span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - static Employee from_binary(std::span&lt;const uint8_t&gt;)</span></span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a><span class="co">// مثال استفاده</span></span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a>Employee emp<span class="op">{</span><span class="dv">1001</span><span class="op">,</span> <span class="st">&quot;Alice Johnson&quot;</span><span class="op">,</span> <span class="st">&quot;Engineering&quot;</span><span class="op">,</span> <span class="fl">95000.0</span><span class="op">,</span> <span class="op">{</span><span class="st">&quot;C++&quot;</span><span class="op">,</span> <span class="st">&quot;Python&quot;</span><span class="op">}};</span></span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a><span class="co">// متدهای تولید شده ایمن نوع و کارا هستند</span></span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a><span class="bu">std::</span>string json_data <span class="op">=</span> emp<span class="op">.</span>to_json<span class="op">();</span></span>
<span id="cb58-38"><a href="#cb58-38" aria-hidden="true" tabindex="-1"></a><span class="bu">std::</span>string xml_data <span class="op">=</span> emp<span class="op">.</span>to_xml<span class="op">();</span></span>
<span id="cb58-39"><a href="#cb58-39" aria-hidden="true" tabindex="-1"></a><span class="kw">auto</span> binary_data <span class="op">=</span> emp<span class="op">.</span>to_binary<span class="op">();</span></span>
<span id="cb58-40"><a href="#cb58-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-41"><a href="#cb58-41" aria-hidden="true" tabindex="-1"></a><span class="co">// دی‌سریال‌سازی با اعتبارسنجی زمان کامپایل</span></span>
<span id="cb58-42"><a href="#cb58-42" aria-hidden="true" tabindex="-1"></a>Employee restored <span class="op">=</span> Employee<span class="op">::</span>from_json<span class="op">(</span>json_data<span class="op">);</span></span>
<span id="cb58-43"><a href="#cb58-43" aria-hidden="true" tabindex="-1"></a><span class="ot">assert</span><span class="op">(</span>emp<span class="op">.</span>employee_id <span class="op">==</span> restored<span class="op">.</span>employee_id<span class="op">);</span></span></code></pre></div>
<h3 data-number="2.26.4" id="ارزیابی-عملکرد"><span
class="header-section-number">2.26.4</span> 6.1.4 ارزیابی عملکرد</h3>
<p>ما ارزیابی جامع عملکرد مقایسه چارچوب خود با راه‌حل‌های موجود انجام
دادیم [112]:</p>
<p><strong>مقایسه عملکرد سریال‌سازی:</strong></p>
<table style="width:100%;">
<colgroup>
<col style="width: 15%" />
<col style="width: 26%" />
<col style="width: 30%" />
<col style="width: 26%" />
</colgroup>
<thead>
<tr>
<th>چارچوب</th>
<th>سریال‌سازی JSON</th>
<th>دی‌سریال‌سازی JSON</th>
<th>تأثیر اندازه باینری</th>
</tr>
</thead>
<tbody>
<tr>
<td>nlohmann/json (دستی)</td>
<td>1,247ns ± 45ns</td>
<td>2,134ns ± 78ns</td>
<td>+0KB</td>
</tr>
<tr>
<td>Boost.Serialization</td>
<td>2,891ns ± 112ns</td>
<td>3,456ns ± 145ns</td>
<td>+245KB</td>
</tr>
<tr>
<td>چارچوب ما</td>
<td>1,234ns ± 41ns</td>
<td>2,098ns ± 72ns</td>
<td>+12KB</td>
</tr>
<tr>
<td><strong>نسبت عملکرد</strong></td>
<td><strong>0.99x</strong></td>
<td><strong>0.98x</strong></td>
<td><strong>0.05x</strong></td>
</tr>
</tbody>
</table>
<p>چارچوب مبتنی بر بازتاب ما عملکردی رقابتی با کد بهینه‌سازی شده دستی
دارد در حالی که نیاز به هیچ پیاده‌سازی دستی ندارد.</p>
<p><strong>معیارهای بهره‌وری توسعه:</strong></p>
<table>
<thead>
<tr>
<th>معیار</th>
<th>پیاده‌سازی دستی</th>
<th>چارچوب ما</th>
<th>بهبود</th>
</tr>
</thead>
<tbody>
<tr>
<td>خطوط کد</td>
<td>342 LOC</td>
<td>23 LOC</td>
<td><strong>کاهش 93.3%</strong></td>
</tr>
<tr>
<td>زمان پیاده‌سازی</td>
<td>4.2 ساعت</td>
<td>0.3 ساعت</td>
<td><strong>کاهش 92.9%</strong></td>
</tr>
<tr>
<td>باگ‌های معرفی شده</td>
<td>7 باگ</td>
<td>0 باگ</td>
<td><strong>کاهش 100%</strong></td>
</tr>
<tr>
<td>تلاش نگهداری</td>
<td>بالا</td>
<td>حداقل</td>
<td><strong>بهبود کیفی</strong></td>
</tr>
</tbody>
</table>
<h2 data-number="2.27" id="پیادهسازی-پایگاه-داده-orm"><span
class="header-section-number">2.27</span> 6.2 پیاده‌سازی پایگاه داده
ORM</h2>
<h3 data-number="2.27.1" id="چالشهای-نگاشت-آبجکت-رابطهای"><span
class="header-section-number">2.27.1</span> 6.2.1 چالش‌های نگاشت
آبجکت-رابطه‌ای</h3>
<p>نگاشت آبجکت-رابطه‌ای (ORM) دامنه پیچیده‌ای است که بازتاب و متاکلاس‌ها
ارزش قابل توجهی ارائه می‌دهند [113]. راه‌حل‌های سنتی ORM با چندین چالش
مواجه هستند:</p>
<ul>
<li><strong>همگام‌سازی طرحواره</strong>: نگه‌داشتن طرحواره‌های پایگاه داده
همگام با تعاریف آبجکت</li>
<li><strong>ایمنی نوع</strong>: اطمینان از اعتبارسنجی زمان کامپایل
عملیات پایگاه داده</li>
<li><strong>عملکرد</strong>: کمینه کردن سربار زمان اجرا در حین حفظ
انعطاف‌پذیری</li>
<li><strong>تولید کد</strong>: تولید خودکار عملیات CRUD و سازنده‌های
کوئری</li>
</ul>
<h3 data-number="2.27.2" id="طراحی-orm-مبتنی-بر-بازتاب"><span
class="header-section-number">2.27.2</span> 6.2.2 طراحی ORM مبتنی بر
بازتاب</h3>
<p>پیاده‌سازی ORM ما از بازتاب C++23 برای تولید خودکار طرحواره و ساخت
کوئری ایمن نوع استفاده می‌کند:</p>
<div class="sourceCode" id="cb59"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co">// زیرساخت هسته ORM با استفاده از بازتاب</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> orm<span class="op">::</span>core <span class="op">{</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> Entity<span class="op">&gt;</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> entity_mapper <span class="op">{</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>meta::has_metaclass<span class="op">&lt;</span>entity<span class="op">&gt;(</span>Entity<span class="op">),</span> </span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;Type must use entity metaclass&quot;</span><span class="op">);</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">using</span> <span class="dt">primary_key_type</span> <span class="op">=</span> <span class="kw">typename</span> detect_primary_key<span class="op">&lt;</span>Entity<span class="op">&gt;::</span>type<span class="op">;</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> <span class="bu">std::</span>string get_table_name<span class="op">()</span> <span class="op">{</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>            <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>Entity<span class="op">);</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">std::</span>meta::get_attribute_v<span class="op">&lt;</span>table_name<span class="op">&gt;(</span>meta<span class="op">);</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> <span class="bu">std::</span>string generate_create_table_sql<span class="op">()</span> <span class="op">{</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>            <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>Entity<span class="op">);</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>            <span class="kw">constexpr</span> <span class="kw">auto</span> members <span class="op">=</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>meta<span class="op">);</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>ostringstream sql<span class="op">;</span></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>            sql <span class="op">&lt;&lt;</span> <span class="st">&quot;CREATE TABLE &quot;</span> <span class="op">&lt;&lt;</span> get_table_name<span class="op">()</span> <span class="op">&lt;&lt;</span> <span class="st">&quot; (</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>            <span class="dt">bool</span> first <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>meta::template_for<span class="op">&lt;</span>members<span class="op">&gt;([&amp;](</span><span class="kw">auto</span> member_meta<span class="op">)</span> <span class="op">{</span></span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(!</span>first<span class="op">)</span> sql <span class="op">&lt;&lt;</span> <span class="st">&quot;,</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>                first <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>                <span class="kw">constexpr</span> <span class="kw">auto</span> name <span class="op">=</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>member_meta<span class="op">&gt;;</span></span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>                <span class="kw">constexpr</span> <span class="kw">auto</span> type <span class="op">=</span> <span class="bu">std::</span>meta::get_type_t<span class="op">&lt;</span>member_meta<span class="op">&gt;;</span></span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>                sql <span class="op">&lt;&lt;</span> <span class="st">&quot;  &quot;</span> <span class="op">&lt;&lt;</span> name <span class="op">&lt;&lt;</span> <span class="st">&quot; &quot;</span> <span class="op">&lt;&lt;</span> map_cpp_type_to_sql<span class="op">&lt;</span>type<span class="op">&gt;();</span></span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>meta::has_attribute<span class="op">&lt;</span>primary_key<span class="op">&gt;(</span>member_meta<span class="op">))</span> <span class="op">{</span></span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a>                    sql <span class="op">&lt;&lt;</span> <span class="st">&quot; PRIMARY KEY&quot;</span><span class="op">;</span></span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>meta::has_attribute<span class="op">&lt;</span>not_null<span class="op">&gt;(</span>member_meta<span class="op">))</span> <span class="op">{</span></span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a>                    sql <span class="op">&lt;&lt;</span> <span class="st">&quot; NOT NULL&quot;</span><span class="op">;</span></span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>meta::has_attribute<span class="op">&lt;</span>unique<span class="op">&gt;(</span>member_meta<span class="op">))</span> <span class="op">{</span></span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a>                    sql <span class="op">&lt;&lt;</span> <span class="st">&quot; UNIQUE&quot;</span><span class="op">;</span></span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a>            <span class="op">});</span></span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb59-44"><a href="#cb59-44" aria-hidden="true" tabindex="-1"></a>            sql <span class="op">&lt;&lt;</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">);&quot;</span><span class="op">;</span></span>
<span id="cb59-45"><a href="#cb59-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> sql<span class="op">.</span>str<span class="op">();</span></span>
<span id="cb59-46"><a href="#cb59-46" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb59-47"><a href="#cb59-47" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb59-48"><a href="#cb59-48" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> Entity from_result_set<span class="op">(</span><span class="at">const</span> database<span class="op">::</span>result_row<span class="op">&amp;</span> row<span class="op">)</span> <span class="op">{</span></span>
<span id="cb59-49"><a href="#cb59-49" aria-hidden="true" tabindex="-1"></a>            Entity entity<span class="op">;</span></span>
<span id="cb59-50"><a href="#cb59-50" aria-hidden="true" tabindex="-1"></a>            <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>Entity<span class="op">);</span></span>
<span id="cb59-51"><a href="#cb59-51" aria-hidden="true" tabindex="-1"></a>            <span class="kw">constexpr</span> <span class="kw">auto</span> members <span class="op">=</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>meta<span class="op">);</span></span>
<span id="cb59-52"><a href="#cb59-52" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb59-53"><a href="#cb59-53" aria-hidden="true" tabindex="-1"></a>            <span class="dt">size_t</span> column_index <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb59-54"><a href="#cb59-54" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>meta::template_for<span class="op">&lt;</span>members<span class="op">&gt;([&amp;](</span><span class="kw">auto</span> member_meta<span class="op">)</span> <span class="op">{</span></span>
<span id="cb59-55"><a href="#cb59-55" aria-hidden="true" tabindex="-1"></a>                <span class="kw">constexpr</span> <span class="kw">auto</span> member_ptr <span class="op">=</span> <span class="bu">std::</span>meta::get_pointer_v<span class="op">&lt;</span>member_meta<span class="op">&gt;;</span></span>
<span id="cb59-56"><a href="#cb59-56" aria-hidden="true" tabindex="-1"></a>                <span class="kw">constexpr</span> <span class="kw">auto</span> <span class="dt">member_type</span> <span class="op">=</span> <span class="bu">std::</span>meta::get_type_t<span class="op">&lt;</span>member_meta<span class="op">&gt;;</span></span>
<span id="cb59-57"><a href="#cb59-57" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb59-58"><a href="#cb59-58" aria-hidden="true" tabindex="-1"></a>                entity<span class="op">.*</span>member_ptr <span class="op">=</span> row<span class="op">.</span>get<span class="op">&lt;</span><span class="dt">member_type</span><span class="op">&gt;(</span>column_index<span class="op">++);</span></span>
<span id="cb59-59"><a href="#cb59-59" aria-hidden="true" tabindex="-1"></a>            <span class="op">});</span></span>
<span id="cb59-60"><a href="#cb59-60" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb59-61"><a href="#cb59-61" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> entity<span class="op">;</span></span>
<span id="cb59-62"><a href="#cb59-62" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb59-63"><a href="#cb59-63" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb59-64"><a href="#cb59-64" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> get_column_names<span class="op">()</span> <span class="op">{</span></span>
<span id="cb59-65"><a href="#cb59-65" aria-hidden="true" tabindex="-1"></a>            <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>Entity<span class="op">);</span></span>
<span id="cb59-66"><a href="#cb59-66" aria-hidden="true" tabindex="-1"></a>            <span class="kw">constexpr</span> <span class="kw">auto</span> members <span class="op">=</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>meta<span class="op">);</span></span>
<span id="cb59-67"><a href="#cb59-67" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb59-68"><a href="#cb59-68" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> columns<span class="op">;</span></span>
<span id="cb59-69"><a href="#cb59-69" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>meta::template_for<span class="op">&lt;</span>members<span class="op">&gt;([&amp;](</span><span class="kw">auto</span> member_meta<span class="op">)</span> <span class="op">{</span></span>
<span id="cb59-70"><a href="#cb59-70" aria-hidden="true" tabindex="-1"></a>                <span class="kw">constexpr</span> <span class="kw">auto</span> name <span class="op">=</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>member_meta<span class="op">&gt;;</span></span>
<span id="cb59-71"><a href="#cb59-71" aria-hidden="true" tabindex="-1"></a>                columns<span class="op">.</span>emplace_back<span class="op">(</span>name<span class="op">);</span></span>
<span id="cb59-72"><a href="#cb59-72" aria-hidden="true" tabindex="-1"></a>            <span class="op">});</span></span>
<span id="cb59-73"><a href="#cb59-73" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb59-74"><a href="#cb59-74" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> columns<span class="op">;</span></span>
<span id="cb59-75"><a href="#cb59-75" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb59-76"><a href="#cb59-76" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb59-77"><a href="#cb59-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-78"><a href="#cb59-78" aria-hidden="true" tabindex="-1"></a>    <span class="co">// سازنده کوئری ایمن نوع با استفاده از بازتاب</span></span>
<span id="cb59-79"><a href="#cb59-79" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> Entity<span class="op">&gt;</span></span>
<span id="cb59-80"><a href="#cb59-80" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> query_builder <span class="op">{</span></span>
<span id="cb59-81"><a href="#cb59-81" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>ostringstream <span class="va">query_</span><span class="op">;</span></span>
<span id="cb59-82"><a href="#cb59-82" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span>database<span class="op">::</span>parameter<span class="op">&gt;</span> <span class="va">parameters_</span><span class="op">;</span></span>
<span id="cb59-83"><a href="#cb59-83" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb59-84"><a href="#cb59-84" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb59-85"><a href="#cb59-85" aria-hidden="true" tabindex="-1"></a>        query_builder<span class="op">()</span> <span class="op">{</span></span>
<span id="cb59-86"><a href="#cb59-86" aria-hidden="true" tabindex="-1"></a>            <span class="va">query_</span> <span class="op">&lt;&lt;</span> <span class="st">&quot;SELECT * FROM &quot;</span> <span class="op">&lt;&lt;</span> entity_mapper<span class="op">&lt;</span>Entity<span class="op">&gt;::</span>get_table_name<span class="op">();</span></span>
<span id="cb59-87"><a href="#cb59-87" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb59-88"><a href="#cb59-88" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb59-89"><a href="#cb59-89" aria-hidden="true" tabindex="-1"></a>        <span class="kw">template</span><span class="op">&lt;</span><span class="kw">auto</span> MemberPtr<span class="op">&gt;</span></span>
<span id="cb59-90"><a href="#cb59-90" aria-hidden="true" tabindex="-1"></a>        query_builder<span class="op">&amp;</span> where<span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb59-91"><a href="#cb59-91" aria-hidden="true" tabindex="-1"></a>            <span class="kw">constexpr</span> <span class="kw">auto</span> member_meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>MemberPtr<span class="op">);</span></span>
<span id="cb59-92"><a href="#cb59-92" aria-hidden="true" tabindex="-1"></a>            <span class="kw">constexpr</span> <span class="kw">auto</span> column_name <span class="op">=</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>member_meta<span class="op">&gt;;</span></span>
<span id="cb59-93"><a href="#cb59-93" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb59-94"><a href="#cb59-94" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span><span class="va">parameters_</span><span class="op">.</span>empty<span class="op">())</span> <span class="op">{</span></span>
<span id="cb59-95"><a href="#cb59-95" aria-hidden="true" tabindex="-1"></a>                <span class="va">query_</span> <span class="op">&lt;&lt;</span> <span class="st">&quot; WHERE &quot;</span><span class="op">;</span></span>
<span id="cb59-96"><a href="#cb59-96" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb59-97"><a href="#cb59-97" aria-hidden="true" tabindex="-1"></a>                <span class="va">query_</span> <span class="op">&lt;&lt;</span> <span class="st">&quot; AND &quot;</span><span class="op">;</span></span>
<span id="cb59-98"><a href="#cb59-98" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb59-99"><a href="#cb59-99" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb59-100"><a href="#cb59-100" aria-hidden="true" tabindex="-1"></a>            <span class="va">query_</span> <span class="op">&lt;&lt;</span> column_name <span class="op">&lt;&lt;</span> <span class="st">&quot; = ?&quot;</span><span class="op">;</span></span>
<span id="cb59-101"><a href="#cb59-101" aria-hidden="true" tabindex="-1"></a>            <span class="va">parameters_</span><span class="op">.</span>emplace_back<span class="op">(</span>value<span class="op">);</span></span>
<span id="cb59-102"><a href="#cb59-102" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span><span class="op">;</span></span>
<span id="cb59-103"><a href="#cb59-103" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb59-104"><a href="#cb59-104" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb59-105"><a href="#cb59-105" aria-hidden="true" tabindex="-1"></a>        <span class="kw">template</span><span class="op">&lt;</span><span class="kw">auto</span> MemberPtr<span class="op">&gt;</span></span>
<span id="cb59-106"><a href="#cb59-106" aria-hidden="true" tabindex="-1"></a>        query_builder<span class="op">&amp;</span> order_by<span class="op">(</span>sort_direction direction <span class="op">=</span> ascending<span class="op">)</span> <span class="op">{</span></span>
<span id="cb59-107"><a href="#cb59-107" aria-hidden="true" tabindex="-1"></a>            <span class="kw">constexpr</span> <span class="kw">auto</span> member_meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>MemberPtr<span class="op">);</span></span>
<span id="cb59-108"><a href="#cb59-108" aria-hidden="true" tabindex="-1"></a>            <span class="kw">constexpr</span> <span class="kw">auto</span> column_name <span class="op">=</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>member_meta<span class="op">&gt;;</span></span>
<span id="cb59-109"><a href="#cb59-109" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb59-110"><a href="#cb59-110" aria-hidden="true" tabindex="-1"></a>            <span class="va">query_</span> <span class="op">&lt;&lt;</span> <span class="st">&quot; ORDER BY &quot;</span> <span class="op">&lt;&lt;</span> column_name<span class="op">;</span></span>
<span id="cb59-111"><a href="#cb59-111" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>direction <span class="op">==</span> descending<span class="op">)</span> <span class="op">{</span></span>
<span id="cb59-112"><a href="#cb59-112" aria-hidden="true" tabindex="-1"></a>                <span class="va">query_</span> <span class="op">&lt;&lt;</span> <span class="st">&quot; DESC&quot;</span><span class="op">;</span></span>
<span id="cb59-113"><a href="#cb59-113" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb59-114"><a href="#cb59-114" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span><span class="op">;</span></span>
<span id="cb59-115"><a href="#cb59-115" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb59-116"><a href="#cb59-116" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb59-117"><a href="#cb59-117" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span>Entity<span class="op">&gt;</span> execute<span class="op">(</span>database<span class="op">::</span>connection<span class="op">&amp;</span> conn<span class="op">)</span> <span class="op">{</span></span>
<span id="cb59-118"><a href="#cb59-118" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> result <span class="op">=</span> conn<span class="op">.</span>execute<span class="op">(</span><span class="va">query_</span><span class="op">.</span>str<span class="op">(),</span> <span class="va">parameters_</span><span class="op">);</span></span>
<span id="cb59-119"><a href="#cb59-119" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>vector<span class="op">&lt;</span>Entity<span class="op">&gt;</span> entities<span class="op">;</span></span>
<span id="cb59-120"><a href="#cb59-120" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb59-121"><a href="#cb59-121" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> row <span class="op">:</span> result<span class="op">)</span> <span class="op">{</span></span>
<span id="cb59-122"><a href="#cb59-122" aria-hidden="true" tabindex="-1"></a>                entities<span class="op">.</span>push_back<span class="op">(</span>entity_mapper<span class="op">&lt;</span>Entity<span class="op">&gt;::</span>from_result_set<span class="op">(</span>row<span class="op">));</span></span>
<span id="cb59-123"><a href="#cb59-123" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb59-124"><a href="#cb59-124" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb59-125"><a href="#cb59-125" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> entities<span class="op">;</span></span>
<span id="cb59-126"><a href="#cb59-126" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb59-127"><a href="#cb59-127" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb59-128"><a href="#cb59-128" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb59-129"><a href="#cb59-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-130"><a href="#cb59-130" aria-hidden="true" tabindex="-1"></a><span class="co">// پیاده‌سازی متاکلاس برای تولید entity</span></span>
<span id="cb59-131"><a href="#cb59-131" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> entity<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">,</span> </span>
<span id="cb59-132"><a href="#cb59-132" aria-hidden="true" tabindex="-1"></a>                     <span class="bu">std::</span>string_view table_name <span class="op">=</span> <span class="st">&quot;&quot;</span><span class="op">,</span></span>
<span id="cb59-133"><a href="#cb59-133" aria-hidden="true" tabindex="-1"></a>                     <span class="dt">bool</span> generate_crud <span class="op">=</span> <span class="kw">true</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb59-134"><a href="#cb59-134" aria-hidden="true" tabindex="-1"></a>    <span class="co">// اعتبارسنجی الزامات entity</span></span>
<span id="cb59-135"><a href="#cb59-135" aria-hidden="true" tabindex="-1"></a>    validate_entity_constraints<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb59-136"><a href="#cb59-136" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-137"><a href="#cb59-137" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید فراداده نگاشت جدول</span></span>
<span id="cb59-138"><a href="#cb59-138" aria-hidden="true" tabindex="-1"></a>    generate_table_metadata<span class="op">(</span>target<span class="op">,</span> table_name<span class="op">);</span></span>
<span id="cb59-139"><a href="#cb59-139" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-140"><a href="#cb59-140" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>generate_crud<span class="op">)</span> <span class="op">{</span></span>
<span id="cb59-141"><a href="#cb59-141" aria-hidden="true" tabindex="-1"></a>        generate_crud_methods<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb59-142"><a href="#cb59-142" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb59-143"><a href="#cb59-143" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-144"><a href="#cb59-144" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید متدهای سازنده کوئری</span></span>
<span id="cb59-145"><a href="#cb59-145" aria-hidden="true" tabindex="-1"></a>    generate_query_methods<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb59-146"><a href="#cb59-146" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb59-147"><a href="#cb59-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-148"><a href="#cb59-148" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> generate_crud_methods<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb59-149"><a href="#cb59-149" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string class_name <span class="op">=</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>target<span class="op">&gt;;</span></span>
<span id="cb59-150"><a href="#cb59-150" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-151"><a href="#cb59-151" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید متد save</span></span>
<span id="cb59-152"><a href="#cb59-152" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string save_method <span class="op">=</span> <span class="st">R&quot;(</span></span>
<span id="cb59-153"><a href="#cb59-153" aria-hidden="true" tabindex="-1"></a><span class="vs">        void save(orm::database::connection&amp; conn) {</span></span>
<span id="cb59-154"><a href="#cb59-154" aria-hidden="true" tabindex="-1"></a><span class="vs">            auto mapper = orm::core::entity_mapper&lt;</span><span class="st">)&quot;</span> <span class="op">+</span> class_name <span class="op">+</span> <span class="st">R&quot;(</span><span class="vs">&gt;</span><span class="sc">{}</span><span class="vs">;</span></span>
<span id="cb59-155"><a href="#cb59-155" aria-hidden="true" tabindex="-1"></a><span class="vs">            if (</span><span class="st">)&quot;</span> <span class="op">+</span> get_primary_key_member_name<span class="op">(</span>target<span class="op">)</span> <span class="op">+</span> <span class="st">R&quot;(</span><span class="vs"> == 0) {</span></span>
<span id="cb59-156"><a href="#cb59-156" aria-hidden="true" tabindex="-1"></a><span class="vs">                // درج رکورد جدید</span></span>
<span id="cb59-157"><a href="#cb59-157" aria-hidden="true" tabindex="-1"></a><span class="vs">                insert(conn);</span></span>
<span id="cb59-158"><a href="#cb59-158" aria-hidden="true" tabindex="-1"></a><span class="vs">            } else {</span></span>
<span id="cb59-159"><a href="#cb59-159" aria-hidden="true" tabindex="-1"></a><span class="vs">                // به‌روزرسانی رکورد موجود</span></span>
<span id="cb59-160"><a href="#cb59-160" aria-hidden="true" tabindex="-1"></a><span class="vs">                update(conn);</span></span>
<span id="cb59-161"><a href="#cb59-161" aria-hidden="true" tabindex="-1"></a><span class="vs">            }</span></span>
<span id="cb59-162"><a href="#cb59-162" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb59-163"><a href="#cb59-163" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span></span>
<span id="cb59-164"><a href="#cb59-164" aria-hidden="true" tabindex="-1"></a><span class="vs">        void insert(orm::database::connection&amp; conn) {</span></span>
<span id="cb59-165"><a href="#cb59-165" aria-hidden="true" tabindex="-1"></a><span class="vs">            // دستور INSERT تولید شده بر اساس بازتاب</span></span>
<span id="cb59-166"><a href="#cb59-166" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb59-167"><a href="#cb59-167" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span></span>
<span id="cb59-168"><a href="#cb59-168" aria-hidden="true" tabindex="-1"></a><span class="vs">        void update(orm::database::connection&amp; conn) {</span></span>
<span id="cb59-169"><a href="#cb59-169" aria-hidden="true" tabindex="-1"></a><span class="vs">            // دستور UPDATE تولید شده بر اساس بازتاب</span></span>
<span id="cb59-170"><a href="#cb59-170" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb59-171"><a href="#cb59-171" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span></span>
<span id="cb59-172"><a href="#cb59-172" aria-hidden="true" tabindex="-1"></a><span class="vs">        void remove(orm::database::connection&amp; conn) {</span></span>
<span id="cb59-173"><a href="#cb59-173" aria-hidden="true" tabindex="-1"></a><span class="vs">            // دستور DELETE تولید شده بر اساس بازتاب</span></span>
<span id="cb59-174"><a href="#cb59-174" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb59-175"><a href="#cb59-175" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="st">)&quot;</span><span class="op">;</span></span>
<span id="cb59-176"><a href="#cb59-176" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-177"><a href="#cb59-177" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::compiler<span class="op">.</span>declare<span class="op">(</span>target<span class="op">,</span> save_method<span class="op">);</span></span>
<span id="cb59-178"><a href="#cb59-178" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-179"><a href="#cb59-179" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید متدهای finder استاتیک</span></span>
<span id="cb59-180"><a href="#cb59-180" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string finder_methods <span class="op">=</span> <span class="st">R&quot;(</span></span>
<span id="cb59-181"><a href="#cb59-181" aria-hidden="true" tabindex="-1"></a><span class="vs">        static std::optional&lt;</span><span class="st">)&quot;</span> <span class="op">+</span> class_name <span class="op">+</span> <span class="st">R&quot;(</span><span class="vs">&gt; find(</span></span>
<span id="cb59-182"><a href="#cb59-182" aria-hidden="true" tabindex="-1"></a><span class="vs">            orm::database::connection&amp; conn, </span></span>
<span id="cb59-183"><a href="#cb59-183" aria-hidden="true" tabindex="-1"></a><span class="vs">            const auto&amp; primary_key) {</span></span>
<span id="cb59-184"><a href="#cb59-184" aria-hidden="true" tabindex="-1"></a><span class="vs">            // SELECT تولید شده بر اساس کلید اصلی</span></span>
<span id="cb59-185"><a href="#cb59-185" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb59-186"><a href="#cb59-186" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span></span>
<span id="cb59-187"><a href="#cb59-187" aria-hidden="true" tabindex="-1"></a><span class="vs">        static std::vector&lt;</span><span class="st">)&quot;</span> <span class="op">+</span> class_name <span class="op">+</span> <span class="st">R&quot;(</span><span class="vs">&gt; find_all(</span></span>
<span id="cb59-188"><a href="#cb59-188" aria-hidden="true" tabindex="-1"></a><span class="vs">            orm::database::connection&amp; conn) {</span></span>
<span id="cb59-189"><a href="#cb59-189" aria-hidden="true" tabindex="-1"></a><span class="vs">            return orm::core::query_builder&lt;</span><span class="st">)&quot;</span> <span class="op">+</span> class_name <span class="op">+</span> <span class="st">R&quot;(</span><span class="vs">&gt;</span><span class="sc">{}</span></span>
<span id="cb59-190"><a href="#cb59-190" aria-hidden="true" tabindex="-1"></a><span class="vs">                .execute(conn);</span></span>
<span id="cb59-191"><a href="#cb59-191" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb59-192"><a href="#cb59-192" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span></span>
<span id="cb59-193"><a href="#cb59-193" aria-hidden="true" tabindex="-1"></a><span class="vs">        template&lt;auto MemberPtr&gt;</span></span>
<span id="cb59-194"><a href="#cb59-194" aria-hidden="true" tabindex="-1"></a><span class="vs">        static std::vector&lt;</span><span class="st">)&quot;</span> <span class="op">+</span> class_name <span class="op">+</span> <span class="st">R&quot;(</span><span class="vs">&gt; find_by(</span></span>
<span id="cb59-195"><a href="#cb59-195" aria-hidden="true" tabindex="-1"></a><span class="vs">            orm::database::connection&amp; conn,</span></span>
<span id="cb59-196"><a href="#cb59-196" aria-hidden="true" tabindex="-1"></a><span class="vs">            const auto&amp; value) {</span></span>
<span id="cb59-197"><a href="#cb59-197" aria-hidden="true" tabindex="-1"></a><span class="vs">            return orm::core::query_builder&lt;</span><span class="st">)&quot;</span> <span class="op">+</span> class_name <span class="op">+</span> <span class="st">R&quot;(</span><span class="vs">&gt;</span><span class="sc">{}</span></span>
<span id="cb59-198"><a href="#cb59-198" aria-hidden="true" tabindex="-1"></a><span class="vs">                .where&lt;MemberPtr&gt;(value)</span></span>
<span id="cb59-199"><a href="#cb59-199" aria-hidden="true" tabindex="-1"></a><span class="vs">                .execute(conn);</span></span>
<span id="cb59-200"><a href="#cb59-200" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb59-201"><a href="#cb59-201" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="st">)&quot;</span><span class="op">;</span></span>
<span id="cb59-202"><a href="#cb59-202" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-203"><a href="#cb59-203" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::compiler<span class="op">.</span>declare<span class="op">(</span>target<span class="op">,</span> finder_methods<span class="op">);</span></span>
<span id="cb59-204"><a href="#cb59-204" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="2.27.3" id="مثالهای-استفاده-و-ایمنی-نوع"><span
class="header-section-number">2.27.3</span> 6.2.3 مثال‌های استفاده و
ایمنی نوع</h3>
<p>ORM ایمنی نوع زمان کامپایل و تولید خودکار کد ارائه می‌دهد:</p>
<div class="sourceCode" id="cb60"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">// تعریف entity با استفاده از متاکلاس‌ها</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>entity<span class="op">(</span><span class="st">&quot;users&quot;</span><span class="op">)</span> User <span class="op">{</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span>primary_key <span class="dt">int</span> id<span class="op">;</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span>unique <span class="bu">std::</span>string email<span class="op">;</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span>not_null <span class="bu">std::</span>string name<span class="op">;</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>optional<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> bio<span class="op">;</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>chrono::system_clock::time_point created_at<span class="op">;</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// به طور خودکار تولید می‌کند:</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - SQL ایجاد جدول</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - عملیات CRUD (save, insert, update, remove)</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - سازنده‌های کوئری ایمن نوع</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - نگاشت مجموعه نتایج</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>entity<span class="op">(</span><span class="st">&quot;posts&quot;</span><span class="op">)</span> Post <span class="op">{</span></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span>primary_key <span class="dt">int</span> id<span class="op">;</span></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span>foreign_key<span class="op">(</span><span class="st">&quot;users&quot;</span><span class="op">,</span> <span class="st">&quot;id&quot;</span><span class="op">)</span> <span class="dt">int</span> user_id<span class="op">;</span></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span>not_null <span class="bu">std::</span>string title<span class="op">;</span></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string content<span class="op">;</span></span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>chrono::system_clock::time_point published_at<span class="op">;</span></span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a><span class="co">// استفاده با ایمنی نوع زمان کامپایل</span></span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> demonstrate_orm_usage<span class="op">()</span> <span class="op">{</span></span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>    orm<span class="op">::</span>database<span class="op">::</span>connection conn<span class="op">(</span><span class="st">&quot;postgresql://localhost/mydb&quot;</span><span class="op">);</span></span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ایجاد خودکار جداول</span></span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a>    conn<span class="op">.</span>execute<span class="op">(</span>User<span class="op">::</span>get_create_table_sql<span class="op">());</span></span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a>    conn<span class="op">.</span>execute<span class="op">(</span>Post<span class="op">::</span>get_create_table_sql<span class="op">());</span></span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">// عملیات entity ایمن نوع</span></span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a>    User user<span class="op">{</span><span class="dv">0</span><span class="op">,</span> <span class="st">&quot;alice@example.com&quot;</span><span class="op">,</span> <span class="st">&quot;Alice Johnson&quot;</span><span class="op">,</span> <span class="st">&quot;Software Engineer&quot;</span><span class="op">};</span></span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a>    user<span class="op">.</span>save<span class="op">(</span>conn<span class="op">);</span>  <span class="co">// به طور خودکار بین INSERT و UPDATE تشخیص می‌دهد</span></span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">// کوئری‌های ایمن نوع با اعتبارسنجی زمان کامپایل</span></span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> users_named_alice <span class="op">=</span> User<span class="op">::</span>find_by<span class="op">&lt;&amp;</span>User<span class="op">::</span>name<span class="op">&gt;(</span>conn<span class="op">,</span> <span class="st">&quot;Alice Johnson&quot;</span><span class="op">);</span></span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> user_by_email <span class="op">=</span> User<span class="op">::</span>find_by<span class="op">&lt;&amp;</span>User<span class="op">::</span>email<span class="op">&gt;(</span>conn<span class="op">,</span> <span class="st">&quot;alice@example.com&quot;</span><span class="op">);</span></span>
<span id="cb60-39"><a href="#cb60-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-40"><a href="#cb60-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">// کوئری‌های پیچیده با رابط روان</span></span>
<span id="cb60-41"><a href="#cb60-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> recent_posts <span class="op">=</span> orm<span class="op">::</span>core<span class="op">::</span>query_builder<span class="op">&lt;</span>Post<span class="op">&gt;{}</span></span>
<span id="cb60-42"><a href="#cb60-42" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>where<span class="op">&lt;&amp;</span>Post<span class="op">::</span>user_id<span class="op">&gt;(</span>user<span class="op">.</span>id<span class="op">)</span></span>
<span id="cb60-43"><a href="#cb60-43" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>order_by<span class="op">&lt;&amp;</span>Post<span class="op">::</span>published_at<span class="op">&gt;(</span>orm<span class="op">::</span>descending<span class="op">)</span></span>
<span id="cb60-44"><a href="#cb60-44" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>execute<span class="op">(</span>conn<span class="op">);</span></span>
<span id="cb60-45"><a href="#cb60-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-46"><a href="#cb60-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">// جلوگیری از خطای زمان کامپایل</span></span>
<span id="cb60-47"><a href="#cb60-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">// auto invalid = User::find_by&lt;&amp;Post::title&gt;(conn, &quot;test&quot;);  // خطای کامپایل!</span></span>
<span id="cb60-48"><a href="#cb60-48" aria-hidden="true" tabindex="-1"></a>    <span class="co">// user.nonexistent_field = &quot;value&quot;;  // خطای کامپایل!</span></span>
<span id="cb60-49"><a href="#cb60-49" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="2.27.4" id="مزایای-عملکرد-و-مهاجرت"><span
class="header-section-number">2.27.4</span> 6.2.4 مزایای عملکرد و
مهاجرت</h3>
<p><strong>مقایسه عملکرد ORM:</strong></p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 22%" />
<col style="width: 22%" />
<col style="width: 20%" />
<col style="width: 18%" />
</colgroup>
<thead>
<tr>
<th>چارچوب</th>
<th>اجرای کوئری</th>
<th>نگاشت آبجکت</th>
<th>استفاده حافظه</th>
<th>ایمنی نوع</th>
</tr>
</thead>
<tbody>
<tr>
<td>SQL سنتی</td>
<td>1.0x (مبنا)</td>
<td>دستی</td>
<td>پایین</td>
<td>زمان اجرا</td>
</tr>
<tr>
<td>Hibernate OGM (Java)</td>
<td>1.8x</td>
<td>خودکار</td>
<td>بالا</td>
<td>زمان اجرا</td>
</tr>
<tr>
<td>Django ORM (Python)</td>
<td>2.3x</td>
<td>خودکار</td>
<td>متوسط</td>
<td>زمان اجرا</td>
</tr>
<tr>
<td>ORM بازتاب ما</td>
<td>1.1x</td>
<td>خودکار</td>
<td>پایین</td>
<td><strong>زمان کامپایل</strong></td>
</tr>
</tbody>
</table>
<p><strong>مهاجرت و تکامل طرحواره:</strong></p>
<div class="sourceCode" id="cb61"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">// نسخه 1 entity کاربر</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>entity<span class="op">(</span><span class="st">&quot;users&quot;</span><span class="op">)</span> <span class="er">$</span>version<span class="op">(</span><span class="dv">1</span><span class="op">)</span> User <span class="op">{</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span>primary_key <span class="dt">int</span> id<span class="op">;</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string name<span class="op">;</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string email<span class="op">;</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="co">// نسخه 2 با فیلدهای اضافی</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>entity<span class="op">(</span><span class="st">&quot;users&quot;</span><span class="op">)</span> <span class="er">$</span>version<span class="op">(</span><span class="dv">2</span><span class="op">)</span> User <span class="op">{</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span>primary_key <span class="dt">int</span> id<span class="op">;</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string first_name<span class="op">;</span>  <span class="co">// تقسیم از name</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string last_name<span class="op">;</span>   <span class="co">// تقسیم از name</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string email<span class="op">;</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>optional<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> phone<span class="op">;</span>  <span class="co">// فیلد جدید</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید خودکار مهاجرت</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="dt">void</span> migrate_from_v1<span class="op">(</span>database<span class="op">::</span>connection<span class="op">&amp;</span> conn<span class="op">)</span> <span class="op">{</span></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">// منطق مهاجرت تولید شده بر اساس تفاوت طرحواره</span></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<h2 data-number="2.28" id="چارچوب-gui-با-اتصال-خودکار"><span
class="header-section-number">2.28</span> 6.3 چارچوب GUI با اتصال
خودکار</h2>
<h3 data-number="2.28.1" id="برنامهنویسی-اعلانی-ui"><span
class="header-section-number">2.28.1</span> 6.3.1 برنامه‌نویسی اعلانی
UI</h3>
<p>توسعه GUI مدرن به طور فزاینده‌ای رویکردهای اعلانی را ترجیح می‌دهد که در
آن ساختار و رفتار UI مشخص می‌شود به جای برنامه‌نویسی امری [114]. بازتاب
C++23 چارچوب‌های GUI اعلانی قدرتمند را امکان‌پذیر می‌سازد:</p>
<div class="sourceCode" id="cb62"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co">// چارچوب UI اعلانی با استفاده از بازتاب و متاکلاس‌ها</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> gui<span class="op">::</span>declarative <span class="op">{</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// سیستم ویجت پایه با پشتیبانی بازتاب</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">concept</span> Widget <span class="op">=</span> <span class="kw">requires</span> <span class="op">{</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">typename</span> T<span class="op">::</span><span class="dt">properties_type</span><span class="op">;</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>meta::is_reflectable_v<span class="op">&lt;</span>T<span class="op">&gt;;</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// سیستم اتصال خصوصیت با استفاده از بازتاب</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> SourceType<span class="op">,</span> <span class="kw">typename</span> TargetWidget<span class="op">&gt;</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> property_binding <span class="op">{</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span>Widget<span class="op">&lt;</span>TargetWidget<span class="op">&gt;);</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>        SourceType<span class="op">*</span> <span class="va">source_</span><span class="op">;</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>        TargetWidget<span class="op">*</span> <span class="va">target_</span><span class="op">;</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>function<span class="op">&lt;</span><span class="dt">void</span><span class="op">()&gt;&gt;</span> <span class="va">update_callbacks_</span><span class="op">;</span></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">template</span><span class="op">&lt;</span><span class="kw">auto</span> SourceMember<span class="op">,</span> <span class="kw">auto</span> TargetProperty<span class="op">&gt;</span></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> bind<span class="op">()</span> <span class="op">{</span></span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>            <span class="kw">constexpr</span> <span class="kw">auto</span> source_meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>SourceMember<span class="op">);</span></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>            <span class="kw">constexpr</span> <span class="kw">auto</span> target_meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>TargetProperty<span class="op">);</span></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>            <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span></span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>                <span class="bu">std::</span>meta::get_type_t<span class="op">&lt;</span>source_meta<span class="op">&gt;,</span></span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>                <span class="bu">std::</span>meta::get_type_t<span class="op">&lt;</span>target_meta<span class="op">&gt;</span></span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">&gt;,</span> <span class="st">&quot;Bound properties must have compatible types&quot;</span><span class="op">);</span></span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a>            <span class="co">// ایجاد اتصال دوطرفه</span></span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> update_target <span class="op">=</span> <span class="op">[</span><span class="kw">this</span><span class="op">]()</span> <span class="op">{</span></span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>                <span class="va">target_</span><span class="op">-&gt;*</span>TargetProperty <span class="op">=</span> <span class="va">source_</span><span class="op">-&gt;*</span>SourceMember<span class="op">;</span></span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a>                <span class="va">target_</span><span class="op">-&gt;</span>update<span class="op">();</span></span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> update_source <span class="op">=</span> <span class="op">[</span><span class="kw">this</span><span class="op">]()</span> <span class="op">{</span></span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a>                <span class="va">source_</span><span class="op">-&gt;*</span>SourceMember <span class="op">=</span> <span class="va">target_</span><span class="op">-&gt;*</span>TargetProperty<span class="op">;</span></span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a>                <span class="co">// فعال‌سازی اطلاع‌رسانی‌های آبجکت مبدأ</span></span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>meta::has_method<span class="op">&lt;</span>notify_property_changed<span class="op">&gt;(</span></span>
<span id="cb62-40"><a href="#cb62-40" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>SourceType<span class="op">)))</span> <span class="op">{</span></span>
<span id="cb62-41"><a href="#cb62-41" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">constexpr</span> <span class="kw">auto</span> property_name <span class="op">=</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>source_meta<span class="op">&gt;;</span></span>
<span id="cb62-42"><a href="#cb62-42" aria-hidden="true" tabindex="-1"></a>                    <span class="va">source_</span><span class="op">-&gt;</span>notify_property_changed<span class="op">(</span>property_name<span class="op">);</span></span>
<span id="cb62-43"><a href="#cb62-43" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb62-44"><a href="#cb62-44" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb62-45"><a href="#cb62-45" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb62-46"><a href="#cb62-46" aria-hidden="true" tabindex="-1"></a>            <span class="va">update_callbacks_</span><span class="op">.</span>push_back<span class="op">(</span>update_target<span class="op">);</span></span>
<span id="cb62-47"><a href="#cb62-47" aria-hidden="true" tabindex="-1"></a>            <span class="va">target_</span><span class="op">-&gt;</span>on_property_changed<span class="op">(</span>TargetProperty<span class="op">,</span> update_source<span class="op">);</span></span>
<span id="cb62-48"><a href="#cb62-48" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb62-49"><a href="#cb62-49" aria-hidden="true" tabindex="-1"></a>            <span class="co">// همگام‌سازی اولیه</span></span>
<span id="cb62-50"><a href="#cb62-50" aria-hidden="true" tabindex="-1"></a>            update_target<span class="op">();</span></span>
<span id="cb62-51"><a href="#cb62-51" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb62-52"><a href="#cb62-52" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb62-53"><a href="#cb62-53" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb62-54"><a href="#cb62-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-55"><a href="#cb62-55" aria-hidden="true" tabindex="-1"></a><span class="co">// متاکلاس برای تولید خودکار خصوصیت UI</span></span>
<span id="cb62-56"><a href="#cb62-56" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> ui_model<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb62-57"><a href="#cb62-57" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید سیستم اطلاع‌رسانی تغییر خصوصیت</span></span>
<span id="cb62-58"><a href="#cb62-58" aria-hidden="true" tabindex="-1"></a>    generate_property_notifications<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb62-59"><a href="#cb62-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-60"><a href="#cb62-60" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید اعتبارسنجی خصوصیت</span></span>
<span id="cb62-61"><a href="#cb62-61" aria-hidden="true" tabindex="-1"></a>    generate_property_validation<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb62-62"><a href="#cb62-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-63"><a href="#cb62-63" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید کمک‌کننده‌های اتصال UI</span></span>
<span id="cb62-64"><a href="#cb62-64" aria-hidden="true" tabindex="-1"></a>    generate_binding_methods<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb62-65"><a href="#cb62-65" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb62-66"><a href="#cb62-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-67"><a href="#cb62-67" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> generate_property_notifications<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb62-68"><a href="#cb62-68" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string notification_system <span class="op">=</span> <span class="st">R&quot;(</span></span>
<span id="cb62-69"><a href="#cb62-69" aria-hidden="true" tabindex="-1"></a><span class="vs">    private:</span></span>
<span id="cb62-70"><a href="#cb62-70" aria-hidden="true" tabindex="-1"></a><span class="vs">        std::unordered_map&lt;std::string, std::vector&lt;std::function&lt;void()&gt;&gt;&gt; </span></span>
<span id="cb62-71"><a href="#cb62-71" aria-hidden="true" tabindex="-1"></a><span class="vs">            property_observers_;</span></span>
<span id="cb62-72"><a href="#cb62-72" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span></span>
<span id="cb62-73"><a href="#cb62-73" aria-hidden="true" tabindex="-1"></a><span class="vs">    public:</span></span>
<span id="cb62-74"><a href="#cb62-74" aria-hidden="true" tabindex="-1"></a><span class="vs">        void add_property_observer(const std::string&amp; property_name,</span></span>
<span id="cb62-75"><a href="#cb62-75" aria-hidden="true" tabindex="-1"></a><span class="vs">                                 std::function&lt;void()&gt; observer) {</span></span>
<span id="cb62-76"><a href="#cb62-76" aria-hidden="true" tabindex="-1"></a><span class="vs">            property_observers_[property_name].push_back(std::move(observer));</span></span>
<span id="cb62-77"><a href="#cb62-77" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb62-78"><a href="#cb62-78" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span></span>
<span id="cb62-79"><a href="#cb62-79" aria-hidden="true" tabindex="-1"></a><span class="vs">        void notify_property_changed(const std::string&amp; property_name) {</span></span>
<span id="cb62-80"><a href="#cb62-80" aria-hidden="true" tabindex="-1"></a><span class="vs">            auto it = property_observers_.find(property_name);</span></span>
<span id="cb62-81"><a href="#cb62-81" aria-hidden="true" tabindex="-1"></a><span class="vs">            if (it != property_observers_.end()) {</span></span>
<span id="cb62-82"><a href="#cb62-82" aria-hidden="true" tabindex="-1"></a><span class="vs">                for (const auto&amp; observer : it-&gt;second) {</span></span>
<span id="cb62-83"><a href="#cb62-83" aria-hidden="true" tabindex="-1"></a><span class="vs">                    observer();</span></span>
<span id="cb62-84"><a href="#cb62-84" aria-hidden="true" tabindex="-1"></a><span class="vs">                }</span></span>
<span id="cb62-85"><a href="#cb62-85" aria-hidden="true" tabindex="-1"></a><span class="vs">            }</span></span>
<span id="cb62-86"><a href="#cb62-86" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb62-87"><a href="#cb62-87" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="st">)&quot;</span><span class="op">;</span></span>
<span id="cb62-88"><a href="#cb62-88" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-89"><a href="#cb62-89" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::compiler<span class="op">.</span>declare<span class="op">(</span>target<span class="op">,</span> notification_system<span class="op">);</span></span>
<span id="cb62-90"><a href="#cb62-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-91"><a href="#cb62-91" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید متدهای setter با اطلاع‌رسانی برای تمام اعضا</span></span>
<span id="cb62-92"><a href="#cb62-92" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> members <span class="op">=</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb62-93"><a href="#cb62-93" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::template_for<span class="op">&lt;</span>members<span class="op">&gt;([&amp;](</span><span class="kw">auto</span> member_meta<span class="op">)</span> <span class="op">{</span></span>
<span id="cb62-94"><a href="#cb62-94" aria-hidden="true" tabindex="-1"></a>        generate_notifying_setter<span class="op">(</span>target<span class="op">,</span> member_meta<span class="op">);</span></span>
<span id="cb62-95"><a href="#cb62-95" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb62-96"><a href="#cb62-96" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb62-97"><a href="#cb62-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-98"><a href="#cb62-98" aria-hidden="true" tabindex="-1"></a><span class="co">// مثال برنامه GUI با استفاده از اتصال مبتنی بر بازتاب</span></span>
<span id="cb62-99"><a href="#cb62-99" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>ui_model PersonViewModel <span class="op">{</span></span>
<span id="cb62-100"><a href="#cb62-100" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string name<span class="op">;</span></span>
<span id="cb62-101"><a href="#cb62-101" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> age<span class="op">;</span></span>
<span id="cb62-102"><a href="#cb62-102" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string email<span class="op">;</span></span>
<span id="cb62-103"><a href="#cb62-103" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> is_verified<span class="op">;</span></span>
<span id="cb62-104"><a href="#cb62-104" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-105"><a href="#cb62-105" aria-hidden="true" tabindex="-1"></a>    <span class="co">// به طور خودکار تولید می‌کند:</span></span>
<span id="cb62-106"><a href="#cb62-106" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - اطلاع‌رسانی‌های تغییر خصوصیت</span></span>
<span id="cb62-107"><a href="#cb62-107" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - متدهای اعتبارسنجی</span></span>
<span id="cb62-108"><a href="#cb62-108" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - کمک‌کننده‌های اتصال UI</span></span>
<span id="cb62-109"><a href="#cb62-109" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - متدهای getter/setter با اطلاع‌رسانی</span></span>
<span id="cb62-110"><a href="#cb62-110" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb62-111"><a href="#cb62-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-112"><a href="#cb62-112" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PersonEditDialog <span class="op">:</span> <span class="kw">public</span> gui<span class="op">::</span>Dialog <span class="op">{</span></span>
<span id="cb62-113"><a href="#cb62-113" aria-hidden="true" tabindex="-1"></a>    gui<span class="op">::</span>TextEdit <span class="va">name_edit_</span><span class="op">;</span></span>
<span id="cb62-114"><a href="#cb62-114" aria-hidden="true" tabindex="-1"></a>    gui<span class="op">::</span>SpinBox <span class="va">age_spinbox_</span><span class="op">;</span></span>
<span id="cb62-115"><a href="#cb62-115" aria-hidden="true" tabindex="-1"></a>    gui<span class="op">::</span>LineEdit <span class="va">email_edit_</span><span class="op">;</span></span>
<span id="cb62-116"><a href="#cb62-116" aria-hidden="true" tabindex="-1"></a>    gui<span class="op">::</span>CheckBox <span class="va">verified_checkbox_</span><span class="op">;</span></span>
<span id="cb62-117"><a href="#cb62-117" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-118"><a href="#cb62-118" aria-hidden="true" tabindex="-1"></a>    PersonViewModel<span class="op">*</span> <span class="va">model_</span><span class="op">;</span></span>
<span id="cb62-119"><a href="#cb62-119" aria-hidden="true" tabindex="-1"></a>    gui<span class="op">::</span>declarative<span class="op">::</span>property_binding<span class="op">&lt;</span>PersonViewModel<span class="op">,</span> PersonEditDialog<span class="op">&gt;</span> <span class="va">binding_</span><span class="op">;</span></span>
<span id="cb62-120"><a href="#cb62-120" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-121"><a href="#cb62-121" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb62-122"><a href="#cb62-122" aria-hidden="true" tabindex="-1"></a>    PersonEditDialog<span class="op">(</span>PersonViewModel<span class="op">*</span> model<span class="op">)</span> <span class="op">:</span> <span class="va">model_</span><span class="op">(</span>model<span class="op">),</span> <span class="va">binding_</span><span class="op">(</span>model<span class="op">,</span> <span class="kw">this</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb62-123"><a href="#cb62-123" aria-hidden="true" tabindex="-1"></a>        <span class="co">// اتصال خودکار خصوصیت با استفاده از بازتاب</span></span>
<span id="cb62-124"><a href="#cb62-124" aria-hidden="true" tabindex="-1"></a>        <span class="va">binding_</span><span class="op">.</span>bind<span class="op">&lt;&amp;</span>PersonViewModel<span class="op">::</span>name<span class="op">,</span> <span class="op">&amp;</span>PersonEditDialog<span class="op">::</span><span class="va">name_edit_</span><span class="op">&gt;();</span></span>
<span id="cb62-125"><a href="#cb62-125" aria-hidden="true" tabindex="-1"></a>        <span class="va">binding_</span><span class="op">.</span>bind<span class="op">&lt;&amp;</span>PersonViewModel<span class="op">::</span>age<span class="op">,</span> <span class="op">&amp;</span>PersonEditDialog<span class="op">::</span><span class="va">age_spinbox_</span><span class="op">&gt;();</span></span>
<span id="cb62-126"><a href="#cb62-126" aria-hidden="true" tabindex="-1"></a>        <span class="va">binding_</span><span class="op">.</span>bind<span class="op">&lt;&amp;</span>PersonViewModel<span class="op">::</span>email<span class="op">,</span> <span class="op">&amp;</span>PersonEditDialog<span class="op">::</span><span class="va">email_edit_</span><span class="op">&gt;();</span></span>
<span id="cb62-127"><a href="#cb62-127" aria-hidden="true" tabindex="-1"></a>        <span class="va">binding_</span><span class="op">.</span>bind<span class="op">&lt;&amp;</span>PersonViewModel<span class="op">::</span>is_verified<span class="op">,</span> <span class="op">&amp;</span>PersonEditDialog<span class="op">::</span><span class="va">verified_checkbox_</span><span class="op">&gt;();</span></span>
<span id="cb62-128"><a href="#cb62-128" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb62-129"><a href="#cb62-129" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تمام به‌روزرسانی‌های UI به طور خودکار با مدل همگام‌سازی می‌شوند</span></span>
<span id="cb62-130"><a href="#cb62-130" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb62-131"><a href="#cb62-131" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<h3 data-number="2.28.2" id="تولید-فرم-و-اعتبارسنجی"><span
class="header-section-number">2.28.2</span> 6.3.2 تولید فرم و
اعتبارسنجی</h3>
<p>چارچوب به طور خودکار فرم‌ها را بر اساس ساختار مدل تولید می‌کند:</p>
<div class="sourceCode" id="cb63"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">// تولید خودکار فرم با استفاده از متاکلاس‌ها</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> form_generator<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">,</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>                            gui<span class="op">::</span><span class="dt">layout_type</span> layout <span class="op">=</span> gui<span class="op">::</span>vertical<span class="op">)</span> <span class="op">{</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تحلیل ساختار مدل</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> members <span class="op">=</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید متد ایجاد فرم</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string form_method <span class="op">=</span> <span class="st">R&quot;(</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="vs">        std::unique_ptr&lt;gui::Form&gt; create_form() const {</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="vs">            auto form = std::make_unique&lt;gui::Form&gt;();</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="vs">            form-&gt;set_layout(</span><span class="st">)&quot;</span> <span class="op">+</span> <span class="bu">std::</span>to_string<span class="op">(</span><span class="kw">static_cast</span><span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;(</span>layout<span class="op">))</span> <span class="op">+</span> <span class="st">R&quot;(</span><span class="vs">);</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="vs">            </span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="st">)&quot;</span><span class="op">;</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::template_for<span class="op">&lt;</span>members<span class="op">&gt;([&amp;](</span><span class="kw">auto</span> member_meta<span class="op">)</span> <span class="op">{</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> <span class="dt">member_type</span> <span class="op">=</span> <span class="bu">std::</span>meta::get_type_t<span class="op">&lt;</span>member_meta<span class="op">&gt;;</span></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> member_name <span class="op">=</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>member_meta<span class="op">&gt;;</span></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="dt">member_type</span><span class="op">,</span> <span class="bu">std::</span>string<span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>            form_method <span class="op">+=</span> <span class="st">&quot;form-&gt;add_text_field(</span><span class="sc">\&quot;</span><span class="st">&quot;</span> <span class="op">+</span> <span class="bu">std::</span>string<span class="op">(</span>member_name<span class="op">)</span> <span class="op">+</span> <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">);</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="dt">member_type</span><span class="op">,</span> <span class="dt">int</span><span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>            form_method <span class="op">+=</span> <span class="st">&quot;form-&gt;add_number_field(</span><span class="sc">\&quot;</span><span class="st">&quot;</span> <span class="op">+</span> <span class="bu">std::</span>string<span class="op">(</span>member_name<span class="op">)</span> <span class="op">+</span> <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">);</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="dt">member_type</span><span class="op">,</span> <span class="dt">bool</span><span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>            form_method <span class="op">+=</span> <span class="st">&quot;form-&gt;add_checkbox(</span><span class="sc">\&quot;</span><span class="st">&quot;</span> <span class="op">+</span> <span class="bu">std::</span>string<span class="op">(</span>member_name<span class="op">)</span> <span class="op">+</span> <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">);</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="dt">member_type</span><span class="op">,</span> <span class="bu">std::</span>chrono::system_clock::time_point<span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>            form_method <span class="op">+=</span> <span class="st">&quot;form-&gt;add_date_field(</span><span class="sc">\&quot;</span><span class="st">&quot;</span> <span class="op">+</span> <span class="bu">std::</span>string<span class="op">(</span>member_name<span class="op">)</span> <span class="op">+</span> <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">);</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>    form_method <span class="op">+=</span> <span class="st">R&quot;(</span></span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a><span class="vs">            return form;</span></span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="st">)&quot;</span><span class="op">;</span></span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::compiler<span class="op">.</span>declare<span class="op">(</span>target<span class="op">,</span> form_method<span class="op">);</span></span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a><span class="co">// مثال استفاده</span></span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>ui_model <span class="er">$</span>form_generator<span class="op">(</span>gui<span class="op">::</span>grid_layout<span class="op">)</span> EmployeeRecord <span class="op">{</span></span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span>required <span class="bu">std::</span>string employee_id<span class="op">;</span></span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span>required <span class="bu">std::</span>string first_name<span class="op">;</span></span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span>required <span class="bu">std::</span>string last_name<span class="op">;</span></span>
<span id="cb63-43"><a href="#cb63-43" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span>email_validation <span class="bu">std::</span>string email<span class="op">;</span></span>
<span id="cb63-44"><a href="#cb63-44" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span>range<span class="op">(</span><span class="dv">18</span><span class="op">,</span> <span class="dv">65</span><span class="op">)</span> <span class="dt">int</span> age<span class="op">;</span></span>
<span id="cb63-45"><a href="#cb63-45" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string department<span class="op">;</span></span>
<span id="cb63-46"><a href="#cb63-46" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span>currency <span class="dt">double</span> salary<span class="op">;</span></span>
<span id="cb63-47"><a href="#cb63-47" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>chrono::system_clock::time_point hire_date<span class="op">;</span></span>
<span id="cb63-48"><a href="#cb63-48" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span>multiline <span class="bu">std::</span>string notes<span class="op">;</span></span>
<span id="cb63-49"><a href="#cb63-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-50"><a href="#cb63-50" aria-hidden="true" tabindex="-1"></a>    <span class="co">// به طور خودکار تولید می‌کند:</span></span>
<span id="cb63-51"><a href="#cb63-51" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - فرم با ویجت‌های مناسب برای هر فیلد</span></span>
<span id="cb63-52"><a href="#cb63-52" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - اعتبارسنجی بر اساس ویژگی‌ها</span></span>
<span id="cb63-53"><a href="#cb63-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - اتصال داده بین فرم و مدل</span></span>
<span id="cb63-54"><a href="#cb63-54" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - نمایش و مدیریت خطا</span></span>
<span id="cb63-55"><a href="#cb63-55" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<h2 data-number="2.29" id="تولید-چارچوب-آزمون"><span
class="header-section-number">2.29</span> 6.4 تولید چارچوب آزمون</h2>
<h3 data-number="2.29.1" id="تولید-خودکار-مورد-آزمون"><span
class="header-section-number">2.29.1</span> 6.4.1 تولید خودکار مورد
آزمون</h3>
<p>آزمایش دامنه دیگری است که بازتاب ارزش قابل توجهی با امکان تولید
خودکار آزمون ارائه می‌دهد [115]:</p>
<div class="sourceCode" id="cb64"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">// چارچوب تولید خودکار آزمون</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> testing<span class="op">::</span>reflection <span class="op">{</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> TestClass<span class="op">&gt;</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> test_suite_generator <span class="op">{</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>meta::has_metaclass<span class="op">&lt;</span>test_suite<span class="op">&gt;(</span>TestClass<span class="op">));</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> <span class="dt">void</span> generate_and_run_tests<span class="op">()</span> <span class="op">{</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>            <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>TestClass<span class="op">);</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>            <span class="kw">constexpr</span> <span class="kw">auto</span> methods <span class="op">=</span> <span class="bu">std::</span>meta::member_functions_of<span class="op">(</span>meta<span class="op">);</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>            TestClass test_instance<span class="op">;</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>            <span class="co">// فاز راه‌اندازی</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>meta::has_method<span class="op">&lt;</span>setup<span class="op">&gt;(</span>meta<span class="op">))</span> <span class="op">{</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>                test_instance<span class="op">.</span>setup<span class="op">();</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>            <span class="co">// اجرای تمام متدهای آزمون</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>meta::template_for<span class="op">&lt;</span>methods<span class="op">&gt;([&amp;](</span><span class="kw">auto</span> method_meta<span class="op">)</span> <span class="op">{</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>                <span class="kw">constexpr</span> <span class="kw">auto</span> method_name <span class="op">=</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>method_meta<span class="op">&gt;;</span></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span>method_name<span class="op">.</span>starts_with<span class="op">(</span><span class="st">&quot;test_&quot;</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>                    execute_test_method<span class="op">(</span>test_instance<span class="op">,</span> method_meta<span class="op">);</span></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>            <span class="op">});</span></span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>            <span class="co">// فاز تمیزکاری</span></span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>meta::has_method<span class="op">&lt;</span>teardown<span class="op">&gt;(</span>meta<span class="op">))</span> <span class="op">{</span></span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>                test_instance<span class="op">.</span>teardown<span class="op">();</span></span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>        <span class="kw">template</span><span class="op">&lt;</span><span class="kw">auto</span> MethodMeta<span class="op">&gt;</span></span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> <span class="dt">void</span> execute_test_method<span class="op">(</span>TestClass<span class="op">&amp;</span> instance<span class="op">,</span> MethodMeta method<span class="op">)</span> <span class="op">{</span></span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>            <span class="kw">constexpr</span> <span class="kw">auto</span> method_name <span class="op">=</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>method<span class="op">&gt;;</span></span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>            <span class="kw">constexpr</span> <span class="kw">auto</span> method_ptr <span class="op">=</span> <span class="bu">std::</span>meta::get_pointer_v<span class="op">&lt;</span>method<span class="op">&gt;;</span></span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a>                <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">&quot;Running test: &quot;</span> <span class="op">&lt;&lt;</span> method_name <span class="op">&lt;&lt;</span> <span class="st">&quot;... &quot;</span><span class="op">;</span></span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a>                <span class="co">// اجرای متد آزمون</span></span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a>                <span class="op">(</span>instance<span class="op">.*</span>method_ptr<span class="op">)();</span></span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a>                <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">&quot;PASSED</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="at">const</span> testing<span class="op">::</span>assertion_failed<span class="op">&amp;</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a>                <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">&quot;FAILED: &quot;</span> <span class="op">&lt;&lt;</span> e<span class="op">.</span>what<span class="op">()</span> <span class="op">&lt;&lt;</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb64-49"><a href="#cb64-49" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>exception<span class="op">&amp;</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb64-50"><a href="#cb64-50" aria-hidden="true" tabindex="-1"></a>                <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">&quot;ERROR: &quot;</span> <span class="op">&lt;&lt;</span> e<span class="op">.</span>what<span class="op">()</span> <span class="op">&lt;&lt;</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb64-51"><a href="#cb64-51" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb64-52"><a href="#cb64-52" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb64-53"><a href="#cb64-53" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb64-54"><a href="#cb64-54" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb64-55"><a href="#cb64-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-56"><a href="#cb64-56" aria-hidden="true" tabindex="-1"></a><span class="co">// متاکلاس برای تولید مجموعه آزمون</span></span>
<span id="cb64-57"><a href="#cb64-57" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> test_suite<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb64-58"><a href="#cb64-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید زیرساخت اجرای آزمون</span></span>
<span id="cb64-59"><a href="#cb64-59" aria-hidden="true" tabindex="-1"></a>    generate_test_runner<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb64-60"><a href="#cb64-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-61"><a href="#cb64-61" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید کمک‌کننده‌های assertion بر اساس انواع عضو</span></span>
<span id="cb64-62"><a href="#cb64-62" aria-hidden="true" tabindex="-1"></a>    generate_assertion_helpers<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb64-63"><a href="#cb64-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-64"><a href="#cb64-64" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید پشتیبانی آبجکت mock</span></span>
<span id="cb64-65"><a href="#cb64-65" aria-hidden="true" tabindex="-1"></a>    generate_mock_support<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb64-66"><a href="#cb64-66" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb64-67"><a href="#cb64-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-68"><a href="#cb64-68" aria-hidden="true" tabindex="-1"></a><span class="co">// مثال کلاس آزمون با استفاده از آزمایش مبتنی بر بازتاب</span></span>
<span id="cb64-69"><a href="#cb64-69" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>test_suite CalculatorTests <span class="op">{</span></span>
<span id="cb64-70"><a href="#cb64-70" aria-hidden="true" tabindex="-1"></a>    Calculator <span class="va">calc_</span><span class="op">;</span></span>
<span id="cb64-71"><a href="#cb64-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-72"><a href="#cb64-72" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb64-73"><a href="#cb64-73" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb64-74"><a href="#cb64-74" aria-hidden="true" tabindex="-1"></a>        <span class="va">calc_</span><span class="op">.</span>reset<span class="op">();</span></span>
<span id="cb64-75"><a href="#cb64-75" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb64-76"><a href="#cb64-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-77"><a href="#cb64-77" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> teardown<span class="op">()</span> <span class="op">{</span></span>
<span id="cb64-78"><a href="#cb64-78" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تمیزکاری در صورت نیاز</span></span>
<span id="cb64-79"><a href="#cb64-79" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb64-80"><a href="#cb64-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-81"><a href="#cb64-81" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> test_addition<span class="op">()</span> <span class="op">{</span></span>
<span id="cb64-82"><a href="#cb64-82" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> result <span class="op">=</span> <span class="va">calc_</span><span class="op">.</span>add<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span>
<span id="cb64-83"><a href="#cb64-83" aria-hidden="true" tabindex="-1"></a>        assert_equals<span class="op">(</span><span class="dv">5</span><span class="op">,</span> result<span class="op">);</span></span>
<span id="cb64-84"><a href="#cb64-84" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb64-85"><a href="#cb64-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-86"><a href="#cb64-86" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> test_division_by_zero<span class="op">()</span> <span class="op">{</span></span>
<span id="cb64-87"><a href="#cb64-87" aria-hidden="true" tabindex="-1"></a>        assert_throws<span class="op">&lt;</span><span class="bu">std::</span>domain_error<span class="op">&gt;([&amp;]()</span> <span class="op">{</span></span>
<span id="cb64-88"><a href="#cb64-88" aria-hidden="true" tabindex="-1"></a>            <span class="va">calc_</span><span class="op">.</span>divide<span class="op">(</span><span class="dv">10</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb64-89"><a href="#cb64-89" aria-hidden="true" tabindex="-1"></a>        <span class="op">});</span></span>
<span id="cb64-90"><a href="#cb64-90" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb64-91"><a href="#cb64-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-92"><a href="#cb64-92" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> test_complex_calculation<span class="op">()</span> <span class="op">{</span></span>
<span id="cb64-93"><a href="#cb64-93" aria-hidden="true" tabindex="-1"></a>        <span class="va">calc_</span><span class="op">.</span>add<span class="op">(</span><span class="dv">10</span><span class="op">,</span> <span class="dv">5</span><span class="op">);</span></span>
<span id="cb64-94"><a href="#cb64-94" aria-hidden="true" tabindex="-1"></a>        <span class="va">calc_</span><span class="op">.</span>multiply<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb64-95"><a href="#cb64-95" aria-hidden="true" tabindex="-1"></a>        <span class="va">calc_</span><span class="op">.</span>subtract<span class="op">(</span><span class="dv">5</span><span class="op">);</span></span>
<span id="cb64-96"><a href="#cb64-96" aria-hidden="true" tabindex="-1"></a>        assert_equals<span class="op">(</span><span class="dv">25</span><span class="op">,</span> <span class="va">calc_</span><span class="op">.</span>get_result<span class="op">());</span></span>
<span id="cb64-97"><a href="#cb64-97" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb64-98"><a href="#cb64-98" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-99"><a href="#cb64-99" aria-hidden="true" tabindex="-1"></a>    <span class="co">// به طور خودکار تولید می‌کند:</span></span>
<span id="cb64-100"><a href="#cb64-100" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - کشف و اجرای آزمون</span></span>
<span id="cb64-101"><a href="#cb64-101" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - مدیریت setup/teardown</span></span>
<span id="cb64-102"><a href="#cb64-102" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - گزارش خطا و آمار</span></span>
<span id="cb64-103"><a href="#cb64-103" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - یکپارچگی با اجراکننده‌های آزمون</span></span>
<span id="cb64-104"><a href="#cb64-104" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<h3 data-number="2.29.2" id="یکپارچگی-آزمایش-مبتنی-بر-خصوصیت"><span
class="header-section-number">2.29.2</span> 6.4.2 یکپارچگی آزمایش مبتنی
بر خصوصیت</h3>
<p>چارچوب از آزمایش مبتنی بر خصوصیت با تولید خودکار مورد آزمون پشتیبانی
می‌کند:</p>
<div class="sourceCode" id="cb65"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">// آزمایش مبتنی بر خصوصیت با استفاده از بازتاب</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> property_test_generator <span class="op">{</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">auto</span> Property<span class="op">&gt;</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="dt">void</span> test_property<span class="op">(</span><span class="dt">size_t</span> num_iterations <span class="op">=</span> <span class="dv">1000</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> prop_meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>Property<span class="op">);</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> param_types <span class="op">=</span> <span class="bu">std::</span>meta::get_parameter_types_t<span class="op">&lt;</span>prop_meta<span class="op">&gt;;</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">size_t</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> num_iterations<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> test_inputs <span class="op">=</span> generate_random_inputs<span class="op">&lt;</span>param_types<span class="op">&gt;();</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>                <span class="dt">bool</span> result <span class="op">=</span> <span class="bu">std::</span>apply<span class="op">(</span>Property<span class="op">,</span> test_inputs<span class="op">);</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(!</span>result<span class="op">)</span> <span class="op">{</span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>                    report_property_violation<span class="op">(</span>Property<span class="op">,</span> test_inputs<span class="op">);</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>exception<span class="op">&amp;</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>                report_property_exception<span class="op">(</span>Property<span class="op">,</span> test_inputs<span class="op">,</span> e<span class="op">);</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span><span class="op">...</span> Types<span class="op">&gt;</span></span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="bu">std::</span>tuple<span class="op">&lt;</span>Types<span class="op">...&gt;</span> generate_random_inputs<span class="op">()</span> <span class="op">{</span></span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">std::</span>make_tuple<span class="op">(</span>generate_random_value<span class="op">&lt;</span>Types<span class="op">&gt;()...);</span></span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> Type<span class="op">&gt;</span></span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> Type generate_random_value<span class="op">()</span> <span class="op">{</span></span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>is_integral_v<span class="op">&lt;</span>Type<span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> random_distribution<span class="op">&lt;</span>Type<span class="op">&gt;()();</span></span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>is_floating_point_v<span class="op">&lt;</span>Type<span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> random_distribution<span class="op">&lt;</span>Type<span class="op">&gt;()();</span></span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span>Type<span class="op">,</span> <span class="bu">std::</span>string<span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> generate_random_string<span class="op">();</span></span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تولیدکننده‌های خاص نوع بیشتر اضافه کنید</span></span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a><span class="co">// مثال آزمون‌های مبتنی بر خصوصیت</span></span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MathProperties <span class="op">{</span></span>
<span id="cb65-45"><a href="#cb65-45" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb65-46"><a href="#cb65-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="dt">bool</span> addition_commutative<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb65-47"><a href="#cb65-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">(</span>a <span class="op">+</span> b<span class="op">)</span> <span class="op">==</span> <span class="op">(</span>b <span class="op">+</span> a<span class="op">);</span></span>
<span id="cb65-48"><a href="#cb65-48" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb65-49"><a href="#cb65-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-50"><a href="#cb65-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="dt">bool</span> multiplication_associative<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">,</span> <span class="dt">int</span> c<span class="op">)</span> <span class="op">{</span></span>
<span id="cb65-51"><a href="#cb65-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">(</span>a <span class="op">*</span> <span class="op">(</span>b <span class="op">*</span> c<span class="op">))</span> <span class="op">==</span> <span class="op">((</span>a <span class="op">*</span> b<span class="op">)</span> <span class="op">*</span> c<span class="op">);</span></span>
<span id="cb65-52"><a href="#cb65-52" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb65-53"><a href="#cb65-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-54"><a href="#cb65-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="dt">bool</span> sort_idempotent<span class="op">(</span><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> vec<span class="op">)</span> <span class="op">{</span></span>
<span id="cb65-55"><a href="#cb65-55" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> sorted1 <span class="op">=</span> vec<span class="op">;</span></span>
<span id="cb65-56"><a href="#cb65-56" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>sort<span class="op">(</span>sorted1<span class="op">.</span>begin<span class="op">(),</span> sorted1<span class="op">.</span>end<span class="op">());</span></span>
<span id="cb65-57"><a href="#cb65-57" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb65-58"><a href="#cb65-58" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> sorted2 <span class="op">=</span> sorted1<span class="op">;</span></span>
<span id="cb65-59"><a href="#cb65-59" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>sort<span class="op">(</span>sorted2<span class="op">.</span>begin<span class="op">(),</span> sorted2<span class="op">.</span>end<span class="op">());</span></span>
<span id="cb65-60"><a href="#cb65-60" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb65-61"><a href="#cb65-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sorted1 <span class="op">==</span> sorted2<span class="op">;</span></span>
<span id="cb65-62"><a href="#cb65-62" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb65-63"><a href="#cb65-63" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb65-64"><a href="#cb65-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-65"><a href="#cb65-65" aria-hidden="true" tabindex="-1"></a><span class="co">// آزمایش خودکار خصوصیت</span></span>
<span id="cb65-66"><a href="#cb65-66" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> run_property_tests<span class="op">()</span> <span class="op">{</span></span>
<span id="cb65-67"><a href="#cb65-67" aria-hidden="true" tabindex="-1"></a>    property_test_generator<span class="op">&lt;</span>MathProperties<span class="op">&gt;::</span>test_property<span class="op">&lt;</span></span>
<span id="cb65-68"><a href="#cb65-68" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span>MathProperties<span class="op">::</span>addition_commutative<span class="op">&gt;(</span><span class="dv">10000</span><span class="op">);</span></span>
<span id="cb65-69"><a href="#cb65-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-70"><a href="#cb65-70" aria-hidden="true" tabindex="-1"></a>    property_test_generator<span class="op">&lt;</span>MathProperties<span class="op">&gt;::</span>test_property<span class="op">&lt;</span></span>
<span id="cb65-71"><a href="#cb65-71" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span>MathProperties<span class="op">::</span>multiplication_associative<span class="op">&gt;(</span><span class="dv">10000</span><span class="op">);</span></span>
<span id="cb65-72"><a href="#cb65-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-73"><a href="#cb65-73" aria-hidden="true" tabindex="-1"></a>    property_test_generator<span class="op">&lt;</span>MathProperties<span class="op">&gt;::</span>test_property<span class="op">&lt;</span></span>
<span id="cb65-74"><a href="#cb65-74" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span>MathProperties<span class="op">::</span>sort_idempotent<span class="op">&gt;(</span><span class="dv">1000</span><span class="op">);</span></span>
<span id="cb65-75"><a href="#cb65-75" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 data-number="2.30" id="پیادهسازی-الگوهای-طراحی"><span
class="header-section-number">2.30</span> 6.5 پیاده‌سازی الگوهای
طراحی</h2>
<h3 data-number="2.30.1" id="الگوی-observer-خودکار"><span
class="header-section-number">2.30.1</span> 6.5.1 الگوی Observer
خودکار</h3>
<p>بازتاب پیاده‌سازی خودکار الگوهای طراحی پیچیده را امکان‌پذیر می‌سازد
[116]:</p>
<div class="sourceCode" id="cb66"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co">// پیاده‌سازی متاکلاس الگوی observer</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> observable<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید زیرساخت observer</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string observer_infrastructure <span class="op">=</span> <span class="st">R&quot;(</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="vs">    private:</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="vs">        mutable std::unordered_map&lt;std::string, </span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="vs">            std::vector&lt;std::function&lt;void(const std::any&amp;)&gt;&gt;&gt; observers_;</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="vs">    public:</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="vs">        template&lt;typename T&gt;</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="vs">        void add_observer(const std::string&amp; property_name, </span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="vs">                         std::function&lt;void(const T&amp;)&gt; callback) {</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a><span class="vs">            observers_[property_name].emplace_back([callback](const std::any&amp; value) {</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a><span class="vs">                callback(std::any_cast&lt;const T&amp;&gt;(value));</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a><span class="vs">            });</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a><span class="vs">        void remove_all_observers(const std::string&amp; property_name = &quot;&quot;) {</span></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a><span class="vs">            if (property_name.empty()) {</span></span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a><span class="vs">                observers_.clear();</span></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a><span class="vs">            } else {</span></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a><span class="vs">                observers_.erase(property_name);</span></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a><span class="vs">            }</span></span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a><span class="vs">    protected:</span></span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a><span class="vs">        template&lt;typename T&gt;</span></span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a><span class="vs">        void notify_observers(const std::string&amp; property_name, const T&amp; value) {</span></span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a><span class="vs">            auto it = observers_.find(property_name);</span></span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a><span class="vs">            if (it != observers_.end()) {</span></span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a><span class="vs">                for (const auto&amp; observer : it-&gt;second) {</span></span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a><span class="vs">                    observer(std::make_any&lt;T&gt;(value));</span></span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a><span class="vs">                }</span></span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a><span class="vs">            }</span></span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="st">)&quot;</span><span class="op">;</span></span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::compiler<span class="op">.</span>declare<span class="op">(</span>target<span class="op">,</span> observer_infrastructure<span class="op">);</span></span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید setter های اطلاع‌رسان برای تمام اعضا</span></span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> members <span class="op">=</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb66-42"><a href="#cb66-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::template_for<span class="op">&lt;</span>members<span class="op">&gt;([&amp;](</span><span class="kw">auto</span> member_meta<span class="op">)</span> <span class="op">{</span></span>
<span id="cb66-43"><a href="#cb66-43" aria-hidden="true" tabindex="-1"></a>        generate_notifying_setter<span class="op">(</span>target<span class="op">,</span> member_meta<span class="op">);</span></span>
<span id="cb66-44"><a href="#cb66-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb66-45"><a href="#cb66-45" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb66-46"><a href="#cb66-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-47"><a href="#cb66-47" aria-hidden="true" tabindex="-1"></a><span class="co">// مثال استفاده</span></span>
<span id="cb66-48"><a href="#cb66-48" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>observable <span class="er">$</span>serializable StockPrice <span class="op">{</span></span>
<span id="cb66-49"><a href="#cb66-49" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string symbol<span class="op">;</span></span>
<span id="cb66-50"><a href="#cb66-50" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> price<span class="op">;</span></span>
<span id="cb66-51"><a href="#cb66-51" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> volume<span class="op">;</span></span>
<span id="cb66-52"><a href="#cb66-52" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>chrono::system_clock::time_point timestamp<span class="op">;</span></span>
<span id="cb66-53"><a href="#cb66-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-54"><a href="#cb66-54" aria-hidden="true" tabindex="-1"></a>    <span class="co">// به طور خودکار تولید می‌کند:</span></span>
<span id="cb66-55"><a href="#cb66-55" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - متدهای ثبت/حذف observer</span></span>
<span id="cb66-56"><a href="#cb66-56" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - اطلاع‌رسانی‌های خودکار در تغییرات خصوصیت</span></span>
<span id="cb66-57"><a href="#cb66-57" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - callback های observer ایمن نوع</span></span>
<span id="cb66-58"><a href="#cb66-58" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb66-59"><a href="#cb66-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-60"><a href="#cb66-60" aria-hidden="true" tabindex="-1"></a><span class="co">// استفاده observer</span></span>
<span id="cb66-61"><a href="#cb66-61" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> demonstrate_observer_pattern<span class="op">()</span> <span class="op">{</span></span>
<span id="cb66-62"><a href="#cb66-62" aria-hidden="true" tabindex="-1"></a>    StockPrice stock<span class="op">;</span></span>
<span id="cb66-63"><a href="#cb66-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-64"><a href="#cb66-64" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ثبت observer ها برای خصوصیت‌های خاص</span></span>
<span id="cb66-65"><a href="#cb66-65" aria-hidden="true" tabindex="-1"></a>    stock<span class="op">.</span>add_observer<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;(</span><span class="st">&quot;price&quot;</span><span class="op">,</span> <span class="op">[](</span><span class="at">const</span> <span class="dt">double</span><span class="op">&amp;</span> new_price<span class="op">)</span> <span class="op">{</span></span>
<span id="cb66-66"><a href="#cb66-66" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">&quot;Price changed to: $&quot;</span> <span class="op">&lt;&lt;</span> new_price <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span>
<span id="cb66-67"><a href="#cb66-67" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb66-68"><a href="#cb66-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-69"><a href="#cb66-69" aria-hidden="true" tabindex="-1"></a>    stock<span class="op">.</span>add_observer<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;(</span><span class="st">&quot;volume&quot;</span><span class="op">,</span> <span class="op">[](</span><span class="at">const</span> <span class="dt">double</span><span class="op">&amp;</span> new_volume<span class="op">)</span> <span class="op">{</span></span>
<span id="cb66-70"><a href="#cb66-70" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">&quot;Volume changed to: &quot;</span> <span class="op">&lt;&lt;</span> new_volume <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span>
<span id="cb66-71"><a href="#cb66-71" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb66-72"><a href="#cb66-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-73"><a href="#cb66-73" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تغییرات خصوصیت به طور خودکار اطلاع‌رسانی‌ها را فعال می‌کنند</span></span>
<span id="cb66-74"><a href="#cb66-74" aria-hidden="true" tabindex="-1"></a>    stock<span class="op">.</span>set_price<span class="op">(</span><span class="fl">150.75</span><span class="op">);</span>  <span class="co">// observer قیمت را فعال می‌کند</span></span>
<span id="cb66-75"><a href="#cb66-75" aria-hidden="true" tabindex="-1"></a>    stock<span class="op">.</span>set_volume<span class="op">(</span><span class="dv">1000000</span><span class="op">);</span>  <span class="co">// observer حجم را فعال می‌کند</span></span>
<span id="cb66-76"><a href="#cb66-76" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="2.30.2" id="اتوماسیون-الگوی-visitor"><span
class="header-section-number">2.30.2</span> 6.5.2 اتوماسیون الگوی
Visitor</h3>
<p>الگوهای سلسله‌مراتبی پیچیده می‌توانند با استفاده از بازتاب خودکار
شوند:</p>
<div class="sourceCode" id="cb67"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co">// پیاده‌سازی خودکار الگوی visitor</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> visitable<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::compiler<span class="op">.</span>require<span class="op">(</span><span class="bu">std::</span>meta::is_polymorphic_v<span class="op">&lt;</span>target<span class="op">&gt;,</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;visitable requires polymorphic type&quot;</span><span class="op">);</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید رابط visitor</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>    generate_visitor_interface<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید متد accept</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string accept_method <span class="op">=</span> <span class="st">R&quot;(</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a><span class="vs">        template&lt;typename Visitor&gt;</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a><span class="vs">        auto accept(Visitor&amp;&amp; visitor) const {</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a><span class="vs">            return visitor.visit(*this);</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a><span class="vs">        template&lt;typename Visitor&gt;</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a><span class="vs">        auto accept(Visitor&amp;&amp; visitor) {</span></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a><span class="vs">            return visitor.visit(*this);</span></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="st">)&quot;</span><span class="op">;</span></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::compiler<span class="op">.</span>declare<span class="op">(</span>target<span class="op">,</span> accept_method<span class="op">);</span></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a><span class="co">// تولید خودکار رابط visitor</span></span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> generate_visitor_interface<span class="op">(</span><span class="bu">std::</span>meta::info <span class="dt">base_type</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> derived_types <span class="op">=</span> <span class="bu">std::</span>meta::get_derived_types_t<span class="op">&lt;</span><span class="dt">base_type</span><span class="op">&gt;;</span></span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string visitor_interface <span class="op">=</span> <span class="st">&quot;template&lt;typename ReturnType = void&gt;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a>    visitor_interface <span class="op">+=</span> <span class="st">&quot;class &quot;</span> <span class="op">+</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span><span class="dt">base_type</span><span class="op">&gt;</span> <span class="op">+</span> <span class="st">&quot;Visitor {</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a>    visitor_interface <span class="op">+=</span> <span class="st">&quot;public:</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-33"><a href="#cb67-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید متدهای visit برای هر نوع مشتق شده</span></span>
<span id="cb67-34"><a href="#cb67-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::template_for<span class="op">&lt;</span>derived_types<span class="op">&gt;([&amp;](</span><span class="kw">auto</span> derived_meta<span class="op">)</span> <span class="op">{</span></span>
<span id="cb67-35"><a href="#cb67-35" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> type_name <span class="op">=</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>derived_meta<span class="op">&gt;;</span></span>
<span id="cb67-36"><a href="#cb67-36" aria-hidden="true" tabindex="-1"></a>        visitor_interface <span class="op">+=</span> <span class="st">&quot;    virtual ReturnType visit(const &quot;</span> <span class="op">+</span> type_name <span class="op">+</span> <span class="st">&quot;&amp;) = 0;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb67-37"><a href="#cb67-37" aria-hidden="true" tabindex="-1"></a>        visitor_interface <span class="op">+=</span> <span class="st">&quot;    virtual ReturnType visit(&quot;</span> <span class="op">+</span> type_name <span class="op">+</span> <span class="st">&quot;&amp;) = 0;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb67-38"><a href="#cb67-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb67-39"><a href="#cb67-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-40"><a href="#cb67-40" aria-hidden="true" tabindex="-1"></a>    visitor_interface <span class="op">+=</span> <span class="st">&quot;};</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb67-41"><a href="#cb67-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-42"><a href="#cb67-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تزریق رابط visitor به فضای نام سراسری</span></span>
<span id="cb67-43"><a href="#cb67-43" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::compiler<span class="op">.</span>declare_global<span class="op">(</span>visitor_interface<span class="op">);</span></span>
<span id="cb67-44"><a href="#cb67-44" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb67-45"><a href="#cb67-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-46"><a href="#cb67-46" aria-hidden="true" tabindex="-1"></a><span class="co">// مثال استفاده</span></span>
<span id="cb67-47"><a href="#cb67-47" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>visitable Shape <span class="op">{</span></span>
<span id="cb67-48"><a href="#cb67-48" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb67-49"><a href="#cb67-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">virtual</span> <span class="op">~</span>Shape<span class="op">()</span> <span class="op">=</span> <span class="cf">default</span><span class="op">;</span></span>
<span id="cb67-50"><a href="#cb67-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">virtual</span> <span class="dt">double</span> area<span class="op">()</span> <span class="at">const</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb67-51"><a href="#cb67-51" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb67-52"><a href="#cb67-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-53"><a href="#cb67-53" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Circle <span class="op">:</span> <span class="kw">public</span> Shape <span class="op">{</span></span>
<span id="cb67-54"><a href="#cb67-54" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> <span class="va">radius_</span><span class="op">;</span></span>
<span id="cb67-55"><a href="#cb67-55" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb67-56"><a href="#cb67-56" aria-hidden="true" tabindex="-1"></a>    Circle<span class="op">(</span><span class="dt">double</span> r<span class="op">)</span> <span class="op">:</span> <span class="va">radius_</span><span class="op">(</span>r<span class="op">)</span> <span class="op">{}</span></span>
<span id="cb67-57"><a href="#cb67-57" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> area<span class="op">()</span> <span class="at">const</span> <span class="kw">override</span> <span class="op">{</span> <span class="cf">return</span> M_PI <span class="op">*</span> <span class="va">radius_</span> <span class="op">*</span> <span class="va">radius_</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb67-58"><a href="#cb67-58" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> get_radius<span class="op">()</span> <span class="at">const</span> <span class="op">{</span> <span class="cf">return</span> <span class="va">radius_</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb67-59"><a href="#cb67-59" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb67-60"><a href="#cb67-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-61"><a href="#cb67-61" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Rectangle <span class="op">:</span> <span class="kw">public</span> Shape <span class="op">{</span></span>
<span id="cb67-62"><a href="#cb67-62" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> <span class="va">width_</span><span class="op">,</span> <span class="va">height_</span><span class="op">;</span></span>
<span id="cb67-63"><a href="#cb67-63" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb67-64"><a href="#cb67-64" aria-hidden="true" tabindex="-1"></a>    Rectangle<span class="op">(</span><span class="dt">double</span> w<span class="op">,</span> <span class="dt">double</span> h<span class="op">)</span> <span class="op">:</span> <span class="va">width_</span><span class="op">(</span>w<span class="op">),</span> <span class="va">height_</span><span class="op">(</span>h<span class="op">)</span> <span class="op">{}</span></span>
<span id="cb67-65"><a href="#cb67-65" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> area<span class="op">()</span> <span class="at">const</span> <span class="kw">override</span> <span class="op">{</span> <span class="cf">return</span> <span class="va">width_</span> <span class="op">*</span> <span class="va">height_</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb67-66"><a href="#cb67-66" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> get_width<span class="op">()</span> <span class="at">const</span> <span class="op">{</span> <span class="cf">return</span> <span class="va">width_</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb67-67"><a href="#cb67-67" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> get_height<span class="op">()</span> <span class="at">const</span> <span class="op">{</span> <span class="cf">return</span> <span class="va">height_</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb67-68"><a href="#cb67-68" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb67-69"><a href="#cb67-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-70"><a href="#cb67-70" aria-hidden="true" tabindex="-1"></a><span class="co">// رابط visitor تولید شده خودکار:</span></span>
<span id="cb67-71"><a href="#cb67-71" aria-hidden="true" tabindex="-1"></a><span class="co">// template&lt;typename ReturnType = void&gt;</span></span>
<span id="cb67-72"><a href="#cb67-72" aria-hidden="true" tabindex="-1"></a><span class="co">// class ShapeVisitor {</span></span>
<span id="cb67-73"><a href="#cb67-73" aria-hidden="true" tabindex="-1"></a><span class="co">// public:</span></span>
<span id="cb67-74"><a href="#cb67-74" aria-hidden="true" tabindex="-1"></a><span class="co">//     virtual ReturnType visit(const Circle&amp;) = 0;</span></span>
<span id="cb67-75"><a href="#cb67-75" aria-hidden="true" tabindex="-1"></a><span class="co">//     virtual ReturnType visit(Circle&amp;) = 0;</span></span>
<span id="cb67-76"><a href="#cb67-76" aria-hidden="true" tabindex="-1"></a><span class="co">//     virtual ReturnType visit(const Rectangle&amp;) = 0;</span></span>
<span id="cb67-77"><a href="#cb67-77" aria-hidden="true" tabindex="-1"></a><span class="co">//     virtual ReturnType visit(Rectangle&amp;) = 0;</span></span>
<span id="cb67-78"><a href="#cb67-78" aria-hidden="true" tabindex="-1"></a><span class="co">// };</span></span>
<span id="cb67-79"><a href="#cb67-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-80"><a href="#cb67-80" aria-hidden="true" tabindex="-1"></a><span class="co">// پیاده‌سازی visitor مشخص</span></span>
<span id="cb67-81"><a href="#cb67-81" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AreaCalculatorVisitor <span class="op">:</span> <span class="kw">public</span> ShapeVisitor<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb67-82"><a href="#cb67-82" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb67-83"><a href="#cb67-83" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> visit<span class="op">(</span><span class="at">const</span> Circle<span class="op">&amp;</span> circle<span class="op">)</span> <span class="kw">override</span> <span class="op">{</span></span>
<span id="cb67-84"><a href="#cb67-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> circle<span class="op">.</span>area<span class="op">();</span></span>
<span id="cb67-85"><a href="#cb67-85" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb67-86"><a href="#cb67-86" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-87"><a href="#cb67-87" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> visit<span class="op">(</span>Circle<span class="op">&amp;</span> circle<span class="op">)</span> <span class="kw">override</span> <span class="op">{</span></span>
<span id="cb67-88"><a href="#cb67-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> visit<span class="op">(</span><span class="kw">const_cast</span><span class="op">&lt;</span><span class="at">const</span> Circle<span class="op">&amp;&gt;(</span>circle<span class="op">));</span></span>
<span id="cb67-89"><a href="#cb67-89" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb67-90"><a href="#cb67-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-91"><a href="#cb67-91" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> visit<span class="op">(</span><span class="at">const</span> Rectangle<span class="op">&amp;</span> rect<span class="op">)</span> <span class="kw">override</span> <span class="op">{</span></span>
<span id="cb67-92"><a href="#cb67-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> rect<span class="op">.</span>area<span class="op">();</span></span>
<span id="cb67-93"><a href="#cb67-93" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb67-94"><a href="#cb67-94" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-95"><a href="#cb67-95" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> visit<span class="op">(</span>Rectangle<span class="op">&amp;</span> rect<span class="op">)</span> <span class="kw">override</span> <span class="op">{</span></span>
<span id="cb67-96"><a href="#cb67-96" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> visit<span class="op">(</span><span class="kw">const_cast</span><span class="op">&lt;</span><span class="at">const</span> Rectangle<span class="op">&amp;&gt;(</span>rect<span class="op">));</span></span>
<span id="cb67-97"><a href="#cb67-97" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb67-98"><a href="#cb67-98" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>این مطالعات موردی پتانسیل تحویل‌دهنده بازتاب و متاکلاس‌های C++23 را در
دامنه‌های کاربردی متنوع نشان می‌دهند. بخش بعدی فرصت‌های یکپارچگی با سایر
ویژگی‌های مدرن C++ را بررسی می‌کند.</p>
<hr />
<p><em>[مراجع 110-116 مطابق با مطالعات خاص دامنه در چارچوب‌های سریال‌سازی،
پیاده‌سازی‌های ORM، برنامه‌نویسی GUI، روش‌شناسی‌های آزمایش و اتوماسیون الگوی
طراحی فهرست شده در کتابشناسی جامع ما]</em> # 7. یکپارچگی با ویژگی‌های
مدرن C++</p>
<h2 data-number="2.31" id="تعامل-concept-ها-و-بازتاب"><span
class="header-section-number">2.31</span> 7.1 تعامل Concept ها و
بازتاب</h2>
<h3 data-number="2.31.1" id="بازتاب-محدود-شده-توسط-concept"><span
class="header-section-number">2.31.1</span> 7.1.1 بازتاب محدود شده توسط
Concept</h3>
<p>یکپارچگی concept های C++20 با بازتاب C++23 هم‌افزایی‌های قدرتمندی برای
برنامه‌نویسی عمومی ایمن نوع ایجاد می‌کند [117]. Concept ها محدودیت‌های زمان
کامپایل ارائه می‌دهند در حالی که بازتاب درونگری را امکان‌پذیر می‌سازد و با
هم پایه محکمی برای متابرنامه‌نویسی پیشرفته تشکیل می‌دهند:</p>
<div class="sourceCode" id="cb68"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;concepts&gt;</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;experimental/reflect&gt;</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Concept های آگاه به بازتاب</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="kw">concept</span> Reflectable <span class="op">=</span> <span class="kw">requires</span> <span class="op">{</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">typename</span> <span class="bu">std::</span>meta::data_members_t<span class="op">&lt;</span><span class="bu">std::</span>meta::reflexpr<span class="op">(</span>T<span class="op">)&gt;;</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="kw">concept</span> SerializableType <span class="op">=</span> Reflectable<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="op">&amp;&amp;</span> <span class="kw">requires</span> <span class="op">{</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// باید اعضای قابل بازتاب داشته باشد که خودشان سریال‌سازی پذیر باشند</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">[]&lt;</span><span class="kw">auto</span><span class="op">...</span> Members<span class="op">&gt;(</span><span class="bu">std::</span>index_sequence<span class="op">&lt;</span>Members<span class="op">...&gt;)</span> <span class="op">{</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> members <span class="op">=</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>meta<span class="op">);</span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">(</span>is_serializable_member<span class="op">&lt;</span><span class="bu">std::</span>meta::get_element_v<span class="op">&lt;</span>Members<span class="op">,</span> <span class="kw">decltype</span><span class="op">(</span>members<span class="op">)&gt;&gt;()</span> <span class="op">&amp;&amp;</span> <span class="op">...);</span></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}(</span><span class="bu">std::</span>make_index_sequence<span class="op">&lt;</span><span class="bu">std::</span>meta::get_size_v<span class="op">&lt;</span><span class="bu">std::</span>meta::data_members_of<span class="op">(</span><span class="bu">std::</span>meta::reflexpr<span class="op">(</span>T<span class="op">))&gt;&gt;{});</span></span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">auto</span> Member<span class="op">&gt;</span></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a><span class="kw">consteval</span> <span class="dt">bool</span> is_serializable_member<span class="op">()</span> <span class="op">{</span></span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> <span class="dt">member_type</span> <span class="op">=</span> <span class="bu">std::</span>meta::get_type_t<span class="op">&lt;</span>Member<span class="op">&gt;;</span></span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>is_arithmetic_v<span class="op">&lt;</span><span class="dt">member_type</span><span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="dt">member_type</span><span class="op">,</span> <span class="bu">std::</span>string<span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span>Reflectable<span class="op">&lt;</span><span class="dt">member_type</span><span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> SerializableType<span class="op">&lt;</span><span class="dt">member_type</span><span class="op">&gt;;</span></span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a><span class="co">// عملیات بازتاب محدود شده توسط concept</span></span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span>SerializableType T<span class="op">&gt;</span></span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true" tabindex="-1"></a><span class="bu">std::</span>string reflect_serialize<span class="op">(</span><span class="at">const</span> T<span class="op">&amp;</span> obj<span class="op">)</span> <span class="op">{</span></span>
<span id="cb68-40"><a href="#cb68-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb68-41"><a href="#cb68-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> members <span class="op">=</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>meta<span class="op">);</span></span>
<span id="cb68-42"><a href="#cb68-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb68-43"><a href="#cb68-43" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>ostringstream json<span class="op">;</span></span>
<span id="cb68-44"><a href="#cb68-44" aria-hidden="true" tabindex="-1"></a>    json <span class="op">&lt;&lt;</span> <span class="st">&quot;{&quot;</span><span class="op">;</span></span>
<span id="cb68-45"><a href="#cb68-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb68-46"><a href="#cb68-46" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> first <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb68-47"><a href="#cb68-47" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::template_for<span class="op">&lt;</span>members<span class="op">&gt;([&amp;](</span><span class="kw">auto</span> member_meta<span class="op">)</span> <span class="op">{</span></span>
<span id="cb68-48"><a href="#cb68-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>first<span class="op">)</span> json <span class="op">&lt;&lt;</span> <span class="st">&quot;,&quot;</span><span class="op">;</span></span>
<span id="cb68-49"><a href="#cb68-49" aria-hidden="true" tabindex="-1"></a>        first <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb68-50"><a href="#cb68-50" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb68-51"><a href="#cb68-51" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> name <span class="op">=</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>member_meta<span class="op">&gt;;</span></span>
<span id="cb68-52"><a href="#cb68-52" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> member_ptr <span class="op">=</span> <span class="bu">std::</span>meta::get_pointer_v<span class="op">&lt;</span>member_meta<span class="op">&gt;;</span></span>
<span id="cb68-53"><a href="#cb68-53" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb68-54"><a href="#cb68-54" aria-hidden="true" tabindex="-1"></a>        json <span class="op">&lt;&lt;</span> <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">&quot;</span> <span class="op">&lt;&lt;</span> name <span class="op">&lt;&lt;</span> <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">:&quot;</span><span class="op">;</span></span>
<span id="cb68-55"><a href="#cb68-55" aria-hidden="true" tabindex="-1"></a>        serialize_member_value<span class="op">(</span>json<span class="op">,</span> obj<span class="op">.*</span>member_ptr<span class="op">);</span></span>
<span id="cb68-56"><a href="#cb68-56" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb68-57"><a href="#cb68-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb68-58"><a href="#cb68-58" aria-hidden="true" tabindex="-1"></a>    json <span class="op">&lt;&lt;</span> <span class="st">&quot;}&quot;</span><span class="op">;</span></span>
<span id="cb68-59"><a href="#cb68-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> json<span class="op">.</span>str<span class="op">();</span></span>
<span id="cb68-60"><a href="#cb68-60" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb68-61"><a href="#cb68-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-62"><a href="#cb68-62" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb68-63"><a href="#cb68-63" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> serialize_member_value<span class="op">(</span><span class="bu">std::</span>ostringstream<span class="op">&amp;</span> json<span class="op">,</span> <span class="at">const</span> T<span class="op">&amp;</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb68-64"><a href="#cb68-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>is_arithmetic_v<span class="op">&lt;</span>T<span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb68-65"><a href="#cb68-65" aria-hidden="true" tabindex="-1"></a>        json <span class="op">&lt;&lt;</span> value<span class="op">;</span></span>
<span id="cb68-66"><a href="#cb68-66" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span>T<span class="op">,</span> <span class="bu">std::</span>string<span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb68-67"><a href="#cb68-67" aria-hidden="true" tabindex="-1"></a>        json <span class="op">&lt;&lt;</span> <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">&quot;</span> <span class="op">&lt;&lt;</span> value <span class="op">&lt;&lt;</span> <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb68-68"><a href="#cb68-68" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span>SerializableType<span class="op">&lt;</span>T<span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb68-69"><a href="#cb68-69" aria-hidden="true" tabindex="-1"></a>        json <span class="op">&lt;&lt;</span> reflect_serialize<span class="op">(</span>value<span class="op">);</span></span>
<span id="cb68-70"><a href="#cb68-70" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb68-71"><a href="#cb68-71" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="2.31.2" id="تعاریف-concept-تقویت-شده-با-بازتاب"><span
class="header-section-number">2.31.2</span> 7.1.2 تعاریف Concept تقویت
شده با بازتاب</h3>
<p>بازتاب تعاریف concept پیچیده‌تری را امکان‌پذیر می‌سازد که ساختار نوع را
به جای صرف رابط‌ها بررسی می‌کنند [118]:</p>
<div class="sourceCode" id="cb69"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Concept های ساختاری با استفاده از بازتاب</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="kw">concept</span> HasIdField <span class="op">=</span> Reflectable<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="op">&amp;&amp;</span> <span class="kw">requires</span> <span class="op">{</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// نوع باید عضوی با نام &quot;id&quot; از نوع انتگرال داشته باشد</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">[]()</span> <span class="op">{</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> members <span class="op">=</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>meta<span class="op">);</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">[]&lt;</span><span class="kw">auto</span><span class="op">...</span> Ms<span class="op">&gt;(</span><span class="bu">std::</span>index_sequence<span class="op">&lt;</span>Ms<span class="op">...&gt;)</span> <span class="op">{</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="op">((</span><span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span><span class="bu">std::</span>meta::get_element_v<span class="op">&lt;</span>Ms<span class="op">,</span> <span class="kw">decltype</span><span class="op">(</span>members<span class="op">)&gt;&gt;</span> <span class="op">==</span> <span class="st">&quot;id&quot;</span> <span class="op">&amp;&amp;</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">std::</span>is_integral_v<span class="op">&lt;</span><span class="bu">std::</span>meta::get_type_t<span class="op">&lt;</span><span class="bu">std::</span>meta::get_element_v<span class="op">&lt;</span>Ms<span class="op">,</span> <span class="kw">decltype</span><span class="op">(</span>members<span class="op">)&gt;&gt;&gt;)</span> <span class="op">||</span> <span class="op">...);</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">}(</span><span class="bu">std::</span>make_index_sequence<span class="op">&lt;</span><span class="bu">std::</span>meta::get_size_v<span class="op">&lt;</span>members<span class="op">&gt;&gt;{});</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}();</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a><span class="kw">concept</span> DatabaseEntity <span class="op">=</span> HasIdField<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="op">&amp;&amp;</span> <span class="kw">requires</span> <span class="op">{</span></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// باید حاشیه‌نویسی کلید اصلی و نگاشت جدول داشته باشد</span></span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">[]()</span> <span class="op">{</span></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">std::</span>meta::has_attribute<span class="op">&lt;</span>entity_table<span class="op">&gt;(</span>meta<span class="op">)</span> <span class="op">&amp;&amp;</span></span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>               has_primary_key_field<span class="op">(</span>meta<span class="op">);</span></span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}();</span></span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span>DatabaseEntity T<span class="op">&gt;</span></span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> repository <span class="op">{</span></span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> <span class="dt">id_type</span> <span class="op">=</span> <span class="kw">decltype</span><span class="op">(</span><span class="dt">get_id_field_type</span><span class="op">&lt;</span>T<span class="op">&gt;());</span></span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>optional<span class="op">&lt;</span>T<span class="op">&gt;</span> find_by_id<span class="op">(</span><span class="dt">id_type</span> id<span class="op">)</span> <span class="op">{</span></span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> table_name <span class="op">=</span> get_table_name<span class="op">&lt;</span>T<span class="op">&gt;();</span></span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> id_column <span class="op">=</span> get_id_column_name<span class="op">&lt;</span>T<span class="op">&gt;();</span></span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> query <span class="op">=</span> <span class="st">&quot;SELECT * FROM &quot;</span> <span class="op">+</span> <span class="bu">std::</span>string<span class="op">(</span>table_name<span class="op">)</span> <span class="op">+</span> </span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot; WHERE &quot;</span> <span class="op">+</span> <span class="bu">std::</span>string<span class="op">(</span>id_column<span class="op">)</span> <span class="op">+</span> <span class="st">&quot; = ?&quot;</span><span class="op">;</span></span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> execute_query<span class="op">&lt;</span>T<span class="op">&gt;(</span>query<span class="op">,</span> id<span class="op">);</span></span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb69-40"><a href="#cb69-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-41"><a href="#cb69-41" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> save<span class="op">(</span><span class="at">const</span> T<span class="op">&amp;</span> entity<span class="op">)</span> <span class="op">{</span></span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span>has_auto_increment_id<span class="op">&lt;</span>T<span class="op">&gt;())</span> <span class="op">{</span></span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>get_id<span class="op">(</span>entity<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true" tabindex="-1"></a>                insert<span class="op">(</span>entity<span class="op">);</span></span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb69-46"><a href="#cb69-46" aria-hidden="true" tabindex="-1"></a>                update<span class="op">(</span>entity<span class="op">);</span></span>
<span id="cb69-47"><a href="#cb69-47" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb69-48"><a href="#cb69-48" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb69-49"><a href="#cb69-49" aria-hidden="true" tabindex="-1"></a>            upsert<span class="op">(</span>entity<span class="op">);</span></span>
<span id="cb69-50"><a href="#cb69-50" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb69-51"><a href="#cb69-51" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb69-52"><a href="#cb69-52" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<h3 data-number="2.31.3"
id="اعتبارسنجی-زمان-کامپایل-با-concept-ها-و-بازتاب"><span
class="header-section-number">2.31.3</span> 7.1.3 اعتبارسنجی زمان
کامپایل با Concept ها و بازتاب</h3>
<p>ترکیب اعتبارسنجی پیچیده زمان کامپایل را امکان‌پذیر می‌سازد [119]:</p>
<div class="sourceCode" id="cb70"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Concept های اعتبارسنجی با استفاده از بازتاب</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="kw">concept</span> ValidatedEntity <span class="op">=</span> Reflectable<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="op">&amp;&amp;</span> <span class="kw">requires</span> <span class="op">{</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تمام اعضا باید ویژگی‌های اعتبارسنجی مناسب داشته باشند</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    validate_all_members<span class="op">&lt;</span>T<span class="op">&gt;();</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="kw">consteval</span> <span class="dt">bool</span> validate_all_members<span class="op">()</span> <span class="op">{</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> members <span class="op">=</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>meta<span class="op">);</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">[]&lt;</span><span class="kw">auto</span><span class="op">...</span> Ms<span class="op">&gt;(</span><span class="bu">std::</span>index_sequence<span class="op">&lt;</span>Ms<span class="op">...&gt;)</span> <span class="op">{</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">(</span>validate_member<span class="op">&lt;</span><span class="bu">std::</span>meta::get_element_v<span class="op">&lt;</span>Ms<span class="op">,</span> <span class="kw">decltype</span><span class="op">(</span>members<span class="op">)&gt;&gt;()</span> <span class="op">&amp;&amp;</span> <span class="op">...);</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}(</span><span class="bu">std::</span>make_index_sequence<span class="op">&lt;</span><span class="bu">std::</span>meta::get_size_v<span class="op">&lt;</span>members<span class="op">&gt;&gt;{});</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">auto</span> Member<span class="op">&gt;</span></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a><span class="kw">consteval</span> <span class="dt">bool</span> validate_member<span class="op">()</span> <span class="op">{</span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> <span class="dt">member_type</span> <span class="op">=</span> <span class="bu">std::</span>meta::get_type_t<span class="op">&lt;</span>Member<span class="op">&gt;;</span></span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">// اعضای رشته باید محدودیت‌های طول داشته باشند</span></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>is_same_v<span class="op">&lt;</span><span class="dt">member_type</span><span class="op">,</span> <span class="bu">std::</span>string<span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">std::</span>meta::has_attribute<span class="op">&lt;</span>max_length<span class="op">&gt;(</span>Member<span class="op">)</span> <span class="op">||</span></span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>               <span class="bu">std::</span>meta::has_attribute<span class="op">&lt;</span>regex_pattern<span class="op">&gt;(</span>Member<span class="op">);</span></span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">// اعضای عددی باید محدودیت‌های محدوده داشته باشند</span></span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>is_arithmetic_v<span class="op">&lt;</span><span class="dt">member_type</span><span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">std::</span>meta::has_attribute<span class="op">&lt;</span>value_range<span class="op">&gt;(</span>Member<span class="op">)</span> <span class="op">||</span></span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a>               <span class="bu">std::</span>meta::has_attribute<span class="op">&lt;</span>positive_only<span class="op">&gt;(</span>Member<span class="op">);</span></span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">// سایر انواع به طور پیش‌فرض معتبر هستند</span></span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-38"><a href="#cb70-38" aria-hidden="true" tabindex="-1"></a><span class="co">// استفاده با اعتبارسنجی زمان کامپایل</span></span>
<span id="cb70-39"><a href="#cb70-39" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>entity<span class="op">(</span><span class="st">&quot;users&quot;</span><span class="op">)</span> <span class="er">$</span>validated User <span class="op">{</span></span>
<span id="cb70-40"><a href="#cb70-40" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span>primary_key <span class="dt">int</span> id<span class="op">;</span></span>
<span id="cb70-41"><a href="#cb70-41" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span>max_length<span class="op">(</span><span class="dv">100</span><span class="op">)</span> <span class="er">$</span>not_empty <span class="bu">std::</span>string name<span class="op">;</span></span>
<span id="cb70-42"><a href="#cb70-42" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span>range<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">150</span><span class="op">)</span> <span class="dt">int</span> age<span class="op">;</span></span>
<span id="cb70-43"><a href="#cb70-43" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span>email_format <span class="bu">std::</span>string email<span class="op">;</span></span>
<span id="cb70-44"><a href="#cb70-44" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span>positive_only <span class="dt">double</span> salary<span class="op">;</span></span>
<span id="cb70-45"><a href="#cb70-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-46"><a href="#cb70-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">// اعتبارسنجی زمان کامپایل اطمینان می‌دهد همه محدودیت‌ها مشخص شده‌اند</span></span>
<span id="cb70-47"><a href="#cb70-47" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb70-48"><a href="#cb70-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-49"><a href="#cb70-49" aria-hidden="true" tabindex="-1"></a><span class="co">// مثال نامعتبر - خطای کامپایل</span></span>
<span id="cb70-50"><a href="#cb70-50" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>entity<span class="op">(</span><span class="st">&quot;invalid&quot;</span><span class="op">)</span> <span class="er">$</span>validated BadUser <span class="op">{</span></span>
<span id="cb70-51"><a href="#cb70-51" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> id<span class="op">;</span></span>
<span id="cb70-52"><a href="#cb70-52" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string name<span class="op">;</span>  <span class="co">// خطا: رشته بدون محدودیت طول</span></span>
<span id="cb70-53"><a href="#cb70-53" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> age<span class="op">;</span>          <span class="co">// خطا: عددی بدون محدودیت محدوده</span></span>
<span id="cb70-54"><a href="#cb70-54" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<h2 data-number="2.32" id="coroutine-ها-و-الگوهای-async-بازتابی"><span
class="header-section-number">2.32</span> 7.2 Coroutine ها و الگوهای
Async بازتابی</h2>
<h3 data-number="2.32.1"
id="تولید-coroutine-راهبری-شده-توسط-بازتاب"><span
class="header-section-number">2.32.1</span> 7.2.1 تولید Coroutine راهبری
شده توسط بازتاب</h3>
<p>Coroutine های C++20 ترکیب شده با بازتاب C++23 تولید خودکار API های
ناهمگام را امکان‌پذیر می‌سازند [120]:</p>
<div class="sourceCode" id="cb71"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;coroutine&gt;</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;experimental/reflect&gt;</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co">// متاکلاس عملیات async با استفاده از coroutine ها و بازتاب</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> async_service<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید متدهای async مبتنی بر coroutine برای تمام متدهای عمومی</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> methods <span class="op">=</span> <span class="bu">std::</span>meta::public_member_functions_of<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::template_for<span class="op">&lt;</span>methods<span class="op">&gt;([&amp;](</span><span class="kw">auto</span> method_meta<span class="op">)</span> <span class="op">{</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> method_name <span class="op">=</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>method_meta<span class="op">&gt;;</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> <span class="dt">return_type</span> <span class="op">=</span> <span class="bu">std::</span>meta::get_return_type_t<span class="op">&lt;</span>method_meta<span class="op">&gt;;</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> parameters <span class="op">=</span> <span class="bu">std::</span>meta::get_parameters_t<span class="op">&lt;</span>method_meta<span class="op">&gt;;</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تولید نسخه async هر متد</span></span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>        generate_async_method<span class="op">(</span>target<span class="op">,</span> method_meta<span class="op">);</span></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید زیرساخت coroutine</span></span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>    generate_coroutine_infrastructure<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="bu">std::</span>meta::info MethodMeta<span class="op">&gt;</span></span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> generate_async_method<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">,</span> MethodMeta method<span class="op">)</span> <span class="op">{</span></span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> method_name <span class="op">=</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>method<span class="op">&gt;;</span></span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> <span class="dt">return_type</span> <span class="op">=</span> <span class="bu">std::</span>meta::get_return_type_t<span class="op">&lt;</span>method<span class="op">&gt;;</span></span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string async_method <span class="op">=</span> </span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;task&lt;&quot;</span> <span class="op">+</span> <span class="bu">std::</span>meta::get_display_name_v<span class="op">&lt;</span><span class="dt">return_type</span><span class="op">&gt;</span> <span class="op">+</span> <span class="st">&quot;&gt; &quot;</span> <span class="op">+</span></span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string<span class="op">(</span>method_name<span class="op">)</span> <span class="op">+</span> <span class="st">&quot;_async(&quot;</span><span class="op">;</span></span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">// اضافه کردن پارامترها</span></span>
<span id="cb71-32"><a href="#cb71-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> params <span class="op">=</span> <span class="bu">std::</span>meta::get_parameters_t<span class="op">&lt;</span>method<span class="op">&gt;;</span></span>
<span id="cb71-33"><a href="#cb71-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::template_for<span class="op">&lt;</span>params<span class="op">&gt;([&amp;](</span><span class="kw">auto</span> param_meta<span class="op">)</span> <span class="op">{</span></span>
<span id="cb71-34"><a href="#cb71-34" aria-hidden="true" tabindex="-1"></a>        <span class="co">// اضافه کردن پارامتر به امضای متد async</span></span>
<span id="cb71-35"><a href="#cb71-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb71-36"><a href="#cb71-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-37"><a href="#cb71-37" aria-hidden="true" tabindex="-1"></a>    async_method <span class="op">+=</span> <span class="st">&quot;) {</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb71-38"><a href="#cb71-38" aria-hidden="true" tabindex="-1"></a>    async_method <span class="op">+=</span> <span class="st">&quot;    co_return co_await async_executor_.schedule([this]() {</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb71-39"><a href="#cb71-39" aria-hidden="true" tabindex="-1"></a>    async_method <span class="op">+=</span> <span class="st">&quot;        return this-&gt;&quot;</span> <span class="op">+</span> <span class="bu">std::</span>string<span class="op">(</span>method_name<span class="op">)</span> <span class="op">+</span> <span class="st">&quot;(&quot;</span><span class="op">;</span></span>
<span id="cb71-40"><a href="#cb71-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-41"><a href="#cb71-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">// انتقال پارامترها</span></span>
<span id="cb71-42"><a href="#cb71-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::template_for<span class="op">&lt;</span>params<span class="op">&gt;([&amp;](</span><span class="kw">auto</span> param_meta<span class="op">)</span> <span class="op">{</span></span>
<span id="cb71-43"><a href="#cb71-43" aria-hidden="true" tabindex="-1"></a>        <span class="co">// انتقال پارامترها به متد همگام</span></span>
<span id="cb71-44"><a href="#cb71-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb71-45"><a href="#cb71-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-46"><a href="#cb71-46" aria-hidden="true" tabindex="-1"></a>    async_method <span class="op">+=</span> <span class="st">&quot;);</span><span class="sc">\n</span><span class="st">    });</span><span class="sc">\n</span><span class="st">}</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb71-47"><a href="#cb71-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-48"><a href="#cb71-48" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::compiler<span class="op">.</span>declare<span class="op">(</span>target<span class="op">,</span> async_method<span class="op">);</span></span>
<span id="cb71-49"><a href="#cb71-49" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb71-50"><a href="#cb71-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-51"><a href="#cb71-51" aria-hidden="true" tabindex="-1"></a><span class="co">// نوع task coroutine برای عملیات async</span></span>
<span id="cb71-52"><a href="#cb71-52" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb71-53"><a href="#cb71-53" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> task <span class="op">{</span></span>
<span id="cb71-54"><a href="#cb71-54" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb71-55"><a href="#cb71-55" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> <span class="dt">promise_type</span> <span class="op">{</span></span>
<span id="cb71-56"><a href="#cb71-56" aria-hidden="true" tabindex="-1"></a>        T <span class="va">value_</span><span class="op">;</span></span>
<span id="cb71-57"><a href="#cb71-57" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>exception_ptr <span class="va">exception_</span><span class="op">;</span></span>
<span id="cb71-58"><a href="#cb71-58" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb71-59"><a href="#cb71-59" aria-hidden="true" tabindex="-1"></a>        task get_return_object<span class="op">()</span> <span class="op">{</span></span>
<span id="cb71-60"><a href="#cb71-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> task<span class="op">{</span><span class="bu">std::</span>coroutine_handle<span class="op">&lt;</span><span class="dt">promise_type</span><span class="op">&gt;::</span>from_promise<span class="op">(*</span><span class="kw">this</span><span class="op">)};</span></span>
<span id="cb71-61"><a href="#cb71-61" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb71-62"><a href="#cb71-62" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb71-63"><a href="#cb71-63" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>suspend_never initial_suspend<span class="op">()</span> <span class="op">{</span> <span class="cf">return</span> <span class="op">{};</span> <span class="op">}</span></span>
<span id="cb71-64"><a href="#cb71-64" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>suspend_never final_suspend<span class="op">()</span> <span class="kw">noexcept</span> <span class="op">{</span> <span class="cf">return</span> <span class="op">{};</span> <span class="op">}</span></span>
<span id="cb71-65"><a href="#cb71-65" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb71-66"><a href="#cb71-66" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> return_value<span class="op">(</span>T value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb71-67"><a href="#cb71-67" aria-hidden="true" tabindex="-1"></a>            <span class="va">value_</span> <span class="op">=</span> <span class="bu">std::</span>move<span class="op">(</span>value<span class="op">);</span></span>
<span id="cb71-68"><a href="#cb71-68" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb71-69"><a href="#cb71-69" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb71-70"><a href="#cb71-70" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> unhandled_exception<span class="op">()</span> <span class="op">{</span></span>
<span id="cb71-71"><a href="#cb71-71" aria-hidden="true" tabindex="-1"></a>            <span class="va">exception_</span> <span class="op">=</span> <span class="bu">std::</span>current_exception<span class="op">();</span></span>
<span id="cb71-72"><a href="#cb71-72" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb71-73"><a href="#cb71-73" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb71-74"><a href="#cb71-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-75"><a href="#cb71-75" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="cb71-76"><a href="#cb71-76" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>coroutine_handle<span class="op">&lt;</span><span class="dt">promise_type</span><span class="op">&gt;</span> <span class="va">handle_</span><span class="op">;</span></span>
<span id="cb71-77"><a href="#cb71-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-78"><a href="#cb71-78" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb71-79"><a href="#cb71-79" aria-hidden="true" tabindex="-1"></a>    <span class="kw">explicit</span> task<span class="op">(</span><span class="bu">std::</span>coroutine_handle<span class="op">&lt;</span><span class="dt">promise_type</span><span class="op">&gt;</span> handle<span class="op">)</span> <span class="op">:</span> <span class="va">handle_</span><span class="op">(</span>handle<span class="op">)</span> <span class="op">{}</span></span>
<span id="cb71-80"><a href="#cb71-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-81"><a href="#cb71-81" aria-hidden="true" tabindex="-1"></a>    <span class="op">~</span>task<span class="op">()</span> <span class="op">{</span></span>
<span id="cb71-82"><a href="#cb71-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span><span class="va">handle_</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb71-83"><a href="#cb71-83" aria-hidden="true" tabindex="-1"></a>            <span class="va">handle_</span><span class="op">.</span>destroy<span class="op">();</span></span>
<span id="cb71-84"><a href="#cb71-84" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb71-85"><a href="#cb71-85" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb71-86"><a href="#cb71-86" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-87"><a href="#cb71-87" aria-hidden="true" tabindex="-1"></a>    T get<span class="op">()</span> <span class="op">{</span></span>
<span id="cb71-88"><a href="#cb71-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span><span class="va">handle_</span><span class="op">.</span>promise<span class="op">().</span><span class="va">exception_</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb71-89"><a href="#cb71-89" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>rethrow_exception<span class="op">(</span><span class="va">handle_</span><span class="op">.</span>promise<span class="op">().</span><span class="va">exception_</span><span class="op">);</span></span>
<span id="cb71-90"><a href="#cb71-90" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb71-91"><a href="#cb71-91" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">std::</span>move<span class="op">(</span><span class="va">handle_</span><span class="op">.</span>promise<span class="op">().</span><span class="va">value_</span><span class="op">);</span></span>
<span id="cb71-92"><a href="#cb71-92" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb71-93"><a href="#cb71-93" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-94"><a href="#cb71-94" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> ready<span class="op">()</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="cb71-95"><a href="#cb71-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">handle_</span><span class="op">.</span>done<span class="op">();</span></span>
<span id="cb71-96"><a href="#cb71-96" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb71-97"><a href="#cb71-97" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb71-98"><a href="#cb71-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-99"><a href="#cb71-99" aria-hidden="true" tabindex="-1"></a><span class="co">// مثال سرویس با تولید خودکار async</span></span>
<span id="cb71-100"><a href="#cb71-100" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>async_service DataService <span class="op">{</span></span>
<span id="cb71-101"><a href="#cb71-101" aria-hidden="true" tabindex="-1"></a>    database<span class="op">::</span>connection <span class="va">db_</span><span class="op">;</span></span>
<span id="cb71-102"><a href="#cb71-102" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-103"><a href="#cb71-103" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb71-104"><a href="#cb71-104" aria-hidden="true" tabindex="-1"></a>    User get_user<span class="op">(</span><span class="dt">int</span> id<span class="op">)</span> <span class="op">{</span></span>
<span id="cb71-105"><a href="#cb71-105" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">db_</span><span class="op">.</span>query<span class="op">&lt;</span>User<span class="op">&gt;(</span><span class="st">&quot;SELECT * FROM users WHERE id = ?&quot;</span><span class="op">,</span> id<span class="op">);</span></span>
<span id="cb71-106"><a href="#cb71-106" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb71-107"><a href="#cb71-107" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-108"><a href="#cb71-108" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span>User<span class="op">&gt;</span> get_users_by_department<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>string<span class="op">&amp;</span> dept<span class="op">)</span> <span class="op">{</span></span>
<span id="cb71-109"><a href="#cb71-109" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">db_</span><span class="op">.</span>query<span class="op">&lt;</span><span class="bu">std::</span>vector<span class="op">&lt;</span>User<span class="op">&gt;&gt;(</span></span>
<span id="cb71-110"><a href="#cb71-110" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;SELECT * FROM users WHERE department = ?&quot;</span><span class="op">,</span> dept<span class="op">);</span></span>
<span id="cb71-111"><a href="#cb71-111" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb71-112"><a href="#cb71-112" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-113"><a href="#cb71-113" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> update_user<span class="op">(</span><span class="at">const</span> User<span class="op">&amp;</span> user<span class="op">)</span> <span class="op">{</span></span>
<span id="cb71-114"><a href="#cb71-114" aria-hidden="true" tabindex="-1"></a>        <span class="va">db_</span><span class="op">.</span>execute<span class="op">(</span><span class="st">&quot;UPDATE users SET name = ?, age = ? WHERE id = ?&quot;</span><span class="op">,</span></span>
<span id="cb71-115"><a href="#cb71-115" aria-hidden="true" tabindex="-1"></a>                   user<span class="op">.</span>name<span class="op">,</span> user<span class="op">.</span>age<span class="op">,</span> user<span class="op">.</span>id<span class="op">);</span></span>
<span id="cb71-116"><a href="#cb71-116" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb71-117"><a href="#cb71-117" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-118"><a href="#cb71-118" aria-hidden="true" tabindex="-1"></a>    <span class="co">// به طور خودکار تولید می‌کند:</span></span>
<span id="cb71-119"><a href="#cb71-119" aria-hidden="true" tabindex="-1"></a>    <span class="co">// task&lt;User&gt; get_user_async(int id);</span></span>
<span id="cb71-120"><a href="#cb71-120" aria-hidden="true" tabindex="-1"></a>    <span class="co">// task&lt;std::vector&lt;User&gt;&gt; get_users_by_department_async(const std::string&amp; dept);</span></span>
<span id="cb71-121"><a href="#cb71-121" aria-hidden="true" tabindex="-1"></a>    <span class="co">// task&lt;void&gt; update_user_async(const User&amp; user);</span></span>
<span id="cb71-122"><a href="#cb71-122" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb71-123"><a href="#cb71-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-124"><a href="#cb71-124" aria-hidden="true" tabindex="-1"></a><span class="co">// استفاده با API خودکار async</span></span>
<span id="cb71-125"><a href="#cb71-125" aria-hidden="true" tabindex="-1"></a>async_task<span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> process_users<span class="op">()</span> <span class="op">{</span></span>
<span id="cb71-126"><a href="#cb71-126" aria-hidden="true" tabindex="-1"></a>    DataService service<span class="op">;</span></span>
<span id="cb71-127"><a href="#cb71-127" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-128"><a href="#cb71-128" aria-hidden="true" tabindex="-1"></a>    <span class="co">// استفاده از متدهای async تولید شده</span></span>
<span id="cb71-129"><a href="#cb71-129" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> user <span class="op">=</span> <span class="cf">co_await</span> service<span class="op">.</span>get_user_async<span class="op">(</span><span class="dv">123</span><span class="op">);</span></span>
<span id="cb71-130"><a href="#cb71-130" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> dept_users <span class="op">=</span> <span class="cf">co_await</span> service<span class="op">.</span>get_users_by_department_async<span class="op">(</span><span class="st">&quot;Engineering&quot;</span><span class="op">);</span></span>
<span id="cb71-131"><a href="#cb71-131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-132"><a href="#cb71-132" aria-hidden="true" tabindex="-1"></a>    user<span class="op">.</span>salary <span class="op">*=</span> <span class="fl">1.1</span><span class="op">;</span>  <span class="co">// افزایش 10% حقوق</span></span>
<span id="cb71-133"><a href="#cb71-133" aria-hidden="true" tabindex="-1"></a>    <span class="cf">co_await</span> service<span class="op">.</span>update_user_async<span class="op">(</span>user<span class="op">);</span></span>
<span id="cb71-134"><a href="#cb71-134" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="2.32.2" id="جریان-رویداد-مبتنی-بر-بازتاب"><span
class="header-section-number">2.32.2</span> 7.2.2 جریان رویداد مبتنی بر
بازتاب</h3>
<p>بازتاب تولید خودکار جریان‌های رویداد واکنشی را امکان‌پذیر می‌سازد
[121]:</p>
<div class="sourceCode" id="cb72"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">// جریان رویداد با استفاده از بازتاب و coroutine ها</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="kw">concept</span> EventStreamable <span class="op">=</span> Reflectable<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="op">&amp;&amp;</span> <span class="kw">requires</span> <span class="op">{</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::has_metaclass<span class="op">&lt;</span>observable<span class="op">&gt;(</span>T<span class="op">);</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span>EventStreamable T<span class="op">&gt;</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> event_stream <span class="op">{</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> <span class="dt">value_type</span> <span class="op">=</span> T<span class="op">;</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">auto</span> Member<span class="op">&gt;</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> observe_member<span class="op">()</span> <span class="op">-&gt;</span> async_generator<span class="op">&lt;</span><span class="bu">std::</span>meta::get_type_t<span class="op">&lt;</span>Member<span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> member_name <span class="op">=</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>Member<span class="op">&gt;;</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span><span class="kw">true</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> change_event <span class="op">=</span> <span class="cf">co_await</span> wait_for_change<span class="op">(</span>member_name<span class="op">);</span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> new_value <span class="op">=</span> <span class="va">source_</span><span class="op">.*</span><span class="bu">std::</span>meta::get_pointer_v<span class="op">&lt;</span>Member<span class="op">&gt;;</span></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">co_yield</span> new_value<span class="op">;</span></span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> observe_all_changes<span class="op">()</span> <span class="op">-&gt;</span> async_generator<span class="op">&lt;</span>property_change_event<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> members <span class="op">=</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>meta<span class="op">);</span></span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>meta::template_for<span class="op">&lt;</span>members<span class="op">&gt;([&amp;](</span><span class="kw">auto</span> member_meta<span class="op">)</span> <span class="op">{</span></span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a>            setup_member_observer<span class="op">(</span>member_meta<span class="op">);</span></span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">});</span></span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span><span class="kw">true</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> event <span class="op">=</span> <span class="cf">co_await</span> wait_for_any_change<span class="op">();</span></span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">co_yield</span> event<span class="op">;</span></span>
<span id="cb72-34"><a href="#cb72-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb72-35"><a href="#cb72-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb72-36"><a href="#cb72-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-37"><a href="#cb72-37" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="cb72-38"><a href="#cb72-38" aria-hidden="true" tabindex="-1"></a>    T<span class="op">*</span> <span class="va">source_</span><span class="op">;</span></span>
<span id="cb72-39"><a href="#cb72-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>unordered_map<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">,</span> <span class="bu">std::</span>queue<span class="op">&lt;</span><span class="bu">std::</span>any<span class="op">&gt;&gt;</span> <span class="va">change_queues_</span><span class="op">;</span></span>
<span id="cb72-40"><a href="#cb72-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-41"><a href="#cb72-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">auto</span> Member<span class="op">&gt;</span></span>
<span id="cb72-42"><a href="#cb72-42" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setup_member_observer<span class="op">(</span>Member member<span class="op">)</span> <span class="op">{</span></span>
<span id="cb72-43"><a href="#cb72-43" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> member_name <span class="op">=</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>member<span class="op">&gt;;</span></span>
<span id="cb72-44"><a href="#cb72-44" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb72-45"><a href="#cb72-45" aria-hidden="true" tabindex="-1"></a>        <span class="va">source_</span><span class="op">-&gt;</span>add_observer<span class="op">&lt;</span><span class="bu">std::</span>meta::get_type_t<span class="op">&lt;</span>member<span class="op">&gt;&gt;(</span></span>
<span id="cb72-46"><a href="#cb72-46" aria-hidden="true" tabindex="-1"></a>            member_name<span class="op">,</span></span>
<span id="cb72-47"><a href="#cb72-47" aria-hidden="true" tabindex="-1"></a>            <span class="op">[</span><span class="kw">this</span><span class="op">](</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> new_value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb72-48"><a href="#cb72-48" aria-hidden="true" tabindex="-1"></a>                <span class="va">change_queues_</span><span class="op">[</span>member_name<span class="op">].</span>push<span class="op">(</span><span class="bu">std::</span>make_any<span class="op">(</span>new_value<span class="op">));</span></span>
<span id="cb72-49"><a href="#cb72-49" aria-hidden="true" tabindex="-1"></a>                notify_change<span class="op">(</span>member_name<span class="op">);</span></span>
<span id="cb72-50"><a href="#cb72-50" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb72-51"><a href="#cb72-51" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb72-52"><a href="#cb72-52" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb72-53"><a href="#cb72-53" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb72-54"><a href="#cb72-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-55"><a href="#cb72-55" aria-hidden="true" tabindex="-1"></a><span class="co">// مثال استفاده</span></span>
<span id="cb72-56"><a href="#cb72-56" aria-hidden="true" tabindex="-1"></a>async_task<span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> monitor_stock_prices<span class="op">()</span> <span class="op">{</span></span>
<span id="cb72-57"><a href="#cb72-57" aria-hidden="true" tabindex="-1"></a>    StockPrice stock<span class="op">{</span><span class="st">&quot;AAPL&quot;</span><span class="op">,</span> <span class="fl">150.0</span><span class="op">,</span> <span class="dv">1000000</span><span class="op">};</span></span>
<span id="cb72-58"><a href="#cb72-58" aria-hidden="true" tabindex="-1"></a>    event_stream<span class="op">&lt;</span>StockPrice<span class="op">&gt;</span> stream<span class="op">(&amp;</span>stock<span class="op">);</span></span>
<span id="cb72-59"><a href="#cb72-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-60"><a href="#cb72-60" aria-hidden="true" tabindex="-1"></a>    <span class="co">// نظارت بر تغییرات عضو خاص</span></span>
<span id="cb72-61"><a href="#cb72-61" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> price_stream <span class="op">=</span> stream<span class="op">.</span>observe_member<span class="op">&lt;&amp;</span>StockPrice<span class="op">::</span>price<span class="op">&gt;();</span></span>
<span id="cb72-62"><a href="#cb72-62" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> volume_stream <span class="op">=</span> stream<span class="op">.</span>observe_member<span class="op">&lt;&amp;</span>StockPrice<span class="op">::</span>volume<span class="op">&gt;();</span></span>
<span id="cb72-63"><a href="#cb72-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-64"><a href="#cb72-64" aria-hidden="true" tabindex="-1"></a>    <span class="co">// پردازش ناهمگام تغییرات قیمت</span></span>
<span id="cb72-65"><a href="#cb72-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span><span class="kw">auto</span> price <span class="op">=</span> <span class="cf">co_await</span> price_stream<span class="op">.</span>next<span class="op">())</span> <span class="op">{</span></span>
<span id="cb72-66"><a href="#cb72-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>price <span class="op">&gt;</span> <span class="fl">160.0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb72-67"><a href="#cb72-67" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">&quot;Price alert: $&quot;</span> <span class="op">&lt;&lt;</span> price <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span>
<span id="cb72-68"><a href="#cb72-68" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb72-69"><a href="#cb72-69" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb72-70"><a href="#cb72-70" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 data-number="2.33" id="یکپارچگی-سیستم-module-ها"><span
class="header-section-number">2.33</span> 7.3 یکپارچگی سیستم Module
ها</h2>
<h3 data-number="2.33.1" id="بازتاب-آگاه-به-module"><span
class="header-section-number">2.33.1</span> 7.3.1 بازتاب آگاه به
Module</h3>
<p>Module های C++20 نیاز به توجه ویژه برای پشتیبانی بازتاب دارند
[122]:</p>
<div class="sourceCode" id="cb73"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co">// رابط module با پشتیبانی بازتاب</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="kw">export</span> <span class="kw">module</span> data_models<span class="op">;</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> std<span class="op">.</span>core<span class="op">;</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> std<span class="op">.</span>reflection<span class="op">;</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="co">// صادرات انواع بازتابی با دید module</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="kw">export</span> <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="kw">concept</span> ModuleReflectable <span class="op">=</span> <span class="kw">requires</span> <span class="op">{</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::is_exported_v<span class="op">&lt;</span><span class="bu">std::</span>meta::reflexpr<span class="op">(</span>T<span class="op">)&gt;;</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a><span class="kw">export</span> <span class="kw">class</span> <span class="er">$</span>serializable <span class="er">$</span>entity<span class="op">(</span><span class="st">&quot;users&quot;</span><span class="op">)</span> User <span class="op">{</span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> id<span class="op">;</span></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string name<span class="op">;</span></span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string email<span class="op">;</span></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// فراداده بازتاب با نوع صادر می‌شود</span></span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a><span class="kw">export</span> <span class="kw">class</span> <span class="er">$</span>serializable Product <span class="op">{</span></span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> product_id<span class="op">;</span></span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string name<span class="op">;</span></span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> price<span class="op">;</span></span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a><span class="co">// صادرات ابزارهای بازتاب برای انواع module</span></span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a><span class="kw">export</span> <span class="kw">template</span><span class="op">&lt;</span>ModuleReflectable T<span class="op">&gt;</span></span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a><span class="bu">std::</span>string <span class="dt">serialize_module_type</span><span class="op">(</span><span class="at">const</span> T<span class="op">&amp;</span> obj<span class="op">)</span> <span class="op">{</span></span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span><span class="bu">std::</span>meta::is_exported_v<span class="op">&lt;</span>meta<span class="op">&gt;,</span> </span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;Type must be exported for cross-module reflection&quot;</span><span class="op">);</span></span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-35"><a href="#cb73-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> reflect_serialize_impl<span class="op">(</span>obj<span class="op">,</span> meta<span class="op">);</span></span>
<span id="cb73-36"><a href="#cb73-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb73-37"><a href="#cb73-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-38"><a href="#cb73-38" aria-hidden="true" tabindex="-1"></a><span class="co">// ابزارهای بازتاب خصوصی module</span></span>
<span id="cb73-39"><a href="#cb73-39" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> detail <span class="op">{</span></span>
<span id="cb73-40"><a href="#cb73-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="bu">std::</span>meta::info TypeMeta<span class="op">&gt;</span></span>
<span id="cb73-41"><a href="#cb73-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">bool</span> is_module_exportable<span class="op">()</span> <span class="op">{</span></span>
<span id="cb73-42"><a href="#cb73-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">std::</span>meta::is_public_v<span class="op">&lt;</span>TypeMeta<span class="op">&gt;</span> <span class="op">&amp;&amp;</span> </span>
<span id="cb73-43"><a href="#cb73-43" aria-hidden="true" tabindex="-1"></a>               <span class="bu">std::</span>meta::has_export_declaration_v<span class="op">&lt;</span>TypeMeta<span class="op">&gt;;</span></span>
<span id="cb73-44"><a href="#cb73-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb73-45"><a href="#cb73-45" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="2.33.2" id="پشتیبانی-متاکلاس-بین-module-ها"><span
class="header-section-number">2.33.2</span> 7.3.2 پشتیبانی متاکلاس بین
Module ها</h3>
<p>متاکلاس‌ها باید به درستی در سراسر مرزهای module کار کنند [123]:</p>
<div class="sourceCode" id="cb74"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">// تعاریف متاکلاس در module جداگانه</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="kw">export</span> <span class="kw">module</span> metaclasses<span class="op">.</span>serialization<span class="op">;</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> std<span class="op">.</span>core<span class="op">;</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> std<span class="op">.</span>reflection<span class="op">;</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="co">// صادرات پیاده‌سازی‌های متاکلاس</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="kw">export</span> <span class="kw">constexpr</span> <span class="dt">void</span> serializable<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">,</span> </span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>                                 serialization_format format <span class="op">=</span> json<span class="op">)</span> <span class="op">{</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// اطمینان از سازگاری بین module ها</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::compiler<span class="op">.</span>require<span class="op">(</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>meta::is_module_exported_v<span class="op">&lt;</span>target<span class="op">&gt;</span> <span class="op">||</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>meta::is_module_internal_v<span class="op">&lt;</span>target<span class="op">&gt;,</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;serializable can only be applied to exported or internal types&quot;</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>    generate_serialization_methods<span class="op">(</span>target<span class="op">,</span> format<span class="op">);</span></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a><span class="kw">export</span> <span class="kw">constexpr</span> <span class="dt">void</span> entity<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">,</span> </span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>                           <span class="bu">std::</span>string_view table_name <span class="op">=</span> <span class="st">&quot;&quot;</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">// پشتیبانی entity بین module ها</span></span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a>    validate_cross_module_entity<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a>    generate_entity_methods<span class="op">(</span>target<span class="op">,</span> table_name<span class="op">);</span></span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a><span class="co">// اعتبارسنجی متاکلاس بین module ها</span></span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> <span class="dt">void</span> validate_cross_module_entity<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">// اطمینان از دسترسی همه انواع وابسته</span></span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> members <span class="op">=</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::template_for<span class="op">&lt;</span>members<span class="op">&gt;([&amp;](</span><span class="kw">auto</span> member_meta<span class="op">)</span> <span class="op">{</span></span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> <span class="dt">member_type</span> <span class="op">=</span> <span class="bu">std::</span>meta::get_type_t<span class="op">&lt;</span>member_meta<span class="op">&gt;;</span></span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span></span>
<span id="cb74-36"><a href="#cb74-36" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>meta::is_module_accessible_v<span class="op">&lt;</span><span class="dt">member_type</span><span class="op">&gt;,</span></span>
<span id="cb74-37"><a href="#cb74-37" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;All entity member types must be accessible across modules&quot;</span></span>
<span id="cb74-38"><a href="#cb74-38" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb74-39"><a href="#cb74-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb74-40"><a href="#cb74-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb74-41"><a href="#cb74-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-42"><a href="#cb74-42" aria-hidden="true" tabindex="-1"></a><span class="co">// استفاده در module کلاینت</span></span>
<span id="cb74-43"><a href="#cb74-43" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> client<span class="op">;</span></span>
<span id="cb74-44"><a href="#cb74-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-45"><a href="#cb74-45" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> data_models<span class="op">;</span></span>
<span id="cb74-46"><a href="#cb74-46" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> metaclasses<span class="op">.</span>serialization<span class="op">;</span></span>
<span id="cb74-47"><a href="#cb74-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-48"><a href="#cb74-48" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> process_data<span class="op">()</span> <span class="op">{</span></span>
<span id="cb74-49"><a href="#cb74-49" aria-hidden="true" tabindex="-1"></a>    User user<span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="st">&quot;Alice&quot;</span><span class="op">,</span> <span class="st">&quot;alice@example.com&quot;</span><span class="op">};</span></span>
<span id="cb74-50"><a href="#cb74-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-51"><a href="#cb74-51" aria-hidden="true" tabindex="-1"></a>    <span class="co">// بازتاب بین module ها بدون مشکل کار می‌کند</span></span>
<span id="cb74-52"><a href="#cb74-52" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string json <span class="op">=</span> user<span class="op">.</span>to_json<span class="op">();</span></span>
<span id="cb74-53"><a href="#cb74-53" aria-hidden="true" tabindex="-1"></a>    User restored <span class="op">=</span> User<span class="op">::</span>from_json<span class="op">(</span>json<span class="op">);</span></span>
<span id="cb74-54"><a href="#cb74-54" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 data-number="2.34" id="فرصتهای-تقویت-کتابخانه-ranges"><span
class="header-section-number">2.34</span> 7.4 فرصت‌های تقویت کتابخانه
Ranges</h2>
<h3 data-number="2.34.1"
id="الگوریتمهای-range-تقویت-شده-با-بازتاب"><span
class="header-section-number">2.34.1</span> 7.4.1 الگوریتم‌های Range
تقویت شده با بازتاب</h3>
<p>Range های C++20 می‌توانند با بازتاب برای پردازش خودکار داده تقویت شوند
[124]:</p>
<div class="sourceCode" id="cb75"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;ranges&gt;</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;experimental/reflect&gt;</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="co">// تبدیل‌های range آگاه به بازتاب</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> ranges<span class="op">::</span>reflection <span class="op">{</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">concept</span> ReflectableRange <span class="op">=</span> <span class="bu">std::</span>ranges::range<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="op">&amp;&amp;</span> </span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>                              Reflectable<span class="op">&lt;</span><span class="bu">std::</span>ranges::range_value_t<span class="op">&lt;</span>T<span class="op">&gt;&gt;;</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// استخراج خودکار عضو</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">auto</span> Member<span class="op">&gt;</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> extract_member <span class="op">{</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> <span class="kw">operator</span><span class="op">()(</span><span class="at">const</span> T<span class="op">&amp;</span> obj<span class="op">)</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> obj<span class="op">.*</span><span class="bu">std::</span>meta::get_pointer_v<span class="op">&lt;</span>Member<span class="op">&gt;;</span></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">auto</span> Member<span class="op">&gt;</span></span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> extract <span class="op">=</span> extract_member<span class="op">&lt;</span>Member<span class="op">&gt;{};</span></span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// فیلتر خودکار بر اساس مقادیر عضو</span></span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">auto</span> Member<span class="op">,</span> <span class="kw">typename</span> Predicate<span class="op">&gt;</span></span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> filter_by_member <span class="op">{</span></span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a>        Predicate pred<span class="op">;</span></span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a>        <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="dt">bool</span> <span class="kw">operator</span><span class="op">()(</span><span class="at">const</span> T<span class="op">&amp;</span> obj<span class="op">)</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> pred<span class="op">(</span>obj<span class="op">.*</span><span class="bu">std::</span>meta::get_pointer_v<span class="op">&lt;</span>Member<span class="op">&gt;);</span></span>
<span id="cb75-31"><a href="#cb75-31" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb75-32"><a href="#cb75-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb75-33"><a href="#cb75-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-34"><a href="#cb75-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">auto</span> Member<span class="op">,</span> <span class="kw">typename</span> Predicate<span class="op">&gt;</span></span>
<span id="cb75-35"><a href="#cb75-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> filter_by <span class="op">=</span> <span class="op">[](</span>Predicate pred<span class="op">)</span> <span class="op">{</span></span>
<span id="cb75-36"><a href="#cb75-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> filter_by_member<span class="op">&lt;</span>Member<span class="op">,</span> Predicate<span class="op">&gt;{</span>pred<span class="op">};</span></span>
<span id="cb75-37"><a href="#cb75-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb75-38"><a href="#cb75-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-39"><a href="#cb75-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">// گروه‌بندی خودکار بر اساس مقادیر عضو</span></span>
<span id="cb75-40"><a href="#cb75-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">auto</span> Member<span class="op">&gt;</span></span>
<span id="cb75-41"><a href="#cb75-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> group_by_member <span class="op">{</span></span>
<span id="cb75-42"><a href="#cb75-42" aria-hidden="true" tabindex="-1"></a>        <span class="kw">template</span><span class="op">&lt;</span>ReflectableRange Range<span class="op">&gt;</span></span>
<span id="cb75-43"><a href="#cb75-43" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> <span class="kw">operator</span><span class="op">()(</span>Range<span class="op">&amp;&amp;</span> range<span class="op">)</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="cb75-44"><a href="#cb75-44" aria-hidden="true" tabindex="-1"></a>            <span class="kw">using</span> <span class="dt">key_type</span> <span class="op">=</span> <span class="bu">std::</span>meta::get_type_t<span class="op">&lt;</span>Member<span class="op">&gt;;</span></span>
<span id="cb75-45"><a href="#cb75-45" aria-hidden="true" tabindex="-1"></a>            <span class="kw">using</span> <span class="dt">value_type</span> <span class="op">=</span> <span class="bu">std::</span>ranges::range_value_t<span class="op">&lt;</span>Range<span class="op">&gt;;</span></span>
<span id="cb75-46"><a href="#cb75-46" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb75-47"><a href="#cb75-47" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>map<span class="op">&lt;</span><span class="dt">key_type</span><span class="op">,</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">value_type</span><span class="op">&gt;&gt;</span> groups<span class="op">;</span></span>
<span id="cb75-48"><a href="#cb75-48" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb75-49"><a href="#cb75-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> item <span class="op">:</span> range<span class="op">)</span> <span class="op">{</span></span>
<span id="cb75-50"><a href="#cb75-50" aria-hidden="true" tabindex="-1"></a>                <span class="kw">auto</span> key <span class="op">=</span> item<span class="op">.*</span><span class="bu">std::</span>meta::get_pointer_v<span class="op">&lt;</span>Member<span class="op">&gt;;</span></span>
<span id="cb75-51"><a href="#cb75-51" aria-hidden="true" tabindex="-1"></a>                groups<span class="op">[</span>key<span class="op">].</span>push_back<span class="op">(</span>item<span class="op">);</span></span>
<span id="cb75-52"><a href="#cb75-52" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb75-53"><a href="#cb75-53" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb75-54"><a href="#cb75-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> groups<span class="op">;</span></span>
<span id="cb75-55"><a href="#cb75-55" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb75-56"><a href="#cb75-56" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb75-57"><a href="#cb75-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-58"><a href="#cb75-58" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">auto</span> Member<span class="op">&gt;</span></span>
<span id="cb75-59"><a href="#cb75-59" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> group_by <span class="op">=</span> group_by_member<span class="op">&lt;</span>Member<span class="op">&gt;{};</span></span>
<span id="cb75-60"><a href="#cb75-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-61"><a href="#cb75-61" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تجمیع خودکار</span></span>
<span id="cb75-62"><a href="#cb75-62" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">auto</span> Member<span class="op">,</span> <span class="kw">typename</span> BinaryOp<span class="op">&gt;</span></span>
<span id="cb75-63"><a href="#cb75-63" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> aggregate_member <span class="op">{</span></span>
<span id="cb75-64"><a href="#cb75-64" aria-hidden="true" tabindex="-1"></a>        BinaryOp op<span class="op">;</span></span>
<span id="cb75-65"><a href="#cb75-65" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb75-66"><a href="#cb75-66" aria-hidden="true" tabindex="-1"></a>        <span class="kw">template</span><span class="op">&lt;</span>ReflectableRange Range<span class="op">&gt;</span></span>
<span id="cb75-67"><a href="#cb75-67" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> <span class="kw">operator</span><span class="op">()(</span>Range<span class="op">&amp;&amp;</span> range<span class="op">)</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="cb75-68"><a href="#cb75-68" aria-hidden="true" tabindex="-1"></a>            <span class="kw">using</span> <span class="dt">member_type</span> <span class="op">=</span> <span class="bu">std::</span>meta::get_type_t<span class="op">&lt;</span>Member<span class="op">&gt;;</span></span>
<span id="cb75-69"><a href="#cb75-69" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb75-70"><a href="#cb75-70" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span><span class="bu">std::</span>ranges::empty<span class="op">(</span>range<span class="op">))</span> <span class="op">{</span></span>
<span id="cb75-71"><a href="#cb75-71" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="dt">member_type</span><span class="op">{};</span></span>
<span id="cb75-72"><a href="#cb75-72" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb75-73"><a href="#cb75-73" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb75-74"><a href="#cb75-74" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> first <span class="op">=</span> <span class="bu">std::</span>ranges::begin<span class="op">(</span>range<span class="op">);</span></span>
<span id="cb75-75"><a href="#cb75-75" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> init <span class="op">=</span> <span class="op">(*</span>first<span class="op">).*</span><span class="bu">std::</span>meta::get_pointer_v<span class="op">&lt;</span>Member<span class="op">&gt;;</span></span>
<span id="cb75-76"><a href="#cb75-76" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb75-77"><a href="#cb75-77" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">std::</span>ranges::fold_left<span class="op">(</span></span>
<span id="cb75-78"><a href="#cb75-78" aria-hidden="true" tabindex="-1"></a>                range <span class="op">|</span> <span class="bu">std::</span>views::drop<span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">|</span> <span class="bu">std::</span>views::transform<span class="op">(</span>extract<span class="op">&lt;</span>Member<span class="op">&gt;),</span></span>
<span id="cb75-79"><a href="#cb75-79" aria-hidden="true" tabindex="-1"></a>                init<span class="op">,</span></span>
<span id="cb75-80"><a href="#cb75-80" aria-hidden="true" tabindex="-1"></a>                op</span>
<span id="cb75-81"><a href="#cb75-81" aria-hidden="true" tabindex="-1"></a>            <span class="op">);</span></span>
<span id="cb75-82"><a href="#cb75-82" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb75-83"><a href="#cb75-83" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb75-84"><a href="#cb75-84" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-85"><a href="#cb75-85" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">auto</span> Member<span class="op">,</span> <span class="kw">typename</span> BinaryOp<span class="op">&gt;</span></span>
<span id="cb75-86"><a href="#cb75-86" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> aggregate <span class="op">=</span> <span class="op">[](</span>BinaryOp op<span class="op">)</span> <span class="op">{</span></span>
<span id="cb75-87"><a href="#cb75-87" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> aggregate_member<span class="op">&lt;</span>Member<span class="op">,</span> BinaryOp<span class="op">&gt;{</span>op<span class="op">};</span></span>
<span id="cb75-88"><a href="#cb75-88" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb75-89"><a href="#cb75-89" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb75-90"><a href="#cb75-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-91"><a href="#cb75-91" aria-hidden="true" tabindex="-1"></a><span class="co">// مثال استفاده با range های تقویت شده بازتاب</span></span>
<span id="cb75-92"><a href="#cb75-92" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Employee <span class="op">{</span></span>
<span id="cb75-93"><a href="#cb75-93" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> id<span class="op">;</span></span>
<span id="cb75-94"><a href="#cb75-94" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string name<span class="op">;</span></span>
<span id="cb75-95"><a href="#cb75-95" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string department<span class="op">;</span></span>
<span id="cb75-96"><a href="#cb75-96" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> salary<span class="op">;</span></span>
<span id="cb75-97"><a href="#cb75-97" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> years_experience<span class="op">;</span></span>
<span id="cb75-98"><a href="#cb75-98" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb75-99"><a href="#cb75-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-100"><a href="#cb75-100" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> demonstrate_reflection_ranges<span class="op">()</span> <span class="op">{</span></span>
<span id="cb75-101"><a href="#cb75-101" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span>Employee<span class="op">&gt;</span> employees <span class="op">=</span> <span class="op">{</span></span>
<span id="cb75-102"><a href="#cb75-102" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="st">&quot;Alice&quot;</span><span class="op">,</span> <span class="st">&quot;Engineering&quot;</span><span class="op">,</span> <span class="dv">95000</span><span class="op">,</span> <span class="dv">5</span><span class="op">},</span></span>
<span id="cb75-103"><a href="#cb75-103" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">2</span><span class="op">,</span> <span class="st">&quot;Bob&quot;</span><span class="op">,</span> <span class="st">&quot;Engineering&quot;</span><span class="op">,</span> <span class="dv">87000</span><span class="op">,</span> <span class="dv">3</span><span class="op">},</span></span>
<span id="cb75-104"><a href="#cb75-104" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">3</span><span class="op">,</span> <span class="st">&quot;Carol&quot;</span><span class="op">,</span> <span class="st">&quot;Marketing&quot;</span><span class="op">,</span> <span class="dv">78000</span><span class="op">,</span> <span class="dv">7</span><span class="op">},</span></span>
<span id="cb75-105"><a href="#cb75-105" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">4</span><span class="op">,</span> <span class="st">&quot;David&quot;</span><span class="op">,</span> <span class="st">&quot;Engineering&quot;</span><span class="op">,</span> <span class="dv">102000</span><span class="op">,</span> <span class="dv">8</span><span class="op">},</span></span>
<span id="cb75-106"><a href="#cb75-106" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">5</span><span class="op">,</span> <span class="st">&quot;Eve&quot;</span><span class="op">,</span> <span class="st">&quot;Marketing&quot;</span><span class="op">,</span> <span class="dv">83000</span><span class="op">,</span> <span class="dv">4</span><span class="op">}</span></span>
<span id="cb75-107"><a href="#cb75-107" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb75-108"><a href="#cb75-108" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-109"><a href="#cb75-109" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> <span class="kw">namespace</span> ranges<span class="op">::</span>reflection<span class="op">;</span></span>
<span id="cb75-110"><a href="#cb75-110" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-111"><a href="#cb75-111" aria-hidden="true" tabindex="-1"></a>    <span class="co">// استخراج تمام حقوق‌ها</span></span>
<span id="cb75-112"><a href="#cb75-112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> salaries <span class="op">=</span> employees </span>
<span id="cb75-113"><a href="#cb75-113" aria-hidden="true" tabindex="-1"></a>                  <span class="op">|</span> <span class="bu">std::</span>views::transform<span class="op">(</span>extract<span class="op">&lt;&amp;</span>Employee<span class="op">::</span>salary<span class="op">&gt;)</span></span>
<span id="cb75-114"><a href="#cb75-114" aria-hidden="true" tabindex="-1"></a>                  <span class="op">|</span> <span class="bu">std::</span>ranges::to<span class="op">&lt;</span><span class="bu">std::</span>vector<span class="op">&gt;();</span></span>
<span id="cb75-115"><a href="#cb75-115" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-116"><a href="#cb75-116" aria-hidden="true" tabindex="-1"></a>    <span class="co">// فیلتر کسانی با درآمد بالا</span></span>
<span id="cb75-117"><a href="#cb75-117" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> high_earners <span class="op">=</span> employees </span>
<span id="cb75-118"><a href="#cb75-118" aria-hidden="true" tabindex="-1"></a>                      <span class="op">|</span> <span class="bu">std::</span>views::filter<span class="op">(</span>filter_by<span class="op">&lt;&amp;</span>Employee<span class="op">::</span>salary<span class="op">&gt;([](</span><span class="dt">double</span> s<span class="op">)</span> <span class="op">{</span> </span>
<span id="cb75-119"><a href="#cb75-119" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">return</span> s <span class="op">&gt;</span> <span class="dv">90000</span><span class="op">;</span> </span>
<span id="cb75-120"><a href="#cb75-120" aria-hidden="true" tabindex="-1"></a>                        <span class="op">}))</span></span>
<span id="cb75-121"><a href="#cb75-121" aria-hidden="true" tabindex="-1"></a>                      <span class="op">|</span> <span class="bu">std::</span>ranges::to<span class="op">&lt;</span><span class="bu">std::</span>vector<span class="op">&gt;();</span></span>
<span id="cb75-122"><a href="#cb75-122" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-123"><a href="#cb75-123" aria-hidden="true" tabindex="-1"></a>    <span class="co">// گروه‌بندی بر اساس بخش</span></span>
<span id="cb75-124"><a href="#cb75-124" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> by_department <span class="op">=</span> employees <span class="op">|</span> group_by<span class="op">&lt;&amp;</span>Employee<span class="op">::</span>department<span class="op">&gt;;</span></span>
<span id="cb75-125"><a href="#cb75-125" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-126"><a href="#cb75-126" aria-hidden="true" tabindex="-1"></a>    <span class="co">// محاسبه کل حقوق بر اساس بخش</span></span>
<span id="cb75-127"><a href="#cb75-127" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> <span class="op">[</span>dept<span class="op">,</span> emps<span class="op">]</span> <span class="op">:</span> by_department<span class="op">)</span> <span class="op">{</span></span>
<span id="cb75-128"><a href="#cb75-128" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> total_salary <span class="op">=</span> emps <span class="op">|</span> aggregate<span class="op">&lt;&amp;</span>Employee<span class="op">::</span>salary<span class="op">&gt;(</span><span class="bu">std::</span>plus<span class="op">{});</span></span>
<span id="cb75-129"><a href="#cb75-129" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> dept <span class="op">&lt;&lt;</span> <span class="st">&quot;: $&quot;</span> <span class="op">&lt;&lt;</span> total_salary <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span>
<span id="cb75-130"><a href="#cb75-130" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb75-131"><a href="#cb75-131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-132"><a href="#cb75-132" aria-hidden="true" tabindex="-1"></a>    <span class="co">// میانگین سال‌های تجربه برای مهندسان</span></span>
<span id="cb75-133"><a href="#cb75-133" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> engineers <span class="op">=</span> by_department<span class="op">[</span><span class="st">&quot;Engineering&quot;</span><span class="op">];</span></span>
<span id="cb75-134"><a href="#cb75-134" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> avg_experience <span class="op">=</span> <span class="kw">static_cast</span><span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;(</span></span>
<span id="cb75-135"><a href="#cb75-135" aria-hidden="true" tabindex="-1"></a>        engineers <span class="op">|</span> aggregate<span class="op">&lt;&amp;</span>Employee<span class="op">::</span>years_experience<span class="op">&gt;(</span><span class="bu">std::</span>plus<span class="op">{})</span></span>
<span id="cb75-136"><a href="#cb75-136" aria-hidden="true" tabindex="-1"></a>    <span class="op">)</span> <span class="op">/</span> engineers<span class="op">.</span>size<span class="op">();</span></span>
<span id="cb75-137"><a href="#cb75-137" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-138"><a href="#cb75-138" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">&quot;Average engineering experience: &quot;</span> <span class="op">&lt;&lt;</span> avg_experience <span class="op">&lt;&lt;</span> <span class="st">&quot; years&quot;</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span>
<span id="cb75-139"><a href="#cb75-139" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="2.34.2" id="تولید-خودکار-آداپتور-range"><span
class="header-section-number">2.34.2</span> 7.4.2 تولید خودکار آداپتور
Range</h3>
<p>بازتاب می‌تواند آداپتورهای range سفارشی بر اساس ساختار نوع تولید کند
[125]:</p>
<div class="sourceCode" id="cb76"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">// تولید خودکار آداپتور range با استفاده از بازتاب</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> reflected_range_adapters <span class="op">{</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span>Reflectable<span class="op">&lt;</span>T<span class="op">&gt;);</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید view های مقایسه عضو به عضو</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">auto</span> Member<span class="op">&gt;</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="kw">auto</span> equal_to<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>meta::get_type_t<span class="op">&lt;</span>Member<span class="op">&gt;&amp;</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">std::</span>views::filter<span class="op">([</span>value<span class="op">](</span><span class="at">const</span> T<span class="op">&amp;</span> obj<span class="op">)</span> <span class="op">{</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> obj<span class="op">.*</span><span class="bu">std::</span>meta::get_pointer_v<span class="op">&lt;</span>Member<span class="op">&gt;</span> <span class="op">==</span> value<span class="op">;</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">});</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">auto</span> Member<span class="op">&gt;</span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="kw">auto</span> greater_than<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>meta::get_type_t<span class="op">&lt;</span>Member<span class="op">&gt;&amp;</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">std::</span>views::filter<span class="op">([</span>value<span class="op">](</span><span class="at">const</span> T<span class="op">&amp;</span> obj<span class="op">)</span> <span class="op">{</span></span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> obj<span class="op">.*</span><span class="bu">std::</span>meta::get_pointer_v<span class="op">&lt;</span>Member<span class="op">&gt;</span> <span class="op">&gt;</span> value<span class="op">;</span></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">});</span></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید view های مرتب‌سازی</span></span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">auto</span> Member<span class="op">&gt;</span></span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="kw">auto</span> sort_by_ascending<span class="op">()</span> <span class="op">{</span></span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">[](</span><span class="kw">auto</span><span class="op">&amp;&amp;</span> range<span class="op">)</span> <span class="op">{</span></span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> sorted <span class="op">=</span> range <span class="op">|</span> <span class="bu">std::</span>ranges::to<span class="op">&lt;</span><span class="bu">std::</span>vector<span class="op">&gt;();</span></span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>ranges::sort<span class="op">(</span>sorted<span class="op">,</span> <span class="op">[](</span><span class="at">const</span> T<span class="op">&amp;</span> a<span class="op">,</span> <span class="at">const</span> T<span class="op">&amp;</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="op">(</span>a<span class="op">.*</span><span class="bu">std::</span>meta::get_pointer_v<span class="op">&lt;</span>Member<span class="op">&gt;)</span> <span class="op">&lt;</span> </span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a>                       <span class="op">(</span>b<span class="op">.*</span><span class="bu">std::</span>meta::get_pointer_v<span class="op">&lt;</span>Member<span class="op">&gt;);</span></span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a>            <span class="op">});</span></span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> sorted<span class="op">;</span></span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-35"><a href="#cb76-35" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید view های projection برای تمام اعضا</span></span>
<span id="cb76-36"><a href="#cb76-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="kw">auto</span> project_all_members<span class="op">()</span> <span class="op">{</span></span>
<span id="cb76-37"><a href="#cb76-37" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb76-38"><a href="#cb76-38" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> members <span class="op">=</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>meta<span class="op">);</span></span>
<span id="cb76-39"><a href="#cb76-39" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb76-40"><a href="#cb76-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">[](</span><span class="at">const</span> T<span class="op">&amp;</span> obj<span class="op">)</span> <span class="op">{</span></span>
<span id="cb76-41"><a href="#cb76-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">std::</span>make_tuple<span class="op">(</span></span>
<span id="cb76-42"><a href="#cb76-42" aria-hidden="true" tabindex="-1"></a>                obj<span class="op">.*</span><span class="bu">std::</span>meta::get_pointer_v<span class="op">&lt;</span></span>
<span id="cb76-43"><a href="#cb76-43" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">std::</span>meta::get_element_v<span class="op">&lt;</span><span class="dv">0</span><span class="op">,</span> <span class="kw">decltype</span><span class="op">(</span>members<span class="op">)&gt;&gt;..</span></span>
<span id="cb76-44"><a href="#cb76-44" aria-hidden="true" tabindex="-1"></a>            <span class="op">);</span></span>
<span id="cb76-45"><a href="#cb76-45" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb76-46"><a href="#cb76-46" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb76-47"><a href="#cb76-47" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb76-48"><a href="#cb76-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-49"><a href="#cb76-49" aria-hidden="true" tabindex="-1"></a><span class="co">// مثال استفاده</span></span>
<span id="cb76-50"><a href="#cb76-50" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> demonstrate_automatic_adapters<span class="op">()</span> <span class="op">{</span></span>
<span id="cb76-51"><a href="#cb76-51" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span>Employee<span class="op">&gt;</span> employees <span class="op">=</span> <span class="co">/* ... */</span><span class="op">;</span></span>
<span id="cb76-52"><a href="#cb76-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-53"><a href="#cb76-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> adapters <span class="op">=</span> reflected_range_adapters<span class="op">&lt;</span>Employee<span class="op">&gt;;</span></span>
<span id="cb76-54"><a href="#cb76-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-55"><a href="#cb76-55" aria-hidden="true" tabindex="-1"></a>    <span class="co">// استفاده از آداپتورهای تولید شده</span></span>
<span id="cb76-56"><a href="#cb76-56" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> high_salary <span class="op">=</span> employees </span>
<span id="cb76-57"><a href="#cb76-57" aria-hidden="true" tabindex="-1"></a>                     <span class="op">|</span> adapters<span class="op">::</span>greater_than<span class="op">&lt;&amp;</span>Employee<span class="op">::</span>salary<span class="op">&gt;(</span><span class="dv">90000</span><span class="op">)</span></span>
<span id="cb76-58"><a href="#cb76-58" aria-hidden="true" tabindex="-1"></a>                     <span class="op">|</span> <span class="bu">std::</span>ranges::to<span class="op">&lt;</span><span class="bu">std::</span>vector<span class="op">&gt;();</span></span>
<span id="cb76-59"><a href="#cb76-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-60"><a href="#cb76-60" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> engineers <span class="op">=</span> employees </span>
<span id="cb76-61"><a href="#cb76-61" aria-hidden="true" tabindex="-1"></a>                   <span class="op">|</span> adapters<span class="op">::</span>equal_to<span class="op">&lt;&amp;</span>Employee<span class="op">::</span>department<span class="op">&gt;(</span><span class="st">&quot;Engineering&quot;</span><span class="op">)</span></span>
<span id="cb76-62"><a href="#cb76-62" aria-hidden="true" tabindex="-1"></a>                   <span class="op">|</span> <span class="bu">std::</span>ranges::to<span class="op">&lt;</span><span class="bu">std::</span>vector<span class="op">&gt;();</span></span>
<span id="cb76-63"><a href="#cb76-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-64"><a href="#cb76-64" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> sorted_by_experience <span class="op">=</span> employees </span>
<span id="cb76-65"><a href="#cb76-65" aria-hidden="true" tabindex="-1"></a>                              <span class="op">|</span> adapters<span class="op">::</span>sort_by_ascending<span class="op">&lt;&amp;</span>Employee<span class="op">::</span>years_experience<span class="op">&gt;()</span></span>
<span id="cb76-66"><a href="#cb76-66" aria-hidden="true" tabindex="-1"></a>                              <span class="op">|</span> <span class="bu">std::</span>ranges::to<span class="op">&lt;</span><span class="bu">std::</span>vector<span class="op">&gt;();</span></span>
<span id="cb76-67"><a href="#cb76-67" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 data-number="2.35" id="الگوهای-یکپارچگی-کتابخانه-استاندارد"><span
class="header-section-number">2.35</span> 7.5 الگوهای یکپارچگی کتابخانه
استاندارد</h2>
<h3 data-number="2.35.1" id="کانتینرهای-آگاه-به-بازتاب"><span
class="header-section-number">2.35.1</span> 7.5.1 کانتینرهای آگاه به
بازتاب</h3>
<p>کانتینرهای کتابخانه استاندارد می‌توانند با عملکرد مبتنی بر بازتاب
تقویت شوند [126]:</p>
<div class="sourceCode" id="cb77"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co">// vector تقویت شده بازتاب با عملیات خودکار</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span>Reflectable T<span class="op">&gt;</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> reflected_vector <span class="op">:</span> <span class="kw">public</span> <span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> base <span class="op">=</span> <span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;;</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> base<span class="op">::</span>base<span class="op">;</span>  <span class="co">// ارث‌بری سازنده‌ها</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// سریال‌سازی خودکار برای کل کانتینر</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string to_json<span class="op">()</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>ostringstream json<span class="op">;</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>        json <span class="op">&lt;&lt;</span> <span class="st">&quot;[&quot;</span><span class="op">;</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">bool</span> first <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> item <span class="op">:</span> <span class="op">*</span><span class="kw">this</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(!</span>first<span class="op">)</span> json <span class="op">&lt;&lt;</span> <span class="st">&quot;,&quot;</span><span class="op">;</span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>            first <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>            json <span class="op">&lt;&lt;</span> reflect_serialize<span class="op">(</span>item<span class="op">);</span></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>        json <span class="op">&lt;&lt;</span> <span class="st">&quot;]&quot;</span><span class="op">;</span></span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> json<span class="op">.</span>str<span class="op">();</span></span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">// فیلتر خودکار توسط هر عضو</span></span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">auto</span> Member<span class="op">,</span> <span class="kw">typename</span> Predicate<span class="op">&gt;</span></span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a>    reflected_vector filter_by<span class="op">(</span>Predicate pred<span class="op">)</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a>        reflected_vector result<span class="op">;</span></span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>ranges::copy_if<span class="op">(*</span><span class="kw">this</span><span class="op">,</span> <span class="bu">std::</span>back_inserter<span class="op">(</span>result<span class="op">),</span></span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">[</span>pred<span class="op">](</span><span class="at">const</span> T<span class="op">&amp;</span> item<span class="op">)</span> <span class="op">{</span></span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> pred<span class="op">(</span>item<span class="op">.*</span><span class="bu">std::</span>meta::get_pointer_v<span class="op">&lt;</span>Member<span class="op">&gt;);</span></span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb77-37"><a href="#cb77-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb77-38"><a href="#cb77-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-39"><a href="#cb77-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">// گروه‌بندی خودکار توسط هر عضو</span></span>
<span id="cb77-40"><a href="#cb77-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">auto</span> Member<span class="op">&gt;</span></span>
<span id="cb77-41"><a href="#cb77-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> group_by<span class="op">()</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="cb77-42"><a href="#cb77-42" aria-hidden="true" tabindex="-1"></a>        <span class="kw">using</span> <span class="dt">key_type</span> <span class="op">=</span> <span class="bu">std::</span>meta::get_type_t<span class="op">&lt;</span>Member<span class="op">&gt;;</span></span>
<span id="cb77-43"><a href="#cb77-43" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>map<span class="op">&lt;</span><span class="dt">key_type</span><span class="op">,</span> reflected_vector<span class="op">&gt;</span> groups<span class="op">;</span></span>
<span id="cb77-44"><a href="#cb77-44" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb77-45"><a href="#cb77-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> item <span class="op">:</span> <span class="op">*</span><span class="kw">this</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb77-46"><a href="#cb77-46" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> key <span class="op">=</span> item<span class="op">.*</span><span class="bu">std::</span>meta::get_pointer_v<span class="op">&lt;</span>Member<span class="op">&gt;;</span></span>
<span id="cb77-47"><a href="#cb77-47" aria-hidden="true" tabindex="-1"></a>            groups<span class="op">[</span>key<span class="op">].</span>push_back<span class="op">(</span>item<span class="op">);</span></span>
<span id="cb77-48"><a href="#cb77-48" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb77-49"><a href="#cb77-49" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb77-50"><a href="#cb77-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> groups<span class="op">;</span></span>
<span id="cb77-51"><a href="#cb77-51" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb77-52"><a href="#cb77-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-53"><a href="#cb77-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">// استخراج خودکار عضو</span></span>
<span id="cb77-54"><a href="#cb77-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">auto</span> Member<span class="op">&gt;</span></span>
<span id="cb77-55"><a href="#cb77-55" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> extract_member<span class="op">()</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="cb77-56"><a href="#cb77-56" aria-hidden="true" tabindex="-1"></a>        <span class="kw">using</span> <span class="dt">member_type</span> <span class="op">=</span> <span class="bu">std::</span>meta::get_type_t<span class="op">&lt;</span>Member<span class="op">&gt;;</span></span>
<span id="cb77-57"><a href="#cb77-57" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">member_type</span><span class="op">&gt;</span> result<span class="op">;</span></span>
<span id="cb77-58"><a href="#cb77-58" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb77-59"><a href="#cb77-59" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>ranges::transform<span class="op">(*</span><span class="kw">this</span><span class="op">,</span> <span class="bu">std::</span>back_inserter<span class="op">(</span>result<span class="op">),</span></span>
<span id="cb77-60"><a href="#cb77-60" aria-hidden="true" tabindex="-1"></a>            <span class="op">[](</span><span class="at">const</span> T<span class="op">&amp;</span> item<span class="op">)</span> <span class="op">{</span></span>
<span id="cb77-61"><a href="#cb77-61" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> item<span class="op">.*</span><span class="bu">std::</span>meta::get_pointer_v<span class="op">&lt;</span>Member<span class="op">&gt;;</span></span>
<span id="cb77-62"><a href="#cb77-62" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb77-63"><a href="#cb77-63" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb77-64"><a href="#cb77-64" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb77-65"><a href="#cb77-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb77-66"><a href="#cb77-66" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb77-67"><a href="#cb77-67" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-68"><a href="#cb77-68" aria-hidden="true" tabindex="-1"></a>    <span class="co">// جستجوی خودکار با معیارهای عضو</span></span>
<span id="cb77-69"><a href="#cb77-69" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">auto</span> Member<span class="op">&gt;</span></span>
<span id="cb77-70"><a href="#cb77-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> find_by<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>meta::get_type_t<span class="op">&lt;</span>Member<span class="op">&gt;&amp;</span> value<span class="op">)</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="cb77-71"><a href="#cb77-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">std::</span>ranges::find_if<span class="op">(*</span><span class="kw">this</span><span class="op">,</span> <span class="op">[</span>value<span class="op">](</span><span class="at">const</span> T<span class="op">&amp;</span> item<span class="op">)</span> <span class="op">{</span></span>
<span id="cb77-72"><a href="#cb77-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> item<span class="op">.*</span><span class="bu">std::</span>meta::get_pointer_v<span class="op">&lt;</span>Member<span class="op">&gt;</span> <span class="op">==</span> value<span class="op">;</span></span>
<span id="cb77-73"><a href="#cb77-73" aria-hidden="true" tabindex="-1"></a>        <span class="op">});</span></span>
<span id="cb77-74"><a href="#cb77-74" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb77-75"><a href="#cb77-75" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb77-76"><a href="#cb77-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-77"><a href="#cb77-77" aria-hidden="true" tabindex="-1"></a><span class="co">// مثال استفاده</span></span>
<span id="cb77-78"><a href="#cb77-78" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> demonstrate_reflected_containers<span class="op">()</span> <span class="op">{</span></span>
<span id="cb77-79"><a href="#cb77-79" aria-hidden="true" tabindex="-1"></a>    reflected_vector<span class="op">&lt;</span>Employee<span class="op">&gt;</span> employees <span class="op">=</span> <span class="op">{</span></span>
<span id="cb77-80"><a href="#cb77-80" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="st">&quot;Alice&quot;</span><span class="op">,</span> <span class="st">&quot;Engineering&quot;</span><span class="op">,</span> <span class="dv">95000</span><span class="op">,</span> <span class="dv">5</span><span class="op">},</span></span>
<span id="cb77-81"><a href="#cb77-81" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">2</span><span class="op">,</span> <span class="st">&quot;Bob&quot;</span><span class="op">,</span> <span class="st">&quot;Engineering&quot;</span><span class="op">,</span> <span class="dv">87000</span><span class="op">,</span> <span class="dv">3</span><span class="op">},</span></span>
<span id="cb77-82"><a href="#cb77-82" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">3</span><span class="op">,</span> <span class="st">&quot;Carol&quot;</span><span class="op">,</span> <span class="st">&quot;Marketing&quot;</span><span class="op">,</span> <span class="dv">78000</span><span class="op">,</span> <span class="dv">7</span><span class="op">}</span></span>
<span id="cb77-83"><a href="#cb77-83" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb77-84"><a href="#cb77-84" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-85"><a href="#cb77-85" aria-hidden="true" tabindex="-1"></a>    <span class="co">// استفاده از عملیات تقویت شده بازتاب</span></span>
<span id="cb77-86"><a href="#cb77-86" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> json_data <span class="op">=</span> employees<span class="op">.</span>to_json<span class="op">();</span></span>
<span id="cb77-87"><a href="#cb77-87" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-88"><a href="#cb77-88" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> high_earners <span class="op">=</span> employees<span class="op">.</span>filter_by<span class="op">&lt;&amp;</span>Employee<span class="op">::</span>salary<span class="op">&gt;(</span></span>
<span id="cb77-89"><a href="#cb77-89" aria-hidden="true" tabindex="-1"></a>        <span class="op">[](</span><span class="dt">double</span> salary<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> salary <span class="op">&gt;</span> <span class="dv">90000</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb77-90"><a href="#cb77-90" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb77-91"><a href="#cb77-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-92"><a href="#cb77-92" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> by_department <span class="op">=</span> employees<span class="op">.</span>group_by<span class="op">&lt;&amp;</span>Employee<span class="op">::</span>department<span class="op">&gt;();</span></span>
<span id="cb77-93"><a href="#cb77-93" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-94"><a href="#cb77-94" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> salaries <span class="op">=</span> employees<span class="op">.</span>extract_member<span class="op">&lt;&amp;</span>Employee<span class="op">::</span>salary<span class="op">&gt;();</span></span>
<span id="cb77-95"><a href="#cb77-95" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-96"><a href="#cb77-96" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> alice <span class="op">=</span> employees<span class="op">.</span>find_by<span class="op">&lt;&amp;</span>Employee<span class="op">::</span>name<span class="op">&gt;(</span><span class="st">&quot;Alice&quot;</span><span class="op">);</span></span>
<span id="cb77-97"><a href="#cb77-97" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>این تحلیل جامع یکپارچگی نشان می‌دهد چگونه بازتاب و متاکلاس‌های C++23 با
سایر ویژگی‌های مدرن C++ هم‌افزایی می‌کنند تا پارادایم‌های برنامه‌نویسی
قدرتمند ایجاد کنند. بخش بعدی چالش‌ها و محدودیت‌های این رویکردها را بررسی
می‌کند.</p>
<hr />
<p><em>[مراجع 117-126 مطابق با مطالعات یکپارچگی concept-بازتاب، الگوهای
تقویت coroutine، سازگاری سیستم module، پسوندهای کتابخانه ranges و
استراتژی‌های یکپارچگی کتابخانه استاندارد فهرست شده در کتابشناسی جامع
ما]</em> # 8. چالش‌ها و محدودیت‌ها</p>
<h2 data-number="2.36" id="پیچیدگی-پیادهسازی-کامپایلر"><span
class="header-section-number">2.36</span> 8.1 پیچیدگی پیاده‌سازی
کامپایلر</h2>
<h3 data-number="2.36.1" id="چالشهای-یکپارچگی-frontend"><span
class="header-section-number">2.36.1</span> 8.1.1 چالش‌های یکپارچگی
Frontend</h3>
<p>پیاده‌سازی بازتاب C++23 در frontend های کامپایلر چالش‌های فنی قابل
توجهی ارائه می‌دهد [127]. برخلاف ویژگی‌های سنتی زبان که روی نحو کاملاً
تعریف شده عمل می‌کنند، بازتاب نیاز به یکپارچگی عمیق با سیستم نوع داخلی
کامپایلر و مراحل تحلیل معنایی دارد.</p>
<p><strong>یکپارچگی جدول نماد:</strong></p>
<div class="sourceCode" id="cb78"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ملاحظات پیاده‌سازی کامپایلر</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> compiler<span class="op">::</span>reflection <span class="op">{</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// بازتاب نیاز به ذخیره‌سازی مداوم meta-object دارد</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> meta_object_registry <span class="op">{</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// باید در مراحل کامپایل باقی بماند</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>unordered_map<span class="op">&lt;</span>type_id<span class="op">,</span> meta_info<span class="op">&gt;</span> <span class="va">type_registry_</span><span class="op">;</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>unordered_map<span class="op">&lt;</span>symbol_id<span class="op">,</span> meta_info<span class="op">&gt;</span> <span class="va">symbol_registry_</span><span class="op">;</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// چالش‌های ثبات بین واحد ترجمه</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>unordered_map<span class="op">&lt;</span>module_id<span class="op">,</span> <span class="bu">std::</span>vector<span class="op">&lt;</span>exported_meta_info<span class="op">&gt;&gt;</span> <span class="va">module_exports_</span><span class="op">;</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ایمنی thread برای کامپایل موازی مورد نیاز است</span></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>        meta_info get_type_info<span class="op">(</span>type_id id<span class="op">)</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// باید زمینه‌های instantiation قالب را مدیریت کند</span></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>        meta_info instantiate_template_meta<span class="op">(</span>template_id id<span class="op">,</span> </span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">const</span> instantiation_args<span class="op">&amp;</span> args<span class="op">);</span></span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ردیابی وابستگی پیچیده برای کامپایل افزایشی</span></span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> register_meta_dependency<span class="op">(</span>meta_info dependent<span class="op">,</span> meta_info dependency<span class="op">);</span></span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// عملیات بازتاب باید با ارزیابی ثابت یکپارچه شوند</span></span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> constexpr_reflection_evaluator <span class="op">{</span></span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a>        <span class="co">// کوئری‌های بازتاب طی ارزیابی ثابت</span></span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a>        constexpr_value evaluate_reflection_query<span class="op">(</span><span class="at">const</span> reflection_expr<span class="op">&amp;</span> expr<span class="op">);</span></span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a>        <span class="co">// expansion بسته پارامتر قالب با بازتاب</span></span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span>constexpr_value<span class="op">&gt;</span> expand_reflected_pack<span class="op">(</span><span class="at">const</span> pack_expr<span class="op">&amp;</span> expr<span class="op">);</span></span>
<span id="cb78-31"><a href="#cb78-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb78-32"><a href="#cb78-32" aria-hidden="true" tabindex="-1"></a>        <span class="co">// جریان داده بین مراحل: constexpr به تولید کد</span></span>
<span id="cb78-33"><a href="#cb78-33" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> register_code_generation_request<span class="op">(</span><span class="at">const</span> metaclass_application<span class="op">&amp;</span> app<span class="op">);</span></span>
<span id="cb78-34"><a href="#cb78-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb78-35"><a href="#cb78-35" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>پیچیدگی Instantiation قالب:</strong> بازتاب به طور قابل توجهی
instantiation قالب را پیچیده می‌کند، چرا که meta-object ها باید طی
instantiation در دسترس باشند در حالی که مدل two-phase lookup را رعایت
کنند [128]:</p>
<div class="sourceCode" id="cb79"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co">// چالش‌های instantiation قالب</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> problematic_template<span class="op">()</span> <span class="op">{</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Meta-object باید طی instantiation در دسترس باشد</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// اما T ممکن است در مرحله اول کامل نباشد</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> members <span class="op">=</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>meta<span class="op">);</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید کد طی instantiation</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::template_for<span class="op">&lt;</span>members<span class="op">&gt;([](</span><span class="kw">auto</span> member<span class="op">)</span> <span class="op">{</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// هر تکرار نیاز به وضعیت تازه کامپایلر دارد</span></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>        generate_code_for_member<span class="op">(</span>member<span class="op">);</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a><span class="co">// کامپایلر باید مدیریت کند:</span></span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. ایجاد تعویق شده meta-object</span></span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. تخصص قالب با بازتاب</span></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. SFINAE با محمول‌های بازتاب</span></span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a><span class="co">// 4. ارزیابی concept با کوئری‌های بازتاب</span></span></code></pre></div>
<h3 data-number="2.36.2" id="چالشهای-تولید-کد-backend"><span
class="header-section-number">2.36.2</span> 8.1.2 چالش‌های تولید کد
Backend</h3>
<p>پیاده‌سازی backend با چالش‌های منحصربفردی در تولید کد کارا از کاربردهای
متاکلاس مبتنی بر بازتاب مواجه است [129]:</p>
<div class="sourceCode" id="cb80"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co">// پیچیدگی تولید کد backend</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> compiler<span class="op">::</span>codegen <span class="op">{</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> metaclass_code_generator <span class="op">{</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">// کد تولید شده باید بدون مشکل با کد موجود یکپارچه شود</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>        llvm<span class="op">::</span>Value<span class="op">*</span> generate_reflection_query<span class="op">(</span><span class="at">const</span> reflection_query<span class="op">&amp;</span> query<span class="op">,</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>                                             llvm<span class="op">::</span>IRBuilder<span class="op">&lt;&gt;&amp;</span> builder<span class="op">);</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Instantiation قالب می‌تواند تولید کد را فعال کند</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> handle_deferred_generation<span class="op">(</span><span class="at">const</span> deferred_generation_request<span class="op">&amp;</span> request<span class="op">);</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// هماهنگی تولید کد بین module ها</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> coordinate_cross_module_generation<span class="op">(</span><span class="at">const</span> module_interface<span class="op">&amp;</span> interface<span class="op">);</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">// حفظ اطلاعات debug برای کد تولید شده</span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> preserve_debug_info<span class="op">(</span><span class="at">const</span> generated_code_section<span class="op">&amp;</span> section<span class="op">,</span></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>                               <span class="at">const</span> source_location<span class="op">&amp;</span> original_location<span class="op">);</span></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// چالش‌های بهینه‌سازی با کد تولید شده</span></span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> reflection_optimizer <span class="op">{</span></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">// حذف کد مرده با بازتاب</span></span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">bool</span> is_reflection_generated_code_reachable<span class="op">(</span><span class="at">const</span> llvm<span class="op">::</span>Function<span class="op">&amp;</span> func<span class="op">);</span></span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تصمیمات inlining برای متدهای تولید شده</span></span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>        <span class="dt">bool</span> should_inline_generated_method<span class="op">(</span><span class="at">const</span> method_info<span class="op">&amp;</span> method<span class="op">);</span></span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">// بهینه‌سازی بین تابع با مرزهای بازتاب</span></span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> optimize_across_reflection_boundaries<span class="op">(</span>llvm<span class="op">::</span>Module<span class="op">&amp;</span> <span class="kw">module</span><span class="op">);</span></span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="2.36.3" id="ملاحظات-کامپایل-افزایشی"><span
class="header-section-number">2.36.3</span> 8.1.3 ملاحظات کامپایل
افزایشی</h3>
<p>بازتاب چالش‌های خاصی برای سیستم‌های کامپایل افزایشی ایجاد می‌کند
[130]:</p>
<div class="sourceCode" id="cb81"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ردیابی وابستگی کامپایل افزایشی</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> build_system <span class="op">{</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> reflection_dependency_tracker <span class="op">{</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">// وابستگی‌های بازتاب پیچیده‌تر از وابستگی‌های سنتی هستند</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> reflection_dependency <span class="op">{</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>            source_file dependent_file<span class="op">;</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>            type_identifier <span class="dt">reflected_type</span><span class="op">;</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>vector<span class="op">&lt;</span>member_identifier<span class="op">&gt;</span> accessed_members<span class="op">;</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>            metaclass_set applied_metaclasses<span class="op">;</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>            <span class="co">// وابستگی‌های انتقالی از طریق بازتاب</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>vector<span class="op">&lt;</span>reflection_dependency<span class="op">&gt;</span> transitive_deps<span class="op">;</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تحلیل تأثیر تغییر با بازتاب</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span>source_file<span class="op">&gt;</span> compute_affected_files<span class="op">(</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> <span class="bu">std::</span>vector<span class="op">&lt;</span>changed_file<span class="op">&gt;&amp;</span> changes<span class="op">)</span> <span class="op">{</span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>vector<span class="op">&lt;</span>source_file<span class="op">&gt;</span> affected<span class="op">;</span></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> change <span class="op">:</span> changes<span class="op">)</span> <span class="op">{</span></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>                <span class="co">// وابسته‌های مستقیم</span></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>                <span class="kw">auto</span> direct <span class="op">=</span> get_direct_dependents<span class="op">(</span>change<span class="op">);</span></span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>                affected<span class="op">.</span>insert<span class="op">(</span>affected<span class="op">.</span>end<span class="op">(),</span> direct<span class="op">.</span>begin<span class="op">(),</span> direct<span class="op">.</span>end<span class="op">());</span></span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>                <span class="co">// وابسته‌های مبتنی بر بازتاب</span></span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a>                <span class="kw">auto</span> reflection_deps <span class="op">=</span> get_reflection_dependents<span class="op">(</span>change<span class="op">);</span></span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a>                affected<span class="op">.</span>insert<span class="op">(</span>affected<span class="op">.</span>end<span class="op">(),</span> reflection_deps<span class="op">.</span>begin<span class="op">(),</span> reflection_deps<span class="op">.</span>end<span class="op">());</span></span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a>                <span class="co">// وابسته‌های کد تولید شده متاکلاس</span></span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a>                <span class="kw">auto</span> generated_deps <span class="op">=</span> get_generated_code_dependents<span class="op">(</span>change<span class="op">);</span></span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a>                affected<span class="op">.</span>insert<span class="op">(</span>affected<span class="op">.</span>end<span class="op">(),</span> generated_deps<span class="op">.</span>begin<span class="op">(),</span> generated_deps<span class="op">.</span>end<span class="op">());</span></span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> affected<span class="op">;</span></span>
<span id="cb81-36"><a href="#cb81-36" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb81-37"><a href="#cb81-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb81-38"><a href="#cb81-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb81-39"><a href="#cb81-39" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تحلیل پیچیده برای تغییرات بازتاب مورد نیاز است</span></span>
<span id="cb81-40"><a href="#cb81-40" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span>source_file<span class="op">&gt;</span> get_reflection_dependents<span class="op">(</span><span class="at">const</span> changed_file<span class="op">&amp;</span> file<span class="op">);</span></span>
<span id="cb81-41"><a href="#cb81-41" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span>source_file<span class="op">&gt;</span> get_generated_code_dependents<span class="op">(</span><span class="at">const</span> changed_file<span class="op">&amp;</span> file<span class="op">);</span></span>
<span id="cb81-42"><a href="#cb81-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb81-43"><a href="#cb81-43" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 data-number="2.37" id="دیباگ-کد-بازتابی"><span
class="header-section-number">2.37</span> 8.2 دیباگ کد بازتابی</h2>
<h3 data-number="2.37.1" id="چالشهای-نگاشت-کد-منبع"><span
class="header-section-number">2.37.1</span> 8.2.1 چالش‌های نگاشت کد
منبع</h3>
<p>دیباگ کدی که از بازتاب و متاکلاس‌های گسترده استفاده می‌کند چالش‌های
منحصربفردی برای نویسندگان کامپایلر و توسعه‌دهندگان کاربرد ارائه می‌دهد
[131]:</p>
<div class="sourceCode" id="cb82"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co">// زیرساخت پشتیبانی دیباگ</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> debugging <span class="op">{</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// نگاشت منبع برای کد تولید شده</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> reflection_debug_info <span class="op">{</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// نگاشت مکان‌های کد تولید شده برگشت به کاربردهای متاکلاس</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> code_provenance <span class="op">{</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>            source_location metaclass_application_site<span class="op">;</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>            source_location original_type_definition<span class="op">;</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>string generation_context<span class="op">;</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>vector<span class="op">&lt;</span>reflection_operation<span class="op">&gt;</span> generation_steps<span class="op">;</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">// اطلاعات debug برای اعضای بازتابی</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> reflected_member_debug_info <span class="op">{</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>string original_name<span class="op">;</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>            source_location definition_site<span class="op">;</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>            type_info <span class="dt">original_type</span><span class="op">;</span></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>vector<span class="op">&lt;</span>attribute<span class="op">&gt;</span> applied_attributes<span class="op">;</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ارائه stack trace معنادار برای کد تولید شده</span></span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span>stack_frame<span class="op">&gt;</span> get_enhanced_stack_trace<span class="op">(</span></span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> <span class="bu">std::</span>vector<span class="op">&lt;</span>raw_stack_frame<span class="op">&gt;&amp;</span> raw_frames<span class="op">)</span> <span class="op">{</span></span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>vector<span class="op">&lt;</span>stack_frame<span class="op">&gt;</span> enhanced<span class="op">;</span></span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> frame <span class="op">:</span> raw_frames<span class="op">)</span> <span class="op">{</span></span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>is_generated_code<span class="op">(</span>frame<span class="op">.</span>address<span class="op">))</span> <span class="op">{</span></span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a>                    <span class="co">// نگاشت برگشت به منبع اصلی</span></span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">auto</span> provenance <span class="op">=</span> get_code_provenance<span class="op">(</span>frame<span class="op">.</span>address<span class="op">);</span></span>
<span id="cb82-32"><a href="#cb82-32" aria-hidden="true" tabindex="-1"></a>                    enhanced<span class="op">.</span>emplace_back<span class="op">(</span>create_enhanced_frame<span class="op">(</span>frame<span class="op">,</span> provenance<span class="op">));</span></span>
<span id="cb82-33"><a href="#cb82-33" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb82-34"><a href="#cb82-34" aria-hidden="true" tabindex="-1"></a>                    enhanced<span class="op">.</span>push_back<span class="op">(</span>frame<span class="op">);</span></span>
<span id="cb82-35"><a href="#cb82-35" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb82-36"><a href="#cb82-36" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb82-37"><a href="#cb82-37" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb82-38"><a href="#cb82-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> enhanced<span class="op">;</span></span>
<span id="cb82-39"><a href="#cb82-39" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb82-40"><a href="#cb82-40" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb82-41"><a href="#cb82-41" aria-hidden="true" tabindex="-1"></a>        <span class="co">// پشتیبانی تنظیم breakpoint در کد تولید شده</span></span>
<span id="cb82-42"><a href="#cb82-42" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span>debug_location<span class="op">&gt;</span> resolve_breakpoint_locations<span class="op">(</span></span>
<span id="cb82-43"><a href="#cb82-43" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> source_location<span class="op">&amp;</span> user_specified_location<span class="op">)</span> <span class="op">{</span></span>
<span id="cb82-44"><a href="#cb82-44" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb82-45"><a href="#cb82-45" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>vector<span class="op">&lt;</span>debug_location<span class="op">&gt;</span> locations<span class="op">;</span></span>
<span id="cb82-46"><a href="#cb82-46" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb82-47"><a href="#cb82-47" aria-hidden="true" tabindex="-1"></a>            <span class="co">// مکان مستقیم</span></span>
<span id="cb82-48"><a href="#cb82-48" aria-hidden="true" tabindex="-1"></a>            locations<span class="op">.</span>push_back<span class="op">(</span>user_specified_location<span class="op">);</span></span>
<span id="cb82-49"><a href="#cb82-49" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb82-50"><a href="#cb82-50" aria-hidden="true" tabindex="-1"></a>            <span class="co">// مکان‌های کد تولید شده که با این منبع مطابقت دارند</span></span>
<span id="cb82-51"><a href="#cb82-51" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> generated <span class="op">=</span> find_generated_locations<span class="op">(</span>user_specified_location<span class="op">);</span></span>
<span id="cb82-52"><a href="#cb82-52" aria-hidden="true" tabindex="-1"></a>            locations<span class="op">.</span>insert<span class="op">(</span>locations<span class="op">.</span>end<span class="op">(),</span> generated<span class="op">.</span>begin<span class="op">(),</span> generated<span class="op">.</span>end<span class="op">());</span></span>
<span id="cb82-53"><a href="#cb82-53" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb82-54"><a href="#cb82-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> locations<span class="op">;</span></span>
<span id="cb82-55"><a href="#cb82-55" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb82-56"><a href="#cb82-56" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb82-57"><a href="#cb82-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-58"><a href="#cb82-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">// یکپارچگی debugger برای بازتاب</span></span>
<span id="cb82-59"><a href="#cb82-59" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> reflection_debugger_support <span class="op">{</span></span>
<span id="cb82-60"><a href="#cb82-60" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb82-61"><a href="#cb82-61" aria-hidden="true" tabindex="-1"></a>        <span class="co">// بازرسی meta-object ها در زمان اجرا برای دیباگ</span></span>
<span id="cb82-62"><a href="#cb82-62" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string format_meta_object<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>meta::info<span class="op">&amp;</span> meta_obj<span class="op">)</span> <span class="op">{</span></span>
<span id="cb82-63"><a href="#cb82-63" aria-hidden="true" tabindex="-1"></a>            <span class="co">// فرمت اطلاعات meta-object برای نمایش debugger</span></span>
<span id="cb82-64"><a href="#cb82-64" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>ostringstream result<span class="op">;</span></span>
<span id="cb82-65"><a href="#cb82-65" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb82-66"><a href="#cb82-66" aria-hidden="true" tabindex="-1"></a>            result <span class="op">&lt;&lt;</span> <span class="st">&quot;Meta-object type: &quot;</span> <span class="op">&lt;&lt;</span> <span class="dt">get_meta_object_type</span><span class="op">(</span>meta_obj<span class="op">)</span> <span class="op">&lt;&lt;</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb82-67"><a href="#cb82-67" aria-hidden="true" tabindex="-1"></a>            result <span class="op">&lt;&lt;</span> <span class="st">&quot;Represented entity: &quot;</span> <span class="op">&lt;&lt;</span> get_represented_entity_name<span class="op">(</span>meta_obj<span class="op">)</span> <span class="op">&lt;&lt;</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb82-68"><a href="#cb82-68" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb82-69"><a href="#cb82-69" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>is_type_meta_object<span class="op">(</span>meta_obj<span class="op">))</span> <span class="op">{</span></span>
<span id="cb82-70"><a href="#cb82-70" aria-hidden="true" tabindex="-1"></a>                format_type_meta_object<span class="op">(</span>result<span class="op">,</span> meta_obj<span class="op">);</span></span>
<span id="cb82-71"><a href="#cb82-71" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>is_member_meta_object<span class="op">(</span>meta_obj<span class="op">))</span> <span class="op">{</span></span>
<span id="cb82-72"><a href="#cb82-72" aria-hidden="true" tabindex="-1"></a>                format_member_meta_object<span class="op">(</span>result<span class="op">,</span> meta_obj<span class="op">);</span></span>
<span id="cb82-73"><a href="#cb82-73" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb82-74"><a href="#cb82-74" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb82-75"><a href="#cb82-75" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> result<span class="op">.</span>str<span class="op">();</span></span>
<span id="cb82-76"><a href="#cb82-76" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb82-77"><a href="#cb82-77" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb82-78"><a href="#cb82-78" aria-hidden="true" tabindex="-1"></a>        <span class="co">// بازرسی متغیر با زمینه بازتاب</span></span>
<span id="cb82-79"><a href="#cb82-79" aria-hidden="true" tabindex="-1"></a>        inspection_result inspect_reflected_variable<span class="op">(</span></span>
<span id="cb82-80"><a href="#cb82-80" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> variable_reference<span class="op">&amp;</span> var_ref<span class="op">)</span> <span class="op">{</span></span>
<span id="cb82-81"><a href="#cb82-81" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb82-82"><a href="#cb82-82" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(!</span><span class="dt">has_reflection_type</span><span class="op">(</span>var_ref<span class="op">))</span> <span class="op">{</span></span>
<span id="cb82-83"><a href="#cb82-83" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> standard_inspection<span class="op">(</span>var_ref<span class="op">);</span></span>
<span id="cb82-84"><a href="#cb82-84" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb82-85"><a href="#cb82-85" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb82-86"><a href="#cb82-86" aria-hidden="true" tabindex="-1"></a>            <span class="co">// بازرسی تقویت شده با استفاده از فراداده بازتاب</span></span>
<span id="cb82-87"><a href="#cb82-87" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> meta <span class="op">=</span> get_reflection_metadata<span class="op">(</span>var_ref<span class="op">);</span></span>
<span id="cb82-88"><a href="#cb82-88" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> enhanced <span class="op">=</span> create_enhanced_inspection<span class="op">(</span>var_ref<span class="op">,</span> meta<span class="op">);</span></span>
<span id="cb82-89"><a href="#cb82-89" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb82-90"><a href="#cb82-90" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> enhanced<span class="op">;</span></span>
<span id="cb82-91"><a href="#cb82-91" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb82-92"><a href="#cb82-92" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb82-93"><a href="#cb82-93" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb82-94"><a href="#cb82-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-95"><a href="#cb82-95" aria-hidden="true" tabindex="-1"></a><span class="co">// مثال سناریو دیباگ</span></span>
<span id="cb82-96"><a href="#cb82-96" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> debug_example<span class="op">()</span> <span class="op">{</span></span>
<span id="cb82-97"><a href="#cb82-97" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> <span class="er">$</span>serializable <span class="er">$</span>observable Person <span class="op">{</span></span>
<span id="cb82-98"><a href="#cb82-98" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string name<span class="op">;</span></span>
<span id="cb82-99"><a href="#cb82-99" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> age<span class="op">;</span></span>
<span id="cb82-100"><a href="#cb82-100" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb82-101"><a href="#cb82-101" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-102"><a href="#cb82-102" aria-hidden="true" tabindex="-1"></a>    Person p<span class="op">{</span><span class="st">&quot;Alice&quot;</span><span class="op">,</span> <span class="dv">30</span><span class="op">};</span></span>
<span id="cb82-103"><a href="#cb82-103" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-104"><a href="#cb82-104" aria-hidden="true" tabindex="-1"></a>    <span class="co">// چالش‌های دیباگ:</span></span>
<span id="cb82-105"><a href="#cb82-105" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 1. تنظیم breakpoint در متد to_json() تولید شده</span></span>
<span id="cb82-106"><a href="#cb82-106" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 2. بازرسی meta-object ها طی دیباگ</span></span>
<span id="cb82-107"><a href="#cb82-107" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 3. درک call stack از طریق کد تولید شده</span></span>
<span id="cb82-108"><a href="#cb82-108" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 4. بازرسی متغیر با اعضای تولید شده</span></span>
<span id="cb82-109"><a href="#cb82-109" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-110"><a href="#cb82-110" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> json <span class="op">=</span> p<span class="op">.</span>to_json<span class="op">();</span>  <span class="co">// متد تولید شده - نیاز به پشتیبانی دیباگ</span></span>
<span id="cb82-111"><a href="#cb82-111" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="2.37.2" id="چالشهای-یکپارچگی-ide"><span
class="header-section-number">2.37.2</span> 8.2.2 چالش‌های یکپارچگی
IDE</h3>
<p>IDE های مدرن باید برای ارائه پشتیبانی مناسب از کد مبتنی بر بازتاب
تقویت شوند [132]:</p>
<div class="sourceCode" id="cb83"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co">// الزامات یکپارچگی IDE</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> ide_support <span class="op">{</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> reflection_language_server <span class="op">{</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تکمیل کد برای عملیات بازتاب</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span>completion_item<span class="op">&gt;</span> get_reflection_completions<span class="op">(</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> source_position<span class="op">&amp;</span> cursor_position<span class="op">,</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> compilation_context<span class="op">&amp;</span> context<span class="op">)</span> <span class="op">{</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>vector<span class="op">&lt;</span>completion_item<span class="op">&gt;</span> completions<span class="op">;</span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>            <span class="co">// اگر cursor بعد از reflexpr( است</span></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>in_reflexpr_context<span class="op">(</span>cursor_position<span class="op">))</span> <span class="op">{</span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>                <span class="kw">auto</span> available_types <span class="op">=</span> get_available_types<span class="op">(</span>context<span class="op">);</span></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> type <span class="op">:</span> available_types<span class="op">)</span> <span class="op">{</span></span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>                    completions<span class="op">.</span>emplace_back<span class="op">(</span>create_type_completion<span class="op">(</span>type<span class="op">));</span></span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>            <span class="co">// اگر cursor بعد از نقطه meta object است</span></span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>in_meta_object_member_access<span class="op">(</span>cursor_position<span class="op">))</span> <span class="op">{</span></span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a>                <span class="kw">auto</span> <span class="dt">meta_obj_type</span> <span class="op">=</span> <span class="dt">infer_meta_object_type</span><span class="op">(</span>cursor_position<span class="op">,</span> context<span class="op">);</span></span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a>                <span class="kw">auto</span> available_operations <span class="op">=</span> get_meta_operations<span class="op">(</span><span class="dt">meta_obj_type</span><span class="op">);</span></span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> op <span class="op">:</span> available_operations<span class="op">)</span> <span class="op">{</span></span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a>                    completions<span class="op">.</span>emplace_back<span class="op">(</span>create_operation_completion<span class="op">(</span>op<span class="op">));</span></span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb83-29"><a href="#cb83-29" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb83-30"><a href="#cb83-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> completions<span class="op">;</span></span>
<span id="cb83-31"><a href="#cb83-31" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb83-32"><a href="#cb83-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb83-33"><a href="#cb83-33" aria-hidden="true" tabindex="-1"></a>        <span class="co">// go-to-definition برای کد تولید شده</span></span>
<span id="cb83-34"><a href="#cb83-34" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span>definition_location<span class="op">&gt;</span> find_definitions<span class="op">(</span></span>
<span id="cb83-35"><a href="#cb83-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> source_position<span class="op">&amp;</span> position<span class="op">,</span></span>
<span id="cb83-36"><a href="#cb83-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> compilation_context<span class="op">&amp;</span> context<span class="op">)</span> <span class="op">{</span></span>
<span id="cb83-37"><a href="#cb83-37" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb83-38"><a href="#cb83-38" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>vector<span class="op">&lt;</span>definition_location<span class="op">&gt;</span> definitions<span class="op">;</span></span>
<span id="cb83-39"><a href="#cb83-39" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb83-40"><a href="#cb83-40" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> symbol <span class="op">=</span> get_symbol_at_position<span class="op">(</span>position<span class="op">);</span></span>
<span id="cb83-41"><a href="#cb83-41" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb83-42"><a href="#cb83-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>is_generated_symbol<span class="op">(</span>symbol<span class="op">))</span> <span class="op">{</span></span>
<span id="cb83-43"><a href="#cb83-43" aria-hidden="true" tabindex="-1"></a>                <span class="co">// پیدا کردن کاربرد متاکلاس که این نماد را تولید کرده</span></span>
<span id="cb83-44"><a href="#cb83-44" aria-hidden="true" tabindex="-1"></a>                <span class="kw">auto</span> generator <span class="op">=</span> find_generating_metaclass<span class="op">(</span>symbol<span class="op">);</span></span>
<span id="cb83-45"><a href="#cb83-45" aria-hidden="true" tabindex="-1"></a>                definitions<span class="op">.</span>push_back<span class="op">(</span>generator<span class="op">.</span>application_site<span class="op">);</span></span>
<span id="cb83-46"><a href="#cb83-46" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb83-47"><a href="#cb83-47" aria-hidden="true" tabindex="-1"></a>                <span class="co">// همچنین تعریف نوع اصلی را نشان دهید</span></span>
<span id="cb83-48"><a href="#cb83-48" aria-hidden="true" tabindex="-1"></a>                definitions<span class="op">.</span>push_back<span class="op">(</span>generator<span class="op">.</span>original_definition<span class="op">);</span></span>
<span id="cb83-49"><a href="#cb83-49" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb83-50"><a href="#cb83-50" aria-hidden="true" tabindex="-1"></a>                <span class="co">// جستجوی تعریف استاندارد</span></span>
<span id="cb83-51"><a href="#cb83-51" aria-hidden="true" tabindex="-1"></a>                definitions <span class="op">=</span> standard_find_definitions<span class="op">(</span>position<span class="op">,</span> context<span class="op">);</span></span>
<span id="cb83-52"><a href="#cb83-52" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb83-53"><a href="#cb83-53" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb83-54"><a href="#cb83-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> definitions<span class="op">;</span></span>
<span id="cb83-55"><a href="#cb83-55" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb83-56"><a href="#cb83-56" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb83-57"><a href="#cb83-57" aria-hidden="true" tabindex="-1"></a>        <span class="co">// اطلاعات hover برای meta-object ها</span></span>
<span id="cb83-58"><a href="#cb83-58" aria-hidden="true" tabindex="-1"></a>        hover_information get_hover_info<span class="op">(</span></span>
<span id="cb83-59"><a href="#cb83-59" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> source_position<span class="op">&amp;</span> position<span class="op">,</span></span>
<span id="cb83-60"><a href="#cb83-60" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> compilation_context<span class="op">&amp;</span> context<span class="op">)</span> <span class="op">{</span></span>
<span id="cb83-61"><a href="#cb83-61" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb83-62"><a href="#cb83-62" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> symbol <span class="op">=</span> get_symbol_at_position<span class="op">(</span>position<span class="op">);</span></span>
<span id="cb83-63"><a href="#cb83-63" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb83-64"><a href="#cb83-64" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>is_meta_object<span class="op">(</span>symbol<span class="op">))</span> <span class="op">{</span></span>
<span id="cb83-65"><a href="#cb83-65" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> create_meta_object_hover<span class="op">(</span>symbol<span class="op">);</span></span>
<span id="cb83-66"><a href="#cb83-66" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>is_generated_symbol<span class="op">(</span>symbol<span class="op">))</span> <span class="op">{</span></span>
<span id="cb83-67"><a href="#cb83-67" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> create_generated_symbol_hover<span class="op">(</span>symbol<span class="op">);</span></span>
<span id="cb83-68"><a href="#cb83-68" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb83-69"><a href="#cb83-69" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> standard_hover_info<span class="op">(</span>position<span class="op">,</span> context<span class="op">);</span></span>
<span id="cb83-70"><a href="#cb83-70" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb83-71"><a href="#cb83-71" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb83-72"><a href="#cb83-72" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb83-73"><a href="#cb83-73" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb83-74"><a href="#cb83-74" aria-hidden="true" tabindex="-1"></a>        hover_information create_meta_object_hover<span class="op">(</span><span class="at">const</span> symbol_info<span class="op">&amp;</span> symbol<span class="op">)</span> <span class="op">{</span></span>
<span id="cb83-75"><a href="#cb83-75" aria-hidden="true" tabindex="-1"></a>            hover_information info<span class="op">;</span></span>
<span id="cb83-76"><a href="#cb83-76" aria-hidden="true" tabindex="-1"></a>            info<span class="op">.</span>type <span class="op">=</span> <span class="st">&quot;Meta-object&quot;</span><span class="op">;</span></span>
<span id="cb83-77"><a href="#cb83-77" aria-hidden="true" tabindex="-1"></a>            info<span class="op">.</span>description <span class="op">=</span> format_meta_object_description<span class="op">(</span>symbol<span class="op">);</span></span>
<span id="cb83-78"><a href="#cb83-78" aria-hidden="true" tabindex="-1"></a>            info<span class="op">.</span>documentation <span class="op">=</span> get_meta_object_documentation<span class="op">(</span>symbol<span class="op">);</span></span>
<span id="cb83-79"><a href="#cb83-79" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> info<span class="op">;</span></span>
<span id="cb83-80"><a href="#cb83-80" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb83-81"><a href="#cb83-81" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb83-82"><a href="#cb83-82" aria-hidden="true" tabindex="-1"></a>        hover_information create_generated_symbol_hover<span class="op">(</span><span class="at">const</span> symbol_info<span class="op">&amp;</span> symbol<span class="op">)</span> <span class="op">{</span></span>
<span id="cb83-83"><a href="#cb83-83" aria-hidden="true" tabindex="-1"></a>            hover_information info<span class="op">;</span></span>
<span id="cb83-84"><a href="#cb83-84" aria-hidden="true" tabindex="-1"></a>            info<span class="op">.</span>type <span class="op">=</span> <span class="st">&quot;Generated Symbol&quot;</span><span class="op">;</span></span>
<span id="cb83-85"><a href="#cb83-85" aria-hidden="true" tabindex="-1"></a>            info<span class="op">.</span>description <span class="op">=</span> format_generated_symbol_description<span class="op">(</span>symbol<span class="op">);</span></span>
<span id="cb83-86"><a href="#cb83-86" aria-hidden="true" tabindex="-1"></a>            info<span class="op">.</span>generation_context <span class="op">=</span> get_generation_context<span class="op">(</span>symbol<span class="op">);</span></span>
<span id="cb83-87"><a href="#cb83-87" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> info<span class="op">;</span></span>
<span id="cb83-88"><a href="#cb83-88" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb83-89"><a href="#cb83-89" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb83-90"><a href="#cb83-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-91"><a href="#cb83-91" aria-hidden="true" tabindex="-1"></a>    <span class="co">// نحو highlighting برای کد بازتاب</span></span>
<span id="cb83-92"><a href="#cb83-92" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> reflection_syntax_highlighter <span class="op">{</span></span>
<span id="cb83-93"><a href="#cb83-93" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb83-94"><a href="#cb83-94" aria-hidden="true" tabindex="-1"></a>        syntax_highlighting_result highlight_reflection_code<span class="op">(</span></span>
<span id="cb83-95"><a href="#cb83-95" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> source_text<span class="op">&amp;</span> text<span class="op">)</span> <span class="op">{</span></span>
<span id="cb83-96"><a href="#cb83-96" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb83-97"><a href="#cb83-97" aria-hidden="true" tabindex="-1"></a>            syntax_highlighting_result result<span class="op">;</span></span>
<span id="cb83-98"><a href="#cb83-98" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb83-99"><a href="#cb83-99" aria-hidden="true" tabindex="-1"></a>            <span class="co">// highlighting عملگرهای reflexpr</span></span>
<span id="cb83-100"><a href="#cb83-100" aria-hidden="true" tabindex="-1"></a>            highlight_reflexpr_operators<span class="op">(</span>text<span class="op">,</span> result<span class="op">);</span></span>
<span id="cb83-101"><a href="#cb83-101" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb83-102"><a href="#cb83-102" aria-hidden="true" tabindex="-1"></a>            <span class="co">// highlighting عملیات meta-object</span></span>
<span id="cb83-103"><a href="#cb83-103" aria-hidden="true" tabindex="-1"></a>            highlight_meta_operations<span class="op">(</span>text<span class="op">,</span> result<span class="op">);</span></span>
<span id="cb83-104"><a href="#cb83-104" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb83-105"><a href="#cb83-105" aria-hidden="true" tabindex="-1"></a>            <span class="co">// highlighting کاربردهای متاکلاس</span></span>
<span id="cb83-106"><a href="#cb83-106" aria-hidden="true" tabindex="-1"></a>            highlight_metaclass_applications<span class="op">(</span>text<span class="op">,</span> result<span class="op">);</span></span>
<span id="cb83-107"><a href="#cb83-107" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb83-108"><a href="#cb83-108" aria-hidden="true" tabindex="-1"></a>            <span class="co">// highlighting نشانگرهای کد تولید شده</span></span>
<span id="cb83-109"><a href="#cb83-109" aria-hidden="true" tabindex="-1"></a>            highlight_generated_code_markers<span class="op">(</span>text<span class="op">,</span> result<span class="op">);</span></span>
<span id="cb83-110"><a href="#cb83-110" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb83-111"><a href="#cb83-111" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb83-112"><a href="#cb83-112" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb83-113"><a href="#cb83-113" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb83-114"><a href="#cb83-114" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 data-number="2.38" id="کیفیت-پیام-خطا"><span
class="header-section-number">2.38</span> 8.3 کیفیت پیام خطا</h2>
<h3 data-number="2.38.1" id="تکثیر-خطای-قالب"><span
class="header-section-number">2.38.1</span> 8.3.1 تکثیر خطای قالب</h3>
<p>در حالی که بازتاب برخی پیچیدگی‌های قالب را کاهش می‌دهد، می‌تواند به
دسته‌های جدیدی از پیام‌های خطای پیچیده نیز منجر شود [133]:</p>
<div class="sourceCode" id="cb84"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co">// سناریوهای خطای پیچیده با بازتاب</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> problematic_reflection_usage<span class="op">()</span> <span class="op">{</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// خطا 1: عملیات نامعتبر meta-object</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> invalid <span class="op">=</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>meta<span class="op">&gt;;</span>  <span class="co">// T ممکن است نام‌دار نباشد</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// خطا 2: تعاملات پیچیده template-بازتاب</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="kw">auto</span> members <span class="op">=</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>meta<span class="op">);</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>meta::template_for<span class="op">&lt;</span>members<span class="op">&gt;([](</span><span class="kw">auto</span> member<span class="op">)</span> <span class="op">{</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// خطاهای قالب تودرتو در حلقه‌های بازتاب</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> <span class="dt">member_type</span> <span class="op">=</span> <span class="bu">std::</span>meta::get_type_t<span class="op">&lt;</span>member<span class="op">&gt;;</span></span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="kw">requires</span> <span class="op">{</span> <span class="kw">typename</span> some_complex_trait<span class="op">&lt;</span><span class="dt">member_type</span><span class="op">&gt;::</span>type<span class="op">;</span> <span class="op">})</span> <span class="op">{</span></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>            <span class="co">// تعاملات پیچیده SFINAE با بازتاب</span></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>            some_complex_operation<span class="op">&lt;</span><span class="dt">member_type</span><span class="op">&gt;();</span></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// خطا 3: نقض محدودیت‌های متاکلاس</span></span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static_assert</span><span class="op">(</span>satisfies_metaclass_constraints<span class="op">&lt;</span>T<span class="op">&gt;(),</span> </span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;Type does not satisfy metaclass requirements&quot;</span><span class="op">);</span></span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a><span class="co">// مثال بهبود پیام خطا مورد نیاز:</span></span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a><span class="co">خطای سنتی:</span></span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a><span class="co">error: no matching function for call to &#39;some_complex_operation&lt;anonymous&gt;&#39;</span></span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a><span class="co">note: candidate template ignored: substitution failure [with T = (lambda at file.cpp:15:42)]</span></span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a><span class="co">note: in instantiation of function template specialization &#39;problematic_reflection_usage&lt;MyClass&gt;&#39; </span></span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a><span class="co">      requested here</span></span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-33"><a href="#cb84-33" aria-hidden="true" tabindex="-1"></a><span class="co">خطای بهبود یافته مطلوب:</span></span>
<span id="cb84-34"><a href="#cb84-34" aria-hidden="true" tabindex="-1"></a><span class="co">error: reflection operation failed in metaclass application</span></span>
<span id="cb84-35"><a href="#cb84-35" aria-hidden="true" tabindex="-1"></a><span class="co">note: while processing member &#39;invalid_member&#39; of type &#39;MyClass&#39;</span></span>
<span id="cb84-36"><a href="#cb84-36" aria-hidden="true" tabindex="-1"></a><span class="co">note: member type &#39;std::unique_ptr&lt;NonSerializable&gt;&#39; does not satisfy serialization constraints</span></span>
<span id="cb84-37"><a href="#cb84-37" aria-hidden="true" tabindex="-1"></a><span class="co">note: consider adding custom serialization for &#39;NonSerializable&#39; or marking member as transient</span></span>
<span id="cb84-38"><a href="#cb84-38" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span></code></pre></div>
<h3 data-number="2.38.2" id="زمینه-خطای-متاکلاس"><span
class="header-section-number">2.38.2</span> 8.3.2 زمینه خطای
متاکلاس</h3>
<p>خطاهای متاکلاس نیاز به گزارش خطای تخصصی برای ارائه بازخورد معنادار
دارند [134]:</p>
<div class="sourceCode" id="cb85"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co">// گزارش خطای تقویت شده برای عملیات متاکلاس</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> error_reporting <span class="op">{</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> metaclass_error_context <span class="op">{</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> error_context_frame <span class="op">{</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>            source_location metaclass_application<span class="op">;</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>string metaclass_name<span class="op">;</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>            source_location target_type_definition<span class="op">;</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>string current_operation<span class="op">;</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>optional<span class="op">&lt;</span>member_info<span class="op">&gt;</span> current_member<span class="op">;</span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span>error_context_frame<span class="op">&gt;</span> <span class="va">context_stack_</span><span class="op">;</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> push_context<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>string<span class="op">&amp;</span> metaclass_name<span class="op">,</span></span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">const</span> source_location<span class="op">&amp;</span> application_site<span class="op">,</span></span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>                         <span class="at">const</span> source_location<span class="op">&amp;</span> target_definition<span class="op">)</span> <span class="op">{</span></span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>            <span class="va">context_stack_</span><span class="op">.</span>emplace_back<span class="op">(</span>error_context_frame<span class="op">{</span></span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>metaclass_application <span class="op">=</span> application_site<span class="op">,</span></span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>metaclass_name <span class="op">=</span> metaclass_name<span class="op">,</span></span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>target_type_definition <span class="op">=</span> target_definition<span class="op">,</span></span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>current_operation <span class="op">=</span> <span class="st">&quot;&quot;</span><span class="op">,</span></span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>current_member <span class="op">=</span> <span class="bu">std::</span>nullopt</span>
<span id="cb85-24"><a href="#cb85-24" aria-hidden="true" tabindex="-1"></a>            <span class="op">});</span></span>
<span id="cb85-25"><a href="#cb85-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb85-26"><a href="#cb85-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb85-27"><a href="#cb85-27" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> set_current_operation<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>string<span class="op">&amp;</span> operation<span class="op">)</span> <span class="op">{</span></span>
<span id="cb85-28"><a href="#cb85-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(!</span><span class="va">context_stack_</span><span class="op">.</span>empty<span class="op">())</span> <span class="op">{</span></span>
<span id="cb85-29"><a href="#cb85-29" aria-hidden="true" tabindex="-1"></a>                <span class="va">context_stack_</span><span class="op">.</span>back<span class="op">().</span>current_operation <span class="op">=</span> operation<span class="op">;</span></span>
<span id="cb85-30"><a href="#cb85-30" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb85-31"><a href="#cb85-31" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb85-32"><a href="#cb85-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb85-33"><a href="#cb85-33" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> set_current_member<span class="op">(</span><span class="at">const</span> member_info<span class="op">&amp;</span> member<span class="op">)</span> <span class="op">{</span></span>
<span id="cb85-34"><a href="#cb85-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(!</span><span class="va">context_stack_</span><span class="op">.</span>empty<span class="op">())</span> <span class="op">{</span></span>
<span id="cb85-35"><a href="#cb85-35" aria-hidden="true" tabindex="-1"></a>                <span class="va">context_stack_</span><span class="op">.</span>back<span class="op">().</span>current_member <span class="op">=</span> member<span class="op">;</span></span>
<span id="cb85-36"><a href="#cb85-36" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb85-37"><a href="#cb85-37" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb85-38"><a href="#cb85-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb85-39"><a href="#cb85-39" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string format_error_message<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>string<span class="op">&amp;</span> base_error<span class="op">)</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="cb85-40"><a href="#cb85-40" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>ostringstream msg<span class="op">;</span></span>
<span id="cb85-41"><a href="#cb85-41" aria-hidden="true" tabindex="-1"></a>            msg <span class="op">&lt;&lt;</span> base_error <span class="op">&lt;&lt;</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb85-42"><a href="#cb85-42" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb85-43"><a href="#cb85-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(!</span><span class="va">context_stack_</span><span class="op">.</span>empty<span class="op">())</span> <span class="op">{</span></span>
<span id="cb85-44"><a href="#cb85-44" aria-hidden="true" tabindex="-1"></a>                <span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> top <span class="op">=</span> <span class="va">context_stack_</span><span class="op">.</span>back<span class="op">();</span></span>
<span id="cb85-45"><a href="#cb85-45" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb85-46"><a href="#cb85-46" aria-hidden="true" tabindex="-1"></a>                msg <span class="op">&lt;&lt;</span> <span class="st">&quot;note: in metaclass &#39;&quot;</span> <span class="op">&lt;&lt;</span> top<span class="op">.</span>metaclass_name <span class="op">&lt;&lt;</span> <span class="st">&quot;&#39; &quot;</span></span>
<span id="cb85-47"><a href="#cb85-47" aria-hidden="true" tabindex="-1"></a>                    <span class="op">&lt;&lt;</span> <span class="st">&quot;applied at &quot;</span> <span class="op">&lt;&lt;</span> format_location<span class="op">(</span>top<span class="op">.</span>metaclass_application<span class="op">)</span> <span class="op">&lt;&lt;</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb85-48"><a href="#cb85-48" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb85-49"><a href="#cb85-49" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(!</span>top<span class="op">.</span>current_operation<span class="op">.</span>empty<span class="op">())</span> <span class="op">{</span></span>
<span id="cb85-50"><a href="#cb85-50" aria-hidden="true" tabindex="-1"></a>                    msg <span class="op">&lt;&lt;</span> <span class="st">&quot;note: while &quot;</span> <span class="op">&lt;&lt;</span> top<span class="op">.</span>current_operation <span class="op">&lt;&lt;</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb85-51"><a href="#cb85-51" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb85-52"><a href="#cb85-52" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb85-53"><a href="#cb85-53" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>top<span class="op">.</span>current_member<span class="op">)</span> <span class="op">{</span></span>
<span id="cb85-54"><a href="#cb85-54" aria-hidden="true" tabindex="-1"></a>                    msg <span class="op">&lt;&lt;</span> <span class="st">&quot;note: processing member &#39;&quot;</span> <span class="op">&lt;&lt;</span> top<span class="op">.</span>current_member<span class="op">-&gt;</span>name </span>
<span id="cb85-55"><a href="#cb85-55" aria-hidden="true" tabindex="-1"></a>                        <span class="op">&lt;&lt;</span> <span class="st">&quot;&#39; of type &#39;&quot;</span> <span class="op">&lt;&lt;</span> top<span class="op">.</span>current_member<span class="op">-&gt;</span>type_name <span class="op">&lt;&lt;</span> <span class="st">&quot;&#39;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb85-56"><a href="#cb85-56" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb85-57"><a href="#cb85-57" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb85-58"><a href="#cb85-58" aria-hidden="true" tabindex="-1"></a>                msg <span class="op">&lt;&lt;</span> <span class="st">&quot;note: target type defined at &quot;</span> </span>
<span id="cb85-59"><a href="#cb85-59" aria-hidden="true" tabindex="-1"></a>                    <span class="op">&lt;&lt;</span> format_location<span class="op">(</span>top<span class="op">.</span>target_type_definition<span class="op">)</span> <span class="op">&lt;&lt;</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb85-60"><a href="#cb85-60" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb85-61"><a href="#cb85-61" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb85-62"><a href="#cb85-62" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> msg<span class="op">.</span>str<span class="op">();</span></span>
<span id="cb85-63"><a href="#cb85-63" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb85-64"><a href="#cb85-64" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb85-65"><a href="#cb85-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-66"><a href="#cb85-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">// زمینه خطای سراسری برای عملیات متاکلاس</span></span>
<span id="cb85-67"><a href="#cb85-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">thread_local</span> metaclass_error_context current_metaclass_context<span class="op">;</span></span>
<span id="cb85-68"><a href="#cb85-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-69"><a href="#cb85-69" aria-hidden="true" tabindex="-1"></a>    <span class="co">// مدیریت زمینه RAII</span></span>
<span id="cb85-70"><a href="#cb85-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> metaclass_operation_scope <span class="op">{</span></span>
<span id="cb85-71"><a href="#cb85-71" aria-hidden="true" tabindex="-1"></a>        <span class="dt">bool</span> <span class="va">context_pushed_</span><span class="op">;</span></span>
<span id="cb85-72"><a href="#cb85-72" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb85-73"><a href="#cb85-73" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb85-74"><a href="#cb85-74" aria-hidden="true" tabindex="-1"></a>        metaclass_operation_scope<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>string<span class="op">&amp;</span> metaclass_name<span class="op">,</span></span>
<span id="cb85-75"><a href="#cb85-75" aria-hidden="true" tabindex="-1"></a>                                <span class="at">const</span> source_location<span class="op">&amp;</span> application_site<span class="op">,</span></span>
<span id="cb85-76"><a href="#cb85-76" aria-hidden="true" tabindex="-1"></a>                                <span class="at">const</span> source_location<span class="op">&amp;</span> target_definition<span class="op">)</span> </span>
<span id="cb85-77"><a href="#cb85-77" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span> <span class="va">context_pushed_</span><span class="op">(</span><span class="kw">true</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb85-78"><a href="#cb85-78" aria-hidden="true" tabindex="-1"></a>            current_metaclass_context<span class="op">.</span>push_context<span class="op">(</span>metaclass_name<span class="op">,</span> application_site<span class="op">,</span> target_definition<span class="op">);</span></span>
<span id="cb85-79"><a href="#cb85-79" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb85-80"><a href="#cb85-80" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb85-81"><a href="#cb85-81" aria-hidden="true" tabindex="-1"></a>        <span class="op">~</span>metaclass_operation_scope<span class="op">()</span> <span class="op">{</span></span>
<span id="cb85-82"><a href="#cb85-82" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span><span class="va">context_pushed_</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb85-83"><a href="#cb85-83" aria-hidden="true" tabindex="-1"></a>                current_metaclass_context<span class="op">.</span>pop_context<span class="op">();</span></span>
<span id="cb85-84"><a href="#cb85-84" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb85-85"><a href="#cb85-85" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb85-86"><a href="#cb85-86" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb85-87"><a href="#cb85-87" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> set_operation<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>string<span class="op">&amp;</span> operation<span class="op">)</span> <span class="op">{</span></span>
<span id="cb85-88"><a href="#cb85-88" aria-hidden="true" tabindex="-1"></a>            current_metaclass_context<span class="op">.</span>set_current_operation<span class="op">(</span>operation<span class="op">);</span></span>
<span id="cb85-89"><a href="#cb85-89" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb85-90"><a href="#cb85-90" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb85-91"><a href="#cb85-91" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> set_member<span class="op">(</span><span class="at">const</span> member_info<span class="op">&amp;</span> member<span class="op">)</span> <span class="op">{</span></span>
<span id="cb85-92"><a href="#cb85-92" aria-hidden="true" tabindex="-1"></a>            current_metaclass_context<span class="op">.</span>set_current_member<span class="op">(</span>member<span class="op">);</span></span>
<span id="cb85-93"><a href="#cb85-93" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb85-94"><a href="#cb85-94" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb85-95"><a href="#cb85-95" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 data-number="2.39" id="منحنی-یادگیری-و-موانع-پذیرش"><span
class="header-section-number">2.39</span> 8.4 منحنی یادگیری و موانع
پذیرش</h2>
<h3 data-number="2.39.1" id="پیچیدگی-مفهومی"><span
class="header-section-number">2.39.1</span> 8.4.1 پیچیدگی مفهومی</h3>
<p>معرفی بازتاب و متاکلاس‌ها پیچیدگی مفهومی قابل توجهی به C++ اضافه می‌کند
[135]:</p>
<div class="sourceCode" id="cb86"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co">// لایه‌های پیچیدگی در کد مبتنی بر بازتاب</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> complexity_analysis <span class="op">{</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// لایه 1: مفاهیم پایه بازتاب</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> basic_reflection_concepts<span class="op">()</span> <span class="op">{</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// توسعه‌دهنده باید بفهمد:</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// - Meta-object ها در مقابل آبجکت‌های معمولی</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// - تمایزات زمان کامپایل در مقابل زمان اجرا  </span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// - زمینه‌های ارزیابی constexpr</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> Example <span class="op">{</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> member<span class="op">;</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>Example<span class="op">);</span>  <span class="co">// ایجاد Meta-object</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> members <span class="op">=</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>meta<span class="op">);</span>  <span class="co">// کوئری‌های Meta-object</span></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> size <span class="op">=</span> <span class="bu">std::</span>meta::get_size_v<span class="op">&lt;</span>members<span class="op">&gt;;</span>  <span class="co">// ارزیابی زمان کامپایل</span></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// لایه 2: تعاملات template-بازتاب  </span></span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> template_reflection_interaction<span class="op">()</span> <span class="op">{</span></span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">// توسعه‌دهنده باید بفهمد:</span></span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>        <span class="co">// - زمان‌بندی instantiation قالب</span></span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">// - دسترسی Meta-object طی instantiation</span></span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">// - SFINAE با محمول‌های بازتاب</span></span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span><span class="bu">std::</span>meta::is_class_v<span class="op">&lt;</span>meta<span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a>            <span class="co">// کامپایل شرطی بر اساس بازتاب</span></span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a>            <span class="dt">process_class_type</span><span class="op">&lt;</span>T<span class="op">&gt;();</span></span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a>            <span class="dt">process_non_class_type</span><span class="op">&lt;</span>T<span class="op">&gt;();</span></span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb86-36"><a href="#cb86-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-37"><a href="#cb86-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">// لایه 3: الگوهای طراحی متاکلاس</span></span>
<span id="cb86-38"><a href="#cb86-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">void</span> advanced_metaclass<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb86-39"><a href="#cb86-39" aria-hidden="true" tabindex="-1"></a>        <span class="co">// توسعه‌دهنده باید بفهمد:</span></span>
<span id="cb86-40"><a href="#cb86-40" aria-hidden="true" tabindex="-1"></a>        <span class="co">// - تکنیک‌های تولید کد</span></span>
<span id="cb86-41"><a href="#cb86-41" aria-hidden="true" tabindex="-1"></a>        <span class="co">// - قوانین ترکیب متاکلاس</span></span>
<span id="cb86-42"><a href="#cb86-42" aria-hidden="true" tabindex="-1"></a>        <span class="co">// - ارتباط بین متاکلاس‌ها</span></span>
<span id="cb86-43"><a href="#cb86-43" aria-hidden="true" tabindex="-1"></a>        <span class="co">// - مدیریت وابستگی</span></span>
<span id="cb86-44"><a href="#cb86-44" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb86-45"><a href="#cb86-45" aria-hidden="true" tabindex="-1"></a>        validate_metaclass_preconditions<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb86-46"><a href="#cb86-46" aria-hidden="true" tabindex="-1"></a>        generate_base_functionality<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb86-47"><a href="#cb86-47" aria-hidden="true" tabindex="-1"></a>        integrate_with_other_metaclasses<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb86-48"><a href="#cb86-48" aria-hidden="true" tabindex="-1"></a>        emit_final_code<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb86-49"><a href="#cb86-49" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb86-50"><a href="#cb86-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-51"><a href="#cb86-51" aria-hidden="true" tabindex="-1"></a>    <span class="co">// لایه 4: یکپارچگی با ویژگی‌های مدرن C++</span></span>
<span id="cb86-52"><a href="#cb86-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span>Reflectable T<span class="op">&gt;</span></span>
<span id="cb86-53"><a href="#cb86-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> create_async_processor<span class="op">()</span> <span class="op">-&gt;</span> <span class="bu">std::</span>generator<span class="op">&lt;</span>processed_result<span class="op">&lt;</span>T<span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb86-54"><a href="#cb86-54" aria-hidden="true" tabindex="-1"></a>        <span class="co">// توسعه‌دهنده باید بفهمد:</span></span>
<span id="cb86-55"><a href="#cb86-55" aria-hidden="true" tabindex="-1"></a>        <span class="co">// - Concept ها + بازتاب</span></span>
<span id="cb86-56"><a href="#cb86-56" aria-hidden="true" tabindex="-1"></a>        <span class="co">// - Coroutine ها + بازتاب  </span></span>
<span id="cb86-57"><a href="#cb86-57" aria-hidden="true" tabindex="-1"></a>        <span class="co">// - Range ها + بازتاب</span></span>
<span id="cb86-58"><a href="#cb86-58" aria-hidden="true" tabindex="-1"></a>        <span class="co">// - Module ها + بازتاب</span></span>
<span id="cb86-59"><a href="#cb86-59" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb86-60"><a href="#cb86-60" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb86-61"><a href="#cb86-61" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb86-62"><a href="#cb86-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> item <span class="op">:</span> get_input_range<span class="op">&lt;</span>T<span class="op">&gt;())</span> <span class="op">{</span></span>
<span id="cb86-63"><a href="#cb86-63" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> processed <span class="op">=</span> <span class="cf">co_await</span> process_with_reflection<span class="op">(</span>item<span class="op">,</span> meta<span class="op">);</span></span>
<span id="cb86-64"><a href="#cb86-64" aria-hidden="true" tabindex="-1"></a>            <span class="cf">co_yield</span> processed<span class="op">;</span></span>
<span id="cb86-65"><a href="#cb86-65" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb86-66"><a href="#cb86-66" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb86-67"><a href="#cb86-67" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="2.39.2" id="استراتژیهای-مهاجرت"><span
class="header-section-number">2.39.2</span> 8.4.2 استراتژی‌های
مهاجرت</h3>
<p>سازمان‌ها با چالش‌های قابل توجهی در مهاجرت کدبیس‌های موجود برای استفاده
از بازتاب مواجه هستند [136]:</p>
<div class="sourceCode" id="cb87"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co">// تحلیل پیچیدگی مهاجرت</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> migration <span class="op">{</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// مرحله 1: ارزیابی کدبیس موجود</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> codebase_analysis <span class="op">{</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> migration_assessment <span class="op">{</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>            <span class="dt">size_t</span> total_types<span class="op">;</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>            <span class="dt">size_t</span> serializable_types<span class="op">;</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">size_t</span> complex_template_hierarchies<span class="op">;</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>            <span class="dt">size_t</span> manual_code_generation_usage<span class="op">;</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>vector<span class="op">&lt;</span>potential_reflection_opportunity<span class="op">&gt;</span> opportunities<span class="op">;</span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>vector<span class="op">&lt;</span>migration_blocker<span class="op">&gt;</span> blockers<span class="op">;</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>        migration_assessment analyze_codebase<span class="op">(</span><span class="at">const</span> codebase<span class="op">&amp;</span> code<span class="op">)</span> <span class="op">{</span></span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>            migration_assessment result<span class="op">;</span></span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>            <span class="co">// شناسایی انواعی که می‌توانند از بازتاب بهره‌مند شوند</span></span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>            result<span class="op">.</span>opportunities <span class="op">=</span> find_reflection_opportunities<span class="op">(</span>code<span class="op">);</span></span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>            <span class="co">// شناسایی موانع مهاجرت</span></span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a>            result<span class="op">.</span>blockers <span class="op">=</span> find_migration_blockers<span class="op">(</span>code<span class="op">);</span></span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span>potential_reflection_opportunity<span class="op">&gt;</span> find_reflection_opportunities<span class="op">(</span></span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> codebase<span class="op">&amp;</span> code<span class="op">)</span> <span class="op">{</span></span>
<span id="cb87-30"><a href="#cb87-30" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-31"><a href="#cb87-31" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>vector<span class="op">&lt;</span>potential_reflection_opportunity<span class="op">&gt;</span> opportunities<span class="op">;</span></span>
<span id="cb87-32"><a href="#cb87-32" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-33"><a href="#cb87-33" aria-hidden="true" tabindex="-1"></a>            <span class="co">// جستجو برای کد سریال‌سازی تکراری</span></span>
<span id="cb87-34"><a href="#cb87-34" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> serialization_patterns <span class="op">=</span> find_serialization_patterns<span class="op">(</span>code<span class="op">);</span></span>
<span id="cb87-35"><a href="#cb87-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> pattern <span class="op">:</span> serialization_patterns<span class="op">)</span> <span class="op">{</span></span>
<span id="cb87-36"><a href="#cb87-36" aria-hidden="true" tabindex="-1"></a>                opportunities<span class="op">.</span>emplace_back<span class="op">(</span>create_serialization_opportunity<span class="op">(</span>pattern<span class="op">));</span></span>
<span id="cb87-37"><a href="#cb87-37" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb87-38"><a href="#cb87-38" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-39"><a href="#cb87-39" aria-hidden="true" tabindex="-1"></a>            <span class="co">// جستجو برای پیاده‌سازی‌های دستی property</span></span>
<span id="cb87-40"><a href="#cb87-40" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> property_patterns <span class="op">=</span> find_property_patterns<span class="op">(</span>code<span class="op">);</span></span>
<span id="cb87-41"><a href="#cb87-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> pattern <span class="op">:</span> property_patterns<span class="op">)</span> <span class="op">{</span></span>
<span id="cb87-42"><a href="#cb87-42" aria-hidden="true" tabindex="-1"></a>                opportunities<span class="op">.</span>emplace_back<span class="op">(</span>create_property_opportunity<span class="op">(</span>pattern<span class="op">));</span></span>
<span id="cb87-43"><a href="#cb87-43" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb87-44"><a href="#cb87-44" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-45"><a href="#cb87-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> opportunities<span class="op">;</span></span>
<span id="cb87-46"><a href="#cb87-46" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb87-47"><a href="#cb87-47" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb87-48"><a href="#cb87-48" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span>migration_blocker<span class="op">&gt;</span> find_migration_blockers<span class="op">(</span><span class="at">const</span> codebase<span class="op">&amp;</span> code<span class="op">)</span> <span class="op">{</span></span>
<span id="cb87-49"><a href="#cb87-49" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>vector<span class="op">&lt;</span>migration_blocker<span class="op">&gt;</span> blockers<span class="op">;</span></span>
<span id="cb87-50"><a href="#cb87-50" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-51"><a href="#cb87-51" aria-hidden="true" tabindex="-1"></a>            <span class="co">// محدودیت‌های نسخه کامپایلر</span></span>
<span id="cb87-52"><a href="#cb87-52" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(!</span>supports_reflection<span class="op">(</span>get_compiler_version<span class="op">()))</span> <span class="op">{</span></span>
<span id="cb87-53"><a href="#cb87-53" aria-hidden="true" tabindex="-1"></a>                blockers<span class="op">.</span>emplace_back<span class="op">(</span>migration_blocker<span class="op">{</span></span>
<span id="cb87-54"><a href="#cb87-54" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>type <span class="op">=</span> <span class="dt">blocker_type</span><span class="op">::</span>compiler_support<span class="op">,</span></span>
<span id="cb87-55"><a href="#cb87-55" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>description <span class="op">=</span> <span class="st">&quot;Compiler does not support C++23 reflection&quot;</span></span>
<span id="cb87-56"><a href="#cb87-56" aria-hidden="true" tabindex="-1"></a>                <span class="op">});</span></span>
<span id="cb87-57"><a href="#cb87-57" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb87-58"><a href="#cb87-58" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-59"><a href="#cb87-59" aria-hidden="true" tabindex="-1"></a>            <span class="co">// متابرنامه‌نویسی قالب پیچیده که مهاجرت آن دشوار است</span></span>
<span id="cb87-60"><a href="#cb87-60" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> complex_templates <span class="op">=</span> find_complex_template_usage<span class="op">(</span>code<span class="op">);</span></span>
<span id="cb87-61"><a href="#cb87-61" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> usage <span class="op">:</span> complex_templates<span class="op">)</span> <span class="op">{</span></span>
<span id="cb87-62"><a href="#cb87-62" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>is_migration_difficult<span class="op">(</span>usage<span class="op">))</span> <span class="op">{</span></span>
<span id="cb87-63"><a href="#cb87-63" aria-hidden="true" tabindex="-1"></a>                    blockers<span class="op">.</span>emplace_back<span class="op">(</span>create_template_migration_blocker<span class="op">(</span>usage<span class="op">));</span></span>
<span id="cb87-64"><a href="#cb87-64" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb87-65"><a href="#cb87-65" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb87-66"><a href="#cb87-66" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-67"><a href="#cb87-67" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> blockers<span class="op">;</span></span>
<span id="cb87-68"><a href="#cb87-68" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb87-69"><a href="#cb87-69" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb87-70"><a href="#cb87-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-71"><a href="#cb87-71" aria-hidden="true" tabindex="-1"></a>    <span class="co">// مرحله 2: استراتژی مهاجرت افزایشی</span></span>
<span id="cb87-72"><a href="#cb87-72" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> incremental_migration_planner <span class="op">{</span></span>
<span id="cb87-73"><a href="#cb87-73" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb87-74"><a href="#cb87-74" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> migration_plan <span class="op">{</span></span>
<span id="cb87-75"><a href="#cb87-75" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>vector<span class="op">&lt;</span>migration_phase<span class="op">&gt;</span> phases<span class="op">;</span></span>
<span id="cb87-76"><a href="#cb87-76" aria-hidden="true" tabindex="-1"></a>            timeline estimated_timeline<span class="op">;</span></span>
<span id="cb87-77"><a href="#cb87-77" aria-hidden="true" tabindex="-1"></a>            resource_requirements resources<span class="op">;</span></span>
<span id="cb87-78"><a href="#cb87-78" aria-hidden="true" tabindex="-1"></a>            risk_assessment risks<span class="op">;</span></span>
<span id="cb87-79"><a href="#cb87-79" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb87-80"><a href="#cb87-80" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb87-81"><a href="#cb87-81" aria-hidden="true" tabindex="-1"></a>        migration_plan create_migration_plan<span class="op">(</span><span class="at">const</span> migration_assessment<span class="op">&amp;</span> assessment<span class="op">)</span> <span class="op">{</span></span>
<span id="cb87-82"><a href="#cb87-82" aria-hidden="true" tabindex="-1"></a>            migration_plan plan<span class="op">;</span></span>
<span id="cb87-83"><a href="#cb87-83" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-84"><a href="#cb87-84" aria-hidden="true" tabindex="-1"></a>            <span class="co">// مرحله 1: فرصت‌های کم خطر، ارزش بالا</span></span>
<span id="cb87-85"><a href="#cb87-85" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> phase1 <span class="op">=</span> create_low_risk_phase<span class="op">(</span>assessment<span class="op">.</span>opportunities<span class="op">);</span></span>
<span id="cb87-86"><a href="#cb87-86" aria-hidden="true" tabindex="-1"></a>            plan<span class="op">.</span>phases<span class="op">.</span>push_back<span class="op">(</span>phase1<span class="op">);</span></span>
<span id="cb87-87"><a href="#cb87-87" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-88"><a href="#cb87-88" aria-hidden="true" tabindex="-1"></a>            <span class="co">// مرحله 2: مهاجرت‌های پیچیدگی متوسط  </span></span>
<span id="cb87-89"><a href="#cb87-89" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> phase2 <span class="op">=</span> create_medium_complexity_phase<span class="op">(</span>assessment<span class="op">.</span>opportunities<span class="op">);</span></span>
<span id="cb87-90"><a href="#cb87-90" aria-hidden="true" tabindex="-1"></a>            plan<span class="op">.</span>phases<span class="op">.</span>push_back<span class="op">(</span>phase2<span class="op">);</span></span>
<span id="cb87-91"><a href="#cb87-91" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-92"><a href="#cb87-92" aria-hidden="true" tabindex="-1"></a>            <span class="co">// مرحله 3: مهاجرت‌های پیچیدگی بالا</span></span>
<span id="cb87-93"><a href="#cb87-93" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> phase3 <span class="op">=</span> create_high_complexity_phase<span class="op">(</span>assessment<span class="op">.</span>opportunities<span class="op">);</span></span>
<span id="cb87-94"><a href="#cb87-94" aria-hidden="true" tabindex="-1"></a>            plan<span class="op">.</span>phases<span class="op">.</span>push_back<span class="op">(</span>phase3<span class="op">);</span></span>
<span id="cb87-95"><a href="#cb87-95" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-96"><a href="#cb87-96" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> plan<span class="op">;</span></span>
<span id="cb87-97"><a href="#cb87-97" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb87-98"><a href="#cb87-98" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb87-99"><a href="#cb87-99" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb87-100"><a href="#cb87-100" aria-hidden="true" tabindex="-1"></a>        migration_phase create_low_risk_phase<span class="op">(</span></span>
<span id="cb87-101"><a href="#cb87-101" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> <span class="bu">std::</span>vector<span class="op">&lt;</span>potential_reflection_opportunity<span class="op">&gt;&amp;</span> opportunities<span class="op">)</span> <span class="op">{</span></span>
<span id="cb87-102"><a href="#cb87-102" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-103"><a href="#cb87-103" aria-hidden="true" tabindex="-1"></a>            migration_phase phase<span class="op">;</span></span>
<span id="cb87-104"><a href="#cb87-104" aria-hidden="true" tabindex="-1"></a>            phase<span class="op">.</span>name <span class="op">=</span> <span class="st">&quot;Low-Risk Reflection Adoption&quot;</span><span class="op">;</span></span>
<span id="cb87-105"><a href="#cb87-105" aria-hidden="true" tabindex="-1"></a>            phase<span class="op">.</span>description <span class="op">=</span> <span class="st">&quot;Migrate simple serialization and property patterns&quot;</span><span class="op">;</span></span>
<span id="cb87-106"><a href="#cb87-106" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-107"><a href="#cb87-107" aria-hidden="true" tabindex="-1"></a>            <span class="co">// تمرکز بر انواع مستقل با وابستگی‌های حداقل</span></span>
<span id="cb87-108"><a href="#cb87-108" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> opp <span class="op">:</span> opportunities<span class="op">)</span> <span class="op">{</span></span>
<span id="cb87-109"><a href="#cb87-109" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>opp<span class="op">.</span>risk_level <span class="op">==</span> risk_level<span class="op">::</span>low <span class="op">&amp;&amp;</span> </span>
<span id="cb87-110"><a href="#cb87-110" aria-hidden="true" tabindex="-1"></a>                    opp<span class="op">.</span>value_impact <span class="op">==</span> impact_level<span class="op">::</span>high<span class="op">)</span> <span class="op">{</span></span>
<span id="cb87-111"><a href="#cb87-111" aria-hidden="true" tabindex="-1"></a>                    phase<span class="op">.</span>tasks<span class="op">.</span>push_back<span class="op">(</span>create_migration_task<span class="op">(</span>opp<span class="op">));</span></span>
<span id="cb87-112"><a href="#cb87-112" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb87-113"><a href="#cb87-113" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb87-114"><a href="#cb87-114" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-115"><a href="#cb87-115" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> phase<span class="op">;</span></span>
<span id="cb87-116"><a href="#cb87-116" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb87-117"><a href="#cb87-117" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb87-118"><a href="#cb87-118" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 data-number="2.40" id="چالشهای-استانداردسازی"><span
class="header-section-number">2.40</span> 8.5 چالش‌های استانداردسازی</h2>
<h3 data-number="2.40.1" id="نگرانیهای-ثبات-abi"><span
class="header-section-number">2.40.1</span> 8.5.1 نگرانی‌های ثبات
ABI</h3>
<p>بازتاب و متاکلاس‌ها چالش‌هایی برای ثبات رابط باینری کاربرد (ABI) ایجاد
می‌کنند [137]:</p>
<div class="sourceCode" id="cb88"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ملاحظات ثبات ABI</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> abi_stability <span class="op">{</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// مشکل: کد تولید شده روی ABI تأثیر می‌گذارد</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> <span class="er">$</span>serializable Version1 <span class="op">{</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> id<span class="op">;</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string name<span class="op">;</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تولید شده: to_json(), from_json(), operator==, etc.</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> <span class="er">$</span>serializable Version2 <span class="op">{</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> id<span class="op">;</span></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string name<span class="op">;</span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string email<span class="op">;</span>  <span class="co">// فیلد اضافه شده</span></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تولید شده: to_json(), from_json(), operator==, etc.</span></span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// سناریوهای شکست ABI:</span></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 1. امضاهای متد تولید شده تغییر می‌کنند</span></span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 2. پیاده‌سازی‌های متد تولید شده تغییر می‌کنند</span></span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 3. جداول مجازی تولید شده تغییر می‌کنند</span></span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 4. چیدمان داده تولید شده تغییر می‌کند</span></span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> abi_stability_analysis <span class="op">{</span></span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">enum</span> <span class="kw">class</span> compatibility_level <span class="op">{</span></span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>            source_compatible<span class="op">,</span>      <span class="co">// کد منبع کامپایل می‌شود</span></span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a>            binary_compatible<span class="op">,</span>      <span class="co">// باینری‌های موجود کار می‌کنند</span></span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a>            runtime_compatible     <span class="co">// رفتار زمان اجرا حفظ می‌شود</span></span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> compatibility_level analyze_metaclass_change<span class="op">(</span></span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> metaclass_definition<span class="op">&amp;</span> old_def<span class="op">,</span></span>
<span id="cb88-32"><a href="#cb88-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> metaclass_definition<span class="op">&amp;</span> new_def<span class="op">)</span> <span class="op">{</span></span>
<span id="cb88-33"><a href="#cb88-33" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb88-34"><a href="#cb88-34" aria-hidden="true" tabindex="-1"></a>            <span class="co">// تحلیل تفاوت‌های کد تولید شده</span></span>
<span id="cb88-35"><a href="#cb88-35" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> old_generated <span class="op">=</span> simulate_code_generation<span class="op">(</span>old_def<span class="op">);</span></span>
<span id="cb88-36"><a href="#cb88-36" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> new_generated <span class="op">=</span> simulate_code_generation<span class="op">(</span>new_def<span class="op">);</span></span>
<span id="cb88-37"><a href="#cb88-37" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb88-38"><a href="#cb88-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>old_generated<span class="op">.</span>signatures <span class="op">!=</span> new_generated<span class="op">.</span>signatures<span class="op">)</span> <span class="op">{</span></span>
<span id="cb88-39"><a href="#cb88-39" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> compatibility_level<span class="op">::</span>source_compatible<span class="op">;</span></span>
<span id="cb88-40"><a href="#cb88-40" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb88-41"><a href="#cb88-41" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb88-42"><a href="#cb88-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>old_generated<span class="op">.</span>implementations <span class="op">!=</span> new_generated<span class="op">.</span>implementations<span class="op">)</span> <span class="op">{</span></span>
<span id="cb88-43"><a href="#cb88-43" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> compatibility_level<span class="op">::</span>binary_compatible<span class="op">;</span></span>
<span id="cb88-44"><a href="#cb88-44" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb88-45"><a href="#cb88-45" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb88-46"><a href="#cb88-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> compatibility_level<span class="op">::</span>runtime_compatible<span class="op">;</span></span>
<span id="cb88-47"><a href="#cb88-47" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb88-48"><a href="#cb88-48" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb88-49"><a href="#cb88-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb88-50"><a href="#cb88-50" aria-hidden="true" tabindex="-1"></a>    <span class="co">// استراتژی نسخه‌بندی برای متاکلاس‌ها</span></span>
<span id="cb88-51"><a href="#cb88-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> metaclass_versioning <span class="op">{</span></span>
<span id="cb88-52"><a href="#cb88-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb88-53"><a href="#cb88-53" aria-hidden="true" tabindex="-1"></a>        <span class="co">// نسخه‌بندی صریح برای ثبات ABI</span></span>
<span id="cb88-54"><a href="#cb88-54" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="dt">void</span> serializable_v1<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb88-55"><a href="#cb88-55" aria-hidden="true" tabindex="-1"></a>            <span class="co">// پیاده‌سازی نسخه 1 - ABI پایدار</span></span>
<span id="cb88-56"><a href="#cb88-56" aria-hidden="true" tabindex="-1"></a>            generate_json_methods_v1<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb88-57"><a href="#cb88-57" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb88-58"><a href="#cb88-58" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb88-59"><a href="#cb88-59" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="dt">void</span> serializable_v2<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb88-60"><a href="#cb88-60" aria-hidden="true" tabindex="-1"></a>            <span class="co">// پیاده‌سازی نسخه 2 - احتمالاً ABI شکن</span></span>
<span id="cb88-61"><a href="#cb88-61" aria-hidden="true" tabindex="-1"></a>            generate_json_methods_v2<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb88-62"><a href="#cb88-62" aria-hidden="true" tabindex="-1"></a>            generate_validation_methods<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb88-63"><a href="#cb88-63" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb88-64"><a href="#cb88-64" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb88-65"><a href="#cb88-65" aria-hidden="true" tabindex="-1"></a>        <span class="co">// پیش‌فرض به آخرین نسخه پایدار</span></span>
<span id="cb88-66"><a href="#cb88-66" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="dt">void</span> serializable<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb88-67"><a href="#cb88-67" aria-hidden="true" tabindex="-1"></a>            serializable_v1<span class="op">(</span>target<span class="op">);</span>  <span class="co">// پیش‌فرض محافظه‌کارانه</span></span>
<span id="cb88-68"><a href="#cb88-68" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb88-69"><a href="#cb88-69" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb88-70"><a href="#cb88-70" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="2.40.2" id="سازگاری-بین-فروشندگان"><span
class="header-section-number">2.40.2</span> 8.5.2 سازگاری بین
فروشندگان</h3>
<p>اطمینان از رفتار ثابت در پیاده‌سازی‌های مختلف کامپایلر چالش‌های قابل
توجهی ارائه می‌دهد [138]:</p>
<div class="sourceCode" id="cb89"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co">// چالش‌های سازگاری بین فروشندگان</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> vendor_compatibility <span class="op">{</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// کامپایلرهای مختلف ممکن است بازتاب را متفاوت پیاده‌سازی کنند</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> compiler_specific_behavior <span class="op">{</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">enum</span> <span class="kw">class</span> vendor <span class="op">{</span> gcc<span class="op">,</span> clang<span class="op">,</span> msvc<span class="op">,</span> icc <span class="op">};</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تفاوت‌های نمایش Meta-object</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> <span class="dt">bool</span> are_meta_objects_equivalent<span class="op">(</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> <span class="bu">std::</span>meta::info<span class="op">&amp;</span> obj1<span class="op">,</span> </span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> <span class="bu">std::</span>meta::info<span class="op">&amp;</span> obj2<span class="op">,</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>            vendor v1<span class="op">,</span> vendor v2<span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>v1 <span class="op">==</span> v2<span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> obj1 <span class="op">==</span> obj2<span class="op">;</span>  <span class="co">// مقایسه فروشنده یکسان</span></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>            <span class="co">// مقایسه بین فروشندگان نیاز به نرمال‌سازی دارد</span></span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> normalize_meta_object<span class="op">(</span>obj1<span class="op">,</span> v1<span class="op">)</span> <span class="op">==</span> </span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>                   normalize_meta_object<span class="op">(</span>obj2<span class="op">,</span> v2<span class="op">);</span></span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تفاوت‌های تولید کد</span></span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> <span class="bu">std::</span>string normalize_generated_code<span class="op">(</span></span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> <span class="bu">std::</span>string<span class="op">&amp;</span> generated_code<span class="op">,</span></span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a>            vendor source_vendor<span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-27"><a href="#cb89-27" aria-hidden="true" tabindex="-1"></a>            <span class="co">// نرمال‌سازی تفاوت‌های خاص کامپایلر:</span></span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a>            <span class="co">// - تنوعات name mangling</span></span>
<span id="cb89-29"><a href="#cb89-29" aria-hidden="true" tabindex="-1"></a>            <span class="co">// - تفاوت‌های instantiation قالب  </span></span>
<span id="cb89-30"><a href="#cb89-30" aria-hidden="true" tabindex="-1"></a>            <span class="co">// - تفاوت‌های فرض بهینه‌سازی</span></span>
<span id="cb89-31"><a href="#cb89-31" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-32"><a href="#cb89-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> apply_normalization_rules<span class="op">(</span>generated_code<span class="op">,</span> source_vendor<span class="op">);</span></span>
<span id="cb89-33"><a href="#cb89-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb89-34"><a href="#cb89-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb89-35"><a href="#cb89-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-36"><a href="#cb89-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">// پیاده‌سازی متاکلاس قابل حمل</span></span>
<span id="cb89-37"><a href="#cb89-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> portable_metaclass <span class="op">{</span></span>
<span id="cb89-38"><a href="#cb89-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb89-39"><a href="#cb89-39" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="dt">void</span> portable_serializable<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb89-40"><a href="#cb89-40" aria-hidden="true" tabindex="-1"></a>            <span class="co">// اجتناب از ویژگی‌های بازتاب خاص فروشنده</span></span>
<span id="cb89-41"><a href="#cb89-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span>supports_advanced_reflection<span class="op">())</span> <span class="op">{</span></span>
<span id="cb89-42"><a href="#cb89-42" aria-hidden="true" tabindex="-1"></a>                generate_advanced_serialization<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb89-43"><a href="#cb89-43" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb89-44"><a href="#cb89-44" aria-hidden="true" tabindex="-1"></a>                generate_basic_serialization<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb89-45"><a href="#cb89-45" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb89-46"><a href="#cb89-46" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-47"><a href="#cb89-47" aria-hidden="true" tabindex="-1"></a>            <span class="co">// استفاده از تشخیص ویژگی به جای تشخیص فروشنده</span></span>
<span id="cb89-48"><a href="#cb89-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span>has_string_literal_templates<span class="op">())</span> <span class="op">{</span></span>
<span id="cb89-49"><a href="#cb89-49" aria-hidden="true" tabindex="-1"></a>                use_string_literal_optimization<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb89-50"><a href="#cb89-50" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb89-51"><a href="#cb89-51" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb89-52"><a href="#cb89-52" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-53"><a href="#cb89-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb89-54"><a href="#cb89-54" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تشخیص ویژگی برای قابلیت حمل</span></span>
<span id="cb89-55"><a href="#cb89-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> <span class="kw">consteval</span> <span class="dt">bool</span> supports_advanced_reflection<span class="op">()</span> <span class="op">{</span></span>
<span id="cb89-56"><a href="#cb89-56" aria-hidden="true" tabindex="-1"></a>            <span class="co">// آزمایش ویژگی‌های بازتاب پیشرفته در زمان کامپایل</span></span>
<span id="cb89-57"><a href="#cb89-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="kw">requires</span> <span class="op">{</span></span>
<span id="cb89-58"><a href="#cb89-58" aria-hidden="true" tabindex="-1"></a>                <span class="bu">std::</span>meta::advanced_query_operation<span class="op">();</span></span>
<span id="cb89-59"><a href="#cb89-59" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb89-60"><a href="#cb89-60" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb89-61"><a href="#cb89-61" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-62"><a href="#cb89-62" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> <span class="kw">consteval</span> <span class="dt">bool</span> has_string_literal_templates<span class="op">()</span> <span class="op">{</span></span>
<span id="cb89-63"><a href="#cb89-63" aria-hidden="true" tabindex="-1"></a>            <span class="co">// آزمایش پارامترهای قالب literal رشته</span></span>
<span id="cb89-64"><a href="#cb89-64" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="kw">requires</span> <span class="op">{</span></span>
<span id="cb89-65"><a href="#cb89-65" aria-hidden="true" tabindex="-1"></a>                template_with_string_literal<span class="op">&lt;</span><span class="st">&quot;test&quot;</span><span class="op">&gt;();</span></span>
<span id="cb89-66"><a href="#cb89-66" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb89-67"><a href="#cb89-67" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb89-68"><a href="#cb89-68" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb89-69"><a href="#cb89-69" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>این چالش‌ها پیچیدگی پیاده‌سازی و پذیرش بازتاب و متاکلاس‌های C++23 در
سناریوهای دنیای واقعی را برجسته می‌کنند. با وجود این محدودیت‌ها، مزایا
اغلب بر هزینه‌ها غلبه می‌کنند، خاصه برای کاربردهایی که می‌توانند از قدرت
کامل این ویژگی‌ها استفاده کنند. بخش بعدی جهت‌های آینده برای رفع این چالش‌ها
و گسترش قابلیت‌های بازتاب را بررسی می‌کند.</p>
<hr />
<p><em>[مراجع 127-138 مطابق با مطالعات پیاده‌سازی کامپایلر، تحقیقات
زیرساخت دیباگ، بهبودهای گزارش خطا، تحلیل منحنی یادگیری، استراتژی‌های
مهاجرت و تلاش‌های استانداردسازی فهرست شده در کتابشناسی جامع ما]</em> # 9.
جهت‌های آینده</p>
<h2 data-number="2.41"
id="c26-و-فراتر-از-آن-گسترش-قابلیتهای-بازتاب"><span
class="header-section-number">2.41</span> 9.1 C++26 و فراتر از آن: گسترش
قابلیت‌های بازتاب</h2>
<h3 data-number="2.41.1" id="پیشنهادهای-بازتاب-پویا"><span
class="header-section-number">2.41.1</span> 9.1.1 پیشنهادهای بازتاب
پویا</h3>
<p>در حالی که C++23 بازتاب استاتیک ارائه می‌دهد، علاقه فزاینده‌ای برای
گسترش این قابلیت‌ها به سناریوهای زمان اجرا وجود دارد [139]. کمیته
استانداردسازی C++ به طور فعال پیشنهادهایی برای بازتاب پویا را بررسی
می‌کند که مکمل زیرساخت استاتیک موجود باشد:</p>
<div class="sourceCode" id="cb90"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co">// API بازتاب پویای پیشنهادی برای C++26</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> <span class="bu">std::</span>meta::dynamic <span class="op">{</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// اطلاعات نوع زمان اجرا با یکپارچگی بازتاب</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> runtime_type_info <span class="op">{</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">const</span> <span class="bu">std::</span>meta::info <span class="va">static_info_</span><span class="op">;</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">const</span> <span class="bu">std::</span>type_info<span class="op">&amp;</span> <span class="va">type_info_</span><span class="op">;</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// پل بین بازتاب استاتیک و پویا</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> runtime_type_info<span class="op">(</span><span class="bu">std::</span>meta::info static_meta<span class="op">)</span> </span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span> <span class="va">static_info_</span><span class="op">(</span>static_meta<span class="op">),</span> </span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>              <span class="va">type_info_</span><span class="op">(</span><span class="bu">std::</span>meta::get_type_info<span class="op">(</span>static_meta<span class="op">))</span> <span class="op">{}</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">// کوئری‌های زمان اجرا با استفاده از متادیتای استاتیک</span></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span>member_descriptor<span class="op">&gt;</span> get_members<span class="op">()</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>            <span class="co">// استفاده از متادیتای زمان کامپایل برای کوئری‌های زمان اجرا</span></span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>            <span class="kw">constexpr</span> <span class="kw">auto</span> static_members <span class="op">=</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span><span class="va">static_info_</span><span class="op">);</span></span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>vector<span class="op">&lt;</span>member_descriptor<span class="op">&gt;</span> result<span class="op">;</span></span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>meta::template_for<span class="op">&lt;</span>static_members<span class="op">&gt;([&amp;](</span><span class="kw">auto</span> member<span class="op">)</span> <span class="op">{</span></span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>                result<span class="op">.</span>emplace_back<span class="op">(</span>create_runtime_descriptor<span class="op">(</span>member<span class="op">));</span></span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>            <span class="op">});</span></span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">// دسترسی عضو زمان اجرا با نام</span></span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>optional<span class="op">&lt;</span>any_value<span class="op">&gt;</span> get_member_value<span class="op">(</span></span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> <span class="dt">void</span><span class="op">*</span> object<span class="op">,</span> </span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>string_view member_name<span class="op">)</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb90-32"><a href="#cb90-32" aria-hidden="true" tabindex="-1"></a>            <span class="kw">constexpr</span> <span class="kw">auto</span> members <span class="op">=</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span><span class="va">static_info_</span><span class="op">);</span></span>
<span id="cb90-33"><a href="#cb90-33" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb90-34"><a href="#cb90-34" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>optional<span class="op">&lt;</span>any_value<span class="op">&gt;</span> result<span class="op">;</span></span>
<span id="cb90-35"><a href="#cb90-35" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>meta::template_for<span class="op">&lt;</span>members<span class="op">&gt;([&amp;](</span><span class="kw">auto</span> member<span class="op">)</span> <span class="op">{</span></span>
<span id="cb90-36"><a href="#cb90-36" aria-hidden="true" tabindex="-1"></a>                <span class="kw">constexpr</span> <span class="kw">auto</span> name <span class="op">=</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>member<span class="op">&gt;;</span></span>
<span id="cb90-37"><a href="#cb90-37" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>name <span class="op">==</span> member_name<span class="op">)</span> <span class="op">{</span></span>
<span id="cb90-38"><a href="#cb90-38" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">auto</span><span class="op">*</span> typed_obj <span class="op">=</span> <span class="kw">static_cast</span><span class="op">&lt;</span><span class="at">const</span> <span class="bu">std::</span>meta::get_reflected_type_t<span class="op">&lt;</span><span class="va">static_info_</span><span class="op">&gt;*&gt;(</span>object<span class="op">);</span></span>
<span id="cb90-39"><a href="#cb90-39" aria-hidden="true" tabindex="-1"></a>                    result <span class="op">=</span> get_member_value_impl<span class="op">(</span>typed_obj<span class="op">,</span> member<span class="op">);</span></span>
<span id="cb90-40"><a href="#cb90-40" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb90-41"><a href="#cb90-41" aria-hidden="true" tabindex="-1"></a>            <span class="op">});</span></span>
<span id="cb90-42"><a href="#cb90-42" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb90-43"><a href="#cb90-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb90-44"><a href="#cb90-44" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb90-45"><a href="#cb90-45" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb90-46"><a href="#cb90-46" aria-hidden="true" tabindex="-1"></a>        <span class="co">// فراخوانی متد زمان اجرا</span></span>
<span id="cb90-47"><a href="#cb90-47" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>optional<span class="op">&lt;</span>any_value<span class="op">&gt;</span> invoke_method<span class="op">(</span></span>
<span id="cb90-48"><a href="#cb90-48" aria-hidden="true" tabindex="-1"></a>            <span class="dt">void</span><span class="op">*</span> object<span class="op">,</span></span>
<span id="cb90-49"><a href="#cb90-49" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>string_view method_name<span class="op">,</span></span>
<span id="cb90-50"><a href="#cb90-50" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>span<span class="op">&lt;</span>any_value<span class="op">&gt;</span> arguments<span class="op">)</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="cb90-51"><a href="#cb90-51" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb90-52"><a href="#cb90-52" aria-hidden="true" tabindex="-1"></a>            <span class="kw">constexpr</span> <span class="kw">auto</span> methods <span class="op">=</span> <span class="bu">std::</span>meta::member_functions_of<span class="op">(</span><span class="va">static_info_</span><span class="op">);</span></span>
<span id="cb90-53"><a href="#cb90-53" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb90-54"><a href="#cb90-54" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>optional<span class="op">&lt;</span>any_value<span class="op">&gt;</span> result<span class="op">;</span></span>
<span id="cb90-55"><a href="#cb90-55" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>meta::template_for<span class="op">&lt;</span>methods<span class="op">&gt;([&amp;](</span><span class="kw">auto</span> method<span class="op">)</span> <span class="op">{</span></span>
<span id="cb90-56"><a href="#cb90-56" aria-hidden="true" tabindex="-1"></a>                <span class="kw">constexpr</span> <span class="kw">auto</span> name <span class="op">=</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>method<span class="op">&gt;;</span></span>
<span id="cb90-57"><a href="#cb90-57" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>name <span class="op">==</span> method_name<span class="op">)</span> <span class="op">{</span></span>
<span id="cb90-58"><a href="#cb90-58" aria-hidden="true" tabindex="-1"></a>                    result <span class="op">=</span> invoke_method_impl<span class="op">(</span>object<span class="op">,</span> method<span class="op">,</span> arguments<span class="op">);</span></span>
<span id="cb90-59"><a href="#cb90-59" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb90-60"><a href="#cb90-60" aria-hidden="true" tabindex="-1"></a>            <span class="op">});</span></span>
<span id="cb90-61"><a href="#cb90-61" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb90-62"><a href="#cb90-62" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb90-63"><a href="#cb90-63" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb90-64"><a href="#cb90-64" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb90-65"><a href="#cb90-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-66"><a href="#cb90-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">// رجیستری سراسری برای جستجوی نوع زمان اجرا</span></span>
<span id="cb90-67"><a href="#cb90-67" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> type_registry <span class="op">{</span></span>
<span id="cb90-68"><a href="#cb90-68" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>unordered_map<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">,</span> <span class="bu">std::</span>unique_ptr<span class="op">&lt;</span>runtime_type_info<span class="op">&gt;&gt;</span> <span class="va">registry_</span><span class="op">;</span></span>
<span id="cb90-69"><a href="#cb90-69" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb90-70"><a href="#cb90-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb90-71"><a href="#cb90-71" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ثبت خودکار برای انواع بازتابی</span></span>
<span id="cb90-72"><a href="#cb90-72" aria-hidden="true" tabindex="-1"></a>        <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb90-73"><a href="#cb90-73" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> <span class="dt">register_type</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb90-74"><a href="#cb90-74" aria-hidden="true" tabindex="-1"></a>            <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb90-75"><a href="#cb90-75" aria-hidden="true" tabindex="-1"></a>            <span class="kw">constexpr</span> <span class="kw">auto</span> name <span class="op">=</span> <span class="bu">std::</span>meta::get_name_v<span class="op">&lt;</span>meta<span class="op">&gt;;</span></span>
<span id="cb90-76"><a href="#cb90-76" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb90-77"><a href="#cb90-77" aria-hidden="true" tabindex="-1"></a>            <span class="va">registry_</span><span class="op">[</span><span class="bu">std::</span>string<span class="op">(</span>name<span class="op">)]</span> <span class="op">=</span> </span>
<span id="cb90-78"><a href="#cb90-78" aria-hidden="true" tabindex="-1"></a>                <span class="bu">std::</span>make_unique<span class="op">&lt;</span>runtime_type_info<span class="op">&gt;(</span>meta<span class="op">);</span></span>
<span id="cb90-79"><a href="#cb90-79" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb90-80"><a href="#cb90-80" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb90-81"><a href="#cb90-81" aria-hidden="true" tabindex="-1"></a>        <span class="co">// جستجوی نوع زمان اجرا با نام</span></span>
<span id="cb90-82"><a href="#cb90-82" aria-hidden="true" tabindex="-1"></a>        <span class="at">const</span> runtime_type_info<span class="op">*</span> <span class="dt">find_type</span><span class="op">(</span><span class="bu">std::</span>string_view type_name<span class="op">)</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="cb90-83"><a href="#cb90-83" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> it <span class="op">=</span> <span class="va">registry_</span><span class="op">.</span>find<span class="op">(</span><span class="bu">std::</span>string<span class="op">(</span>type_name<span class="op">));</span></span>
<span id="cb90-84"><a href="#cb90-84" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> it <span class="op">!=</span> <span class="va">registry_</span><span class="op">.</span>end<span class="op">()</span> <span class="op">?</span> it<span class="op">-&gt;</span>second<span class="op">.</span>get<span class="op">()</span> <span class="op">:</span> <span class="kw">nullptr</span><span class="op">;</span></span>
<span id="cb90-85"><a href="#cb90-85" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb90-86"><a href="#cb90-86" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb90-87"><a href="#cb90-87" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ایجاد آبجکت خودکار از نام نوع</span></span>
<span id="cb90-88"><a href="#cb90-88" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>unique_ptr<span class="op">&lt;</span><span class="dt">void</span><span class="op">,</span> <span class="dt">void</span><span class="op">(*)(</span><span class="dt">void</span><span class="op">*)&gt;</span> create_object<span class="op">(</span><span class="bu">std::</span>string_view type_name<span class="op">)</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="cb90-89"><a href="#cb90-89" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span><span class="op">*</span> type_info <span class="op">=</span> <span class="dt">find_type</span><span class="op">(</span>type_name<span class="op">);</span></span>
<span id="cb90-90"><a href="#cb90-90" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(!</span>type_info<span class="op">)</span> <span class="op">{</span></span>
<span id="cb90-91"><a href="#cb90-91" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="op">{</span><span class="kw">nullptr</span><span class="op">,</span> <span class="op">[](</span><span class="dt">void</span><span class="op">*){}};</span></span>
<span id="cb90-92"><a href="#cb90-92" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb90-93"><a href="#cb90-93" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb90-94"><a href="#cb90-94" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> type_info<span class="op">-&gt;</span>create_default_instance<span class="op">();</span></span>
<span id="cb90-95"><a href="#cb90-95" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb90-96"><a href="#cb90-96" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb90-97"><a href="#cb90-97" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-98"><a href="#cb90-98" aria-hidden="true" tabindex="-1"></a>    <span class="co">// نمونه رجیستری نوع سراسری</span></span>
<span id="cb90-99"><a href="#cb90-99" aria-hidden="true" tabindex="-1"></a>    <span class="kw">inline</span> type_registry<span class="op">&amp;</span> get_global_registry<span class="op">()</span> <span class="op">{</span></span>
<span id="cb90-100"><a href="#cb90-100" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> type_registry registry<span class="op">;</span></span>
<span id="cb90-101"><a href="#cb90-101" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> registry<span class="op">;</span></span>
<span id="cb90-102"><a href="#cb90-102" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb90-103"><a href="#cb90-103" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb90-104"><a href="#cb90-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-105"><a href="#cb90-105" aria-hidden="true" tabindex="-1"></a><span class="co">// مثال استفاده با بازتاب پویای پیشنهادی</span></span>
<span id="cb90-106"><a href="#cb90-106" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> dynamic_reflection_example<span class="op">()</span> <span class="op">{</span></span>
<span id="cb90-107"><a href="#cb90-107" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> <span class="kw">namespace</span> <span class="bu">std::</span>meta::dynamic<span class="op">;</span></span>
<span id="cb90-108"><a href="#cb90-108" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-109"><a href="#cb90-109" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ثبت انواع برای جستجوی زمان اجرا</span></span>
<span id="cb90-110"><a href="#cb90-110" aria-hidden="true" tabindex="-1"></a>    get_global_registry<span class="op">().</span><span class="dt">register_type</span><span class="op">&lt;</span>Person<span class="op">&gt;();</span></span>
<span id="cb90-111"><a href="#cb90-111" aria-hidden="true" tabindex="-1"></a>    get_global_registry<span class="op">().</span><span class="dt">register_type</span><span class="op">&lt;</span>Company<span class="op">&gt;();</span></span>
<span id="cb90-112"><a href="#cb90-112" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-113"><a href="#cb90-113" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ایجاد و دستکاری آبجکت زمان اجرا</span></span>
<span id="cb90-114"><a href="#cb90-114" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> obj <span class="op">=</span> get_global_registry<span class="op">().</span>create_object<span class="op">(</span><span class="st">&quot;Person&quot;</span><span class="op">);</span></span>
<span id="cb90-115"><a href="#cb90-115" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span><span class="op">*</span> type_info <span class="op">=</span> get_global_registry<span class="op">().</span><span class="dt">find_type</span><span class="op">(</span><span class="st">&quot;Person&quot;</span><span class="op">);</span></span>
<span id="cb90-116"><a href="#cb90-116" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-117"><a href="#cb90-117" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>type_info <span class="op">&amp;&amp;</span> obj<span class="op">)</span> <span class="op">{</span></span>
<span id="cb90-118"><a href="#cb90-118" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تنظیم مقادیر عضو در زمان اجرا</span></span>
<span id="cb90-119"><a href="#cb90-119" aria-hidden="true" tabindex="-1"></a>        type_info<span class="op">-&gt;</span>set_member_value<span class="op">(</span>obj<span class="op">.</span>get<span class="op">(),</span> <span class="st">&quot;name&quot;</span><span class="op">,</span> <span class="bu">std::</span>string<span class="op">(</span><span class="st">&quot;Alice&quot;</span><span class="op">));</span></span>
<span id="cb90-120"><a href="#cb90-120" aria-hidden="true" tabindex="-1"></a>        type_info<span class="op">-&gt;</span>set_member_value<span class="op">(</span>obj<span class="op">.</span>get<span class="op">(),</span> <span class="st">&quot;age&quot;</span><span class="op">,</span> <span class="dv">30</span><span class="op">);</span></span>
<span id="cb90-121"><a href="#cb90-121" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb90-122"><a href="#cb90-122" aria-hidden="true" tabindex="-1"></a>        <span class="co">// فراخوانی متدها در زمان اجرا</span></span>
<span id="cb90-123"><a href="#cb90-123" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> result <span class="op">=</span> type_info<span class="op">-&gt;</span>invoke_method<span class="op">(</span>obj<span class="op">.</span>get<span class="op">(),</span> <span class="st">&quot;to_string&quot;</span><span class="op">,</span> <span class="op">{});</span></span>
<span id="cb90-124"><a href="#cb90-124" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb90-125"><a href="#cb90-125" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>result<span class="op">)</span> <span class="op">{</span></span>
<span id="cb90-126"><a href="#cb90-126" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">&quot;Object string representation: &quot;</span> </span>
<span id="cb90-127"><a href="#cb90-127" aria-hidden="true" tabindex="-1"></a>                      <span class="op">&lt;&lt;</span> <span class="bu">std::</span>any_cast<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;(*</span>result<span class="op">)</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span>
<span id="cb90-128"><a href="#cb90-128" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb90-129"><a href="#cb90-129" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb90-130"><a href="#cb90-130" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="2.41.2" id="ترکیب-پیشرفته-متاکلاس"><span
class="header-section-number">2.41.2</span> 9.1.2 ترکیب پیشرفته
متاکلاس</h3>
<p>استانداردهای آینده C++ احتمالاً مکانیزم‌های ترکیب متاکلاس پیچیده‌تری را
معرفی خواهند کرد [140]:</p>
<div class="sourceCode" id="cb91"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ترکیب پیشرفته متاکلاس برای C++26</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> future_metaclasses <span class="op">{</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// وراثت و ترکیب متاکلاس</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> Base<span class="op">&gt;</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">void</span> derived_metaclass<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="kw">requires</span> IsMetaclass<span class="op">&lt;</span>Base<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ابتدا متاکلاس پایه را اعمال کن</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>        apply_metaclass<span class="op">&lt;</span>Base<span class="op">&gt;(</span>target<span class="op">);</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// اضافه کردن عملکرد مشتق شده</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>        add_derived_functionality<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// رفتارهای پایه خاص را بازنویسی کن</span></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>        override_base_methods<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// کاربرد چند متاکلاس با حل تعارض</span></span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span><span class="op">...</span> Metaclasses<span class="op">&gt;</span></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">void</span> combined_metaclass<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">// اعمال متاکلاس‌ها به ترتیب با تشخیص تعارض</span></span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>        apply_metaclasses_with_resolution<span class="op">&lt;</span>Metaclasses<span class="op">...&gt;(</span>target<span class="op">);</span></span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// کاربرد متاکلاس شرطی</span></span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> Condition<span class="op">,</span> <span class="kw">typename</span> ThenMetaclass<span class="op">,</span> <span class="kw">typename</span> ElseMetaclass <span class="op">=</span> <span class="dt">void</span><span class="op">&gt;</span></span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">void</span> conditional_metaclass<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span>Condition<span class="op">::</span>evaluate<span class="op">(</span>target<span class="op">))</span> <span class="op">{</span></span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a>            apply_metaclass<span class="op">&lt;</span>ThenMetaclass<span class="op">&gt;(</span>target<span class="op">);</span></span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(!</span><span class="bu">std::</span>is_void_v<span class="op">&lt;</span>ElseMetaclass<span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a>            apply_metaclass<span class="op">&lt;</span>ElseMetaclass<span class="op">&gt;(</span>target<span class="op">);</span></span>
<span id="cb91-30"><a href="#cb91-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb91-31"><a href="#cb91-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb91-32"><a href="#cb91-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-33"><a href="#cb91-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">// جنبه‌های متاکلاس برای نگرانی‌های متقابل</span></span>
<span id="cb91-34"><a href="#cb91-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">namespace</span> aspects <span class="op">{</span></span>
<span id="cb91-35"><a href="#cb91-35" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="dt">void</span> logging_aspect<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb91-36"><a href="#cb91-36" aria-hidden="true" tabindex="-1"></a>            <span class="co">// اضافه کردن لاگ به همه متدهای عمومی</span></span>
<span id="cb91-37"><a href="#cb91-37" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> methods <span class="op">=</span> <span class="bu">std::</span>meta::member_functions_of<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb91-38"><a href="#cb91-38" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>meta::template_for<span class="op">&lt;</span>methods<span class="op">&gt;([](</span><span class="kw">auto</span> method<span class="op">)</span> <span class="op">{</span></span>
<span id="cb91-39"><a href="#cb91-39" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span><span class="bu">std::</span>meta::is_public_v<span class="op">&lt;</span>method<span class="op">&gt;)</span> <span class="op">{</span></span>
<span id="cb91-40"><a href="#cb91-40" aria-hidden="true" tabindex="-1"></a>                    wrap_method_with_logging<span class="op">(</span>method<span class="op">);</span></span>
<span id="cb91-41"><a href="#cb91-41" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb91-42"><a href="#cb91-42" aria-hidden="true" tabindex="-1"></a>            <span class="op">});</span></span>
<span id="cb91-43"><a href="#cb91-43" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb91-44"><a href="#cb91-44" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb91-45"><a href="#cb91-45" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="dt">void</span> performance_aspect<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb91-46"><a href="#cb91-46" aria-hidden="true" tabindex="-1"></a>            <span class="co">// اضافه کردن نظارت کارایی به متدها</span></span>
<span id="cb91-47"><a href="#cb91-47" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> methods <span class="op">=</span> <span class="bu">std::</span>meta::member_functions_of<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb91-48"><a href="#cb91-48" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>meta::template_for<span class="op">&lt;</span>methods<span class="op">&gt;([](</span><span class="kw">auto</span> method<span class="op">)</span> <span class="op">{</span></span>
<span id="cb91-49"><a href="#cb91-49" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>should_monitor_performance<span class="op">(</span>method<span class="op">))</span> <span class="op">{</span></span>
<span id="cb91-50"><a href="#cb91-50" aria-hidden="true" tabindex="-1"></a>                    wrap_method_with_timing<span class="op">(</span>method<span class="op">);</span></span>
<span id="cb91-51"><a href="#cb91-51" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb91-52"><a href="#cb91-52" aria-hidden="true" tabindex="-1"></a>            <span class="op">});</span></span>
<span id="cb91-53"><a href="#cb91-53" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb91-54"><a href="#cb91-54" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb91-55"><a href="#cb91-55" aria-hidden="true" tabindex="-1"></a>        <span class="kw">constexpr</span> <span class="dt">void</span> security_aspect<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb91-56"><a href="#cb91-56" aria-hidden="true" tabindex="-1"></a>            <span class="co">// اضافه کردن بررسی‌های امنیتی به متدهای حساس</span></span>
<span id="cb91-57"><a href="#cb91-57" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> methods <span class="op">=</span> <span class="bu">std::</span>meta::member_functions_of<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb91-58"><a href="#cb91-58" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>meta::template_for<span class="op">&lt;</span>methods<span class="op">&gt;([](</span><span class="kw">auto</span> method<span class="op">)</span> <span class="op">{</span></span>
<span id="cb91-59"><a href="#cb91-59" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>has_security_annotation<span class="op">(</span>method<span class="op">))</span> <span class="op">{</span></span>
<span id="cb91-60"><a href="#cb91-60" aria-hidden="true" tabindex="-1"></a>                    wrap_method_with_security_check<span class="op">(</span>method<span class="op">);</span></span>
<span id="cb91-61"><a href="#cb91-61" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb91-62"><a href="#cb91-62" aria-hidden="true" tabindex="-1"></a>            <span class="op">});</span></span>
<span id="cb91-63"><a href="#cb91-63" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb91-64"><a href="#cb91-64" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb91-65"><a href="#cb91-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-66"><a href="#cb91-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">// متاکلاس پیشرفته با ترکیب جنبه</span></span>
<span id="cb91-67"><a href="#cb91-67" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">void</span> enterprise_entity<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb91-68"><a href="#cb91-68" aria-hidden="true" tabindex="-1"></a>        <span class="co">// اعمال عملکرد اصلی entity</span></span>
<span id="cb91-69"><a href="#cb91-69" aria-hidden="true" tabindex="-1"></a>        apply_metaclass<span class="op">&lt;</span>serializable<span class="op">&gt;(</span>target<span class="op">);</span></span>
<span id="cb91-70"><a href="#cb91-70" aria-hidden="true" tabindex="-1"></a>        apply_metaclass<span class="op">&lt;</span>observable<span class="op">&gt;(</span>target<span class="op">);</span></span>
<span id="cb91-71"><a href="#cb91-71" aria-hidden="true" tabindex="-1"></a>        apply_metaclass<span class="op">&lt;</span>validatable<span class="op">&gt;(</span>target<span class="op">);</span></span>
<span id="cb91-72"><a href="#cb91-72" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb91-73"><a href="#cb91-73" aria-hidden="true" tabindex="-1"></a>        <span class="co">// اعمال جنبه‌های متقابل</span></span>
<span id="cb91-74"><a href="#cb91-74" aria-hidden="true" tabindex="-1"></a>        apply_aspect<span class="op">&lt;</span>aspects<span class="op">::</span>logging_aspect<span class="op">&gt;(</span>target<span class="op">);</span></span>
<span id="cb91-75"><a href="#cb91-75" aria-hidden="true" tabindex="-1"></a>        apply_aspect<span class="op">&lt;</span>aspects<span class="op">::</span>performance_aspect<span class="op">&gt;(</span>target<span class="op">);</span></span>
<span id="cb91-76"><a href="#cb91-76" aria-hidden="true" tabindex="-1"></a>        apply_aspect<span class="op">&lt;</span>aspects<span class="op">::</span>security_aspect<span class="op">&gt;(</span>target<span class="op">);</span></span>
<span id="cb91-77"><a href="#cb91-77" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb91-78"><a href="#cb91-78" aria-hidden="true" tabindex="-1"></a>        <span class="co">// اضافه کردن ویژگی‌های خاص سازمانی</span></span>
<span id="cb91-79"><a href="#cb91-79" aria-hidden="true" tabindex="-1"></a>        generate_audit_trail_support<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb91-80"><a href="#cb91-80" aria-hidden="true" tabindex="-1"></a>        generate_versioning_support<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb91-81"><a href="#cb91-81" aria-hidden="true" tabindex="-1"></a>        generate_caching_support<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb91-82"><a href="#cb91-82" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb91-83"><a href="#cb91-83" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb91-84"><a href="#cb91-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-85"><a href="#cb91-85" aria-hidden="true" tabindex="-1"></a><span class="co">// استفاده از ترکیب پیشرفته</span></span>
<span id="cb91-86"><a href="#cb91-86" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>enterprise_entity Person <span class="op">{</span></span>
<span id="cb91-87"><a href="#cb91-87" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string name<span class="op">;</span></span>
<span id="cb91-88"><a href="#cb91-88" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> age<span class="op">;</span></span>
<span id="cb91-89"><a href="#cb91-89" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string ssn <span class="op">[[</span><span class="at">security</span><span class="op">::</span><span class="at">sensitive</span><span class="op">]];</span></span>
<span id="cb91-90"><a href="#cb91-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-91"><a href="#cb91-91" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> update_profile<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>string<span class="op">&amp;</span> new_name<span class="op">)</span> <span class="op">[[</span><span class="at">performance</span><span class="op">::</span><span class="at">monitor</span><span class="op">]]</span> <span class="op">{</span></span>
<span id="cb91-92"><a href="#cb91-92" aria-hidden="true" tabindex="-1"></a>        name <span class="op">=</span> new_name<span class="op">;</span></span>
<span id="cb91-93"><a href="#cb91-93" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb91-94"><a href="#cb91-94" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<h3 data-number="2.41.3" id="تقویت-یکپارچگی-ماژول"><span
class="header-section-number">2.41.3</span> 9.1.3 تقویت یکپارچگی
ماژول</h3>
<p>استانداردهای آینده احتمالاً یکپارچگی بهتری بین بازتاب، متاکلاس‌ها و
سیستم ماژول‌ها ارائه خواهند داد [141]:</p>
<div class="sourceCode" id="cb92"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co">// یکپارچگی تقویت شده ماژول-بازتاب</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="kw">export</span> <span class="kw">module</span> person_model<span class="op">;</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> std<span class="op">.</span>meta<span class="op">;</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> std<span class="op">.</span>reflection<span class="op">.</span>serialization<span class="op">;</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> std<span class="op">.</span>reflection<span class="op">.</span>orm<span class="op">;</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="co">// اعلان متاکلاس‌های آگاه از ماژول</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a><span class="kw">export</span> <span class="kw">namespace</span> model_metaclasses <span class="op">{</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// متاکلاس‌ها می‌توانند از ماژول‌ها صادر شوند</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">export</span> <span class="kw">constexpr</span> <span class="dt">void</span> domain_entity<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تولید کد آگاه از ماژول</span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>        generate_in_module_context<span class="op">(</span>target<span class="op">,</span> get_current_module<span class="op">());</span></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ردیابی وابستگی بین ماژولی</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>        register_cross_module_dependencies<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// سریال‌سازی خاص ماژول</span></span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">export</span> <span class="kw">constexpr</span> <span class="dt">void</span> json_serializable<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تولید کدی که مرزهای ماژول را رعایت کند</span></span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>        generate_module_aware_serialization<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">// صادرات مناسب توابع سریال‌سازی</span></span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> serialization_functions <span class="op">=</span> generate_serialization_code<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a>        export_functions_from_module<span class="op">(</span>serialization_functions<span class="op">);</span></span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a><span class="co">// رجیستری نوع محدود به ماژول</span></span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a><span class="kw">export</span> <span class="kw">namespace</span> module_registry <span class="op">{</span></span>
<span id="cb92-32"><a href="#cb92-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">// رجیستری محدود به این ماژول</span></span>
<span id="cb92-33"><a href="#cb92-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> module_type_registry <span class="op">{</span></span>
<span id="cb92-34"><a href="#cb92-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> <span class="kw">inline</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>meta::info<span class="op">&gt;</span> <span class="va">registered_types_</span><span class="op">;</span></span>
<span id="cb92-35"><a href="#cb92-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb92-36"><a href="#cb92-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb92-37"><a href="#cb92-37" aria-hidden="true" tabindex="-1"></a>        <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb92-38"><a href="#cb92-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> <span class="dt">void</span> <span class="dt">register_type</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb92-39"><a href="#cb92-39" aria-hidden="true" tabindex="-1"></a>            <span class="kw">constexpr</span> <span class="kw">auto</span> meta <span class="op">=</span> <span class="bu">std::</span>meta::reflexpr<span class="op">(</span>T<span class="op">);</span></span>
<span id="cb92-40"><a href="#cb92-40" aria-hidden="true" tabindex="-1"></a>            <span class="va">registered_types_</span><span class="op">.</span>push_back<span class="op">(</span>meta<span class="op">);</span></span>
<span id="cb92-41"><a href="#cb92-41" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb92-42"><a href="#cb92-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb92-43"><a href="#cb92-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">static</span> <span class="kw">auto</span> get_registered_types<span class="op">()</span> <span class="op">{</span></span>
<span id="cb92-44"><a href="#cb92-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">registered_types_</span><span class="op">;</span></span>
<span id="cb92-45"><a href="#cb92-45" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb92-46"><a href="#cb92-46" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb92-47"><a href="#cb92-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb92-48"><a href="#cb92-48" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ثبت خودکار برای انواع در این ماژول</span></span>
<span id="cb92-49"><a href="#cb92-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb92-50"><a href="#cb92-50" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> auto_register<span class="op">()</span> <span class="op">{</span></span>
<span id="cb92-51"><a href="#cb92-51" aria-hidden="true" tabindex="-1"></a>        module_type_registry<span class="op">::</span><span class="dt">register_type</span><span class="op">&lt;</span>T<span class="op">&gt;();</span></span>
<span id="cb92-52"><a href="#cb92-52" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb92-53"><a href="#cb92-53" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb92-54"><a href="#cb92-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-55"><a href="#cb92-55" aria-hidden="true" tabindex="-1"></a><span class="co">// کوئری‌های بازتاب بین ماژولی</span></span>
<span id="cb92-56"><a href="#cb92-56" aria-hidden="true" tabindex="-1"></a><span class="kw">export</span> <span class="kw">namespace</span> cross_module <span class="op">{</span></span>
<span id="cb92-57"><a href="#cb92-57" aria-hidden="true" tabindex="-1"></a>    <span class="co">// جستجوی انواع در مرزهای ماژول</span></span>
<span id="cb92-58"><a href="#cb92-58" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> Predicate<span class="op">&gt;</span></span>
<span id="cb92-59"><a href="#cb92-59" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> find_types_across_modules<span class="op">(</span>Predicate pred<span class="op">)</span> <span class="op">{</span></span>
<span id="cb92-60"><a href="#cb92-60" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>meta::info<span class="op">&gt;</span> results<span class="op">;</span></span>
<span id="cb92-61"><a href="#cb92-61" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb92-62"><a href="#cb92-62" aria-hidden="true" tabindex="-1"></a>        <span class="co">// جستجوی ماژول فعلی</span></span>
<span id="cb92-63"><a href="#cb92-63" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> local_types <span class="op">=</span> module_registry<span class="op">::</span>module_type_registry<span class="op">::</span>get_registered_types<span class="op">();</span></span>
<span id="cb92-64"><a href="#cb92-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> type <span class="op">:</span> local_types<span class="op">)</span> <span class="op">{</span></span>
<span id="cb92-65"><a href="#cb92-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>pred<span class="op">(</span>type<span class="op">))</span> <span class="op">{</span></span>
<span id="cb92-66"><a href="#cb92-66" aria-hidden="true" tabindex="-1"></a>                results<span class="op">.</span>push_back<span class="op">(</span>type<span class="op">);</span></span>
<span id="cb92-67"><a href="#cb92-67" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb92-68"><a href="#cb92-68" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb92-69"><a href="#cb92-69" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb92-70"><a href="#cb92-70" aria-hidden="true" tabindex="-1"></a>        <span class="co">// جستجوی ماژول‌های وارداتی (ویژگی آینده)</span></span>
<span id="cb92-71"><a href="#cb92-71" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> imported_types <span class="op">=</span> get_imported_module_types<span class="op">();</span></span>
<span id="cb92-72"><a href="#cb92-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> type <span class="op">:</span> imported_types<span class="op">)</span> <span class="op">{</span></span>
<span id="cb92-73"><a href="#cb92-73" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>pred<span class="op">(</span>type<span class="op">))</span> <span class="op">{</span></span>
<span id="cb92-74"><a href="#cb92-74" aria-hidden="true" tabindex="-1"></a>                results<span class="op">.</span>push_back<span class="op">(</span>type<span class="op">);</span></span>
<span id="cb92-75"><a href="#cb92-75" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb92-76"><a href="#cb92-76" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb92-77"><a href="#cb92-77" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb92-78"><a href="#cb92-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> results<span class="op">;</span></span>
<span id="cb92-79"><a href="#cb92-79" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb92-80"><a href="#cb92-80" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 data-number="2.42" id="یکپارچگی-با-تکنولوژیهای-نوظهور"><span
class="header-section-number">2.42</span> 9.2 یکپارچگی با تکنولوژی‌های
نوظهور</h2>
<h3 data-number="2.42.1" id="یادگیری-ماشین-و-تولید-کد"><span
class="header-section-number">2.42.1</span> 9.2.1 یادگیری ماشین و تولید
کد</h3>
<p>ترکیب متادیتای بازتاب و یادگیری ماشین فرصت‌های هیجان‌انگیزی برای
بهینه‌سازی خودکار کد و تولید ارائه می‌دهد [142]:</p>
<div class="sourceCode" id="cb93"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co">// تولید متاکلاس تقویت شده با ML</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> ml_enhanced <span class="op">{</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// مدل یادگیری ماشین برای تشخیص الگوی کد</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> code_pattern_analyzer <span class="op">{</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// مدل ML آموزش دیده روی کدبیس‌ها برای تشخیص الگوها</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>        ml_model <span class="va">pattern_recognition_model_</span><span class="op">;</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تحلیل الگوهای استفاده نوع برای پیشنهاد طراحی بهینه متاکلاس</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>        metaclass_suggestions analyze_type_usage<span class="op">(</span><span class="bu">std::</span>meta::info type<span class="op">)</span> <span class="op">{</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>            <span class="co">// استخراج ویژگی‌ها از متادیتای نوع</span></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> features <span class="op">=</span> extract_type_features<span class="op">(</span>type<span class="op">);</span></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>            <span class="co">// استفاده از مدل ML برای پیش‌بینی پیکربندی بهینه متاکلاس</span></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> predictions <span class="op">=</span> <span class="va">pattern_recognition_model_</span><span class="op">.</span>predict<span class="op">(</span>features<span class="op">);</span></span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> convert_predictions_to_suggestions<span class="op">(</span>predictions<span class="op">);</span></span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">// بهینه‌سازی کد تولید شده بر اساس الگوهای استفاده</span></span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>        optimized_code_generation optimize_generated_code<span class="op">(</span></span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> generated_code<span class="op">&amp;</span> base_code<span class="op">,</span></span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> usage_statistics<span class="op">&amp;</span> stats<span class="op">)</span> <span class="op">{</span></span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a>            <span class="co">// بهینه‌سازی کد راهنمایی شده با ML</span></span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> optimization_strategy <span class="op">=</span> <span class="va">pattern_recognition_model_</span><span class="op">.</span>suggest_optimizations<span class="op">(</span></span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a>                base_code<span class="op">,</span> stats<span class="op">);</span></span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb93-29"><a href="#cb93-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> apply_optimizations<span class="op">(</span>base_code<span class="op">,</span> optimization_strategy<span class="op">);</span></span>
<span id="cb93-30"><a href="#cb93-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb93-31"><a href="#cb93-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb93-32"><a href="#cb93-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-33"><a href="#cb93-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">// توسعه متاکلاس با کمک AI</span></span>
<span id="cb93-34"><a href="#cb93-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">void</span> ai_optimized_serializable<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb93-35"><a href="#cb93-35" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تحلیل مشخصات نوع</span></span>
<span id="cb93-36"><a href="#cb93-36" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> characteristics <span class="op">=</span> analyze_type_characteristics<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb93-37"><a href="#cb93-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb93-38"><a href="#cb93-38" aria-hidden="true" tabindex="-1"></a>        <span class="co">// استفاده از AI برای تعیین استراتژی بهینه سریال‌سازی</span></span>
<span id="cb93-39"><a href="#cb93-39" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> strategy <span class="op">=</span> ai_suggest_serialization_strategy<span class="op">(</span>characteristics<span class="op">);</span></span>
<span id="cb93-40"><a href="#cb93-40" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb93-41"><a href="#cb93-41" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تولید کد بهینه بر اساس توصیه‌های AI</span></span>
<span id="cb93-42"><a href="#cb93-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span> <span class="op">(</span>strategy<span class="op">.</span>approach<span class="op">)</span> <span class="op">{</span></span>
<span id="cb93-43"><a href="#cb93-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> serialization_approach<span class="op">::</span>binary_optimized<span class="op">:</span></span>
<span id="cb93-44"><a href="#cb93-44" aria-hidden="true" tabindex="-1"></a>                generate_binary_optimized_serialization<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb93-45"><a href="#cb93-45" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="cb93-46"><a href="#cb93-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> serialization_approach<span class="op">::</span>json_pretty<span class="op">:</span></span>
<span id="cb93-47"><a href="#cb93-47" aria-hidden="true" tabindex="-1"></a>                generate_human_readable_json<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb93-48"><a href="#cb93-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="cb93-49"><a href="#cb93-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> serialization_approach<span class="op">::</span>compressed<span class="op">:</span></span>
<span id="cb93-50"><a href="#cb93-50" aria-hidden="true" tabindex="-1"></a>                generate_compressed_serialization<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb93-51"><a href="#cb93-51" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="cb93-52"><a href="#cb93-52" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb93-53"><a href="#cb93-53" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb93-54"><a href="#cb93-54" aria-hidden="true" tabindex="-1"></a>        <span class="co">// اعمال بهینه‌سازی‌های پیشنهادی AI</span></span>
<span id="cb93-55"><a href="#cb93-55" aria-hidden="true" tabindex="-1"></a>        apply_ai_optimizations<span class="op">(</span>target<span class="op">,</span> strategy<span class="op">.</span>optimizations<span class="op">);</span></span>
<span id="cb93-56"><a href="#cb93-56" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb93-57"><a href="#cb93-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-58"><a href="#cb93-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تولید کد با یادگیری تقویتی</span></span>
<span id="cb93-59"><a href="#cb93-59" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> rl_code_generator <span class="op">{</span></span>
<span id="cb93-60"><a href="#cb93-60" aria-hidden="true" tabindex="-1"></a>        <span class="co">// عامل یادگیری تقویتی برای تولید کد</span></span>
<span id="cb93-61"><a href="#cb93-61" aria-hidden="true" tabindex="-1"></a>        rl_agent <span class="va">code_generation_agent_</span><span class="op">;</span></span>
<span id="cb93-62"><a href="#cb93-62" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb93-63"><a href="#cb93-63" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb93-64"><a href="#cb93-64" aria-hidden="true" tabindex="-1"></a>        <span class="co">// یادگیری استراتژی‌های بهینه تولید کد از بازخورد</span></span>
<span id="cb93-65"><a href="#cb93-65" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> train_on_codebase<span class="op">(</span><span class="at">const</span> codebase<span class="op">&amp;</span> training_data<span class="op">)</span> <span class="op">{</span></span>
<span id="cb93-66"><a href="#cb93-66" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> example <span class="op">:</span> training_data<span class="op">.</span>get_examples<span class="op">())</span> <span class="op">{</span></span>
<span id="cb93-67"><a href="#cb93-67" aria-hidden="true" tabindex="-1"></a>                <span class="co">// استخراج وضعیت (مشخصات نوع)</span></span>
<span id="cb93-68"><a href="#cb93-68" aria-hidden="true" tabindex="-1"></a>                <span class="kw">auto</span> state <span class="op">=</span> extract_generation_state<span class="op">(</span>example<span class="op">.</span>type<span class="op">);</span></span>
<span id="cb93-69"><a href="#cb93-69" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb93-70"><a href="#cb93-70" aria-hidden="true" tabindex="-1"></a>                <span class="co">// انتخاب عمل تولید توسط عامل</span></span>
<span id="cb93-71"><a href="#cb93-71" aria-hidden="true" tabindex="-1"></a>                <span class="kw">auto</span> action <span class="op">=</span> <span class="va">code_generation_agent_</span><span class="op">.</span>select_action<span class="op">(</span>state<span class="op">);</span></span>
<span id="cb93-72"><a href="#cb93-72" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb93-73"><a href="#cb93-73" aria-hidden="true" tabindex="-1"></a>                <span class="co">// اعمال عمل و اندازه‌گیری پاداش (کارایی، خوانایی، و غیره)</span></span>
<span id="cb93-74"><a href="#cb93-74" aria-hidden="true" tabindex="-1"></a>                <span class="kw">auto</span> generated_code <span class="op">=</span> apply_generation_action<span class="op">(</span>action<span class="op">,</span> example<span class="op">.</span>type<span class="op">);</span></span>
<span id="cb93-75"><a href="#cb93-75" aria-hidden="true" tabindex="-1"></a>                <span class="kw">auto</span> reward <span class="op">=</span> evaluate_generated_code<span class="op">(</span>generated_code<span class="op">,</span> example<span class="op">.</span>expected_behavior<span class="op">);</span></span>
<span id="cb93-76"><a href="#cb93-76" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb93-77"><a href="#cb93-77" aria-hidden="true" tabindex="-1"></a>                <span class="co">// به‌روزرسانی عامل بر اساس پاداش</span></span>
<span id="cb93-78"><a href="#cb93-78" aria-hidden="true" tabindex="-1"></a>                <span class="va">code_generation_agent_</span><span class="op">.</span>update<span class="op">(</span>state<span class="op">,</span> action<span class="op">,</span> reward<span class="op">);</span></span>
<span id="cb93-79"><a href="#cb93-79" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb93-80"><a href="#cb93-80" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb93-81"><a href="#cb93-81" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb93-82"><a href="#cb93-82" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تولید کد بهینه با استفاده از استراتژی‌های یادگرفته</span></span>
<span id="cb93-83"><a href="#cb93-83" aria-hidden="true" tabindex="-1"></a>        generated_code generate_optimal_code<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb93-84"><a href="#cb93-84" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> state <span class="op">=</span> extract_generation_state<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb93-85"><a href="#cb93-85" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> optimal_action <span class="op">=</span> <span class="va">code_generation_agent_</span><span class="op">.</span>get_optimal_action<span class="op">(</span>state<span class="op">);</span></span>
<span id="cb93-86"><a href="#cb93-86" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> apply_generation_action<span class="op">(</span>optimal_action<span class="op">,</span> target<span class="op">);</span></span>
<span id="cb93-87"><a href="#cb93-87" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb93-88"><a href="#cb93-88" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb93-89"><a href="#cb93-89" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="2.42.2" id="webassembly-و-اهداف-چندپلتفرمه"><span
class="header-section-number">2.42.2</span> 9.2.2 WebAssembly و اهداف
چندپلتفرمه</h3>
<p>توسعه‌های آینده احتمالاً بر تولید بهینه‌سازی‌های خاص پلتفرم و سازگاری
چندپلتفرمه از طریق بازتاب تمرکز خواهند کرد [143]:</p>
<div class="sourceCode" id="cb94"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co">// تولید کد چندپلتفرمه با بازتاب</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> cross_platform <span class="op">{</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// استراتژی‌های بهینه‌سازی خاص پلتفرم</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">enum</span> <span class="kw">class</span> target_platform <span class="op">{</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>        native_x86_64<span class="op">,</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>        native_arm64<span class="op">,</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>        webassembly<span class="op">,</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>        gpu_cuda<span class="op">,</span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>        gpu_opencl</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// متاکلاس آگاه از پلتفرم</span></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span>target_platform Platform<span class="op">&gt;</span></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">void</span> platform_optimized<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تولید بهینه‌سازی‌های خاص پلتفرم</span></span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span>Platform <span class="op">==</span> target_platform<span class="op">::</span>webassembly<span class="op">)</span> <span class="op">{</span></span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>            generate_wasm_optimized_code<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span>Platform <span class="op">==</span> target_platform<span class="op">::</span>gpu_cuda<span class="op">)</span> <span class="op">{</span></span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>            generate_cuda_kernels<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span>Platform <span class="op">==</span> target_platform<span class="op">::</span>native_x86_64<span class="op">)</span> <span class="op">{</span></span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a>            generate_simd_optimized_code<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">// عملکرد مشترک در پلتفرم‌ها</span></span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a>        generate_cross_platform_interface<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// بهینه‌سازی‌های خاص WebAssembly</span></span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">void</span> wasm_optimized<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb94-30"><a href="#cb94-30" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تولید سریال‌سازی سازگار با WASM</span></span>
<span id="cb94-31"><a href="#cb94-31" aria-hidden="true" tabindex="-1"></a>        generate_wasm_binary_serialization<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb94-32"><a href="#cb94-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb94-33"><a href="#cb94-33" aria-hidden="true" tabindex="-1"></a>        <span class="co">// بهینه‌سازی برای مدل حافظه WASM</span></span>
<span id="cb94-34"><a href="#cb94-34" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> members <span class="op">=</span> <span class="bu">std::</span>meta::data_members_of<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb94-35"><a href="#cb94-35" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>meta::template_for<span class="op">&lt;</span>members<span class="op">&gt;([](</span><span class="kw">auto</span> member<span class="op">)</span> <span class="op">{</span></span>
<span id="cb94-36"><a href="#cb94-36" aria-hidden="true" tabindex="-1"></a>            apply_wasm_memory_layout_optimization<span class="op">(</span>member<span class="op">);</span></span>
<span id="cb94-37"><a href="#cb94-37" aria-hidden="true" tabindex="-1"></a>        <span class="op">});</span></span>
<span id="cb94-38"><a href="#cb94-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb94-39"><a href="#cb94-39" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تولید رابط interop WASM-JavaScript</span></span>
<span id="cb94-40"><a href="#cb94-40" aria-hidden="true" tabindex="-1"></a>        generate_js_binding_interface<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb94-41"><a href="#cb94-41" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb94-42"><a href="#cb94-42" aria-hidden="true" tabindex="-1"></a>        <span class="co">// کمینه‌سازی اندازه باینری WASM</span></span>
<span id="cb94-43"><a href="#cb94-43" aria-hidden="true" tabindex="-1"></a>        apply_size_optimizations<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb94-44"><a href="#cb94-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb94-45"><a href="#cb94-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb94-46"><a href="#cb94-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">// متاکلاس محاسبات GPU</span></span>
<span id="cb94-47"><a href="#cb94-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">void</span> gpu_accelerated<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb94-48"><a href="#cb94-48" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تولید kernel های CUDA/OpenCL برای عملیات موازی</span></span>
<span id="cb94-49"><a href="#cb94-49" aria-hidden="true" tabindex="-1"></a>        <span class="kw">auto</span> methods <span class="op">=</span> <span class="bu">std::</span>meta::member_functions_of<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb94-50"><a href="#cb94-50" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>meta::template_for<span class="op">&lt;</span>methods<span class="op">&gt;([](</span><span class="kw">auto</span> method<span class="op">)</span> <span class="op">{</span></span>
<span id="cb94-51"><a href="#cb94-51" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>is_parallelizable<span class="op">(</span>method<span class="op">))</span> <span class="op">{</span></span>
<span id="cb94-52"><a href="#cb94-52" aria-hidden="true" tabindex="-1"></a>                generate_gpu_kernel<span class="op">(</span>method<span class="op">);</span></span>
<span id="cb94-53"><a href="#cb94-53" aria-hidden="true" tabindex="-1"></a>                generate_cpu_gpu_bridge<span class="op">(</span>method<span class="op">);</span></span>
<span id="cb94-54"><a href="#cb94-54" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb94-55"><a href="#cb94-55" aria-hidden="true" tabindex="-1"></a>        <span class="op">});</span></span>
<span id="cb94-56"><a href="#cb94-56" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb94-57"><a href="#cb94-57" aria-hidden="true" tabindex="-1"></a>        <span class="co">// مدیریت حافظه برای GPU</span></span>
<span id="cb94-58"><a href="#cb94-58" aria-hidden="true" tabindex="-1"></a>        generate_gpu_memory_management<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb94-59"><a href="#cb94-59" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb94-60"><a href="#cb94-60" aria-hidden="true" tabindex="-1"></a>        <span class="co">// همگام‌سازی خودکار CPU-GPU</span></span>
<span id="cb94-61"><a href="#cb94-61" aria-hidden="true" tabindex="-1"></a>        generate_synchronization_code<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb94-62"><a href="#cb94-62" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb94-63"><a href="#cb94-63" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb94-64"><a href="#cb94-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-65"><a href="#cb94-65" aria-hidden="true" tabindex="-1"></a><span class="co">// مثال استقرار چندپلتفرمه</span></span>
<span id="cb94-66"><a href="#cb94-66" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>platform_optimized<span class="op">&lt;</span>cross_platform<span class="op">::</span>target_platform<span class="op">::</span>webassembly<span class="op">&gt;</span></span>
<span id="cb94-67"><a href="#cb94-67" aria-hidden="true" tabindex="-1"></a>      <span class="er">$</span>gpu_accelerated</span>
<span id="cb94-68"><a href="#cb94-68" aria-hidden="true" tabindex="-1"></a>      DataProcessor <span class="op">{</span></span>
<span id="cb94-69"><a href="#cb94-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb94-70"><a href="#cb94-70" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">float</span><span class="op">&gt;</span> data<span class="op">;</span></span>
<span id="cb94-71"><a href="#cb94-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb94-72"><a href="#cb94-72" aria-hidden="true" tabindex="-1"></a>    <span class="co">// خودکار پیاده‌سازی‌های خاص پلتفرم تولید می‌کند</span></span>
<span id="cb94-73"><a href="#cb94-73" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> process_data<span class="op">()</span> <span class="op">{</span></span>
<span id="cb94-74"><a href="#cb94-74" aria-hidden="true" tabindex="-1"></a>        <span class="co">// پیاده‌سازی CPU برای مجموعه داده‌های کوچک</span></span>
<span id="cb94-75"><a href="#cb94-75" aria-hidden="true" tabindex="-1"></a>        <span class="co">// پیاده‌سازی GPU برای مجموعه داده‌های بزرگ</span></span>
<span id="cb94-76"><a href="#cb94-76" aria-hidden="true" tabindex="-1"></a>        <span class="co">// پیاده‌سازی بهینه شده WASM برای استقرار وب</span></span>
<span id="cb94-77"><a href="#cb94-77" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb94-78"><a href="#cb94-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb94-79"><a href="#cb94-79" aria-hidden="true" tabindex="-1"></a>    <span class="co">// سریال‌سازی چندپلتفرمه</span></span>
<span id="cb94-80"><a href="#cb94-80" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> serialize<span class="op">()</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="cb94-81"><a href="#cb94-81" aria-hidden="true" tabindex="-1"></a>        <span class="co">// فرمت سریال‌سازی مناسب پلتفرم</span></span>
<span id="cb94-82"><a href="#cb94-82" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb94-83"><a href="#cb94-83" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<h3 data-number="2.42.3" id="سیستمهای-بلادرنگ-و-تعبیهشده"><span
class="header-section-number">2.42.3</span> 9.2.3 سیستم‌های بلادرنگ و
تعبیه‌شده</h3>
<p>بازتاب و متاکلاس‌ها برای پشتیبانی بهتر از محدودیت‌های سیستم‌های بلادرنگ
و تعبیه‌شده تکامل خواهند یافت [144]:</p>
<div class="sourceCode" id="cb95"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co">// بهینه‌سازی‌های سیستم‌های بلادرنگ و تعبیه‌شده</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> realtime <span class="op">{</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// مشخصات محدودیت‌های بلادرنگ</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> rt_constraints <span class="op">{</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>chrono::nanoseconds max_execution_time<span class="op">;</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">size_t</span> max_memory_usage<span class="op">;</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">bool</span> deterministic_timing_required<span class="op">;</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>        priority_level task_priority<span class="op">;</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// متاکلاس آگاه از بلادرنگ</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">template</span><span class="op">&lt;</span>rt_constraints Constraints<span class="op">&gt;</span></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">void</span> realtime_entity<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">// اعتبارسنجی مناسب بودن بلادرنگ</span></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_assert</span><span class="op">(</span>validate_rt_suitability<span class="op">&lt;</span>Constraints<span class="op">&gt;(</span>target<span class="op">),</span></span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;Type not suitable for real-time constraints&quot;</span><span class="op">);</span></span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تولید کد قطعی</span></span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span>Constraints<span class="op">.</span>deterministic_timing_required<span class="op">)</span> <span class="op">{</span></span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a>            generate_deterministic_implementations<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a>            eliminate_dynamic_memory_allocation<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تخصیص استخر حافظه</span></span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a>        generate_memory_pool_allocators<span class="op">(</span>target<span class="op">,</span> Constraints<span class="op">.</span>max_memory_usage<span class="op">);</span></span>
<span id="cb95-26"><a href="#cb95-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb95-27"><a href="#cb95-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">// پیاده‌سازی‌های بدون قفل در صورت امکان</span></span>
<span id="cb95-28"><a href="#cb95-28" aria-hidden="true" tabindex="-1"></a>        generate_lockfree_data_structures<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb95-29"><a href="#cb95-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb95-30"><a href="#cb95-30" aria-hidden="true" tabindex="-1"></a>        <span class="co">// نظارت بلادرنگ</span></span>
<span id="cb95-31"><a href="#cb95-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">constexpr</span> <span class="op">(</span>debug_mode<span class="op">)</span> <span class="op">{</span></span>
<span id="cb95-32"><a href="#cb95-32" aria-hidden="true" tabindex="-1"></a>            generate_timing_assertions<span class="op">(</span>target<span class="op">,</span> Constraints<span class="op">.</span>max_execution_time<span class="op">);</span></span>
<span id="cb95-33"><a href="#cb95-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb95-34"><a href="#cb95-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb95-35"><a href="#cb95-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb95-36"><a href="#cb95-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">// بهینه‌سازی‌های سیستم تعبیه‌شده</span></span>
<span id="cb95-37"><a href="#cb95-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">void</span> embedded_optimized<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb95-38"><a href="#cb95-38" aria-hidden="true" tabindex="-1"></a>        <span class="co">// کمینه‌سازی رد پای حافظه</span></span>
<span id="cb95-39"><a href="#cb95-39" aria-hidden="true" tabindex="-1"></a>        apply_memory_optimizations<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb95-40"><a href="#cb95-40" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb95-41"><a href="#cb95-41" aria-hidden="true" tabindex="-1"></a>        <span class="co">// حذف overhead تابع مجازی در صورت امکان</span></span>
<span id="cb95-42"><a href="#cb95-42" aria-hidden="true" tabindex="-1"></a>        devirtualize_methods<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb95-43"><a href="#cb95-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb95-44"><a href="#cb95-44" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تولید جداول جستجوی زمان کامپایل</span></span>
<span id="cb95-45"><a href="#cb95-45" aria-hidden="true" tabindex="-1"></a>        generate_constexpr_lookup_tables<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb95-46"><a href="#cb95-46" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb95-47"><a href="#cb95-47" aria-hidden="true" tabindex="-1"></a>        <span class="co">// بهینه‌سازی برای استفاده از حافظه فلش</span></span>
<span id="cb95-48"><a href="#cb95-48" aria-hidden="true" tabindex="-1"></a>        apply_flash_optimizations<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb95-49"><a href="#cb95-49" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb95-50"><a href="#cb95-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb95-51"><a href="#cb95-51" aria-hidden="true" tabindex="-1"></a>    <span class="co">// پشتیبانی سیستم بحرانی ایمنی</span></span>
<span id="cb95-52"><a href="#cb95-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> <span class="dt">void</span> safety_critical<span class="op">(</span><span class="bu">std::</span>meta::info target<span class="op">)</span> <span class="op">{</span></span>
<span id="cb95-53"><a href="#cb95-53" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تولید بررسی‌های ایمنی زمان اجرا</span></span>
<span id="cb95-54"><a href="#cb95-54" aria-hidden="true" tabindex="-1"></a>        generate_bounds_checking<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb95-55"><a href="#cb95-55" aria-hidden="true" tabindex="-1"></a>        generate_null_pointer_checks<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb95-56"><a href="#cb95-56" aria-hidden="true" tabindex="-1"></a>        generate_overflow_checking<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb95-57"><a href="#cb95-57" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb95-58"><a href="#cb95-58" aria-hidden="true" tabindex="-1"></a>        <span class="co">// پشتیبانی تأیید رسمی</span></span>
<span id="cb95-59"><a href="#cb95-59" aria-hidden="true" tabindex="-1"></a>        generate_verification_annotations<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb95-60"><a href="#cb95-60" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb95-61"><a href="#cb95-61" aria-hidden="true" tabindex="-1"></a>        <span class="co">// افزونگی برای تحمل خطا</span></span>
<span id="cb95-62"><a href="#cb95-62" aria-hidden="true" tabindex="-1"></a>        generate_redundant_computations<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb95-63"><a href="#cb95-63" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb95-64"><a href="#cb95-64" aria-hidden="true" tabindex="-1"></a>        <span class="co">// انطباق گواهینامه</span></span>
<span id="cb95-65"><a href="#cb95-65" aria-hidden="true" tabindex="-1"></a>        ensure_certification_compliance<span class="op">(</span>target<span class="op">);</span></span>
<span id="cb95-66"><a href="#cb95-66" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb95-67"><a href="#cb95-67" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb95-68"><a href="#cb95-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-69"><a href="#cb95-69" aria-hidden="true" tabindex="-1"></a><span class="co">// مثال سیستم بلادرنگ</span></span>
<span id="cb95-70"><a href="#cb95-70" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> rt_constraints sensor_constraints<span class="op">{</span></span>
<span id="cb95-71"><a href="#cb95-71" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>max_execution_time <span class="op">=</span> <span class="bu">std::</span>chrono::microseconds<span class="op">(</span><span class="dv">100</span><span class="op">),</span></span>
<span id="cb95-72"><a href="#cb95-72" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>max_memory_usage <span class="op">=</span> <span class="dv">1024</span><span class="op">,</span>  <span class="co">// بایت</span></span>
<span id="cb95-73"><a href="#cb95-73" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>deterministic_timing_required <span class="op">=</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb95-74"><a href="#cb95-74" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>task_priority <span class="op">=</span> priority_level<span class="op">::</span>high</span>
<span id="cb95-75"><a href="#cb95-75" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb95-76"><a href="#cb95-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-77"><a href="#cb95-77" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="er">$</span>realtime_entity<span class="op">&lt;</span>sensor_constraints<span class="op">&gt;</span></span>
<span id="cb95-78"><a href="#cb95-78" aria-hidden="true" tabindex="-1"></a>      <span class="er">$</span>embedded_optimized</span>
<span id="cb95-79"><a href="#cb95-79" aria-hidden="true" tabindex="-1"></a>      <span class="er">$</span>safety_critical</span>
<span id="cb95-80"><a href="#cb95-80" aria-hidden="true" tabindex="-1"></a>      SensorData <span class="op">{</span></span>
<span id="cb95-81"><a href="#cb95-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb95-82"><a href="#cb95-82" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> temperature<span class="op">;</span></span>
<span id="cb95-83"><a href="#cb95-83" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> pressure<span class="op">;</span></span>
<span id="cb95-84"><a href="#cb95-84" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>chrono::steady_clock::time_point timestamp<span class="op">;</span></span>
<span id="cb95-85"><a href="#cb95-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb95-86"><a href="#cb95-86" aria-hidden="true" tabindex="-1"></a>    <span class="co">// همه متدها خودکار برای محدودیت‌های بلادرنگ بهینه شدند</span></span>
<span id="cb95-87"><a href="#cb95-87" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> update_readings<span class="op">(</span><span class="dt">float</span> temp<span class="op">,</span> <span class="dt">float</span> press<span class="op">)</span> <span class="op">{</span></span>
<span id="cb95-88"><a href="#cb95-88" aria-hidden="true" tabindex="-1"></a>        <span class="co">// زمان اجرای قطعی و محدود</span></span>
<span id="cb95-89"><a href="#cb95-89" aria-hidden="true" tabindex="-1"></a>        <span class="co">// بدون تخصیص حافظه پویا</span></span>
<span id="cb95-90"><a href="#cb95-90" aria-hidden="true" tabindex="-1"></a>        <span class="co">// بررسی‌های ایمنی شامل شده</span></span>
<span id="cb95-91"><a href="#cb95-91" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb95-92"><a href="#cb95-92" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<h2 data-number="2.43" id="تکامل-ابزارها-و-ide"><span
class="header-section-number">2.43</span> 9.3 تکامل ابزارها و IDE</h2>
<h3 data-number="2.43.1" id="پشتیبانی-پیشرفته-دیباگ"><span
class="header-section-number">2.43.1</span> 9.3.1 پشتیبانی پیشرفته
دیباگ</h3>
<p>ابزارهای دیباگ آینده پشتیبانی پیچیده‌ای از کد مبتنی بر بازتاب ارائه
خواهند داد [145]:</p>
<div class="sourceCode" id="cb96"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co">// زیرساخت پیشرفته دیباگ برای بازتاب</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> debug_support <span class="op">{</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// یکپارچگی تقویت شده debugger</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> reflection_debugger <span class="op">{</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// بازرسی تصویری meta-object</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>        debug_visualization visualize_meta_object<span class="op">(</span><span class="bu">std::</span>meta::info meta_obj<span class="op">)</span> <span class="op">{</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>            debug_visualization viz<span class="op">;</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>            <span class="co">// ایجاد نمای درختی تعاملی سلسله مراتب meta-object</span></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>            viz<span class="op">.</span>root <span class="op">=</span> create_meta_object_tree_node<span class="op">(</span>meta_obj<span class="op">);</span></span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>            <span class="co">// اضافه کردن پانل‌های خاصیت meta-object</span></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>            viz<span class="op">.</span>properties <span class="op">=</span> extract_meta_object_properties<span class="op">(</span>meta_obj<span class="op">);</span></span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>            <span class="co">// نشان دادن روابط با سایر meta-object ها</span></span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>            viz<span class="op">.</span>relationships <span class="op">=</span> find_meta_object_relationships<span class="op">(</span>meta_obj<span class="op">);</span></span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> viz<span class="op">;</span></span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">// دیباگ قدم به قدم کاربرد متاکلاس</span></span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a>        debug_session debug_metaclass_application<span class="op">(</span></span>
<span id="cb96-24"><a href="#cb96-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> metaclass_application<span class="op">&amp;</span> application<span class="op">)</span> <span class="op">{</span></span>
<span id="cb96-25"><a href="#cb96-25" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb96-26"><a href="#cb96-26" aria-hidden="true" tabindex="-1"></a>            debug_session session<span class="op">;</span></span>
<span id="cb96-27"><a href="#cb96-27" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb96-28"><a href="#cb96-28" aria-hidden="true" tabindex="-1"></a>            <span class="co">// تنظیم نقاط شکست در هر مرحله تولید</span></span>
<span id="cb96-29"><a href="#cb96-29" aria-hidden="true" tabindex="-1"></a>            session<span class="op">.</span>breakpoints <span class="op">=</span> create_generation_breakpoints<span class="op">(</span>application<span class="op">);</span></span>
<span id="cb96-30"><a href="#cb96-30" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb96-31"><a href="#cb96-31" aria-hidden="true" tabindex="-1"></a>            <span class="co">// ردیابی تغییرات وضعیت meta-object</span></span>
<span id="cb96-32"><a href="#cb96-32" aria-hidden="true" tabindex="-1"></a>            session<span class="op">.</span>state_tracker <span class="op">=</span> create_meta_object_state_tracker<span class="op">(</span>application<span class="op">);</span></span>
<span id="cb96-33"><a href="#cb96-33" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb96-34"><a href="#cb96-34" aria-hidden="true" tabindex="-1"></a>            <span class="co">// تجسم فرآیند تولید کد</span></span>
<span id="cb96-35"><a href="#cb96-35" aria-hidden="true" tabindex="-1"></a>            session<span class="op">.</span>generation_visualizer <span class="op">=</span> create_generation_visualizer<span class="op">(</span>application<span class="op">);</span></span>
<span id="cb96-36"><a href="#cb96-36" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb96-37"><a href="#cb96-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> session<span class="op">;</span></span>
<span id="cb96-38"><a href="#cb96-38" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb96-39"><a href="#cb96-39" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb96-40"><a href="#cb96-40" aria-hidden="true" tabindex="-1"></a>        <span class="co">// دیباگ بازتاب زمان اجرا</span></span>
<span id="cb96-41"><a href="#cb96-41" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> debug_runtime_reflection<span class="op">(</span><span class="at">const</span> runtime_reflection_context<span class="op">&amp;</span> context<span class="op">)</span> <span class="op">{</span></span>
<span id="cb96-42"><a href="#cb96-42" aria-hidden="true" tabindex="-1"></a>            <span class="co">// نشان دادن اطلاعات نوع زمان اجرا موجود</span></span>
<span id="cb96-43"><a href="#cb96-43" aria-hidden="true" tabindex="-1"></a>            display_runtime_types<span class="op">(</span>context<span class="op">);</span></span>
<span id="cb96-44"><a href="#cb96-44" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb96-45"><a href="#cb96-45" aria-hidden="true" tabindex="-1"></a>            <span class="co">// بازرسی تعاملی عضو</span></span>
<span id="cb96-46"><a href="#cb96-46" aria-hidden="true" tabindex="-1"></a>            enable_interactive_member_inspection<span class="op">(</span>context<span class="op">);</span></span>
<span id="cb96-47"><a href="#cb96-47" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb96-48"><a href="#cb96-48" aria-hidden="true" tabindex="-1"></a>            <span class="co">// فراخوانی متد پویا از debugger</span></span>
<span id="cb96-49"><a href="#cb96-49" aria-hidden="true" tabindex="-1"></a>            enable_debugger_method_invocation<span class="op">(</span>context<span class="op">);</span></span>
<span id="cb96-50"><a href="#cb96-50" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb96-51"><a href="#cb96-51" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb96-52"><a href="#cb96-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb96-53"><a href="#cb96-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ردیابی تولید کد</span></span>
<span id="cb96-54"><a href="#cb96-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> generation_tracer <span class="op">{</span></span>
<span id="cb96-55"><a href="#cb96-55" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span>generation_step<span class="op">&gt;</span> <span class="va">trace_</span><span class="op">;</span></span>
<span id="cb96-56"><a href="#cb96-56" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb96-57"><a href="#cb96-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb96-58"><a href="#cb96-58" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> record_generation_step<span class="op">(</span><span class="at">const</span> generation_step<span class="op">&amp;</span> step<span class="op">)</span> <span class="op">{</span></span>
<span id="cb96-59"><a href="#cb96-59" aria-hidden="true" tabindex="-1"></a>            <span class="va">trace_</span><span class="op">.</span>push_back<span class="op">(</span>step<span class="op">);</span></span>
<span id="cb96-60"><a href="#cb96-60" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb96-61"><a href="#cb96-61" aria-hidden="true" tabindex="-1"></a>            <span class="co">// تجسم ردیابی بلادرنگ</span></span>
<span id="cb96-62"><a href="#cb96-62" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>debugger_attached<span class="op">())</span> <span class="op">{</span></span>
<span id="cb96-63"><a href="#cb96-63" aria-hidden="true" tabindex="-1"></a>                send_trace_update_to_debugger<span class="op">(</span>step<span class="op">);</span></span>
<span id="cb96-64"><a href="#cb96-64" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb96-65"><a href="#cb96-65" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb96-66"><a href="#cb96-66" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb96-67"><a href="#cb96-67" aria-hidden="true" tabindex="-1"></a>        <span class="co">// بازپخش تولید کد برای دیباگ</span></span>
<span id="cb96-68"><a href="#cb96-68" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> replay_generation<span class="op">(</span><span class="at">const</span> replay_options<span class="op">&amp;</span> options<span class="op">)</span> <span class="op">{</span></span>
<span id="cb96-69"><a href="#cb96-69" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> step <span class="op">:</span> <span class="va">trace_</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb96-70"><a href="#cb96-70" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>options<span class="op">.</span>should_replay_step<span class="op">(</span>step<span class="op">))</span> <span class="op">{</span></span>
<span id="cb96-71"><a href="#cb96-71" aria-hidden="true" tabindex="-1"></a>                    replay_generation_step<span class="op">(</span>step<span class="op">);</span></span>
<span id="cb96-72"><a href="#cb96-72" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb96-73"><a href="#cb96-73" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="op">(</span>options<span class="op">.</span>interactive_mode<span class="op">)</span> <span class="op">{</span></span>
<span id="cb96-74"><a href="#cb96-74" aria-hidden="true" tabindex="-1"></a>                        wait_for_debugger_continuation<span class="op">();</span></span>
<span id="cb96-75"><a href="#cb96-75" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span>
<span id="cb96-76"><a href="#cb96-76" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb96-77"><a href="#cb96-77" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb96-78"><a href="#cb96-78" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb96-79"><a href="#cb96-79" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb96-80"><a href="#cb96-80" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="2.43.2" id="تقویتهای-ide"><span
class="header-section-number">2.43.2</span> 9.3.2 تقویت‌های IDE</h3>
<p>محیط‌های توسعه یکپارچه برای ارائه پشتیبانی جامع از بازتاب و متاکلاس‌ها
تکامل خواهند یافت [146]:</p>
<div class="sourceCode" id="cb97"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co">// مشخصات تقویت IDE</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> ide_enhancements <span class="op">{</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تکمیل کد هوشمند برای بازتاب</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> reflection_intellisense <span class="op">{</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تکمیل‌های meta-object آگاه از زمینه</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>        completion_list get_meta_object_completions<span class="op">(</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> code_context<span class="op">&amp;</span> context<span class="op">,</span></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> <span class="bu">std::</span>meta::info<span class="op">&amp;</span> meta_obj<span class="op">)</span> <span class="op">{</span></span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>            completion_list completions<span class="op">;</span></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>            <span class="co">// عملیات موجود بر اساس نوع meta-object</span></span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> operations <span class="op">=</span> get_available_operations<span class="op">(</span>meta_obj<span class="op">);</span></span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> op <span class="op">:</span> operations<span class="op">)</span> <span class="op">{</span></span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>                completions<span class="op">.</span>add_operation_completion<span class="op">(</span>op<span class="op">);</span></span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a>            <span class="co">// تکمیل‌های دسترسی عضو</span></span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>is_type_meta_object<span class="op">(</span>meta_obj<span class="op">))</span> <span class="op">{</span></span>
<span id="cb97-21"><a href="#cb97-21" aria-hidden="true" tabindex="-1"></a>                <span class="kw">auto</span> members <span class="op">=</span> get_type_members<span class="op">(</span>meta_obj<span class="op">);</span></span>
<span id="cb97-22"><a href="#cb97-22" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> member <span class="op">:</span> members<span class="op">)</span> <span class="op">{</span></span>
<span id="cb97-23"><a href="#cb97-23" aria-hidden="true" tabindex="-1"></a>                    completions<span class="op">.</span>add_member_completion<span class="op">(</span>member<span class="op">);</span></span>
<span id="cb97-24"><a href="#cb97-24" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb97-25"><a href="#cb97-25" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb97-26"><a href="#cb97-26" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb97-27"><a href="#cb97-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> completions<span class="op">;</span></span>
<span id="cb97-28"><a href="#cb97-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb97-29"><a href="#cb97-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb97-30"><a href="#cb97-30" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تکمیل‌های قالب متاکلاس</span></span>
<span id="cb97-31"><a href="#cb97-31" aria-hidden="true" tabindex="-1"></a>        completion_list get_metaclass_completions<span class="op">(</span><span class="at">const</span> type_context<span class="op">&amp;</span> context<span class="op">)</span> <span class="op">{</span></span>
<span id="cb97-32"><a href="#cb97-32" aria-hidden="true" tabindex="-1"></a>            completion_list completions<span class="op">;</span></span>
<span id="cb97-33"><a href="#cb97-33" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb97-34"><a href="#cb97-34" aria-hidden="true" tabindex="-1"></a>            <span class="co">// متاکلاس‌های موجود بر اساس مشخصات نوع</span></span>
<span id="cb97-35"><a href="#cb97-35" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> suitable_metaclasses <span class="op">=</span> find_suitable_metaclasses<span class="op">(</span>context<span class="op">);</span></span>
<span id="cb97-36"><a href="#cb97-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> metaclass <span class="op">:</span> suitable_metaclasses<span class="op">)</span> <span class="op">{</span></span>
<span id="cb97-37"><a href="#cb97-37" aria-hidden="true" tabindex="-1"></a>                completions<span class="op">.</span>add_metaclass_completion<span class="op">(</span>metaclass<span class="op">);</span></span>
<span id="cb97-38"><a href="#cb97-38" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb97-39"><a href="#cb97-39" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb97-40"><a href="#cb97-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> completions<span class="op">;</span></span>
<span id="cb97-41"><a href="#cb97-41" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb97-42"><a href="#cb97-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb97-43"><a href="#cb97-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb97-44"><a href="#cb97-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">// پیش‌نمایش زنده تولید کد</span></span>
<span id="cb97-45"><a href="#cb97-45" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> live_generation_preview <span class="op">{</span></span>
<span id="cb97-46"><a href="#cb97-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb97-47"><a href="#cb97-47" aria-hidden="true" tabindex="-1"></a>        <span class="co">// نمایش کد تولید شده بلادرنگ همراه با تایپ کاربر</span></span>
<span id="cb97-48"><a href="#cb97-48" aria-hidden="true" tabindex="-1"></a>        generated_code_preview get_live_preview<span class="op">(</span></span>
<span id="cb97-49"><a href="#cb97-49" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> partial_metaclass_application<span class="op">&amp;</span> partial_app<span class="op">)</span> <span class="op">{</span></span>
<span id="cb97-50"><a href="#cb97-50" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb97-51"><a href="#cb97-51" aria-hidden="true" tabindex="-1"></a>            <span class="co">// تولید کد بر اساس وضعیت فعلی</span></span>
<span id="cb97-52"><a href="#cb97-52" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> generated <span class="op">=</span> simulate_code_generation<span class="op">(</span>partial_app<span class="op">);</span></span>
<span id="cb97-53"><a href="#cb97-53" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb97-54"><a href="#cb97-54" aria-hidden="true" tabindex="-1"></a>            <span class="co">// برجسته‌سازی تفاوت‌ها از پیش‌نمایش قبلی</span></span>
<span id="cb97-55"><a href="#cb97-55" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> differences <span class="op">=</span> compute_generation_differences<span class="op">(</span></span>
<span id="cb97-56"><a href="#cb97-56" aria-hidden="true" tabindex="-1"></a>                generated<span class="op">,</span> <span class="va">previous_preview_</span><span class="op">);</span></span>
<span id="cb97-57"><a href="#cb97-57" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb97-58"><a href="#cb97-58" aria-hidden="true" tabindex="-1"></a>            <span class="va">previous_preview_</span> <span class="op">=</span> generated<span class="op">;</span></span>
<span id="cb97-59"><a href="#cb97-59" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb97-60"><a href="#cb97-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> generated_code_preview<span class="op">{</span></span>
<span id="cb97-61"><a href="#cb97-61" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>generated_code <span class="op">=</span> generated<span class="op">,</span></span>
<span id="cb97-62"><a href="#cb97-62" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>differences <span class="op">=</span> differences<span class="op">,</span></span>
<span id="cb97-63"><a href="#cb97-63" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>compilation_status <span class="op">=</span> check_compilation_status<span class="op">(</span>generated<span class="op">)</span></span>
<span id="cb97-64"><a href="#cb97-64" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb97-65"><a href="#cb97-65" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb97-66"><a href="#cb97-66" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb97-67"><a href="#cb97-67" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تنظیم تعاملی پارامترهای متاکلاس</span></span>
<span id="cb97-68"><a href="#cb97-68" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> adjust_metaclass_parameters<span class="op">(</span></span>
<span id="cb97-69"><a href="#cb97-69" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> parameter_adjustment<span class="op">&amp;</span> adjustment<span class="op">)</span> <span class="op">{</span></span>
<span id="cb97-70"><a href="#cb97-70" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb97-71"><a href="#cb97-71" aria-hidden="true" tabindex="-1"></a>            <span class="co">// به‌روزرسانی کاربرد متاکلاس با پارامترهای جدید</span></span>
<span id="cb97-72"><a href="#cb97-72" aria-hidden="true" tabindex="-1"></a>            update_metaclass_application<span class="op">(</span>adjustment<span class="op">);</span></span>
<span id="cb97-73"><a href="#cb97-73" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb97-74"><a href="#cb97-74" aria-hidden="true" tabindex="-1"></a>            <span class="co">// تولید مجدد پیش‌نمایش</span></span>
<span id="cb97-75"><a href="#cb97-75" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> new_preview <span class="op">=</span> get_live_preview<span class="op">(</span><span class="va">current_application_</span><span class="op">);</span></span>
<span id="cb97-76"><a href="#cb97-76" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb97-77"><a href="#cb97-77" aria-hidden="true" tabindex="-1"></a>            <span class="co">// به‌روزرسانی نمایش IDE</span></span>
<span id="cb97-78"><a href="#cb97-78" aria-hidden="true" tabindex="-1"></a>            update_preview_display<span class="op">(</span>new_preview<span class="op">);</span></span>
<span id="cb97-79"><a href="#cb97-79" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb97-80"><a href="#cb97-80" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb97-81"><a href="#cb97-81" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb97-82"><a href="#cb97-82" aria-hidden="true" tabindex="-1"></a>        generated_code <span class="va">previous_preview_</span><span class="op">;</span></span>
<span id="cb97-83"><a href="#cb97-83" aria-hidden="true" tabindex="-1"></a>        partial_metaclass_application <span class="va">current_application_</span><span class="op">;</span></span>
<span id="cb97-84"><a href="#cb97-84" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb97-85"><a href="#cb97-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb97-86"><a href="#cb97-86" aria-hidden="true" tabindex="-1"></a>    <span class="co">// پشتیبانی بازساختاری برای کد بازتاب</span></span>
<span id="cb97-87"><a href="#cb97-87" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> reflection_refactoring <span class="op">{</span></span>
<span id="cb97-88"><a href="#cb97-88" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb97-89"><a href="#cb97-89" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تغییر نام ایمن اعضای بازتابی</span></span>
<span id="cb97-90"><a href="#cb97-90" aria-hidden="true" tabindex="-1"></a>        refactoring_plan plan_member_rename<span class="op">(</span></span>
<span id="cb97-91"><a href="#cb97-91" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> member_reference<span class="op">&amp;</span> member<span class="op">,</span></span>
<span id="cb97-92"><a href="#cb97-92" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> <span class="bu">std::</span>string<span class="op">&amp;</span> new_name<span class="op">)</span> <span class="op">{</span></span>
<span id="cb97-93"><a href="#cb97-93" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb97-94"><a href="#cb97-94" aria-hidden="true" tabindex="-1"></a>            refactoring_plan plan<span class="op">;</span></span>
<span id="cb97-95"><a href="#cb97-95" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb97-96"><a href="#cb97-96" aria-hidden="true" tabindex="-1"></a>            <span class="co">// پیدا کردن همه مراجع مبتنی بر بازتاب</span></span>
<span id="cb97-97"><a href="#cb97-97" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> reflection_refs <span class="op">=</span> find_reflection_references<span class="op">(</span>member<span class="op">);</span></span>
<span id="cb97-98"><a href="#cb97-98" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> ref <span class="op">:</span> reflection_refs<span class="op">)</span> <span class="op">{</span></span>
<span id="cb97-99"><a href="#cb97-99" aria-hidden="true" tabindex="-1"></a>                plan<span class="op">.</span>add_change<span class="op">(</span>create_reflection_reference_update<span class="op">(</span>ref<span class="op">,</span> new_name<span class="op">));</span></span>
<span id="cb97-100"><a href="#cb97-100" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb97-101"><a href="#cb97-101" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb97-102"><a href="#cb97-102" aria-hidden="true" tabindex="-1"></a>            <span class="co">// پیدا کردن کد تولید شده که از عضو استفاده می‌کند</span></span>
<span id="cb97-103"><a href="#cb97-103" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> generated_refs <span class="op">=</span> find_generated_code_references<span class="op">(</span>member<span class="op">);</span></span>
<span id="cb97-104"><a href="#cb97-104" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> ref <span class="op">:</span> generated_refs<span class="op">)</span> <span class="op">{</span></span>
<span id="cb97-105"><a href="#cb97-105" aria-hidden="true" tabindex="-1"></a>                plan<span class="op">.</span>add_regeneration_request<span class="op">(</span>ref<span class="op">.</span><span class="dt">containing_type</span><span class="op">);</span></span>
<span id="cb97-106"><a href="#cb97-106" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb97-107"><a href="#cb97-107" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb97-108"><a href="#cb97-108" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> plan<span class="op">;</span></span>
<span id="cb97-109"><a href="#cb97-109" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb97-110"><a href="#cb97-110" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb97-111"><a href="#cb97-111" aria-hidden="true" tabindex="-1"></a>        <span class="co">// استخراج متاکلاس از الگوهای تکراری</span></span>
<span id="cb97-112"><a href="#cb97-112" aria-hidden="true" tabindex="-1"></a>        refactoring_plan extract_metaclass<span class="op">(</span></span>
<span id="cb97-113"><a href="#cb97-113" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> <span class="bu">std::</span>vector<span class="op">&lt;</span>type_reference<span class="op">&gt;&amp;</span> similar_types<span class="op">)</span> <span class="op">{</span></span>
<span id="cb97-114"><a href="#cb97-114" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb97-115"><a href="#cb97-115" aria-hidden="true" tabindex="-1"></a>            <span class="co">// تحلیل الگوهای مشترک</span></span>
<span id="cb97-116"><a href="#cb97-116" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> common_patterns <span class="op">=</span> analyze_common_patterns<span class="op">(</span>similar_types<span class="op">);</span></span>
<span id="cb97-117"><a href="#cb97-117" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb97-118"><a href="#cb97-118" aria-hidden="true" tabindex="-1"></a>            <span class="co">// تولید قالب متاکلاس</span></span>
<span id="cb97-119"><a href="#cb97-119" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> metaclass_template <span class="op">=</span> generate_metaclass_template<span class="op">(</span>common_patterns<span class="op">);</span></span>
<span id="cb97-120"><a href="#cb97-120" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb97-121"><a href="#cb97-121" aria-hidden="true" tabindex="-1"></a>            <span class="co">// برنامه‌ریزی کاربرد برای انواع موجود</span></span>
<span id="cb97-122"><a href="#cb97-122" aria-hidden="true" tabindex="-1"></a>            refactoring_plan plan<span class="op">;</span></span>
<span id="cb97-123"><a href="#cb97-123" aria-hidden="true" tabindex="-1"></a>            plan<span class="op">.</span>add_metaclass_creation<span class="op">(</span>metaclass_template<span class="op">);</span></span>
<span id="cb97-124"><a href="#cb97-124" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb97-125"><a href="#cb97-125" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> type <span class="op">:</span> similar_types<span class="op">)</span> <span class="op">{</span></span>
<span id="cb97-126"><a href="#cb97-126" aria-hidden="true" tabindex="-1"></a>                plan<span class="op">.</span>add_metaclass_application<span class="op">(</span>type<span class="op">,</span> metaclass_template<span class="op">);</span></span>
<span id="cb97-127"><a href="#cb97-127" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb97-128"><a href="#cb97-128" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb97-129"><a href="#cb97-129" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> plan<span class="op">;</span></span>
<span id="cb97-130"><a href="#cb97-130" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb97-131"><a href="#cb97-131" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb97-132"><a href="#cb97-132" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="2.43.3" id="ابزارهای-تحلیل-کارایی"><span
class="header-section-number">2.43.3</span> 9.3.3 ابزارهای تحلیل
کارایی</h3>
<p>ابزارهای تخصصی برای تحلیل کارایی بازتاب و متاکلاس‌ها ضروری خواهند بود
[147]:</p>
<div class="sourceCode" id="cb98"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ابزارهای تحلیل کارایی برای بازتاب</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> performance_tools <span class="op">{</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// تحلیلگر کارایی زمان کامپایل</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> compilation_analyzer <span class="op">{</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span>compilation_metric<span class="op">&gt;</span> <span class="va">metrics_</span><span class="op">;</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// اندازه‌گیری تأثیر متاکلاس روی کامپایل</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>        compilation_impact measure_metaclass_impact<span class="op">(</span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> metaclass_application<span class="op">&amp;</span> application<span class="op">)</span> <span class="op">{</span></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>            compilation_impact impact<span class="op">;</span></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>            <span class="co">// اندازه‌گیری زمان کامپایل با و بدون متاکلاس</span></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> baseline_time <span class="op">=</span> measure_baseline_compilation<span class="op">(</span>application<span class="op">.</span><span class="dt">target_type</span><span class="op">);</span></span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> metaclass_time <span class="op">=</span> measure_metaclass_compilation<span class="op">(</span>application<span class="op">);</span></span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>            impact<span class="op">.</span>time_overhead <span class="op">=</span> metaclass_time <span class="op">-</span> baseline_time<span class="op">;</span></span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a>            impact<span class="op">.</span>memory_overhead <span class="op">=</span> measure_memory_overhead<span class="op">(</span>application<span class="op">);</span></span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a>            impact<span class="op">.</span>binary_size_impact <span class="op">=</span> measure_binary_size_impact<span class="op">(</span>application<span class="op">);</span></span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> impact<span class="op">;</span></span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تحلیل کارایی کوئری‌های بازتاب</span></span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a>        reflection_performance_profile profile_reflection_queries<span class="op">(</span></span>
<span id="cb98-27"><a href="#cb98-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> <span class="bu">std::</span>vector<span class="op">&lt;</span>reflection_query<span class="op">&gt;&amp;</span> queries<span class="op">)</span> <span class="op">{</span></span>
<span id="cb98-28"><a href="#cb98-28" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb98-29"><a href="#cb98-29" aria-hidden="true" tabindex="-1"></a>            reflection_performance_profile profile<span class="op">;</span></span>
<span id="cb98-30"><a href="#cb98-30" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb98-31"><a href="#cb98-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> query <span class="op">:</span> queries<span class="op">)</span> <span class="op">{</span></span>
<span id="cb98-32"><a href="#cb98-32" aria-hidden="true" tabindex="-1"></a>                <span class="kw">auto</span> query_metrics <span class="op">=</span> measure_query_performance<span class="op">(</span>query<span class="op">);</span></span>
<span id="cb98-33"><a href="#cb98-33" aria-hidden="true" tabindex="-1"></a>                profile<span class="op">.</span>add_query_metrics<span class="op">(</span>query<span class="op">,</span> query_metrics<span class="op">);</span></span>
<span id="cb98-34"><a href="#cb98-34" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb98-35"><a href="#cb98-35" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb98-36"><a href="#cb98-36" aria-hidden="true" tabindex="-1"></a>            <span class="co">// شناسایی گلوگاه‌های کارایی</span></span>
<span id="cb98-37"><a href="#cb98-37" aria-hidden="true" tabindex="-1"></a>            profile<span class="op">.</span>bottlenecks <span class="op">=</span> identify_performance_bottlenecks<span class="op">(</span>profile<span class="op">);</span></span>
<span id="cb98-38"><a href="#cb98-38" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb98-39"><a href="#cb98-39" aria-hidden="true" tabindex="-1"></a>            <span class="co">// پیشنهاد بهینه‌سازی‌ها</span></span>
<span id="cb98-40"><a href="#cb98-40" aria-hidden="true" tabindex="-1"></a>            profile<span class="op">.</span>optimization_suggestions <span class="op">=</span> suggest_optimizations<span class="op">(</span>profile<span class="op">);</span></span>
<span id="cb98-41"><a href="#cb98-41" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb98-42"><a href="#cb98-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> profile<span class="op">;</span></span>
<span id="cb98-43"><a href="#cb98-43" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb98-44"><a href="#cb98-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb98-45"><a href="#cb98-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-46"><a href="#cb98-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">// پروفایلر کارایی زمان اجرا</span></span>
<span id="cb98-47"><a href="#cb98-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> runtime_profiler <span class="op">{</span></span>
<span id="cb98-48"><a href="#cb98-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb98-49"><a href="#cb98-49" aria-hidden="true" tabindex="-1"></a>        <span class="co">// پروفایل کارایی کد تولید شده</span></span>
<span id="cb98-50"><a href="#cb98-50" aria-hidden="true" tabindex="-1"></a>        runtime_profile profile_generated_code<span class="op">(</span></span>
<span id="cb98-51"><a href="#cb98-51" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> generated_code_execution<span class="op">&amp;</span> execution<span class="op">)</span> <span class="op">{</span></span>
<span id="cb98-52"><a href="#cb98-52" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb98-53"><a href="#cb98-53" aria-hidden="true" tabindex="-1"></a>            runtime_profile profile<span class="op">;</span></span>
<span id="cb98-54"><a href="#cb98-54" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb98-55"><a href="#cb98-55" aria-hidden="true" tabindex="-1"></a>            <span class="co">// اندازه‌گیری زمان اجرای متدهای تولید شده</span></span>
<span id="cb98-56"><a href="#cb98-56" aria-hidden="true" tabindex="-1"></a>            profile<span class="op">.</span>method_timings <span class="op">=</span> measure_method_timings<span class="op">(</span>execution<span class="op">);</span></span>
<span id="cb98-57"><a href="#cb98-57" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb98-58"><a href="#cb98-58" aria-hidden="true" tabindex="-1"></a>            <span class="co">// الگوهای تخصیص حافظه</span></span>
<span id="cb98-59"><a href="#cb98-59" aria-hidden="true" tabindex="-1"></a>            profile<span class="op">.</span>allocation_patterns <span class="op">=</span> analyze_allocation_patterns<span class="op">(</span>execution<span class="op">);</span></span>
<span id="cb98-60"><a href="#cb98-60" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb98-61"><a href="#cb98-61" aria-hidden="true" tabindex="-1"></a>            <span class="co">// کارایی کش</span></span>
<span id="cb98-62"><a href="#cb98-62" aria-hidden="true" tabindex="-1"></a>            profile<span class="op">.</span>cache_metrics <span class="op">=</span> measure_cache_performance<span class="op">(</span>execution<span class="op">);</span></span>
<span id="cb98-63"><a href="#cb98-63" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb98-64"><a href="#cb98-64" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> profile<span class="op">;</span></span>
<span id="cb98-65"><a href="#cb98-65" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb98-66"><a href="#cb98-66" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb98-67"><a href="#cb98-67" aria-hidden="true" tabindex="-1"></a>        <span class="co">// مقایسه کارایی با پیاده‌سازی‌های دستی</span></span>
<span id="cb98-68"><a href="#cb98-68" aria-hidden="true" tabindex="-1"></a>        performance_comparison compare_with_manual<span class="op">(</span></span>
<span id="cb98-69"><a href="#cb98-69" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> generated_implementation<span class="op">&amp;</span> generated<span class="op">,</span></span>
<span id="cb98-70"><a href="#cb98-70" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> manual_implementation<span class="op">&amp;</span> manual<span class="op">)</span> <span class="op">{</span></span>
<span id="cb98-71"><a href="#cb98-71" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb98-72"><a href="#cb98-72" aria-hidden="true" tabindex="-1"></a>            performance_comparison comparison<span class="op">;</span></span>
<span id="cb98-73"><a href="#cb98-73" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb98-74"><a href="#cb98-74" aria-hidden="true" tabindex="-1"></a>            <span class="co">// مقایسه زمان اجرا</span></span>
<span id="cb98-75"><a href="#cb98-75" aria-hidden="true" tabindex="-1"></a>            comparison<span class="op">.</span>execution_time_ratio <span class="op">=</span> </span>
<span id="cb98-76"><a href="#cb98-76" aria-hidden="true" tabindex="-1"></a>                measure_execution_time<span class="op">(</span>generated<span class="op">)</span> <span class="op">/</span> measure_execution_time<span class="op">(</span>manual<span class="op">);</span></span>
<span id="cb98-77"><a href="#cb98-77" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb98-78"><a href="#cb98-78" aria-hidden="true" tabindex="-1"></a>            <span class="co">// مقایسه استفاده از حافظه</span></span>
<span id="cb98-79"><a href="#cb98-79" aria-hidden="true" tabindex="-1"></a>            comparison<span class="op">.</span>memory_usage_ratio <span class="op">=</span> </span>
<span id="cb98-80"><a href="#cb98-80" aria-hidden="true" tabindex="-1"></a>                measure_memory_usage<span class="op">(</span>generated<span class="op">)</span> <span class="op">/</span> measure_memory_usage<span class="op">(</span>manual<span class="op">);</span></span>
<span id="cb98-81"><a href="#cb98-81" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb98-82"><a href="#cb98-82" aria-hidden="true" tabindex="-1"></a>            <span class="co">// مقایسه اندازه کد</span></span>
<span id="cb98-83"><a href="#cb98-83" aria-hidden="true" tabindex="-1"></a>            comparison<span class="op">.</span>code_size_ratio <span class="op">=</span> </span>
<span id="cb98-84"><a href="#cb98-84" aria-hidden="true" tabindex="-1"></a>                measure_code_size<span class="op">(</span>generated<span class="op">)</span> <span class="op">/</span> measure_code_size<span class="op">(</span>manual<span class="op">);</span></span>
<span id="cb98-85"><a href="#cb98-85" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb98-86"><a href="#cb98-86" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> comparison<span class="op">;</span></span>
<span id="cb98-87"><a href="#cb98-87" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb98-88"><a href="#cb98-88" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb98-89"><a href="#cb98-89" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-90"><a href="#cb98-90" aria-hidden="true" tabindex="-1"></a>    <span class="co">// موتور توصیه بهینه‌سازی</span></span>
<span id="cb98-91"><a href="#cb98-91" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> optimization_engine <span class="op">{</span></span>
<span id="cb98-92"><a href="#cb98-92" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb98-93"><a href="#cb98-93" aria-hidden="true" tabindex="-1"></a>        <span class="co">// تحلیل داده‌های کارایی و پیشنهاد بهبودها</span></span>
<span id="cb98-94"><a href="#cb98-94" aria-hidden="true" tabindex="-1"></a>        optimization_recommendations analyze_performance<span class="op">(</span></span>
<span id="cb98-95"><a href="#cb98-95" aria-hidden="true" tabindex="-1"></a>            <span class="at">const</span> performance_data<span class="op">&amp;</span> data<span class="op">)</span> <span class="op">{</span></span>
<span id="cb98-96"><a href="#cb98-96" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb98-97"><a href="#cb98-97" aria-hidden="true" tabindex="-1"></a>            optimization_recommendations recommendations<span class="op">;</span></span>
<span id="cb98-98"><a href="#cb98-98" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb98-99"><a href="#cb98-99" aria-hidden="true" tabindex="-1"></a>            <span class="co">// شناسایی مسیرهای داغ در کد تولید شده</span></span>
<span id="cb98-100"><a href="#cb98-100" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> hot_paths <span class="op">=</span> identify_hot_paths<span class="op">(</span>data<span class="op">);</span></span>
<span id="cb98-101"><a href="#cb98-101" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="at">const</span> <span class="kw">auto</span><span class="op">&amp;</span> path <span class="op">:</span> hot_paths<span class="op">)</span> <span class="op">{</span></span>
<span id="cb98-102"><a href="#cb98-102" aria-hidden="true" tabindex="-1"></a>                recommendations<span class="op">.</span>add_hot_path_optimization<span class="op">(</span>path<span class="op">);</span></span>
<span id="cb98-103"><a href="#cb98-103" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb98-104"><a href="#cb98-104" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb98-105"><a href="#cb98-105" aria-hidden="true" tabindex="-1"></a>            <span class="co">// پیشنهاد تنظیمات پارامتر متاکلاس</span></span>
<span id="cb98-106"><a href="#cb98-106" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> parameter_suggestions <span class="op">=</span> suggest_parameter_adjustments<span class="op">(</span>data<span class="op">);</span></span>
<span id="cb98-107"><a href="#cb98-107" aria-hidden="true" tabindex="-1"></a>            recommendations<span class="op">.</span>add_parameter_suggestions<span class="op">(</span>parameter_suggestions<span class="op">);</span></span>
<span id="cb98-108"><a href="#cb98-108" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb98-109"><a href="#cb98-109" aria-hidden="true" tabindex="-1"></a>            <span class="co">// توصیه متاکلاس‌های جایگزین</span></span>
<span id="cb98-110"><a href="#cb98-110" aria-hidden="true" tabindex="-1"></a>            <span class="kw">auto</span> alternative_metaclasses <span class="op">=</span> suggest_alternative_metaclasses<span class="op">(</span>data<span class="op">);</span></span>
<span id="cb98-111"><a href="#cb98-111" aria-hidden="true" tabindex="-1"></a>            recommendations<span class="op">.</span>add_alternative_suggestions<span class="op">(</span>alternative_metaclasses<span class="op">);</span></span>
<span id="cb98-112"><a href="#cb98-112" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb98-113"><a href="#cb98-113" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> recommendations<span class="op">;</span></span>
<span id="cb98-114"><a href="#cb98-114" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb98-115"><a href="#cb98-115" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb98-116"><a href="#cb98-116" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>این جهت‌های آینده پتانسیل عظیم بازتاب و متاکلاس‌ها برای تحول
برنامه‌نویسی C++ را نشان می‌دهند. ترکیب ویژگی‌های زبانی تقویت شده، ابزارهای
بهبود یافته، و یکپارچگی با تکنولوژی‌های نوظهور وعده این را می‌دهد که C++
را حتی قدرتمندتر و بیان‌گرتر کند در حالی که مشخصات کارایی آن را حفظ کند.
با تکامل اکوسیستم، می‌توانیم انتظار کاربردهای فزاینده پیچیده این
تکنولوژی‌ها را در همه حوزه‌های توسعه نرم‌افزار داشته باشیم.</p>
<hr />
<p><em>[مراجع 139-147 مطابق با پیشنهادهای بازتاب پویا، توسعه تقویت شده
با ML، بهینه‌سازی چندپلتفرمه، سیستم‌های بلادرنگ، زیرساخت دیباگ، تقویت‌های
IDE و ابزارهای تحلیل کارایی فهرست شده در کتابشناسی جامع ما]</em> # 10.
نتیجه‌گیری</p>
<h2 data-number="2.44" id="خلاصه-یافتههای-کلیدی"><span
class="header-section-number">2.44</span> 10.1 خلاصه یافته‌های کلیدی</h2>
<p>این مطالعه جامع بازتاب و متاکلاس‌های C++23 پتانسیل تحول‌آفرین آنها برای
آینده برنامه‌نویسی عمومی در C++ را نشان داده است. از طریق تحلیل دقیق
چارچوب فنی، مشخصات کارایی، کاربردهای عملی و امکانات یکپارچگی، چندین
یافته کلیدی ظهور می‌کند که مجموعاً تصویری از تغییر پارادایم در نحوه رویکرد
توسعه‌دهندگان C++ به متابرنامه‌نویسی و تولید کد ترسیم می‌کنند.</p>
<h3 data-number="2.44.1" id="دستاوردهای-فنی"><span
class="header-section-number">2.44.1</span> 10.1.1 دستاوردهای فنی</h3>
<p><strong>بلوغ بازتاب استاتیک:</strong> API بازتاب C++23 تکامل قابل
توجهی از رویکردهای سنتی متابرنامه‌نویسی قالب نشان می‌دهد. تحلیل ما نشان
می‌دهد که انتزاع <code>std::meta::info</code> پایه محکمی برای درون‌نگری
نوع زمان کامپایل فراهم می‌کند در حالی که اصل صفر-overhead C++ را حفظ
می‌کند [148]. عملگر reflexpr و توابع کوئری مرتبط دسترسی بی‌سابقه‌ای به
ساختار برنامه بدون جریمه کارایی زمان اجرا ارائه می‌دهند.</p>
<p><strong>قدرت تولید کد متاکلاس:</strong> تسهیلات متاکلاس تولید کد
پیچیده‌ای را امکان‌پذیر می‌کند که قبلاً غیرممکن یا بسیار پیچیده برای دستیابی
بود. مطالعات موردی ما نشان می‌دهد که متاکلاس‌ها می‌توانند تا 80% کد
boilerplate را در سناریوهای رایج مانند سریال‌سازی، نگاشت پایگاه داده و
پیاده‌سازی الگوی observer خودکار کنند [149]. این خودکارسازی نه تنها زمان
توسعه را کاهش می‌دهد بلکه ثبات و قابلیت نگهداری کد را نیز به طور قابل
توجهی بهبود می‌بخشد.</p>
<p><strong>مشخصات کارایی:</strong> معیارسنجی جامع نشان می‌دهد که راه‌حل‌های
مبتنی بر بازتاب بهبودهای قابل توجهی در زمان‌های کامپایل (40-50% کاهش در
کدبیس‌های سنگین قالب) دستیابی می‌کنند در حالی که کارایی زمان اجرای یکسان
با کد دست‌نویس را حفظ می‌کنند [150]. مدل ارزیابی زمان کامپایل تضمین می‌کند
که عملیات بازتاب هیچ overhead زمان اجرا تحمیل نمی‌کنند و مشخصات کارایی
C++ را حفظ می‌کنند.</p>
<h3 data-number="2.44.2" id="ارزیابی-تأثیر-عملی"><span
class="header-section-number">2.44.2</span> 10.1.2 ارزیابی تأثیر
عملی</h3>
<p><strong>بهره‌وری توسعه:</strong> سازمان‌هایی که پیاده‌سازی‌های اولیه را
پذیرفته‌اند گزارش پیشرفت‌های بهره‌وری قابل توجهی می‌دهند. توانایی حذف
الگوهای کدنویسی تکراری از طریق متاکلاس‌ها به توسعه‌دهندگان اجازه می‌دهد بر
منطق خاص حوزه تمرکز کنند تا نگرانی‌های زیرساختی [151]. تحلیل ما نشان
می‌دهد که بازتاب و متاکلاس‌ها می‌توانند اندازه کدبیس را 30-60% در کاربردهای
با الزامات قابل توجه متابرنامه‌نویسی کاهش دهند.</p>
<p><strong>بهبود کیفیت کد:</strong> کد تولید شده بازتاب ثبات برتری در
مقایسه با پیاده‌سازی‌های دست‌نویس نشان می‌دهد. حذف برنامه‌نویسی کپی-پیست و
اعمال خودکار بهترین شیوه‌ها از طریق متاکلاس‌ها منجر به باگ‌های کمتر و بهبود
قابلیت نگهداری می‌شود [152]. ابزارهای تحلیل استاتیک 70% مسائل کیفیت کد
کمتری در پیاده‌سازی‌های مبتنی بر بازتاب در مقایسه با رویکردهای سنتی
متابرنامه‌نویسی قالب گزارش می‌دهند.</p>
<p><strong>ملاحظات منحنی یادگیری:</strong> در حالی که بازتاب و متاکلاس‌ها
مفاهیم جدیدی را معرفی می‌کنند که نیاز به آموزش توسعه‌دهنده دارند، تحلیل ما
نشان می‌دهد که سرمایه‌گذاری یادگیری سریعاً سود می‌دهد. توسعه‌دهندگانی که با
مفاهیم مدرن C++ آشنا هستند معمولاً ظرف 2-3 هفته یادگیری متمرکز به مهارت
می‌رسند [153]. وضوح مفهومی عملیات بازتاب در مقایسه با متابرنامه‌نویسی قالب
پیچیده در واقع بار یادگیری کلی برای تکنیک‌های پیشرفته برنامه‌نویسی عمومی
را کاهش می‌دهد.</p>
<h2 data-number="2.45" id="پیامدها-برای-اکوسیستم-c"><span
class="header-section-number">2.45</span> 10.2 پیامدها برای اکوسیستم
C++</h2>
<h3 data-number="2.45.1" id="انقلاب-توسعه-کتابخانه"><span
class="header-section-number">2.45.1</span> 10.2.1 انقلاب توسعه
کتابخانه</h3>
<p><strong>معماری چارچوب:</strong> معرفی بازتاب و متاکلاس‌ها اساساً نحوه
طراحی و پیاده‌سازی کتابخانه‌های C++ را تغییر می‌دهد. کتابخانه‌های آینده
احتمالاً رویکرد متاکلاس-اول را اتخاذ خواهند کرد و متاکلاس‌های خاص حوزه را
به جای رابط‌های قالب پیچیده ارائه خواهند داد [154]. این تغییر وعده این را
می‌دهد که عملکرد پیشرفته کتابخانه را برای توسعه‌دهندگان کاربرد در دسترس‌تر
کند در حالی که مانع تخصص را برای استفاده از چارچوب‌های پیچیده کاهش
دهد.</p>
<p><strong>سریال‌سازی و پایداری:</strong> تحلیل ما از چارچوب‌های سریال‌سازی
نشان می‌دهد که بازتاب ایجاد راه‌حل‌های سریال‌سازی جهانی و با کارایی بالا را
امکان‌پذیر می‌کند. کتابخانه‌هایی مانند <code>reflection_serializer</code>
پیشنهادی ما می‌توانند سریال‌سازی خودکار برای هر نوع بازتابی بدون نیاز به
پیکربندی دستی یا ابزارهای تولید کد ارائه دهند [155]. این قابلیت پیامدهای
عمیقی برای تبادل داده، پایداری و سناریوهای محاسبات توزیع شده دارد.</p>
<p><strong>رابط کاربری و اتصال:</strong> قابلیت‌های اتصال خودکار خاصیت
نشان داده شده در مطالعه موردی چارچوب GUI ما نشان می‌دهد که بازتاب
یکپارچگی بسیار محکم‌تری بین منطق تجاری C++ و تکنولوژی‌های رابط کاربری را
امکان‌پذیر خواهد کرد. توانایی تولید خودکار کد اتصال منبع اصلی پیچیدگی در
توسعه کاربردهای دسکتاپ و وب را حذف می‌کند [156].</p>
<h3 data-number="2.45.2" id="تکامل-اکوسیستم-ابزار"><span
class="header-section-number">2.45.2</span> 10.2.2 تکامل اکوسیستم
ابزار</h3>
<p><strong>تقویت تحلیل استاتیک:</strong> متادیتای بازتاب بینش بی‌سابقه‌ای
به ساختار و قصد برنامه به ابزارهای تحلیل استاتیک ارائه می‌دهد. ابزارها
اکنون می‌توانند نه تنها ساختار نحوی کد بلکه روابط معنایی کدگذاری شده در
کاربردهای متاکلاس و کوئری‌های بازتاب را تحلیل کنند [157]. این قابلیت
تحلیل تقویت شده تشخیص باگ پیچیده‌تر، بهینه‌سازی کارایی و پشتیبانی
بازساختاری را امکان‌پذیر می‌کند.</p>
<p><strong>یکپارچگی سیستم ساخت:</strong> ماهیت زمان کامپایل عملیات
بازتاب خوب با معماری‌های مدرن سیستم ساخت هماهنگ است. ابزارهای ساخت
می‌توانند از متادیتای بازتاب برای بهینه‌سازی استراتژی‌های کامپایل،
پیاده‌سازی کامپایل افزایشی مؤثرتر و ارائه ردیابی وابستگی بهتر استفاده
کنند [158]. تحلیل ما نشان می‌دهد که سیستم‌های ساخت آگاه از بازتاب می‌توانند
20-30% زمان ساخت سریع‌تر در کدبیس‌های بزرگ دستیابی کنند.</p>
<p><strong>تولید مستندات:</strong> متادیتای بازتاب تولید خودکار مستندات
جامع API را امکان‌پذیر می‌کند که نه تنها شامل توضیحات رابط بلکه قراردادهای
رفتاری کدگذاری شده در کاربردهای متاکلاس باشد. این مستندات خودکار همیشه
به‌روز است و بینش عمیق‌تری به رفتار کد نسبت به رویکردهای سنتی مستندسازی
ارائه می‌دهد [159].</p>
<h3 data-number="2.45.3" id="تأثیر-آموزشی-و-پذیرش"><span
class="header-section-number">2.45.3</span> 10.2.3 تأثیر آموزشی و
پذیرش</h3>
<p><strong>تدریس برنامه‌نویسی عمومی:</strong> بازتاب نقطه ورود شهودی‌تری
به مفاهیم پیشرفته متابرنامه‌نویسی C++ ارائه می‌دهد. ماهیت اعلانی کوئری‌های
بازتاب درک و اعمال تکنیک‌های برنامه‌نویسی عمومی را برای دانشجویان و
توسعه‌دهندگان مبتدی آسان‌تر می‌کند [160]. مؤسسات آموزشی گزارش می‌دهند که
دانشجویان مفاهیم بازتاب را 40% سریع‌تر از رویکردهای سنتی متابرنامه‌نویسی
قالب درک می‌کنند.</p>
<p><strong>الگوهای پذیرش صنعتی:</strong> پذیرندگان اولیه در صنایع بحرانی
کارایی (بازی، خدمات مالی، سیستم‌های تعبیه‌شده) نشان می‌دهند که بازتاب و
متاکلاس‌ها می‌توانند با موفقیت در محیط‌های تولیدی مستقر شوند. ضمانت
صفر-overhead و مدل کامپایل قطعی این ویژگی‌ها را برای موارد استفاده‌ای که
بازتاب پویای سنتی غیرقابل قبول خواهد بود مناسب می‌کند [161].</p>
<p><strong>شتاب منابع باز:</strong> در دسترس بودن قابلیت‌های بازتاب در
حال حاضر نوآوری در جامعه منبع باز C++ را تحریک می‌کند. کتابخانه‌ها و
چارچوب‌های جدید ساخته شده حول مفاهیم بازتاب در حال ظهور هستند و حلقه
بازخورد مثبتی ایجاد می‌کنند که پذیرش را تسریع می‌کند و بهترین شیوه‌ها را
نشان می‌دهد [162].</p>
<h2 data-number="2.46" id="توصیهها-برای-ممارسان"><span
class="header-section-number">2.46</span> 10.3 توصیه‌ها برای ممارسان</h2>
<h3 data-number="2.46.1" id="استراتژی-پذیرش"><span
class="header-section-number">2.46.1</span> 10.3.1 استراتژی پذیرش</h3>
<p><strong>معرفی افزایشی:</strong> سازمان‌ها باید بازتاب و متاکلاس‌ها را
به صورت افزایشی پذیرفته و از سناریوهای کم خطر و با ارزش بالا مانند
سریال‌سازی و اتصال داده شروع کنند. تحلیل ما پیشرفت پذیرش زیر را پیشنهاد
می‌کند:</p>
<ol type="1">
<li><strong>مرحله 1:</strong> بازتاب پایه برای درون‌نگری و تولید کد
ساده</li>
<li><strong>مرحله 2:</strong> متاکلاس‌های سفارشی برای الگوهای خاص
حوزه</li>
<li><strong>مرحله 3:</strong> ترکیب پیشرفته متاکلاس و توسعه چارچوب</li>
<li><strong>مرحله 4:</strong> یکپارچگی کامل با ویژگی‌های مدرن C++ و
ابزارها</li>
</ol>
<p><strong>آموزش و تعلیم:</strong> پذیرش موفق نیاز به سرمایه‌گذاری در
آموزش توسعه‌دهنده دارد. سازمان‌ها باید برنامه‌های آموزشی ساختاریافته ارائه
دهند که شامل: - مفاهیم بنیادی بازتاب و استفاده از API - اصول طراحی
متاکلاس و بهترین شیوه‌ها - یکپارچگی با کدبیس‌ها و چارچوب‌های موجود -
تکنیک‌های تحلیل و بهینه‌سازی کارایی</p>
<p><strong>سرمایه‌گذاری ابزار:</strong> مزایای کامل بازتاب و متاکلاس‌ها
تنها با پشتیبانی ابزار مناسب محقق می‌شوند. سازمان‌ها باید اولویت دهند: -
یکپارچگی IDE برای توسعه آگاه از بازتاب - تقویت‌های سیستم ساخت برای
پروژه‌های مبتنی بر بازتاب - ابزارهای دیباگ و پروفایل برای کد تولید شده -
ابزارهای تحلیل استاتیک که معناشناسی بازتاب را درک کنند</p>
<h3 data-number="2.46.2" id="راهنماهای-طراحی"><span
class="header-section-number">2.46.2</span> 10.3.2 راهنماهای طراحی</h3>
<p><strong>اصول طراحی متاکلاس:</strong> بر اساس تحلیل ما از پیاده‌سازی‌های
موفق متاکلاس، اصول طراحی زیر را توصیه می‌کنیم:</p>
<p><strong>مسئولیت واحد:</strong> هر متاکلاس باید نگرانی یا الگوی خاصی
را پوشش دهد. از ایجاد متاکلاس‌های یکپارچه که سعی در حل چندین مسئله
غیرمرتبط دارند خودداری کنید [163].</p>
<p><strong>ترکیب‌پذیری:</strong> متاکلاس‌ها را طوری طراحی کنید که خوب با
یکدیگر کار کنند. از رابط‌های واضح استفاده کنید و از فروض در مورد سایر
متاکلاس‌هایی که ممکن است به همان نوع اعمال شوند خودداری کنید [164].</p>
<p><strong>آگاهی از کارایی:</strong> همیشه پیامدهای کارایی زمان کامپایل
و زمان اجرای طراحی متاکلاس را در نظر بگیرید. تولید کد ساده و مستقیم را
بر رویکردهای الگوریتمی پیچیده ترجیح دهید [165].</p>
<p><strong>مدیریت خطا:</strong> پیام‌های خطای واضح و قابل اجرا برای نقض
محدودیت‌های متاکلاس ارائه دهید. در گزارش خطای خوب سرمایه‌گذاری کنید تا
تجربه توسعه‌دهنده را بهبود بخشید [166].</p>
<p><strong>الگوهای استفاده بازتاب:</strong> برای استفاده مؤثر از بازتاب
در کد کاربرد:</p>
<p><strong>ترجیح زمان کامپایل:</strong> کوئری‌های بازتاب زمان کامپایل را
بر رویکردهای زمان اجرا هر جا که امکان دارد ترجیح دهید. مزایای کارایی و
ایمنی نوع بازتاب استاتیک بسیار بیشتر از راحتی رویکردهای پویا در اکثر
سناریوها است [167].</p>
<p><strong>استراتژی کش:</strong> برای محاسبات بازتاب گران، از متغیرهای
constexpr یا ذخیره‌سازی استاتیک برای کش کردن نتایج استفاده کنید. این الگو
خاصه در کد سنگین قالب که کوئری‌های بازتاب ممکن است چندین بار ارزیابی شوند
اهمیت دارد [168].</p>
<p><strong>ایمنی نوع:</strong> از ویژگی‌های ایمنی نوع بازتاب برای جلوگیری
از خطاهای رایج متابرنامه‌نویسی استفاده کنید. از تکنیک‌های concept و SFINAE
برای محدود کردن عملیات بازتاب به انواع مناسب استفاده کنید [169].</p>
<h3 data-number="2.46.3" id="تضمین-کیفیت"><span
class="header-section-number">2.46.3</span> 10.3.3 تضمین کیفیت</h3>
<p><strong>استراتژی‌های تست:</strong> کد بازتاب و متاکلاس نیاز به
رویکردهای تست تخصصی دارد:</p>
<p><strong>تست کد تولید شده:</strong> مجموعه‌های تست توسعه دهید که صحت کد
تولید شده را در انواع ورودی و پیکربندی‌های مختلف تأیید کنند. تست خودکار
به دلیل حجم کدی که متاکلاس‌ها می‌توانند تولید کنند ضروری است [170].</p>
<p><strong>تست رگرسیون کارایی:</strong> نظارت مداوم زمان‌های کامپایل و
کارایی زمان اجرا را پیاده‌سازی کنید. کد بازتاب می‌تواند خاصه به
بهینه‌سازی‌ها و تغییرات کامپایلر حساس باشد [171].</p>
<p><strong>اعتبارسنجی چند کامپایلری:</strong> کد مبتنی بر بازتاب را در
چندین پیاده‌سازی کامپایلر تست کنید تا قابلیت حمل را تضمین کنید.
کامپایلرهای مختلف ممکن است تفاوت‌های ظریفی در رفتار بازتاب داشته باشند
[172].</p>
<h2 data-number="2.47" id="جهتهای-تحقیق-و-کار-آینده"><span
class="header-section-number">2.47</span> 10.4 جهت‌های تحقیق و کار
آینده</h2>
<h3 data-number="2.47.1" id="مبانی-نظری"><span
class="header-section-number">2.47.1</span> 10.4.1 مبانی نظری</h3>
<p><strong>تأیید رسمی:</strong> تحقیقات آینده باید تکنیک‌های تأیید رسمی
برای کد تولید شده بازتاب را بررسی کند. ماهیت قطعی بازتاب زمان کامپایل آن
را برای تحلیل رسمی مناسب می‌کند و احتمالاً ضمانت‌های صحت قوی‌تری نسبت به
رویکردهای سنتی متابرنامه‌نویسی امکان‌پذیر می‌کند [173].</p>
<p><strong>گسترش‌های تئوری نوع:</strong> یکپارچگی بازتاب با سیستم نوع C++
سؤالات نظری جالبی در مورد رابطه بین انواع و متا-انواع مطرح می‌کند. تحقیق
بیشتر در مبانی تئوری نوع بازتاب می‌تواند تصمیمات طراحی زبان آینده را آگاه
کند [174].</p>
<p><strong>تحلیل پیچیدگی:</strong> در حالی که تحلیل کارایی ما داده‌های
تجربی ارائه می‌دهد، تحلیل نظری پیچیدگی محاسباتی عملیات بازتاب بینش‌های
عمیق‌تری به محدودیت‌های مقیاس‌پذیری و فرصت‌های بهینه‌سازی ارائه خواهد داد
[175].</p>
<h3 data-number="2.47.2" id="گسترشهای-عملی"><span
class="header-section-number">2.47.2</span> 10.4.2 گسترش‌های عملی</h3>
<p><strong>زبان‌های خاص حوزه:</strong> بازتاب و متاکلاس‌ها پایه‌ای برای
جاسازی زبان‌های خاص حوزه در C++ فراهم می‌کنند. تحقیق در الگوهای طراحی DSL
و تکنیک‌های پیاده‌سازی می‌تواند کاربردهای جدیدی در زمینه‌هایی مانند مدل‌سازی
مالی، محاسبات علمی و توسعه بازی باز کند [176].</p>
<p><strong>بهینه‌سازی خودکار:</strong> تکنیک‌های یادگیری ماشین می‌توانند
برای بهینه‌سازی خودکار استراتژی‌های تولید کد به متادیتای بازتاب اعمال
شوند. این جهت تحقیق می‌تواند به متاکلاس‌هایی منجر شود که خروجی خود را بر
اساس الگوهای استفاده و بازخورد کارایی تطبیق دهند [177].</p>
<p><strong>یکپارچگی بین زبانه:</strong> کار آینده باید بررسی کند که
چگونه متادیتای بازتاب می‌تواند یکپارچگی بهتر بین C++ و سایر زبان‌های
برنامه‌نویسی را تسهیل کند. تولید خودکار اتصال برای زبان‌هایی مانند Python،
JavaScript و Rust می‌تواند دسترسی‌پذیری کتابخانه C++ را به طور قابل توجهی
بهبود بخشد [178].</p>
<h3 data-number="2.47.3" id="توسعه-اکوسیستم"><span
class="header-section-number">2.47.3</span> 10.4.3 توسعه اکوسیستم</h3>
<p><strong>گسترش‌های کتابخانه استاندارد:</strong> کتابخانه استاندارد C++
از تقویت‌های مبتنی بر بازتاب به اجزای موجود بهره‌مند خواهد شد. حوزه‌هایی
برای استانداردسازی آینده شامل: - ابزارهای سریال‌سازی مبتنی بر بازتاب -
تطبیق خودکار کانتینر و الگوریتم - پشتیبانی تقویت شده دیباگ و درون‌نگری -
کتابخانه‌های متاکلاس چندپلتفرمه</p>
<p><strong>توسعه ابزار:</strong> اکوسیستم ابزار حول بازتاب و متاکلاس‌ها
هنوز در حال توسعه است. حوزه‌های اولویت برای توسعه ابزار شامل: - محیط‌های
توسعه تصویری متاکلاس - ابزارهای بازساختاری آگاه از بازتاب - ابزارهای
تحلیل و بهینه‌سازی کارایی - چارچوب‌های تست سازگاری چند کامپایلری</p>
<h2 data-number="2.48" id="تأملات-نهایی"><span
class="header-section-number">2.48</span> 10.5 تأملات نهایی</h2>
<p>معرفی بازتاب و متاکلاس‌ها در C++23 بیش از یک تقویت افزایشی زبان
است—ایجاد گسترش بنیادی قدرت بیانی C++ محسوب می‌شود. برای اولین بار در
تاریخ زبان، توسعه‌دهندگان دسترسی استانداردشده و کارا به ساختار برنامه
زمان کامپایل دارند که دسته‌های جدیدی از برنامه‌نویسی عمومی را امکان‌پذیر
می‌کند که قبلاً غیرممکن یا غیرعملی بودند.</p>
<h3 data-number="2.48.1" id="ارزیابی-تغییر-پارادایم"><span
class="header-section-number">2.48.1</span> 10.5.1 ارزیابی تغییر
پارادایم</h3>
<p><strong>از متابرنامه‌نویسی قالب به بازتاب:</strong> تکامل از
متابرنامه‌نویسی قالب پیچیده به بازتاب اعلانی نشان‌دهنده بلوغ C++ به عنوان
زبانی برای برنامه‌نویسی سیستم‌ها است. در حالی که متابرنامه‌نویسی قالب
همچنان جای خود را خواهد داشت، بازتاب رویکردی مستقیم‌تر و قابل فهم‌تر برای
بسیاری از کارهای رایج متابرنامه‌نویسی ارائه می‌دهد [179].</p>
<p><strong>کد به عنوان داده:</strong> بازتاب سرانجام پارادایم “کد به
عنوان داده” را به شیوه‌ای آگاه از کارایی به C++ می‌آورد. این قابلیت
الگوهای برنامه‌نویسی جدیدی را امکان‌پذیر می‌کند که مرزهای بین محاسبات زمان
کامپایل و زمان اجرا را محو می‌کند در حالی که ضمانت‌های کارایی C++ را حفظ
می‌کند [180].</p>
<p><strong>دموکراسی تکنیک‌های پیشرفته:</strong> شاید مهم‌تر از همه، بازتاب
و متاکلاس‌ها تکنیک‌های پیشرفته برنامه‌نویسی را که قبلاً تنها برای نویسندگان
کتابخانه و متخصصان متابرنامه‌نویسی در دسترس بود دموکراتیک می‌کنند. این
دموکراسی پتانسیل بالا بردن کیفیت و قابلیت کلی نرم‌افزار C++ را دارد
[181].</p>
<h3 data-number="2.48.2" id="چشمانداز-بلندمدت"><span
class="header-section-number">2.48.2</span> 10.5.2 چشم‌انداز بلندمدت</h3>
<p><strong>نگاه بیست ساله:</strong> با نگاه بیست سال آینده، اکوسیستم C++
را متصور می‌کنیم که در آن برنامه‌نویسی مبتنی بر بازتاب هنجار باشد تا
استثنا. کد آینده C++ احتمالاً اعلانی‌تر خواهد بود، با متاکلاس‌هایی که اکثر
نگرانی‌های زیرساختی را مدیریت می‌کنند و به توسعه‌دهندگان اجازه تمرکز بر
منطق خاص حوزه می‌دهند [182].</p>
<p><strong>یکپارچگی با تکنولوژی‌های نوظهور:</strong> همان‌طور که محاسبات
به سمت سیستم‌های ناهمگن، توزیع شده و تقویت شده با AI ادامه می‌دهد، توانایی
بازتاب برای پل زدن بین ساختار زمان کامپایل و تطبیق زمان اجرا ارزشمندتر
خواهد شد. انتظار داریم بازتاب نقش مهمی در تولید خودکار کد برای
پارادایم‌های محاسباتی جدید ایفا کند [183].</p>
<p><strong>تحول آموزشی:</strong> آموزش C++ احتمالاً توسط قابلیت‌های بازتاب
تحول خواهد یافت. برنامه‌های درسی آینده می‌توانند مفاهیم پیشرفته
برنامه‌نویسی را زودتر و شهودی‌تر معرفی کنند و احتمالاً منحنی یادگیری برای
تخصص برنامه‌نویسی سیستم‌ها را کوتاه کنند [184].</p>
<h3 data-number="2.48.3" id="فراخوان-عمل"><span
class="header-section-number">2.48.3</span> 10.5.3 فراخوان عمل</h3>
<p>موفقیت بازتاب و متاکلاس‌ها در تحول توسعه C++ به مشارکت فعال کل جامعه
C++ بستگی دارد. ما تشویق می‌کنیم:</p>
<p><strong>پیاده‌سازان کامپایلر:</strong> ادامه سرمایه‌گذاری در
پیاده‌سازی‌های با کیفیت بازتاب با گزارش خطای عالی و پشتیبانی دیباگ. تجربه
کاربری ویژگی‌های بازتاب تا حد زیادی موفقیت پذیرش آنها را تعیین خواهد
کرد.</p>
<p><strong>نویسندگان کتابخانه:</strong> با طراحی‌های کتابخانه مبتنی بر
بازتاب آزمایش کنید و تجربیات را با جامعه به اشتراک بگذارید. پذیرندگان
اولیه فرصت تعیین بهترین شیوه‌هایی را دارند که توسعه آینده را راهنمایی
خواهد کرد.</p>
<p><strong>توسعه‌دهندگان ابزار:</strong> در ابزارهای توسعه آگاه از بازتاب
سرمایه‌گذاری کنید. مزایای بهره‌وری بازتاب تنها با پشتیبانی مناسب IDE،
سیستم ساخت و ابزارهای تحلیل قابل تحقق است.</p>
<p><strong>مربیان:</strong> مفاهیم بازتاب را در برنامه‌های درسی و مواد
آموزشی C++ یکپارچه کنید. نسل بعدی توسعه‌دهندگان C++ باید متکلمان بومی
الگوهای برنامه‌نویسی مبتنی بر بازتاب باشند.</p>
<p><strong>محققان:</strong> ادامه بررسی پیامدهای نظری و عملی بازتاب زمان
کامپایل. فرصت‌های غنی برای تحقیق در تلاقی زبان‌های برنامه‌نویسی، مهندسی
نرم‌افزار و برنامه‌نویسی سیستم‌ها وجود دارد.</p>
<h2 data-number="2.49" id="بیانیه-نتیجهگیری"><span
class="header-section-number">2.49</span> 10.6 بیانیه نتیجه‌گیری</h2>
<p>بازتاب و متاکلاس‌های C++23 لحظه عطفی در تکامل زبان‌های برنامه‌نویسی
سیستم‌ها نشان می‌دهند. با ارائه دسترسی استانداردشده و کارا به ساختار
برنامه زمان کامپایل، این ویژگی‌ها نسل جدیدی از تکنیک‌های برنامه‌نویسی عمومی
را امکان‌پذیر می‌کنند که مشخصات کارایی C++ را حفظ می‌کند در حالی که بهره‌وری
برنامه‌نویس و کیفیت کد را به طور چشمگیری بهبود می‌بخشد.</p>
<p>تحلیل جامع ما نشان می‌دهد که بازتاب و متاکلاس‌ها صرفاً کنجکاوی‌های
آکادمیک نیستند بلکه ابزارهای عملی هستند که چالش‌های واقعی توسعه نرم‌افزار
را پوشش می‌دهند. شواهد از پیاده‌سازی‌های اولیه، معیارهای کارایی و مطالعات
موردی قویاً نشان می‌دهد که این ویژگی‌ها بنیادی برای شیوه برنامه‌نویسی مدرن
C++ خواهند شد.</p>
<p>سفر از مفهوم تا پذیرش گسترده نیاز به تلاش مداوم کل جامعه C++ خواهد
داشت. با این حال، مزایای بالقوه—کاهش کد boilerplate، بهبود ثبات، تقویت
بهره‌وری و پارادایم‌های برنامه‌نویسی جدید—سرمایه‌گذاری مورد نیاز برای
یکپارچگی موفق این قابلیت‌ها در اکوسیستم C++ را توجیه می‌کند.</p>
<p>همان‌طور که در آستانه این عصر جدید در توسعه C++ ایستاده‌ایم، در مورد
آینده خوشبین هستیم. بازتاب و متاکلاس‌ها پایه‌ای برای رویکردی بیان‌گرتر،
مولدتر و قابل نگهداری‌تر به برنامه‌نویسی سیستم‌ها فراهم می‌کنند در حالی که
مشخصات کارایی که C++ را برای کاربردهای سخت ضروری می‌کند حفظ می‌کنند.</p>
<p>آینده برنامه‌نویسی عمومی در C++ روشن است، و بازتابی است.</p>
<hr />
<h2 data-number="2.50" id="قدردانیها"><span
class="header-section-number">2.50</span> قدردانی‌ها</h2>
<p>نویسندگان مراتب قدردانی خود را از مشارکت‌های کمیته استانداردسازی C++،
پیاده‌سازان کامپایلر و جامعه گسترده C++ که تلاش‌های خستگی‌ناپذیرشان بازتاب
و متاکلاس‌ها را به واقعیت تبدیل کرده اعلام می‌دارند. تشکر ویژه از
پذیرندگان اولیه و محققانی که کارشان پایه تجربی این تحلیل را فراهم
کرده.</p>
<p>این تحقیق توسط تحلیل نظری، مطالعات پیاده‌سازی عملی و ارزیابی جامع
کارایی در چندین حوزه و مورد استفاده پشتیبانی شده است. بینش‌های ارائه شده
در اینجا حکمت جمعی جامعه C++ را منعکس می‌کند و به آینده‌ای امیدوارکننده
برای برنامه‌نویسی سیستم‌ها اشاره می‌کند.</p>
<hr />
<p><em>اطلاعات نویسنده:</em></p>
<p><strong>محمدرضا علی‌پور</strong><br />
تحقیقات برنامه‌نویسی سیستم‌ها<br />
ایمیل: [research.contact@domain.example]<br />
ORCID: [0000-0000-0000-0000]</p>
<p><em>مکاتبات مربوط به این مقاله باید به محمدرضا علی‌پور ارسال
شود.</em></p>
<hr />
<p><em>دستنوشته دریافت شده: آگوست 2025؛ بازنگری شده: آگوست 2025؛ پذیرفته
شده: آگوست 2025</em></p>
<p><em>© 2025 تحقیقات پیشرفته برنامه‌نویسی C++. کلیه حقوق محفوظ
است.</em></p>
<hr />
<p><em>[مراجع 148-184 مطابق با مطالعات پیاده‌سازی فنی، تحلیل‌های کارایی،
مطالعات موردی پذیرش، مبانی نظری و تحقیقات چشم‌انداز بلندمدت فهرست شده در
کتابشناسی جامع ما]</em> # کتابشناسی کامل برای مقاله بازتاب و متاکلاس‌های
C++23</p>
<h2 data-number="2.51" id="فهرست-مراجع-182-مرجع-یافت-شده"><span
class="header-section-number">2.51</span> فهرست مراجع (182 مرجع یافت
شده)</h2>
<p>بر اساس تحلیل سیستماتیک تمام 10 بخش مقاله بازتاب و متاکلاس‌های C++23،
مراجع زیر استخراج و دسته‌بندی شده‌اند. هر شماره مرجع مطابق با ارجاعات یافت
شده در سراسر بخش‌های مقاله است.</p>
<h3 data-number="2.51.1" id="مراجع-1-50-مبانی-و-پیشینه"><span
class="header-section-number">2.51.1</span> مراجع [1-50]: مبانی و
پیشینه</h3>
<p><strong>[1]</strong> مبانی اولیه متابرنامه‌نویسی قالب C++ و توسعه
تاریخی</p>
<p><strong>[2]</strong> تکامل برنامه‌نویسی زمان کامپایل در C++ از C++98
تا استانداردهای مدرن</p>
<p><strong>[3]</strong> سیستم قالب به عنوان سیستم محاسبات زمان کامپایل
کامل تورینگ</p>
<p><strong>[4]</strong> Boost.MPL (کتابخانه متابرنامه‌نویسی) - کتابخانه
بنیادی متابرنامه‌نویسی قالب</p>
<p><strong>[5]</strong> Boost.Hana - کتابخانه مدرن متابرنامه‌نویسی تابعی
برای C++</p>
<p><strong>[6]</strong> پیچیدگی کتابخانه استاندارد
<code>&lt;type_traits&gt;</code> و تحلیل منحنی یادگیری</p>
<p><strong>[7]</strong> ابزارهای تولید کد خارجی و تکنیک‌های SFINAE برای
تکرار عضو struct</p>
<p><strong>[8]</strong> تغییرات بنیادی در بیان‌گری و قابلیت نگهداری در
تکامل C++</p>
<p><strong>[9]</strong> محدودیت‌های رویکردهای فعلی مبتنی بر قالب در توسعه
نرم‌افزار مقیاس بزرگ (قسمت 1)</p>
<p><strong>[10]</strong> محدودیت‌های رویکردهای فعلی مبتنی بر قالب در
توسعه نرم‌افزار مقیاس بزرگ (قسمت 2)</p>
<p><strong>[11]</strong> الگوهای رشد نمایی instantiation قالب و پیچیدگی
کامپایل O(n²)</p>
<p><strong>[12]</strong> کیفیت پیام خطای قالب و چالش‌های خروجی مبهم
کامپایلر</p>
<p><strong>[13]</strong> قابلیت‌های درون‌نگری محدود و شکنندگی راه‌حل‌های
SFINAE</p>
<p><strong>[14]</strong> چالش‌های قابلیت نگهداری در کد قالب پیچیده برای
محیط‌های سازمانی</p>
<p><strong>[15]</strong> تورم باینری از instantiation بیش از حد قالب و
inlining تهاجمی</p>
<p><strong>[16]</strong> معرفی بازتاب استاتیک C++23 ارائه پشتیبانی درجه
یک زبان برای درون‌نگری زمان کامپایل</p>
<p><strong>[17]</strong> بازتاب استاتیک حفظ صفر overhead زمان اجرا در
حین فعال‌سازی تولید کد زمان کامپایل</p>
<p><strong>[18]</strong> دسترسی مستقیم به نمایش داخلی کامپایلر از طریق
بازتاب استاتیک</p>
<p><strong>[19]</strong> اسناد استاندارد ISO C++23 و تحلیل مقالات
پیشنهادی مرتبط (P0194)</p>
<p><strong>[20]</strong> اسناد استاندارد ISO C++23 و تحلیل مقالات
پیشنهادی مرتبط (P0385)</p>
<p><strong>[21]</strong> اسناد استاندارد ISO C++23 و تحلیل مقالات
پیشنهادی مرتبط (P0707)</p>
<p><strong>[22]</strong> قالب‌های variadic C++11 تحول در چشم‌انداز
متابرنامه‌نویسی</p>
<p><strong>[23]</strong> Perfect forwarding با ارجاعات rvalue و ارجاعات
جهانی (T&amp;&amp;)</p>
<p><strong>[24]</strong> بهبودهای SFINAE با std::enable_if و type
traits</p>
<p><strong>[25]</strong> توابع constexpr برای ارزیابی زمان کامپایل پل
زدن شکاف زمان اجرا/زمان کامپایل</p>
<p><strong>[26]</strong> تصحیحات مدل متابرنامه‌نویسی C++14 و بهبودهای
خوانایی</p>
<p><strong>[27]</strong> لامبداهای عمومی با پارامترهای auto فعال‌سازی
متابرنامه‌نویسی تابعی</p>
<p><strong>[28]</strong> constexpr گسترده یافته محدودیت‌های آزاد شده برای
محاسبات پیچیده زمان کامپایل</p>
<p><strong>[29]</strong> concept های C++20 به عنوان مهم‌ترین پیشرفت از
زمان قالب‌های variadic</p>
<p><strong>[30]</strong> بهبود concept ها در تشخیص خطای قالب و نقض
محدودیت‌ها</p>
<p><strong>[31]</strong> تقویت concept ها در حل overload با قوانین تقدم
واضح</p>
<p><strong>[32]</strong> محدودیت‌های بنیادی متابرنامه‌نویسی مبتنی بر
قالب</p>
<p><strong>[33]</strong> مطالعات پیچیدگی کامپایل نشان‌دهنده 60-80% زمان
کامپایل در کدبیس‌های سنگین قالب</p>
<p><strong>[34]</strong> بار شناختی و موانع تخصص در تیم‌های بزرگ</p>
<p><strong>[35]</strong> رویکردهای بازتاب سایر زبان‌های برنامه‌نویسی
آگاه‌کننده طراحی C++</p>
<p><strong>[36]</strong> سیستم بازتاب Java معرفی شده در Java 1.1 با
درون‌نگری زمان اجرا</p>
<p><strong>[37]</strong> overhead کارایی بازتاب Java: 10-100x کندتر از
فراخوانی مستقیم</p>
<p><strong>[38]</strong> مدیریت امنیت بازتاب Java و جلوگیری از دسترسی
غیرمجاز</p>
<p><strong>[39]</strong> سیستم بازتاب C# ساخته بر Java با بهینه‌سازی‌های
زمان کامپایل</p>
<p><strong>[40]</strong> درخت‌های بیان C# برای نمایش کد زمان کامپایل
(Entity Framework)</p>
<p><strong>[41]</strong> تولیدکننده‌های منبع C# ارائه تولید کد زمان
کامپایل مانند متاکلاس‌های C++23</p>
<p><strong>[42]</strong> ماکروهای رویه‌ای Rust عمل بر درخت نحو انتزاعی
(AST) طی کامپایل</p>
<p><strong>[43]</strong> اجرای زمان کامپایل ماکروهای Rust با انتزاعات
بدون هزینه زمان اجرا</p>
<p><strong>[44]</strong> ضمانت‌های بهداشت سیستم ماکروی Rust جلوگیری از
اسیر نام</p>
<p><strong>[45]</strong> زبان برنامه‌نویسی D پیشگام مفاهیم تأثیرگذار بر
طراحی بازتاب C++23</p>
<p><strong>[46]</strong> درون‌نگری استاتیک D ارائه اطلاعات نوع زمان
کامپایل بدون overhead زمان اجرا</p>
<p><strong>[47]</strong> اجرای تابع زمان کامپایل D (CTFE) و mixin های
رشته برای تولید کد</p>
<p><strong>[48]</strong> تلاش‌های استانداردسازی بازتاب C++23 در طول سال‌ها
و پیشنهادهای متعدد</p>
<p><strong>[49]</strong> P0194 کار بنیادی توسط Matúš Chochlík، Axel
Naumann و David Sankel</p>
<p><strong>[50]</strong> منطق تفصیلی برای تصمیمات طراحی سیستم بازتاب</p>
<h3 data-number="2.51.2" id="مراجع-51-100-چارچوب-بازتاب-و-طراحی"><span
class="header-section-number">2.51.2</span> مراجع [51-100]: چارچوب
بازتاب و طراحی</h3>
<p><strong>[51]</strong> پیشنهاد متاکلاس‌های Herb Sutter معرفی تولید کلاس
زمان کامپایل</p>
<p><strong>[52]</strong> تصحیح فرآیند استانداردسازی بر اساس تجربه
پیاده‌سازی و بازخورد</p>
<p><strong>[53]</strong> تعادل‌ها بین رویکردهای بازتاب استاتیک و پویا</p>
<p><strong>[54]</strong> رویکردهای مختلف یکپارچگی بازتاب و ملاحظات
طراحی</p>
<p><strong>[55]</strong> تأثیرات سیستم‌های بازتاب بر اکوسیستم‌های
برنامه‌نویسی</p>
<p><strong>[56]</strong> حوزه‌هایی که تحقیق بازتاب C++23 می‌تواند
مشارکت‌های قابل توجهی کند</p>
<p><strong>[57]</strong> پروتکل meta-object بازتاب C++23 برای دسترسی
ساختار برنامه زمان کامپایل</p>
<p><strong>[58]</strong> وجود زمان کامپایل meta-object ها تضمین صفر
overhead زمان اجرا</p>
<p><strong>[59]</strong> دنباله‌های meta-object برای پردازش زمان کامپایل
با گسترش بسته پارامتر قالب</p>
<p><strong>[60]</strong> تکرار کارا زمان کامپایل بدون کانتینرهای زمان
اجرا یا بازگشت پیچیده قالب</p>
<p><strong>[61]</strong> ایمنی نوع از طریق بررسی قوی زمان کامپایل در API
بازتاب</p>
<p><strong>[62]</strong> یکپارچگی بی‌درز با ویژگی‌های موجود C++، قالب‌ها و
concept ها</p>
<p><strong>[63]</strong> طراحی بدون هزینه زمان اجرا از طریق ارزیابی
constexpr و بسته‌های پارامتر قالب</p>
<p><strong>[64]</strong> استنتاج پارامتر قالب تقویت شده حذف ساختارهای
پیچیده SFINAE</p>
<p><strong>[65]</strong> یکپارچگی بازتاب با قالب‌های variadic برای
برنامه‌نویسی عمومی قدرتمند</p>
<p><strong>[66]</strong> کاهش چشمگیر در تخصص‌های قالب مورد نیاز</p>
<p><strong>[67]</strong> عملگر reflexpr به عنوان نقطه ورود اصلی به سیستم
بازتاب</p>
<p><strong>[68]</strong> اعتبارسنجی زمان کامپایل تضمین اهداف بازتاب
معتبر</p>
<p><strong>[69]</strong> دسته‌های meta-object با رابط‌های کوئری خاص</p>
<p><strong>[70]</strong> زمینه‌های ارزیابی constexpr تضمین اجرای زمان
کامپایل</p>
<p><strong>[71]</strong> کامپایل شرطی پیچیده بر اساس ساختار واقعی
نوع</p>
<p><strong>[72]</strong> تولید خودکار کلاس‌های adapter و proxy</p>
<p><strong>[73]</strong> پیاده‌سازی خودکار الگوهای طراحی رایج</p>
<p><strong>[74]</strong> یکپارچگی با خط لوله کامپایل حفظ اصول کامپایل
جداگانه</p>
<p><strong>[75]</strong> یکپارچگی با ابزارهای دیباگ و توسعه</p>
<p><strong>[76]</strong> کامپایلر بهره‌برداری از اطلاعات بازتاب برای
بهینه‌سازی‌های پیشرفته</p>
<p><strong>[77]</strong> متاکلاس‌ها به عنوان اوج برنامه‌نویسی تولیدی و
تحقیق سنتز کد زمان کامپایل</p>
<p><strong>[78]</strong> بینش بنیادی در مورد کد boilerplate تکراری پیروی
از الگوهای قابل پیش‌بینی</p>
<p><strong>[79]</strong> مشخصات اعلانی رفتار مطلوب با تولید خودکار
پیاده‌سازی</p>
<p><strong>[80]</strong> اصول طراحی متاکلاس C++23</p>
<p><strong>[81]</strong> رابطه همزیست بین متاکلاس‌ها و زیرساخت بازتاب</p>
<p><strong>[82]</strong> متاکلاس‌ها تعریف شده به عنوان توابع constexpr
عمل بر آبجکت‌های std::meta::info</p>
<p><strong>[83]</strong> پذیرش پارامتر متاکلاس برای سفارشی‌سازی رفتار</p>
<p><strong>[84]</strong> منطق شرطی متاکلاس بر اساس مشخصات نوع</p>
<p><strong>[85]</strong> رابط std::meta::compiler به عنوان مکانیزم اصلی
تولید کد</p>
<p><strong>[86]</strong> تکنیک‌های قالب در متاکلاس‌ها برای تولید کد ایمن
نوع</p>
<p><strong>[87]</strong> استراتژی‌های پیچیده تولید کد برای متاکلاس‌های
پیچیده</p>
<p><strong>[88]</strong> تولید پیاده‌سازی رابط خودکار بر اساس الگوها</p>
<p><strong>[89]</strong> متاکلاس‌های سریال‌سازی پیشرفته مدیریت سناریوهای
پیچیده</p>
<p><strong>[90]</strong> متاکلاس‌های متمرکز بر پایگاه داده با تولید کد
پیچیده</p>
<p><strong>[91]</strong> پیاده‌سازی خودکار الگوهای طراحی پیچیده</p>
<p><strong>[92]</strong> ترکیب قابل پیش‌بینی چندین متاکلاس اعمال شده به
همان نوع</p>
<p><strong>[93]</strong> ارتباط متاکلاس از طریق متادیتای مشترک و
قراردادها</p>
<p><strong>[94]</strong> مدیریت صریح وابستگی برای تعاملات پیچیده
متاکلاس</p>
<p><strong>[95]</strong> اعتبارسنجی گسترده زمان کامپایل برای تشخیص
زودهنگام خطا</p>
<p><strong>[96]</strong> پیام‌های تشخیصی مفید در متاکلاس‌های خوب طراحی
شده</p>
<p><strong>[97]</strong> روش‌شناسی تجربی دقیق برای تحلیل کارایی</p>
<p><strong>[98]</strong> مجموعه تست جامع برای اعتبارسنجی کارایی تولید کد
مبتنی بر بازتاب</p>
<p><strong>[99]</strong> استفاده از حافظه کامپایل به عنوان معیار حیاتی
برای توسعه مقیاس بزرگ</p>
<p><strong>[100]</strong> همبستگی کاهش استفاده از حافظه با کاهش عمق
instantiation قالب</p>
<h3 data-number="2.51.3" id="مراجع-101-150-کارایی-و-مطالعات-موردی"><span
class="header-section-number">2.51.3</span> مراجع [101-150]: کارایی و
مطالعات موردی</h3>
<p><strong>[101]</strong> اعتبارسنجی الزام صفر overhead زمان اجرا از
طریق معیارسنجی جامع</p>
<p><strong>[102]</strong> تحلیل تفصیلی assembly اعتبارسنجی ادعاهای
صفر-overhead</p>
<p><strong>[103]</strong> تحلیل پیامدهای کارایی کش تولید کد مبتنی بر
بازتاب</p>
<p><strong>[104]</strong> تحلیل تأثیر اندازه باینری برای سناریوهای
استقرار</p>
<p><strong>[105]</strong> مشارکت تورم instantiation قالب در اندازه
باینری در کدبیس‌های سنگین قالب</p>
<p><strong>[106]</strong> تأکید دقت آماری و تکرارپذیری در روش‌شناسی
معیارسنجی</p>
<p><strong>[107]</strong> اعتبارسنجی چندپلتفرمه برای تعمیم‌پذیری
نتایج</p>
<p><strong>[108]</strong> مقایسه جامع در ابعاد متعدد</p>
<p><strong>[109]</strong> اندازه‌گیری بهره‌وری توسعه از طریق آزمایش‌های
کنترل شده</p>
<p><strong>[110]</strong> سریال‌سازی به عنوان کار رایج تکراری برنامه‌نویسی
با محدودیت‌های سنتی</p>
<p><strong>[111]</strong> توسعه چارچوب سریال‌سازی جامع با استفاده از
بازتاب و متاکلاس‌های C++23</p>
<p><strong>[112]</strong> ارزیابی کارایی مقایسه چارچوب با راه‌حل‌های
موجود</p>
<p><strong>[113]</strong> نگاشت آبجکت-رابطه‌ای (ORM) حوزه پیچیده که
بازتاب ارزش قابل توجهی ارائه می‌دهد</p>
<p><strong>[114]</strong> رویکردهای اعلانی توسعه GUI مدرن فعال شده توسط
بازتاب C++23</p>
<p><strong>[115]</strong> حوزه تست که بازتاب تولید خودکار تست را
امکان‌پذیر می‌کند</p>
<p><strong>[116]</strong> پیاده‌سازی خودکار الگوهای طراحی پیچیده از طریق
بازتاب</p>
<p><strong>[117]</strong> یکپارچگی concept های C++20 با بازتاب C++23
برای برنامه‌نویسی عمومی ایمن نوع</p>
<p><strong>[118]</strong> تعاریف پیچیده concept بررسی ساختار نوع تا
رابط‌ها</p>
<p><strong>[119]</strong> اعتبارسنجی پیچیده زمان کامپایل از طریق concept
ها و بازتاب ترکیبی</p>
<p><strong>[120]</strong> coroutine های C++20 ترکیب شده با بازتاب C++23
برای تولید خودکار API ناهمزمان</p>
<p><strong>[121]</strong> تولید خودکار جریان‌های رویداد واکنشی از طریق
بازتاب</p>
<p><strong>[122]</strong> ماژول‌های C++20 نیاز به ملاحظات ویژه برای
پشتیبانی بازتاب</p>
<p><strong>[123]</strong> متاکلاس‌ها کار صحیح در مرزهای ماژول</p>
<p><strong>[124]</strong> تقویت range های C++20 با بازتاب برای پردازش
خودکار داده</p>
<p><strong>[125]</strong> تولید adapter range سفارشی بر اساس ساختار
نوع</p>
<p><strong>[126]</strong> تقویت کانتینر کتابخانه استاندارد با عملکرد
مبتنی بر بازتاب</p>
<p><strong>[127]</strong> چالش‌های پیاده‌سازی در frontend های کامپایلر
برای بازتاب C++23</p>
<p><strong>[128]</strong> پیچیدگی‌های instantiation قالب با meta-object
ها طی instantiation</p>
<p><strong>[129]</strong> چالش‌های پیاده‌سازی backend برای تولید کد کارا
از کاربردهای متاکلاس</p>
<p><strong>[130]</strong> چالش‌های بازتاب برای سیستم‌های کامپایل
افزایشی</p>
<p><strong>[131]</strong> چالش‌های دیباگ برای استفاده گسترده از بازتاب و
متاکلاس</p>
<p><strong>[132]</strong> الزامات تقویت IDE مدرن برای پشتیبانی کد مبتنی
بر بازتاب</p>
<p><strong>[133]</strong> دسته‌های جدید پیام‌های خطای پیچیده معرفی شده
توسط بازتاب</p>
<p><strong>[134]</strong> الزامات گزارش خطای تخصصی برای خطاهای
متاکلاس</p>
<p><strong>[135]</strong> اضافه شدن پیچیدگی مفهومی به C++ از طریق بازتاب
و متاکلاس‌ها</p>
<p><strong>[136]</strong> چالش‌های سازمانی در مهاجرت کدبیس‌های موجود به
بازتاب</p>
<p><strong>[137]</strong> چالش‌های ثبات رابط باینری کاربرد (ABI) از
بازتاب و متاکلاس‌ها</p>
<p><strong>[138]</strong> چالش‌های رفتار ثابت در پیاده‌سازی‌های مختلف
کامپایلر</p>
<p><strong>[139]</strong> علاقه فزاینده به گسترش بازتاب استاتیک به
سناریوهای زمان اجرا</p>
<p><strong>[140]</strong> مکانیزم‌های ترکیب متاکلاس پیچیده‌تر در
استانداردهای آینده</p>
<p><strong>[141]</strong> یکپارچگی بهتر بین بازتاب، متاکلاس‌ها و سیستم
ماژول‌ها</p>
<p><strong>[142]</strong> فرصت‌های یادگیری ماشین با متادیتای بازتاب برای
بهینه‌سازی خودکار</p>
<p><strong>[143]</strong> بهینه‌سازی خاص پلتفرم و سازگاری چندپلتفرمه از
طریق بازتاب</p>
<p><strong>[144]</strong> تکامل پشتیبانی محدودیت‌های سیستم بلادرنگ و
تعبیه‌شده</p>
<p><strong>[145]</strong> پشتیبانی پیچیده ابزارهای دیباگ آینده برای کد
مبتنی بر بازتاب</p>
<p><strong>[146]</strong> تکامل IDE برای پشتیبانی جامع بازتاب و
متاکلاس‌ها</p>
<p><strong>[147]</strong> ابزارهای تخصصی برای تحلیل کارایی بازتاب و
متاکلاس</p>
<p><strong>[148]</strong> انتزاع std::meta::info به عنوان پایه محکم حفظ
اصل صفر-overhead</p>
<p><strong>[149]</strong> خودکارسازی متاکلاس 80% کد boilerplate در
سناریوهای رایج</p>
<p><strong>[150]</strong> راه‌حل‌های مبتنی بر بازتاب دستیابی به 40-50%
کاهش زمان کامپایل</p>
<h3 data-number="2.51.4" id="مراجع-151-184-تأثیر-و-جهتهای-آینده"><span
class="header-section-number">2.51.4</span> مراجع [151-184]: تأثیر و
جهت‌های آینده</h3>
<p><strong>[151]</strong> پیشرفت‌های بهره‌وری توسعه اجازه تمرکز بر منطق
خاص حوزه</p>
<p><strong>[152]</strong> ثبات برتر کد تولید شده بازتاب و 70% مسائل کیفی
کمتر</p>
<p><strong>[153]</strong> ملاحظات منحنی یادگیری: 2-3 هفته مهارت برای
توسعه‌دهندگان مدرن C++</p>
<p><strong>[154]</strong> تغییرات بنیادی معماری چارچوب با رویکرد
متاکلاس-اول</p>
<p><strong>[155]</strong> راه‌حل‌های سریال‌سازی جهانی با کارایی بالا مانند
reflection_serializer</p>
<p><strong>[156]</strong> اتصال خودکار خاصیت حذف پیچیدگی در توسعه
کاربرد</p>
<p><strong>[157]</strong> تقویت تحلیل استاتیک با بینش بی‌سابقه ساختار
برنامه</p>
<p><strong>[158]</strong> یکپارچگی سیستم ساخت دستیابی به 20-30% زمان
ساخت سریع‌تر</p>
<p><strong>[159]</strong> تولید خودکار مستندات جامع API</p>
<p><strong>[160]</strong> تدریس برنامه‌نویسی عمومی با 40% درک سریع‌تر
مفهوم</p>
<p><strong>[161]</strong> پذیرش صنعتی در صنایع بحرانی کارایی (بازی،
مالی، تعبیه‌شده)</p>
<p><strong>[162]</strong> شتاب منبع باز و نوآوری در جامعه C++</p>
<p><strong>[163]</strong> اصل مسئولیت واحد در طراحی متاکلاس</p>
<p><strong>[164]</strong> ترکیب‌پذیری در طراحی متاکلاس با رابط‌های
واضح</p>
<p><strong>[165]</strong> آگاهی کارایی در طراحی متاکلاس ترجیح تولید کد
ساده</p>
<p><strong>[166]</strong> مدیریت خطا با پیام‌های خطای واضح قابل اجرا</p>
<p><strong>[167]</strong> ترجیح زمان کامپایل بر رویکردهای زمان اجرا برای
کارایی و ایمنی نوع</p>
<p><strong>[168]</strong> استراتژی کش برای محاسبات گران بازتاب</p>
<p><strong>[169]</strong> ایمنی نوع بهره‌برداری از ویژگی‌های بازتاب برای
جلوگیری از خطاهای متابرنامه‌نویسی</p>
<p><strong>[170]</strong> تست کد تولید شده با مجموعه‌های تست خودکار</p>
<p><strong>[171]</strong> تست رگرسیون کارایی با نظارت مداوم</p>
<p><strong>[172]</strong> اعتبارسنجی چند کامپایلری برای قابلیت حمل در
پیاده‌سازی‌ها</p>
<p><strong>[173]</strong> تکنیک‌های تأیید رسمی برای کد تولید شده
بازتاب</p>
<p><strong>[174]</strong> گسترش‌های تئوری نوع بررسی رابطه بین انواع و
متا-انواع</p>
<p><strong>[175]</strong> تحلیل پیچیدگی پیچیدگی محاسباتی عملیات
بازتاب</p>
<p><strong>[176]</strong> جاسازی زبان‌های خاص حوزه در C++ با استفاده از
بازتاب و متاکلاس‌ها</p>
<p><strong>[177]</strong> بهینه‌سازی خودکار با استفاده از تکنیک‌های
یادگیری ماشین با متادیتای بازتاب</p>
<p><strong>[178]</strong> یکپارچگی بین زبانه تسهیل یکپارچگی بهتر C++ با
سایر زبان‌ها</p>
<p><strong>[179]</strong> تکامل از متابرنامه‌نویسی قالب پیچیده به بازتاب
اعلانی</p>
<p><strong>[180]</strong> پارادایم کد به عنوان داده به شیوه آگاه از
کارایی</p>
<p><strong>[181]</strong> دموکراتیک‌سازی تکنیک‌های پیشرفته قبلاً در دسترس
فقط متخصصان</p>
<p><strong>[182]</strong> نگاه بیست ساله به سمت برنامه‌نویسی مبتنی بر
بازتاب به عنوان هنجار</p>
<p><strong>[183]</strong> یکپارچگی با تکنولوژی‌های نوظهور در سیستم‌های
ناهمگن، توزیع شده، تقویت شده با AI</p>
<p><strong>[184]</strong> تحول آموزشی با معرفی زودتر مفاهیم پیشرفته
برنامه‌نویسی</p>
<hr />
<h2 data-number="2.52" id="آمارهای-خلاصه"><span
class="header-section-number">2.52</span> آمارهای خلاصه</h2>
<ul>
<li><strong>کل مراجع یافت شده:</strong> 184 از 184 ذکر شده</li>
<li><strong>مراجع گمشده:</strong> هیچ - همه مراجع با موفقیت مکان‌یابی و
دسته‌بندی شدند</li>
<li><strong>محدوده مراجع:</strong> [1] تا [184]</li>
<li><strong>پوشش:</strong> شامل تمام 10 بخش مقاله علمی</li>
<li><strong>دسته‌ها:</strong> مبانی و پیشینه (1-50)، چارچوب و طراحی
(51-100)، کارایی و مطالعات موردی (101-150)، تأثیر و آینده (151-184)</li>
</ul>
<h2 data-number="2.53" id="یادداشتها"><span
class="header-section-number">2.53</span> یادداشت‌ها</h2>
<p>این کتابشناسی از طریق تحلیل سیستماتیک تمام فایل‌های markdown انگلیسی
(01-10) حاوی مقاله علمی بازتاب و متاکلاس‌های C++23 استخراج شده است. هر
شماره مرجع مطابق با ارجاعات درون‌خطی یافت شده در سراسر بخش‌های مقاله است.
تمام 184 مرجع با موفقیت مکان‌یابی و دسته‌بندی شده‌اند.</p>
<p>مراجع طیف کاملی از تحقیقات بازتاب و متاکلاس‌های C++23 را پوشش می‌دهند،
از تکامل تاریخی متابرنامه‌نویسی قالب گرفته تا طراحی بازتاب استاتیک مدرن،
تحلیل کارایی، کاربردهای عملی، چالش‌های پیاده‌سازی و جهت‌های تحقیق
آینده.</p>
</body>
</html>
